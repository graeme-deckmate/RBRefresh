(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();function Hm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ym={exports:{}},eu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N1=Symbol.for("react.transitional.element"),w1=Symbol.for("react.fragment");function Fm(e,t,n){var i=null;if(n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),"key"in t){n={};for(var a in t)a!=="key"&&(n[a]=t[a])}else n=t;return t=n.ref,{$$typeof:N1,type:e,key:i,ref:t!==void 0?t:null,props:n}}eu.Fragment=w1;eu.jsx=Fm;eu.jsxs=Fm;Ym.exports=eu;var r=Ym.exports,qm={exports:{}},Fe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ch=Symbol.for("react.transitional.element"),A1=Symbol.for("react.portal"),C1=Symbol.for("react.fragment"),I1=Symbol.for("react.strict_mode"),S1=Symbol.for("react.profiler"),D1=Symbol.for("react.consumer"),R1=Symbol.for("react.context"),k1=Symbol.for("react.forward_ref"),_1=Symbol.for("react.suspense"),O1=Symbol.for("react.memo"),Wm=Symbol.for("react.lazy"),B1=Symbol.for("react.activity"),Qp=Symbol.iterator;function j1(e){return e===null||typeof e!="object"?null:(e=Qp&&e[Qp]||e["@@iterator"],typeof e=="function"?e:null)}var Km={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Vm=Object.assign,Qm={};function zl(e,t,n){this.props=e,this.context=t,this.refs=Qm,this.updater=n||Km}zl.prototype.isReactComponent={};zl.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};zl.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Xm(){}Xm.prototype=zl.prototype;function uh(e,t,n){this.props=e,this.context=t,this.refs=Qm,this.updater=n||Km}var dh=uh.prototype=new Xm;dh.constructor=uh;Vm(dh,zl.prototype);dh.isPureReactComponent=!0;var Xp=Array.isArray;function Qd(){}var Ct={H:null,A:null,T:null,S:null},Zm=Object.prototype.hasOwnProperty;function fh(e,t,n){var i=n.ref;return{$$typeof:ch,type:e,key:t,ref:i!==void 0?i:null,props:n}}function M1(e,t){return fh(e.type,t,e.props)}function hh(e){return typeof e=="object"&&e!==null&&e.$$typeof===ch}function P1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Zp=/\/+/g;function od(e,t){return typeof e=="object"&&e!==null&&e.key!=null?P1(""+e.key):t.toString(36)}function L1(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(Qd,Qd):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function nl(e,t,n,i,a){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var c=!1;if(e===null)c=!0;else switch(l){case"bigint":case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case ch:case A1:c=!0;break;case Wm:return c=e._init,nl(c(e._payload),t,n,i,a)}}if(c)return a=a(e),c=i===""?"."+od(e,0):i,Xp(a)?(n="",c!=null&&(n=c.replace(Zp,"$&/")+"/"),nl(a,t,n,"",function(v){return v})):a!=null&&(hh(a)&&(a=M1(a,n+(a.key==null||e&&e.key===a.key?"":(""+a.key).replace(Zp,"$&/")+"/")+c)),t.push(a)),1;c=0;var u=i===""?".":i+":";if(Xp(e))for(var y=0;y<e.length;y++)i=e[y],l=u+od(i,y),c+=nl(i,t,n,l,a);else if(y=j1(e),typeof y=="function")for(e=y.call(e),y=0;!(i=e.next()).done;)i=i.value,l=u+od(i,y++),c+=nl(i,t,n,l,a);else if(l==="object"){if(typeof e.then=="function")return nl(L1(e),t,n,i,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return c}function Do(e,t,n){if(e==null)return e;var i=[],a=0;return nl(e,i,"","",function(l){return t.call(n,l,a++)}),i}function U1(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Jp=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},$1={map:Do,forEach:function(e,t,n){Do(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Do(e,function(){t++}),t},toArray:function(e){return Do(e,function(t){return t})||[]},only:function(e){if(!hh(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Fe.Activity=B1;Fe.Children=$1;Fe.Component=zl;Fe.Fragment=C1;Fe.Profiler=S1;Fe.PureComponent=uh;Fe.StrictMode=I1;Fe.Suspense=_1;Fe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ct;Fe.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Ct.H.useMemoCache(e)}};Fe.cache=function(e){return function(){return e.apply(null,arguments)}};Fe.cacheSignal=function(){return null};Fe.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var i=Vm({},e.props),a=e.key;if(t!=null)for(l in t.key!==void 0&&(a=""+t.key),t)!Zm.call(t,l)||l==="key"||l==="__self"||l==="__source"||l==="ref"&&t.ref===void 0||(i[l]=t[l]);var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return fh(e.type,a,i)};Fe.createContext=function(e){return e={$$typeof:R1,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:D1,_context:e},e};Fe.createElement=function(e,t,n){var i,a={},l=null;if(t!=null)for(i in t.key!==void 0&&(l=""+t.key),t)Zm.call(t,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(a[i]=t[i]);var c=arguments.length-2;if(c===1)a.children=n;else if(1<c){for(var u=Array(c),y=0;y<c;y++)u[y]=arguments[y+2];a.children=u}if(e&&e.defaultProps)for(i in c=e.defaultProps,c)a[i]===void 0&&(a[i]=c[i]);return fh(e,l,a)};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(e){return{$$typeof:k1,render:e}};Fe.isValidElement=hh;Fe.lazy=function(e){return{$$typeof:Wm,_payload:{_status:-1,_result:e},_init:U1}};Fe.memo=function(e,t){return{$$typeof:O1,type:e,compare:t===void 0?null:t}};Fe.startTransition=function(e){var t=Ct.T,n={};Ct.T=n;try{var i=e(),a=Ct.S;a!==null&&a(n,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(Qd,Jp)}catch(l){Jp(l)}finally{t!==null&&n.types!==null&&(t.types=n.types),Ct.T=t}};Fe.unstable_useCacheRefresh=function(){return Ct.H.useCacheRefresh()};Fe.use=function(e){return Ct.H.use(e)};Fe.useActionState=function(e,t,n){return Ct.H.useActionState(e,t,n)};Fe.useCallback=function(e,t){return Ct.H.useCallback(e,t)};Fe.useContext=function(e){return Ct.H.useContext(e)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(e,t){return Ct.H.useDeferredValue(e,t)};Fe.useEffect=function(e,t){return Ct.H.useEffect(e,t)};Fe.useEffectEvent=function(e){return Ct.H.useEffectEvent(e)};Fe.useId=function(){return Ct.H.useId()};Fe.useImperativeHandle=function(e,t,n){return Ct.H.useImperativeHandle(e,t,n)};Fe.useInsertionEffect=function(e,t){return Ct.H.useInsertionEffect(e,t)};Fe.useLayoutEffect=function(e,t){return Ct.H.useLayoutEffect(e,t)};Fe.useMemo=function(e,t){return Ct.H.useMemo(e,t)};Fe.useOptimistic=function(e,t){return Ct.H.useOptimistic(e,t)};Fe.useReducer=function(e,t,n){return Ct.H.useReducer(e,t,n)};Fe.useRef=function(e){return Ct.H.useRef(e)};Fe.useState=function(e){return Ct.H.useState(e)};Fe.useSyncExternalStore=function(e,t,n){return Ct.H.useSyncExternalStore(e,t,n)};Fe.useTransition=function(){return Ct.H.useTransition()};Fe.version="19.2.4";qm.exports=Fe;var he=qm.exports;const Xd=Hm(he);var Jm={exports:{}},tu={},eg={exports:{}},tg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(V,we){var ve=V.length;V.push(we);e:for(;0<ve;){var Ne=ve-1>>>1,Ce=V[Ne];if(0<a(Ce,we))V[Ne]=we,V[ve]=Ce,ve=Ne;else break e}}function n(V){return V.length===0?null:V[0]}function i(V){if(V.length===0)return null;var we=V[0],ve=V.pop();if(ve!==we){V[0]=ve;e:for(var Ne=0,Ce=V.length,ei=Ce>>>1;Ne<ei;){var F=2*(Ne+1)-1,mi=V[F],jn=F+1,gi=V[jn];if(0>a(mi,ve))jn<Ce&&0>a(gi,mi)?(V[Ne]=gi,V[jn]=ve,Ne=jn):(V[Ne]=mi,V[F]=ve,Ne=F);else if(jn<Ce&&0>a(gi,ve))V[Ne]=gi,V[jn]=ve,Ne=jn;else break e}}return we}function a(V,we){var ve=V.sortIndex-we.sortIndex;return ve!==0?ve:V.id-we.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();e.unstable_now=function(){return c.now()-u}}var y=[],v=[],g=1,E=null,I=3,R=!1,q=!1,J=!1,K=!1,O=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function P(V){for(var we=n(v);we!==null;){if(we.callback===null)i(v);else if(we.startTime<=V)i(v),we.sortIndex=we.expirationTime,t(y,we);else break;we=n(v)}}function ee(V){if(J=!1,P(V),!q)if(n(y)!==null)q=!0,ne||(ne=!0,Ue());else{var we=n(v);we!==null&&_e(ee,we.startTime-V)}}var ne=!1,te=-1,se=5,Q=-1;function ce(){return K?!0:!(e.unstable_now()-Q<se)}function We(){if(K=!1,ne){var V=e.unstable_now();Q=V;var we=!0;try{e:{q=!1,J&&(J=!1,k(te),te=-1),R=!0;var ve=I;try{t:{for(P(V),E=n(y);E!==null&&!(E.expirationTime>V&&ce());){var Ne=E.callback;if(typeof Ne=="function"){E.callback=null,I=E.priorityLevel;var Ce=Ne(E.expirationTime<=V);if(V=e.unstable_now(),typeof Ce=="function"){E.callback=Ce,P(V),we=!0;break t}E===n(y)&&i(y),P(V)}else i(y);E=n(y)}if(E!==null)we=!0;else{var ei=n(v);ei!==null&&_e(ee,ei.startTime-V),we=!1}}break e}finally{E=null,I=ve,R=!1}we=void 0}}finally{we?Ue():ne=!1}}}var Ue;if(typeof j=="function")Ue=function(){j(We)};else if(typeof MessageChannel<"u"){var Ke=new MessageChannel,ze=Ke.port2;Ke.port1.onmessage=We,Ue=function(){ze.postMessage(null)}}else Ue=function(){O(We,0)};function _e(V,we){te=O(function(){V(e.unstable_now())},we)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(V){V.callback=null},e.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<V?Math.floor(1e3/V):5},e.unstable_getCurrentPriorityLevel=function(){return I},e.unstable_next=function(V){switch(I){case 1:case 2:case 3:var we=3;break;default:we=I}var ve=I;I=we;try{return V()}finally{I=ve}},e.unstable_requestPaint=function(){K=!0},e.unstable_runWithPriority=function(V,we){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var ve=I;I=V;try{return we()}finally{I=ve}},e.unstable_scheduleCallback=function(V,we,ve){var Ne=e.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?Ne+ve:Ne):ve=Ne,V){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=ve+Ce,V={id:g++,callback:we,priorityLevel:V,startTime:ve,expirationTime:Ce,sortIndex:-1},ve>Ne?(V.sortIndex=ve,t(v,V),n(y)===null&&V===n(v)&&(J?(k(te),te=-1):J=!0,_e(ee,ve-Ne))):(V.sortIndex=Ce,t(y,V),q||R||(q=!0,ne||(ne=!0,Ue()))),V},e.unstable_shouldYield=ce,e.unstable_wrapCallback=function(V){var we=I;return function(){var ve=I;I=we;try{return V.apply(this,arguments)}finally{I=ve}}}})(tg);eg.exports=tg;var z1=eg.exports,ng={exports:{}},vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G1=he;function ig(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ss(){}var Tn={d:{f:Ss,r:function(){throw Error(ig(522))},D:Ss,C:Ss,L:Ss,m:Ss,X:Ss,S:Ss,M:Ss},p:0,findDOMNode:null},H1=Symbol.for("react.portal");function Y1(e,t,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:H1,key:i==null?null:""+i,children:e,containerInfo:t,implementation:n}}var Tr=G1.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function nu(e,t){if(e==="font")return"";if(typeof t=="string")return t==="use-credentials"?t:""}vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Tn;vn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)throw Error(ig(299));return Y1(e,t,null,n)};vn.flushSync=function(e){var t=Tr.T,n=Tn.p;try{if(Tr.T=null,Tn.p=2,e)return e()}finally{Tr.T=t,Tn.p=n,Tn.d.f()}};vn.preconnect=function(e,t){typeof e=="string"&&(t?(t=t.crossOrigin,t=typeof t=="string"?t==="use-credentials"?t:"":void 0):t=null,Tn.d.C(e,t))};vn.prefetchDNS=function(e){typeof e=="string"&&Tn.d.D(e)};vn.preinit=function(e,t){if(typeof e=="string"&&t&&typeof t.as=="string"){var n=t.as,i=nu(n,t.crossOrigin),a=typeof t.integrity=="string"?t.integrity:void 0,l=typeof t.fetchPriority=="string"?t.fetchPriority:void 0;n==="style"?Tn.d.S(e,typeof t.precedence=="string"?t.precedence:void 0,{crossOrigin:i,integrity:a,fetchPriority:l}):n==="script"&&Tn.d.X(e,{crossOrigin:i,integrity:a,fetchPriority:l,nonce:typeof t.nonce=="string"?t.nonce:void 0})}};vn.preinitModule=function(e,t){if(typeof e=="string")if(typeof t=="object"&&t!==null){if(t.as==null||t.as==="script"){var n=nu(t.as,t.crossOrigin);Tn.d.M(e,{crossOrigin:n,integrity:typeof t.integrity=="string"?t.integrity:void 0,nonce:typeof t.nonce=="string"?t.nonce:void 0})}}else t==null&&Tn.d.M(e)};vn.preload=function(e,t){if(typeof e=="string"&&typeof t=="object"&&t!==null&&typeof t.as=="string"){var n=t.as,i=nu(n,t.crossOrigin);Tn.d.L(e,n,{crossOrigin:i,integrity:typeof t.integrity=="string"?t.integrity:void 0,nonce:typeof t.nonce=="string"?t.nonce:void 0,type:typeof t.type=="string"?t.type:void 0,fetchPriority:typeof t.fetchPriority=="string"?t.fetchPriority:void 0,referrerPolicy:typeof t.referrerPolicy=="string"?t.referrerPolicy:void 0,imageSrcSet:typeof t.imageSrcSet=="string"?t.imageSrcSet:void 0,imageSizes:typeof t.imageSizes=="string"?t.imageSizes:void 0,media:typeof t.media=="string"?t.media:void 0})}};vn.preloadModule=function(e,t){if(typeof e=="string")if(t){var n=nu(t.as,t.crossOrigin);Tn.d.m(e,{as:typeof t.as=="string"&&t.as!=="script"?t.as:void 0,crossOrigin:n,integrity:typeof t.integrity=="string"?t.integrity:void 0})}else Tn.d.m(e)};vn.requestFormReset=function(e){Tn.d.r(e)};vn.unstable_batchedUpdates=function(e,t){return e(t)};vn.useFormState=function(e,t,n){return Tr.H.useFormState(e,t,n)};vn.useFormStatus=function(){return Tr.H.useHostTransitionStatus()};vn.version="19.2.4";function sg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sg)}catch(e){console.error(e)}}sg(),ng.exports=vn;var F1=ng.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xt=z1,ag=he,q1=F1;function le(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function lg(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Jr(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function rg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function og(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ey(e){if(Jr(e)!==e)throw Error(le(188))}function W1(e){var t=e.alternate;if(!t){if(t=Jr(e),t===null)throw Error(le(188));return t!==e?null:e}for(var n=e,i=t;;){var a=n.return;if(a===null)break;var l=a.alternate;if(l===null){if(i=a.return,i!==null){n=i;continue}break}if(a.child===l.child){for(l=a.child;l;){if(l===n)return ey(a),e;if(l===i)return ey(a),t;l=l.sibling}throw Error(le(188))}if(n.return!==i.return)n=a,i=l;else{for(var c=!1,u=a.child;u;){if(u===n){c=!0,n=a,i=l;break}if(u===i){c=!0,i=a,n=l;break}u=u.sibling}if(!c){for(u=l.child;u;){if(u===n){c=!0,n=l,i=a;break}if(u===i){c=!0,i=l,n=a;break}u=u.sibling}if(!c)throw Error(le(189))}}if(n.alternate!==i)throw Error(le(190))}if(n.tag!==3)throw Error(le(188));return n.stateNode.current===n?e:t}function cg(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=cg(e),t!==null)return t;e=e.sibling}return null}var It=Object.assign,K1=Symbol.for("react.element"),Ro=Symbol.for("react.transitional.element"),mr=Symbol.for("react.portal"),ll=Symbol.for("react.fragment"),ug=Symbol.for("react.strict_mode"),Zd=Symbol.for("react.profiler"),dg=Symbol.for("react.consumer"),os=Symbol.for("react.context"),ph=Symbol.for("react.forward_ref"),Jd=Symbol.for("react.suspense"),ef=Symbol.for("react.suspense_list"),yh=Symbol.for("react.memo"),Rs=Symbol.for("react.lazy"),tf=Symbol.for("react.activity"),V1=Symbol.for("react.memo_cache_sentinel"),ty=Symbol.iterator;function cr(e){return e===null||typeof e!="object"?null:(e=ty&&e[ty]||e["@@iterator"],typeof e=="function"?e:null)}var Q1=Symbol.for("react.client.reference");function nf(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Q1?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ll:return"Fragment";case Zd:return"Profiler";case ug:return"StrictMode";case Jd:return"Suspense";case ef:return"SuspenseList";case tf:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case mr:return"Portal";case os:return e.displayName||"Context";case dg:return(e._context.displayName||"Context")+".Consumer";case ph:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case yh:return t=e.displayName||null,t!==null?t:nf(e.type)||"Memo";case Rs:t=e._payload,e=e._init;try{return nf(e(t))}catch{}}return null}var gr=Array.isArray,$e=ag.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ct=q1.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Na={pending:!1,data:null,method:null,action:null},sf=[],rl=-1;function Yi(e){return{current:e}}function rn(e){0>rl||(e.current=sf[rl],sf[rl]=null,rl--)}function Nt(e,t){rl++,sf[rl]=e.current,e.current=t}var Gi=Yi(null),Mr=Yi(null),Gs=Yi(null),Tc=Yi(null);function vc(e,t){switch(Nt(Gs,t),Nt(Mr,e),Nt(Gi,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?rm(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=rm(t),e=k0(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}rn(Gi),Nt(Gi,e)}function Il(){rn(Gi),rn(Mr),rn(Gs)}function af(e){e.memoizedState!==null&&Nt(Tc,e);var t=Gi.current,n=k0(t,e.type);t!==n&&(Nt(Mr,e),Nt(Gi,n))}function Nc(e){Mr.current===e&&(rn(Gi),rn(Mr)),Tc.current===e&&(rn(Tc),Wr._currentValue=Na)}var cd,ny;function ha(e){if(cd===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);cd=t&&t[1]||"",ny=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+cd+e+ny}var ud=!1;function dd(e,t){if(!e||ud)return"";ud=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var E=function(){throw Error()};if(Object.defineProperty(E.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(E,[])}catch(R){var I=R}Reflect.construct(e,[],E)}else{try{E.call()}catch(R){I=R}e.call(E.prototype)}}else{try{throw Error()}catch(R){I=R}(E=e())&&typeof E.catch=="function"&&E.catch(function(){})}}catch(R){if(R&&I&&typeof R.stack=="string")return[R.stack,I.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var l=i.DetermineComponentFrameRoot(),c=l[0],u=l[1];if(c&&u){var y=c.split(`
`),v=u.split(`
`);for(a=i=0;i<y.length&&!y[i].includes("DetermineComponentFrameRoot");)i++;for(;a<v.length&&!v[a].includes("DetermineComponentFrameRoot");)a++;if(i===y.length||a===v.length)for(i=y.length-1,a=v.length-1;1<=i&&0<=a&&y[i]!==v[a];)a--;for(;1<=i&&0<=a;i--,a--)if(y[i]!==v[a]){if(i!==1||a!==1)do if(i--,a--,0>a||y[i]!==v[a]){var g=`
`+y[i].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}while(1<=i&&0<=a);break}}}finally{ud=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?ha(n):""}function X1(e,t){switch(e.tag){case 26:case 27:case 5:return ha(e.type);case 16:return ha("Lazy");case 13:return e.child!==t&&t!==null?ha("Suspense Fallback"):ha("Suspense");case 19:return ha("SuspenseList");case 0:case 15:return dd(e.type,!1);case 11:return dd(e.type.render,!1);case 1:return dd(e.type,!0);case 31:return ha("Activity");default:return""}}function iy(e){try{var t="",n=null;do t+=X1(e,n),n=e,e=e.return;while(e);return t}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var lf=Object.prototype.hasOwnProperty,mh=Xt.unstable_scheduleCallback,fd=Xt.unstable_cancelCallback,Z1=Xt.unstable_shouldYield,J1=Xt.unstable_requestPaint,Kn=Xt.unstable_now,eE=Xt.unstable_getCurrentPriorityLevel,fg=Xt.unstable_ImmediatePriority,hg=Xt.unstable_UserBlockingPriority,wc=Xt.unstable_NormalPriority,tE=Xt.unstable_LowPriority,pg=Xt.unstable_IdlePriority,nE=Xt.log,iE=Xt.unstable_setDisableYieldValue,eo=null,Vn=null;function Ms(e){if(typeof nE=="function"&&iE(e),Vn&&typeof Vn.setStrictMode=="function")try{Vn.setStrictMode(eo,e)}catch{}}var Qn=Math.clz32?Math.clz32:lE,sE=Math.log,aE=Math.LN2;function lE(e){return e>>>=0,e===0?32:31-(sE(e)/aE|0)|0}var ko=256,_o=262144,Oo=4194304;function pa(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function iu(e,t,n){var i=e.pendingLanes;if(i===0)return 0;var a=0,l=e.suspendedLanes,c=e.pingedLanes;e=e.warmLanes;var u=i&134217727;return u!==0?(i=u&~l,i!==0?a=pa(i):(c&=u,c!==0?a=pa(c):n||(n=u&~e,n!==0&&(a=pa(n))))):(u=i&~l,u!==0?a=pa(u):c!==0?a=pa(c):n||(n=i&~e,n!==0&&(a=pa(n)))),a===0?0:t!==0&&t!==a&&!(t&l)&&(l=a&-a,n=t&-t,l>=n||l===32&&(n&4194048)!==0)?t:a}function to(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function rE(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yg(){var e=Oo;return Oo<<=1,!(Oo&62914560)&&(Oo=4194304),e}function hd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function no(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function oE(e,t,n,i,a,l){var c=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var u=e.entanglements,y=e.expirationTimes,v=e.hiddenUpdates;for(n=c&~n;0<n;){var g=31-Qn(n),E=1<<g;u[g]=0,y[g]=-1;var I=v[g];if(I!==null)for(v[g]=null,g=0;g<I.length;g++){var R=I[g];R!==null&&(R.lane&=-536870913)}n&=~E}i!==0&&mg(e,i,0),l!==0&&a===0&&e.tag!==0&&(e.suspendedLanes|=l&~(c&~t))}function mg(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-Qn(t);e.entangledLanes|=t,e.entanglements[i]=e.entanglements[i]|1073741824|n&261930}function gg(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-Qn(n),a=1<<i;a&t|e[i]&t&&(e[i]|=t),n&=~a}}function bg(e,t){var n=t&-t;return n=n&42?1:gh(n),n&(e.suspendedLanes|t)?0:n}function gh(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function bh(e){return e&=-e,2<e?8<e?e&134217727?32:268435456:8:2}function xg(){var e=ct.p;return e!==0?e:(e=window.event,e===void 0?32:G0(e.type))}function sy(e,t){var n=ct.p;try{return ct.p=e,t()}finally{ct.p=n}}var na=Math.random().toString(36).slice(2),fn="__reactFiber$"+na,On="__reactProps$"+na,Gl="__reactContainer$"+na,rf="__reactEvents$"+na,cE="__reactListeners$"+na,uE="__reactHandles$"+na,ay="__reactResources$"+na,io="__reactMarker$"+na;function xh(e){delete e[fn],delete e[On],delete e[rf],delete e[cE],delete e[uE]}function ol(e){var t=e[fn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Gl]||n[fn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=fm(e);e!==null;){if(n=e[fn])return n;e=fm(e)}return t}e=n,n=e.parentNode}return null}function Hl(e){if(e=e[fn]||e[Gl]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function br(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(le(33))}function xl(e){var t=e[ay];return t||(t=e[ay]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function ln(e){e[io]=!0}var Eg=new Set,Tg={};function Ba(e,t){Sl(e,t),Sl(e+"Capture",t)}function Sl(e,t){for(Tg[e]=t,e=0;e<t.length;e++)Eg.add(t[e])}var dE=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ly={},ry={};function fE(e){return lf.call(ry,e)?!0:lf.call(ly,e)?!1:dE.test(e)?ry[e]=!0:(ly[e]=!0,!1)}function tc(e,t,n){if(fE(t))if(n===null)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var i=t.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+n)}}function Bo(e,t,n){if(n===null)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+n)}}function Xi(e,t,n,i){if(i===null)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttributeNS(t,n,""+i)}}function ri(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function vg(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function hE(e,t,n){var i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var a=i.get,l=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(c){n=""+c,l.call(this,c)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(c){n=""+c},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function of(e){if(!e._valueTracker){var t=vg(e)?"checked":"value";e._valueTracker=hE(e,t,""+e[t])}}function Ng(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=vg(e)?e.checked?"true":"false":e.value),e=i,e!==n?(t.setValue(e),!0):!1}function Ac(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var pE=/[\n"\\]/g;function ui(e){return e.replace(pE,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function cf(e,t,n,i,a,l,c,u){e.name="",c!=null&&typeof c!="function"&&typeof c!="symbol"&&typeof c!="boolean"?e.type=c:e.removeAttribute("type"),t!=null?c==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+ri(t)):e.value!==""+ri(t)&&(e.value=""+ri(t)):c!=="submit"&&c!=="reset"||e.removeAttribute("value"),t!=null?uf(e,c,ri(t)):n!=null?uf(e,c,ri(n)):i!=null&&e.removeAttribute("value"),a==null&&l!=null&&(e.defaultChecked=!!l),a!=null&&(e.checked=a&&typeof a!="function"&&typeof a!="symbol"),u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"?e.name=""+ri(u):e.removeAttribute("name")}function wg(e,t,n,i,a,l,c,u){if(l!=null&&typeof l!="function"&&typeof l!="symbol"&&typeof l!="boolean"&&(e.type=l),t!=null||n!=null){if(!(l!=="submit"&&l!=="reset"||t!=null)){of(e);return}n=n!=null?""+ri(n):"",t=t!=null?""+ri(t):n,u||t===e.value||(e.value=t),e.defaultValue=t}i=i??a,i=typeof i!="function"&&typeof i!="symbol"&&!!i,e.checked=u?e.checked:!!i,e.defaultChecked=!!i,c!=null&&typeof c!="function"&&typeof c!="symbol"&&typeof c!="boolean"&&(e.name=c),of(e)}function uf(e,t,n){t==="number"&&Ac(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function El(e,t,n,i){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ri(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,i&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Ag(e,t,n){if(t!=null&&(t=""+ri(t),t!==e.value&&(e.value=t),n==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=n!=null?""+ri(n):""}function Cg(e,t,n,i){if(t==null){if(i!=null){if(n!=null)throw Error(le(92));if(gr(i)){if(1<i.length)throw Error(le(93));i=i[0]}n=i}n==null&&(n=""),t=n}n=ri(t),e.defaultValue=n,i=e.textContent,i===n&&i!==""&&i!==null&&(e.value=i),of(e)}function Dl(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var yE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function oy(e,t,n){var i=t.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?i?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":i?e.setProperty(t,n):typeof n!="number"||n===0||yE.has(t)?t==="float"?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Ig(e,t,n){if(t!=null&&typeof t!="object")throw Error(le(62));if(e=e.style,n!=null){for(var i in n)!n.hasOwnProperty(i)||t!=null&&t.hasOwnProperty(i)||(i.indexOf("--")===0?e.setProperty(i,""):i==="float"?e.cssFloat="":e[i]="");for(var a in t)i=t[a],t.hasOwnProperty(a)&&n[a]!==i&&oy(e,a,i)}else for(var l in t)t.hasOwnProperty(l)&&oy(e,l,t[l])}function Eh(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mE=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gE=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function nc(e){return gE.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function cs(){}var df=null;function Th(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var cl=null,Tl=null;function cy(e){var t=Hl(e);if(t&&(e=t.stateNode)){var n=e[On]||null;e:switch(e=t.stateNode,t.type){case"input":if(cf(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+ui(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var a=i[On]||null;if(!a)throw Error(le(90));cf(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)i=n[t],i.form===e.form&&Ng(i)}break e;case"textarea":Ag(e,n.value,n.defaultValue);break e;case"select":t=n.value,t!=null&&El(e,!!n.multiple,t,!1)}}}var pd=!1;function Sg(e,t,n){if(pd)return e(t,n);pd=!0;try{var i=e(t);return i}finally{if(pd=!1,(cl!==null||Tl!==null)&&(yu(),cl&&(t=cl,e=Tl,Tl=cl=null,cy(t),e)))for(t=0;t<e.length;t++)cy(e[t])}}function Pr(e,t){var n=e.stateNode;if(n===null)return null;var i=n[On]||null;if(i===null)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(le(231,t,typeof n));return n}var ys=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ff=!1;if(ys)try{var ur={};Object.defineProperty(ur,"passive",{get:function(){ff=!0}}),window.addEventListener("test",ur,ur),window.removeEventListener("test",ur,ur)}catch{ff=!1}var Ps=null,vh=null,ic=null;function Dg(){if(ic)return ic;var e,t=vh,n=t.length,i,a="value"in Ps?Ps.value:Ps.textContent,l=a.length;for(e=0;e<n&&t[e]===a[e];e++);var c=n-e;for(i=1;i<=c&&t[n-i]===a[l-i];i++);return ic=a.slice(e,1<i?1-i:void 0)}function sc(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function jo(){return!0}function uy(){return!1}function Bn(e){function t(n,i,a,l,c){this._reactName=n,this._targetInst=a,this.type=i,this.nativeEvent=l,this.target=c,this.currentTarget=null;for(var u in e)e.hasOwnProperty(u)&&(n=e[u],this[u]=n?n(l):l[u]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?jo:uy,this.isPropagationStopped=uy,this}return It(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=jo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=jo)},persist:function(){},isPersistent:jo}),t}var ja={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},su=Bn(ja),so=It({},ja,{view:0,detail:0}),bE=Bn(so),yd,md,dr,au=It({},so,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dr&&(dr&&e.type==="mousemove"?(yd=e.screenX-dr.screenX,md=e.screenY-dr.screenY):md=yd=0,dr=e),yd)},movementY:function(e){return"movementY"in e?e.movementY:md}}),dy=Bn(au),xE=It({},au,{dataTransfer:0}),EE=Bn(xE),TE=It({},so,{relatedTarget:0}),gd=Bn(TE),vE=It({},ja,{animationName:0,elapsedTime:0,pseudoElement:0}),NE=Bn(vE),wE=It({},ja,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),AE=Bn(wE),CE=It({},ja,{data:0}),fy=Bn(CE),IE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},SE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function RE(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=DE[e])?!!t[e]:!1}function Nh(){return RE}var kE=It({},so,{key:function(e){if(e.key){var t=IE[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=sc(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?SE[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nh,charCode:function(e){return e.type==="keypress"?sc(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?sc(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),_E=Bn(kE),OE=It({},au,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hy=Bn(OE),BE=It({},so,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nh}),jE=Bn(BE),ME=It({},ja,{propertyName:0,elapsedTime:0,pseudoElement:0}),PE=Bn(ME),LE=It({},au,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),UE=Bn(LE),$E=It({},ja,{newState:0,oldState:0}),zE=Bn($E),GE=[9,13,27,32],wh=ys&&"CompositionEvent"in window,vr=null;ys&&"documentMode"in document&&(vr=document.documentMode);var HE=ys&&"TextEvent"in window&&!vr,Rg=ys&&(!wh||vr&&8<vr&&11>=vr),py=" ",yy=!1;function kg(e,t){switch(e){case"keyup":return GE.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _g(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ul=!1;function YE(e,t){switch(e){case"compositionend":return _g(t);case"keypress":return t.which!==32?null:(yy=!0,py);case"textInput":return e=t.data,e===py&&yy?null:e;default:return null}}function FE(e,t){if(ul)return e==="compositionend"||!wh&&kg(e,t)?(e=Dg(),ic=vh=Ps=null,ul=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Rg&&t.locale!=="ko"?null:t.data;default:return null}}var qE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function my(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!qE[e.type]:t==="textarea"}function Og(e,t,n,i){cl?Tl?Tl.push(i):Tl=[i]:cl=i,t=Hc(t,"onChange"),0<t.length&&(n=new su("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Nr=null,Lr=null;function WE(e){S0(e,0)}function lu(e){var t=br(e);if(Ng(t))return e}function gy(e,t){if(e==="change")return t}var Bg=!1;if(ys){var bd;if(ys){var xd="oninput"in document;if(!xd){var by=document.createElement("div");by.setAttribute("oninput","return;"),xd=typeof by.oninput=="function"}bd=xd}else bd=!1;Bg=bd&&(!document.documentMode||9<document.documentMode)}function xy(){Nr&&(Nr.detachEvent("onpropertychange",jg),Lr=Nr=null)}function jg(e){if(e.propertyName==="value"&&lu(Lr)){var t=[];Og(t,Lr,e,Th(e)),Sg(WE,t)}}function KE(e,t,n){e==="focusin"?(xy(),Nr=t,Lr=n,Nr.attachEvent("onpropertychange",jg)):e==="focusout"&&xy()}function VE(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return lu(Lr)}function QE(e,t){if(e==="click")return lu(t)}function XE(e,t){if(e==="input"||e==="change")return lu(t)}function ZE(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Zn=typeof Object.is=="function"?Object.is:ZE;function Ur(e,t){if(Zn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var a=n[i];if(!lf.call(t,a)||!Zn(e[a],t[a]))return!1}return!0}function Ey(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ty(e,t){var n=Ey(e);e=0;for(var i;n;){if(n.nodeType===3){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ey(n)}}function Mg(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Mg(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Pg(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Ac(e.document);t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ac(e.document)}return t}function Ah(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var JE=ys&&"documentMode"in document&&11>=document.documentMode,dl=null,hf=null,wr=null,pf=!1;function vy(e,t,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;pf||dl==null||dl!==Ac(i)||(i=dl,"selectionStart"in i&&Ah(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),wr&&Ur(wr,i)||(wr=i,i=Hc(hf,"onSelect"),0<i.length&&(t=new su("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=dl)))}function fa(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var fl={animationend:fa("Animation","AnimationEnd"),animationiteration:fa("Animation","AnimationIteration"),animationstart:fa("Animation","AnimationStart"),transitionrun:fa("Transition","TransitionRun"),transitionstart:fa("Transition","TransitionStart"),transitioncancel:fa("Transition","TransitionCancel"),transitionend:fa("Transition","TransitionEnd")},Ed={},Lg={};ys&&(Lg=document.createElement("div").style,"AnimationEvent"in window||(delete fl.animationend.animation,delete fl.animationiteration.animation,delete fl.animationstart.animation),"TransitionEvent"in window||delete fl.transitionend.transition);function Ma(e){if(Ed[e])return Ed[e];if(!fl[e])return e;var t=fl[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Lg)return Ed[e]=t[n];return e}var Ug=Ma("animationend"),$g=Ma("animationiteration"),zg=Ma("animationstart"),eT=Ma("transitionrun"),tT=Ma("transitionstart"),nT=Ma("transitioncancel"),Gg=Ma("transitionend"),Hg=new Map,yf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yf.push("scrollEnd");function Ai(e,t){Hg.set(e,t),Ba(t,[e])}var Cc=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},li=[],hl=0,Ch=0;function ru(){for(var e=hl,t=Ch=hl=0;t<e;){var n=li[t];li[t++]=null;var i=li[t];li[t++]=null;var a=li[t];li[t++]=null;var l=li[t];if(li[t++]=null,i!==null&&a!==null){var c=i.pending;c===null?a.next=a:(a.next=c.next,c.next=a),i.pending=a}l!==0&&Yg(n,a,l)}}function ou(e,t,n,i){li[hl++]=e,li[hl++]=t,li[hl++]=n,li[hl++]=i,Ch|=i,e.lanes|=i,e=e.alternate,e!==null&&(e.lanes|=i)}function Ih(e,t,n,i){return ou(e,t,n,i),Ic(e)}function Pa(e,t){return ou(e,null,null,t),Ic(e)}function Yg(e,t,n){e.lanes|=n;var i=e.alternate;i!==null&&(i.lanes|=n);for(var a=!1,l=e.return;l!==null;)l.childLanes|=n,i=l.alternate,i!==null&&(i.childLanes|=n),l.tag===22&&(e=l.stateNode,e===null||e._visibility&1||(a=!0)),e=l,l=l.return;return e.tag===3?(l=e.stateNode,a&&t!==null&&(a=31-Qn(n),e=l.hiddenUpdates,i=e[a],i===null?e[a]=[t]:i.push(t),t.lane=n|536870912),l):null}function Ic(e){if(50<Or)throw Or=0,Mf=null,Error(le(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var pl={};function iT(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(e,t,n,i){return new iT(e,t,n,i)}function Sh(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fs(e,t){var n=e.alternate;return n===null?(n=qn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&65011712,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Fg(e,t){e.flags&=65011714;var n=e.alternate;return n===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function ac(e,t,n,i,a,l){var c=0;if(i=e,typeof e=="function")Sh(e)&&(c=1);else if(typeof e=="string")c=ov(e,n,Gi.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case tf:return e=qn(31,n,t,a),e.elementType=tf,e.lanes=l,e;case ll:return wa(n.children,a,l,t);case ug:c=8,a|=24;break;case Zd:return e=qn(12,n,t,a|2),e.elementType=Zd,e.lanes=l,e;case Jd:return e=qn(13,n,t,a),e.elementType=Jd,e.lanes=l,e;case ef:return e=qn(19,n,t,a),e.elementType=ef,e.lanes=l,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case os:c=10;break e;case dg:c=9;break e;case ph:c=11;break e;case yh:c=14;break e;case Rs:c=16,i=null;break e}c=29,n=Error(le(130,e===null?"null":typeof e,"")),i=null}return t=qn(c,n,t,a),t.elementType=e,t.type=i,t.lanes=l,t}function wa(e,t,n,i){return e=qn(7,e,i,t),e.lanes=n,e}function Td(e,t,n){return e=qn(6,e,null,t),e.lanes=n,e}function qg(e){var t=qn(18,null,null,0);return t.stateNode=e,t}function vd(e,t,n){return t=qn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Ny=new WeakMap;function di(e,t){if(typeof e=="object"&&e!==null){var n=Ny.get(e);return n!==void 0?n:(t={value:e,source:t,stack:iy(t)},Ny.set(e,t),t)}return{value:e,source:t,stack:iy(t)}}var yl=[],ml=0,Sc=null,$r=0,oi=[],ci=0,Xs=null,Ui=1,$i="";function as(e,t){yl[ml++]=$r,yl[ml++]=Sc,Sc=e,$r=t}function Wg(e,t,n){oi[ci++]=Ui,oi[ci++]=$i,oi[ci++]=Xs,Xs=e;var i=Ui;e=$i;var a=32-Qn(i)-1;i&=~(1<<a),n+=1;var l=32-Qn(t)+a;if(30<l){var c=a-a%5;l=(i&(1<<c)-1).toString(32),i>>=c,a-=c,Ui=1<<32-Qn(t)+a|n<<a|i,$i=l+e}else Ui=1<<l|n<<a|i,$i=e}function Dh(e){e.return!==null&&(as(e,1),Wg(e,1,0))}function Rh(e){for(;e===Sc;)Sc=yl[--ml],yl[ml]=null,$r=yl[--ml],yl[ml]=null;for(;e===Xs;)Xs=oi[--ci],oi[ci]=null,$i=oi[--ci],oi[ci]=null,Ui=oi[--ci],oi[ci]=null}function Kg(e,t){oi[ci++]=Ui,oi[ci++]=$i,oi[ci++]=Xs,Ui=t.id,$i=t.overflow,Xs=e}var hn=null,At=null,at=!1,Hs=null,fi=!1,mf=Error(le(519));function Zs(e){var t=Error(le(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw zr(di(t,e)),mf}function wy(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[fn]=e,t[On]=i,n){case"dialog":tt("cancel",t),tt("close",t);break;case"iframe":case"object":case"embed":tt("load",t);break;case"video":case"audio":for(n=0;n<Fr.length;n++)tt(Fr[n],t);break;case"source":tt("error",t);break;case"img":case"image":case"link":tt("error",t),tt("load",t);break;case"details":tt("toggle",t);break;case"input":tt("invalid",t),wg(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":tt("invalid",t);break;case"textarea":tt("invalid",t),Cg(t,i.value,i.defaultValue,i.children)}n=i.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||t.textContent===""+n||i.suppressHydrationWarning===!0||R0(t.textContent,n)?(i.popover!=null&&(tt("beforetoggle",t),tt("toggle",t)),i.onScroll!=null&&tt("scroll",t),i.onScrollEnd!=null&&tt("scrollend",t),i.onClick!=null&&(t.onclick=cs),t=!0):t=!1,t||Zs(e,!0)}function Ay(e){for(hn=e.return;hn;)switch(hn.tag){case 5:case 31:case 13:fi=!1;return;case 27:case 3:fi=!0;return;default:hn=hn.return}}function Za(e){if(e!==hn)return!1;if(!at)return Ay(e),at=!0,!1;var t=e.tag,n;if((n=t!==3&&t!==27)&&((n=t===5)&&(n=e.type,n=!(n!=="form"&&n!=="button")||zf(e.type,e.memoizedProps)),n=!n),n&&At&&Zs(e),Ay(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(le(317));At=dm(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(le(317));At=dm(e)}else t===27?(t=At,ia(e.type)?(e=Ff,Ff=null,At=e):At=t):At=hn?pi(e.stateNode.nextSibling):null;return!0}function Da(){At=hn=null,at=!1}function Nd(){var e=Hs;return e!==null&&(Rn===null?Rn=e:Rn.push.apply(Rn,e),Hs=null),e}function zr(e){Hs===null?Hs=[e]:Hs.push(e)}var gf=Yi(null),La=null,us=null;function _s(e,t,n){Nt(gf,t._currentValue),t._currentValue=n}function hs(e){e._currentValue=gf.current,rn(gf)}function bf(e,t,n){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function xf(e,t,n,i){var a=e.child;for(a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){var c=a.child;l=l.firstContext;e:for(;l!==null;){var u=l;l=a;for(var y=0;y<t.length;y++)if(u.context===t[y]){l.lanes|=n,u=l.alternate,u!==null&&(u.lanes|=n),bf(l.return,n,e),i||(c=null);break e}l=u.next}}else if(a.tag===18){if(c=a.return,c===null)throw Error(le(341));c.lanes|=n,l=c.alternate,l!==null&&(l.lanes|=n),bf(c,n,e),c=null}else c=a.child;if(c!==null)c.return=a;else for(c=a;c!==null;){if(c===e){c=null;break}if(a=c.sibling,a!==null){a.return=c.return,c=a;break}c=c.return}a=c}}function Yl(e,t,n,i){e=null;for(var a=t,l=!1;a!==null;){if(!l){if(a.flags&524288)l=!0;else if(a.flags&262144)break}if(a.tag===10){var c=a.alternate;if(c===null)throw Error(le(387));if(c=c.memoizedProps,c!==null){var u=a.type;Zn(a.pendingProps.value,c.value)||(e!==null?e.push(u):e=[u])}}else if(a===Tc.current){if(c=a.alternate,c===null)throw Error(le(387));c.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(e!==null?e.push(Wr):e=[Wr])}a=a.return}e!==null&&xf(t,e,n,i),t.flags|=262144}function Dc(e){for(e=e.firstContext;e!==null;){if(!Zn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ra(e){La=e,us=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function pn(e){return Vg(La,e)}function Mo(e,t){return La===null&&Ra(e),Vg(e,t)}function Vg(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},us===null){if(e===null)throw Error(le(308));us=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else us=us.next=t;return n}var sT=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(n,i){e.push(i)}};this.abort=function(){t.aborted=!0,e.forEach(function(n){return n()})}},aT=Xt.unstable_scheduleCallback,lT=Xt.unstable_NormalPriority,Wt={$$typeof:os,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function kh(){return{controller:new sT,data:new Map,refCount:0}}function ao(e){e.refCount--,e.refCount===0&&aT(lT,function(){e.controller.abort()})}var Ar=null,Ef=0,Rl=0,vl=null;function rT(e,t){if(Ar===null){var n=Ar=[];Ef=0,Rl=np(),vl={status:"pending",value:void 0,then:function(i){n.push(i)}}}return Ef++,t.then(Cy,Cy),t}function Cy(){if(--Ef===0&&Ar!==null){vl!==null&&(vl.status="fulfilled");var e=Ar;Ar=null,Rl=0,vl=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function oT(e,t){var n=[],i={status:"pending",value:null,reason:null,then:function(a){n.push(a)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var a=0;a<n.length;a++)(0,n[a])(t)},function(a){for(i.status="rejected",i.reason=a,a=0;a<n.length;a++)(0,n[a])(void 0)}),i}var Iy=$e.S;$e.S=function(e,t){c0=Kn(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&rT(e,t),Iy!==null&&Iy(e,t)};var Aa=Yi(null);function _h(){var e=Aa.current;return e!==null?e:Et.pooledCache}function lc(e,t){t===null?Nt(Aa,Aa.current):Nt(Aa,t.pool)}function Qg(){var e=_h();return e===null?null:{parent:Wt._currentValue,pool:e}}var Fl=Error(le(460)),Oh=Error(le(474)),cu=Error(le(542)),Rc={then:function(){}};function Sy(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Xg(e,t,n){switch(n=e[n],n===void 0?e.push(t):n!==t&&(t.then(cs,cs),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Ry(e),e;default:if(typeof t.status=="string")t.then(cs,cs);else{if(e=Et,e!==null&&100<e.shellSuspendCounter)throw Error(le(482));e=t,e.status="pending",e.then(function(i){if(t.status==="pending"){var a=t;a.status="fulfilled",a.value=i}},function(i){if(t.status==="pending"){var a=t;a.status="rejected",a.reason=i}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Ry(e),e}throw Ca=t,Fl}}function ya(e){try{var t=e._init;return t(e._payload)}catch(n){throw n!==null&&typeof n=="object"&&typeof n.then=="function"?(Ca=n,Fl):n}}var Ca=null;function Dy(){if(Ca===null)throw Error(le(459));var e=Ca;return Ca=null,e}function Ry(e){if(e===Fl||e===cu)throw Error(le(483))}var Nl=null,Gr=0;function Po(e){var t=Gr;return Gr+=1,Nl===null&&(Nl=[]),Xg(Nl,e,t)}function fr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Lo(e,t){throw t.$$typeof===K1?Error(le(525)):(e=Object.prototype.toString.call(t),Error(le(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Zg(e){function t(O,k){if(e){var j=O.deletions;j===null?(O.deletions=[k],O.flags|=16):j.push(k)}}function n(O,k){if(!e)return null;for(;k!==null;)t(O,k),k=k.sibling;return null}function i(O){for(var k=new Map;O!==null;)O.key!==null?k.set(O.key,O):k.set(O.index,O),O=O.sibling;return k}function a(O,k){return O=fs(O,k),O.index=0,O.sibling=null,O}function l(O,k,j){return O.index=j,e?(j=O.alternate,j!==null?(j=j.index,j<k?(O.flags|=67108866,k):j):(O.flags|=67108866,k)):(O.flags|=1048576,k)}function c(O){return e&&O.alternate===null&&(O.flags|=67108866),O}function u(O,k,j,P){return k===null||k.tag!==6?(k=Td(j,O.mode,P),k.return=O,k):(k=a(k,j),k.return=O,k)}function y(O,k,j,P){var ee=j.type;return ee===ll?g(O,k,j.props.children,P,j.key):k!==null&&(k.elementType===ee||typeof ee=="object"&&ee!==null&&ee.$$typeof===Rs&&ya(ee)===k.type)?(k=a(k,j.props),fr(k,j),k.return=O,k):(k=ac(j.type,j.key,j.props,null,O.mode,P),fr(k,j),k.return=O,k)}function v(O,k,j,P){return k===null||k.tag!==4||k.stateNode.containerInfo!==j.containerInfo||k.stateNode.implementation!==j.implementation?(k=vd(j,O.mode,P),k.return=O,k):(k=a(k,j.children||[]),k.return=O,k)}function g(O,k,j,P,ee){return k===null||k.tag!==7?(k=wa(j,O.mode,P,ee),k.return=O,k):(k=a(k,j),k.return=O,k)}function E(O,k,j){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return k=Td(""+k,O.mode,j),k.return=O,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Ro:return j=ac(k.type,k.key,k.props,null,O.mode,j),fr(j,k),j.return=O,j;case mr:return k=vd(k,O.mode,j),k.return=O,k;case Rs:return k=ya(k),E(O,k,j)}if(gr(k)||cr(k))return k=wa(k,O.mode,j,null),k.return=O,k;if(typeof k.then=="function")return E(O,Po(k),j);if(k.$$typeof===os)return E(O,Mo(O,k),j);Lo(O,k)}return null}function I(O,k,j,P){var ee=k!==null?k.key:null;if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return ee!==null?null:u(O,k,""+j,P);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Ro:return j.key===ee?y(O,k,j,P):null;case mr:return j.key===ee?v(O,k,j,P):null;case Rs:return j=ya(j),I(O,k,j,P)}if(gr(j)||cr(j))return ee!==null?null:g(O,k,j,P,null);if(typeof j.then=="function")return I(O,k,Po(j),P);if(j.$$typeof===os)return I(O,k,Mo(O,j),P);Lo(O,j)}return null}function R(O,k,j,P,ee){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return O=O.get(j)||null,u(k,O,""+P,ee);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Ro:return O=O.get(P.key===null?j:P.key)||null,y(k,O,P,ee);case mr:return O=O.get(P.key===null?j:P.key)||null,v(k,O,P,ee);case Rs:return P=ya(P),R(O,k,j,P,ee)}if(gr(P)||cr(P))return O=O.get(j)||null,g(k,O,P,ee,null);if(typeof P.then=="function")return R(O,k,j,Po(P),ee);if(P.$$typeof===os)return R(O,k,j,Mo(k,P),ee);Lo(k,P)}return null}function q(O,k,j,P){for(var ee=null,ne=null,te=k,se=k=0,Q=null;te!==null&&se<j.length;se++){te.index>se?(Q=te,te=null):Q=te.sibling;var ce=I(O,te,j[se],P);if(ce===null){te===null&&(te=Q);break}e&&te&&ce.alternate===null&&t(O,te),k=l(ce,k,se),ne===null?ee=ce:ne.sibling=ce,ne=ce,te=Q}if(se===j.length)return n(O,te),at&&as(O,se),ee;if(te===null){for(;se<j.length;se++)te=E(O,j[se],P),te!==null&&(k=l(te,k,se),ne===null?ee=te:ne.sibling=te,ne=te);return at&&as(O,se),ee}for(te=i(te);se<j.length;se++)Q=R(te,O,se,j[se],P),Q!==null&&(e&&Q.alternate!==null&&te.delete(Q.key===null?se:Q.key),k=l(Q,k,se),ne===null?ee=Q:ne.sibling=Q,ne=Q);return e&&te.forEach(function(We){return t(O,We)}),at&&as(O,se),ee}function J(O,k,j,P){if(j==null)throw Error(le(151));for(var ee=null,ne=null,te=k,se=k=0,Q=null,ce=j.next();te!==null&&!ce.done;se++,ce=j.next()){te.index>se?(Q=te,te=null):Q=te.sibling;var We=I(O,te,ce.value,P);if(We===null){te===null&&(te=Q);break}e&&te&&We.alternate===null&&t(O,te),k=l(We,k,se),ne===null?ee=We:ne.sibling=We,ne=We,te=Q}if(ce.done)return n(O,te),at&&as(O,se),ee;if(te===null){for(;!ce.done;se++,ce=j.next())ce=E(O,ce.value,P),ce!==null&&(k=l(ce,k,se),ne===null?ee=ce:ne.sibling=ce,ne=ce);return at&&as(O,se),ee}for(te=i(te);!ce.done;se++,ce=j.next())ce=R(te,O,se,ce.value,P),ce!==null&&(e&&ce.alternate!==null&&te.delete(ce.key===null?se:ce.key),k=l(ce,k,se),ne===null?ee=ce:ne.sibling=ce,ne=ce);return e&&te.forEach(function(Ue){return t(O,Ue)}),at&&as(O,se),ee}function K(O,k,j,P){if(typeof j=="object"&&j!==null&&j.type===ll&&j.key===null&&(j=j.props.children),typeof j=="object"&&j!==null){switch(j.$$typeof){case Ro:e:{for(var ee=j.key;k!==null;){if(k.key===ee){if(ee=j.type,ee===ll){if(k.tag===7){n(O,k.sibling),P=a(k,j.props.children),P.return=O,O=P;break e}}else if(k.elementType===ee||typeof ee=="object"&&ee!==null&&ee.$$typeof===Rs&&ya(ee)===k.type){n(O,k.sibling),P=a(k,j.props),fr(P,j),P.return=O,O=P;break e}n(O,k);break}else t(O,k);k=k.sibling}j.type===ll?(P=wa(j.props.children,O.mode,P,j.key),P.return=O,O=P):(P=ac(j.type,j.key,j.props,null,O.mode,P),fr(P,j),P.return=O,O=P)}return c(O);case mr:e:{for(ee=j.key;k!==null;){if(k.key===ee)if(k.tag===4&&k.stateNode.containerInfo===j.containerInfo&&k.stateNode.implementation===j.implementation){n(O,k.sibling),P=a(k,j.children||[]),P.return=O,O=P;break e}else{n(O,k);break}else t(O,k);k=k.sibling}P=vd(j,O.mode,P),P.return=O,O=P}return c(O);case Rs:return j=ya(j),K(O,k,j,P)}if(gr(j))return q(O,k,j,P);if(cr(j)){if(ee=cr(j),typeof ee!="function")throw Error(le(150));return j=ee.call(j),J(O,k,j,P)}if(typeof j.then=="function")return K(O,k,Po(j),P);if(j.$$typeof===os)return K(O,k,Mo(O,j),P);Lo(O,j)}return typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint"?(j=""+j,k!==null&&k.tag===6?(n(O,k.sibling),P=a(k,j),P.return=O,O=P):(n(O,k),P=Td(j,O.mode,P),P.return=O,O=P),c(O)):n(O,k)}return function(O,k,j,P){try{Gr=0;var ee=K(O,k,j,P);return Nl=null,ee}catch(te){if(te===Fl||te===cu)throw te;var ne=qn(29,te,null,O.mode);return ne.lanes=P,ne.return=O,ne}finally{}}}var ka=Zg(!0),Jg=Zg(!1),ks=!1;function Bh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Tf(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ys(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Fs(e,t,n){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,ot&2){var a=i.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),i.pending=t,t=Ic(e),Yg(e,null,n),t}return ou(e,i,t,n),Ic(e)}function Cr(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194048)!==0)){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,gg(e,n)}}function wd(e,t){var n=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var a=null,l=null;if(n=n.firstBaseUpdate,n!==null){do{var c={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};l===null?a=l=c:l=l.next=c,n=n.next}while(n!==null);l===null?a=l=t:l=l.next=t}else a=l=t;n={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:l,shared:i.shared,callbacks:i.callbacks},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var vf=!1;function Ir(){if(vf){var e=vl;if(e!==null)throw e}}function Sr(e,t,n,i){vf=!1;var a=e.updateQueue;ks=!1;var l=a.firstBaseUpdate,c=a.lastBaseUpdate,u=a.shared.pending;if(u!==null){a.shared.pending=null;var y=u,v=y.next;y.next=null,c===null?l=v:c.next=v,c=y;var g=e.alternate;g!==null&&(g=g.updateQueue,u=g.lastBaseUpdate,u!==c&&(u===null?g.firstBaseUpdate=v:u.next=v,g.lastBaseUpdate=y))}if(l!==null){var E=a.baseState;c=0,g=v=y=null,u=l;do{var I=u.lane&-536870913,R=I!==u.lane;if(R?(st&I)===I:(i&I)===I){I!==0&&I===Rl&&(vf=!0),g!==null&&(g=g.next={lane:0,tag:u.tag,payload:u.payload,callback:null,next:null});e:{var q=e,J=u;I=t;var K=n;switch(J.tag){case 1:if(q=J.payload,typeof q=="function"){E=q.call(K,E,I);break e}E=q;break e;case 3:q.flags=q.flags&-65537|128;case 0:if(q=J.payload,I=typeof q=="function"?q.call(K,E,I):q,I==null)break e;E=It({},E,I);break e;case 2:ks=!0}}I=u.callback,I!==null&&(e.flags|=64,R&&(e.flags|=8192),R=a.callbacks,R===null?a.callbacks=[I]:R.push(I))}else R={lane:I,tag:u.tag,payload:u.payload,callback:u.callback,next:null},g===null?(v=g=R,y=E):g=g.next=R,c|=I;if(u=u.next,u===null){if(u=a.shared.pending,u===null)break;R=u,u=R.next,R.next=null,a.lastBaseUpdate=R,a.shared.pending=null}}while(!0);g===null&&(y=E),a.baseState=y,a.firstBaseUpdate=v,a.lastBaseUpdate=g,l===null&&(a.shared.lanes=0),ea|=c,e.lanes=c,e.memoizedState=E}}function eb(e,t){if(typeof e!="function")throw Error(le(191,e));e.call(t)}function tb(e,t){var n=e.callbacks;if(n!==null)for(e.callbacks=null,e=0;e<n.length;e++)eb(n[e],t)}var kl=Yi(null),kc=Yi(0);function ky(e,t){e=xs,Nt(kc,e),Nt(kl,t),xs=e|t.baseLanes}function Nf(){Nt(kc,xs),Nt(kl,kl.current)}function jh(){xs=kc.current,rn(kl),rn(kc)}var Jn=Yi(null),hi=null;function Os(e){var t=e.alternate;Nt($t,$t.current&1),Nt(Jn,e),hi===null&&(t===null||kl.current!==null||t.memoizedState!==null)&&(hi=e)}function wf(e){Nt($t,$t.current),Nt(Jn,e),hi===null&&(hi=e)}function nb(e){e.tag===22?(Nt($t,$t.current),Nt(Jn,e),hi===null&&(hi=e)):Bs()}function Bs(){Nt($t,$t.current),Nt(Jn,Jn.current)}function Fn(e){rn(Jn),hi===e&&(hi=null),rn($t)}var $t=Yi(0);function _c(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||Hf(n)||Yf(n)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ms=0,qe=null,yt=null,Ft=null,Oc=!1,wl=!1,_a=!1,Bc=0,Hr=0,Al=null,cT=0;function Mt(){throw Error(le(321))}function Mh(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Zn(e[n],t[n]))return!1;return!0}function Ph(e,t,n,i,a,l){return ms=l,qe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$e.H=e===null||e.memoizedState===null?Ob:Kh,_a=!1,l=n(i,a),_a=!1,wl&&(l=sb(t,n,i,a)),ib(e),l}function ib(e){$e.H=Yr;var t=yt!==null&&yt.next!==null;if(ms=0,Ft=yt=qe=null,Oc=!1,Hr=0,Al=null,t)throw Error(le(300));e===null||Vt||(e=e.dependencies,e!==null&&Dc(e)&&(Vt=!0))}function sb(e,t,n,i){qe=e;var a=0;do{if(wl&&(Al=null),Hr=0,wl=!1,25<=a)throw Error(le(301));if(a+=1,Ft=yt=null,e.updateQueue!=null){var l=e.updateQueue;l.lastEffect=null,l.events=null,l.stores=null,l.memoCache!=null&&(l.memoCache.index=0)}$e.H=Bb,l=t(n,i)}while(wl);return l}function uT(){var e=$e.H,t=e.useState()[0];return t=typeof t.then=="function"?lo(t):t,e=e.useState()[0],(yt!==null?yt.memoizedState:null)!==e&&(qe.flags|=1024),t}function Lh(){var e=Bc!==0;return Bc=0,e}function Uh(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function $h(e){if(Oc){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Oc=!1}ms=0,Ft=yt=qe=null,wl=!1,Hr=Bc=0,Al=null}function En(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?qe.memoizedState=Ft=e:Ft=Ft.next=e,Ft}function zt(){if(yt===null){var e=qe.alternate;e=e!==null?e.memoizedState:null}else e=yt.next;var t=Ft===null?qe.memoizedState:Ft.next;if(t!==null)Ft=t,yt=e;else{if(e===null)throw qe.alternate===null?Error(le(467)):Error(le(310));yt=e,e={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},Ft===null?qe.memoizedState=Ft=e:Ft=Ft.next=e}return Ft}function uu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function lo(e){var t=Hr;return Hr+=1,Al===null&&(Al=[]),e=Xg(Al,e,t),t=qe,(Ft===null?t.memoizedState:Ft.next)===null&&(t=t.alternate,$e.H=t===null||t.memoizedState===null?Ob:Kh),e}function du(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return lo(e);if(e.$$typeof===os)return pn(e)}throw Error(le(438,String(e)))}function zh(e){var t=null,n=qe.updateQueue;if(n!==null&&(t=n.memoCache),t==null){var i=qe.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(t={data:i.data.map(function(a){return a.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),n===null&&(n=uu(),qe.updateQueue=n),n.memoCache=t,n=t.data[t.index],n===void 0)for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=V1;return t.index++,n}function gs(e,t){return typeof t=="function"?t(e):t}function rc(e){var t=zt();return Gh(t,yt,e)}function Gh(e,t,n){var i=e.queue;if(i===null)throw Error(le(311));i.lastRenderedReducer=n;var a=e.baseQueue,l=i.pending;if(l!==null){if(a!==null){var c=a.next;a.next=l.next,l.next=c}t.baseQueue=a=l,i.pending=null}if(l=e.baseState,a===null)e.memoizedState=l;else{t=a.next;var u=c=null,y=null,v=t,g=!1;do{var E=v.lane&-536870913;if(E!==v.lane?(st&E)===E:(ms&E)===E){var I=v.revertLane;if(I===0)y!==null&&(y=y.next={lane:0,revertLane:0,gesture:null,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),E===Rl&&(g=!0);else if((ms&I)===I){v=v.next,I===Rl&&(g=!0);continue}else E={lane:0,revertLane:v.revertLane,gesture:null,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null},y===null?(u=y=E,c=l):y=y.next=E,qe.lanes|=I,ea|=I;E=v.action,_a&&n(l,E),l=v.hasEagerState?v.eagerState:n(l,E)}else I={lane:E,revertLane:v.revertLane,gesture:v.gesture,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null},y===null?(u=y=I,c=l):y=y.next=I,qe.lanes|=E,ea|=E;v=v.next}while(v!==null&&v!==t);if(y===null?c=l:y.next=u,!Zn(l,e.memoizedState)&&(Vt=!0,g&&(n=vl,n!==null)))throw n;e.memoizedState=l,e.baseState=c,e.baseQueue=y,i.lastRenderedState=l}return a===null&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Ad(e){var t=zt(),n=t.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=e;var i=n.dispatch,a=n.pending,l=t.memoizedState;if(a!==null){n.pending=null;var c=a=a.next;do l=e(l,c.action),c=c.next;while(c!==a);Zn(l,t.memoizedState)||(Vt=!0),t.memoizedState=l,t.baseQueue===null&&(t.baseState=l),n.lastRenderedState=l}return[l,i]}function ab(e,t,n){var i=qe,a=zt(),l=at;if(l){if(n===void 0)throw Error(le(407));n=n()}else n=t();var c=!Zn((yt||a).memoizedState,n);if(c&&(a.memoizedState=n,Vt=!0),a=a.queue,Hh(ob.bind(null,i,a,e),[e]),a.getSnapshot!==t||c||Ft!==null&&Ft.memoizedState.tag&1){if(i.flags|=2048,_l(9,{destroy:void 0},rb.bind(null,i,a,n,t),null),Et===null)throw Error(le(349));l||ms&127||lb(i,t,n)}return n}function lb(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=qe.updateQueue,t===null?(t=uu(),qe.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function rb(e,t,n,i){t.value=n,t.getSnapshot=i,cb(t)&&ub(e)}function ob(e,t,n){return n(function(){cb(t)&&ub(e)})}function cb(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Zn(e,n)}catch{return!0}}function ub(e){var t=Pa(e,2);t!==null&&kn(t,e,2)}function Af(e){var t=En();if(typeof e=="function"){var n=e;if(e=n(),_a){Ms(!0);try{n()}finally{Ms(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:e},t}function db(e,t,n,i){return e.baseState=n,Gh(e,yt,typeof i=="function"?i:gs)}function dT(e,t,n,i,a){if(hu(e))throw Error(le(485));if(e=t.action,e!==null){var l={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(c){l.listeners.push(c)}};$e.T!==null?n(!0):l.isTransition=!1,i(l),n=t.pending,n===null?(l.next=t.pending=l,fb(t,l)):(l.next=n.next,t.pending=n.next=l)}}function fb(e,t){var n=t.action,i=t.payload,a=e.state;if(t.isTransition){var l=$e.T,c={};$e.T=c;try{var u=n(a,i),y=$e.S;y!==null&&y(c,u),_y(e,t,u)}catch(v){Cf(e,t,v)}finally{l!==null&&c.types!==null&&(l.types=c.types),$e.T=l}}else try{l=n(a,i),_y(e,t,l)}catch(v){Cf(e,t,v)}}function _y(e,t,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(i){Oy(e,t,i)},function(i){return Cf(e,t,i)}):Oy(e,t,n)}function Oy(e,t,n){t.status="fulfilled",t.value=n,hb(t),e.state=n,t=e.pending,t!==null&&(n=t.next,n===t?e.pending=null:(n=n.next,t.next=n,fb(e,n)))}function Cf(e,t,n){var i=e.pending;if(e.pending=null,i!==null){i=i.next;do t.status="rejected",t.reason=n,hb(t),t=t.next;while(t!==i)}e.action=null}function hb(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function pb(e,t){return t}function By(e,t){if(at){var n=Et.formState;if(n!==null){e:{var i=qe;if(at){if(At){t:{for(var a=At,l=fi;a.nodeType!==8;){if(!l){a=null;break t}if(a=pi(a.nextSibling),a===null){a=null;break t}}l=a.data,a=l==="F!"||l==="F"?a:null}if(a){At=pi(a.nextSibling),i=a.data==="F!";break e}}Zs(i)}i=!1}i&&(t=n[0])}}return n=En(),n.memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pb,lastRenderedState:t},n.queue=i,n=Rb.bind(null,qe,i),i.dispatch=n,i=Af(!1),l=Wh.bind(null,qe,!1,i.queue),i=En(),a={state:t,dispatch:null,action:e,pending:null},i.queue=a,n=dT.bind(null,qe,a,l,n),a.dispatch=n,i.memoizedState=e,[t,n,!1]}function jy(e){var t=zt();return yb(t,yt,e)}function yb(e,t,n){if(t=Gh(e,t,pb)[0],e=rc(gs)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var i=lo(t)}catch(c){throw c===Fl?cu:c}else i=t;t=zt();var a=t.queue,l=a.dispatch;return n!==t.memoizedState&&(qe.flags|=2048,_l(9,{destroy:void 0},fT.bind(null,a,n),null)),[i,l,e]}function fT(e,t){e.action=t}function My(e){var t=zt(),n=yt;if(n!==null)return yb(t,n,e);zt(),t=t.memoizedState,n=zt();var i=n.queue.dispatch;return n.memoizedState=e,[t,i,!1]}function _l(e,t,n,i){return e={tag:e,create:n,deps:i,inst:t,next:null},t=qe.updateQueue,t===null&&(t=uu(),qe.updateQueue=t),n=t.lastEffect,n===null?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function mb(){return zt().memoizedState}function oc(e,t,n,i){var a=En();qe.flags|=e,a.memoizedState=_l(1|t,{destroy:void 0},n,i===void 0?null:i)}function fu(e,t,n,i){var a=zt();i=i===void 0?null:i;var l=a.memoizedState.inst;yt!==null&&i!==null&&Mh(i,yt.memoizedState.deps)?a.memoizedState=_l(t,l,n,i):(qe.flags|=e,a.memoizedState=_l(1|t,l,n,i))}function Py(e,t){oc(8390656,8,e,t)}function Hh(e,t){fu(2048,8,e,t)}function hT(e){qe.flags|=4;var t=qe.updateQueue;if(t===null)t=uu(),qe.updateQueue=t,t.events=[e];else{var n=t.events;n===null?t.events=[e]:n.push(e)}}function gb(e){var t=zt().memoizedState;return hT({ref:t,nextImpl:e}),function(){if(ot&2)throw Error(le(440));return t.impl.apply(void 0,arguments)}}function bb(e,t){return fu(4,2,e,t)}function xb(e,t){return fu(4,4,e,t)}function Eb(e,t){if(typeof t=="function"){e=e();var n=t(e);return function(){typeof n=="function"?n():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Tb(e,t,n){n=n!=null?n.concat([e]):null,fu(4,4,Eb.bind(null,t,e),n)}function Yh(){}function vb(e,t){var n=zt();t=t===void 0?null:t;var i=n.memoizedState;return t!==null&&Mh(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Nb(e,t){var n=zt();t=t===void 0?null:t;var i=n.memoizedState;if(t!==null&&Mh(t,i[1]))return i[0];if(i=e(),_a){Ms(!0);try{e()}finally{Ms(!1)}}return n.memoizedState=[i,t],i}function Fh(e,t,n){return n===void 0||ms&1073741824&&!(st&261930)?e.memoizedState=t:(e.memoizedState=n,e=d0(),qe.lanes|=e,ea|=e,n)}function wb(e,t,n,i){return Zn(n,t)?n:kl.current!==null?(e=Fh(e,n,i),Zn(e,t)||(Vt=!0),e):!(ms&42)||ms&1073741824&&!(st&261930)?(Vt=!0,e.memoizedState=n):(e=d0(),qe.lanes|=e,ea|=e,t)}function Ab(e,t,n,i,a){var l=ct.p;ct.p=l!==0&&8>l?l:8;var c=$e.T,u={};$e.T=u,Wh(e,!1,t,n);try{var y=a(),v=$e.S;if(v!==null&&v(u,y),y!==null&&typeof y=="object"&&typeof y.then=="function"){var g=oT(y,i);Dr(e,t,g,Xn(e))}else Dr(e,t,i,Xn(e))}catch(E){Dr(e,t,{then:function(){},status:"rejected",reason:E},Xn())}finally{ct.p=l,c!==null&&u.types!==null&&(c.types=u.types),$e.T=c}}function pT(){}function If(e,t,n,i){if(e.tag!==5)throw Error(le(476));var a=Cb(e).queue;Ab(e,a,t,Na,n===null?pT:function(){return Ib(e),n(i)})}function Cb(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:Na,baseState:Na,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:Na},next:null};var n={};return t.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:n},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Ib(e){var t=Cb(e);t.next===null&&(t=e.alternate.memoizedState),Dr(e,t.next.queue,{},Xn())}function qh(){return pn(Wr)}function Sb(){return zt().memoizedState}function Db(){return zt().memoizedState}function yT(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var n=Xn();e=Ys(n);var i=Fs(t,e,n);i!==null&&(kn(i,t,n),Cr(i,t,n)),t={cache:kh()},e.payload=t;return}t=t.return}}function mT(e,t,n){var i=Xn();n={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},hu(e)?kb(t,n):(n=Ih(e,t,n,i),n!==null&&(kn(n,e,i),_b(n,t,i)))}function Rb(e,t,n){var i=Xn();Dr(e,t,n,i)}function Dr(e,t,n,i){var a={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(hu(e))kb(t,a);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=t.lastRenderedReducer,l!==null))try{var c=t.lastRenderedState,u=l(c,n);if(a.hasEagerState=!0,a.eagerState=u,Zn(u,c))return ou(e,t,a,0),Et===null&&ru(),!1}catch{}finally{}if(n=Ih(e,t,a,i),n!==null)return kn(n,e,i),_b(n,t,i),!0}return!1}function Wh(e,t,n,i){if(i={lane:2,revertLane:np(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},hu(e)){if(t)throw Error(le(479))}else t=Ih(e,n,i,2),t!==null&&kn(t,e,2)}function hu(e){var t=e.alternate;return e===qe||t!==null&&t===qe}function kb(e,t){wl=Oc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function _b(e,t,n){if(n&4194048){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,gg(e,n)}}var Yr={readContext:pn,use:du,useCallback:Mt,useContext:Mt,useEffect:Mt,useImperativeHandle:Mt,useLayoutEffect:Mt,useInsertionEffect:Mt,useMemo:Mt,useReducer:Mt,useRef:Mt,useState:Mt,useDebugValue:Mt,useDeferredValue:Mt,useTransition:Mt,useSyncExternalStore:Mt,useId:Mt,useHostTransitionStatus:Mt,useFormState:Mt,useActionState:Mt,useOptimistic:Mt,useMemoCache:Mt,useCacheRefresh:Mt};Yr.useEffectEvent=Mt;var Ob={readContext:pn,use:du,useCallback:function(e,t){return En().memoizedState=[e,t===void 0?null:t],e},useContext:pn,useEffect:Py,useImperativeHandle:function(e,t,n){n=n!=null?n.concat([e]):null,oc(4194308,4,Eb.bind(null,t,e),n)},useLayoutEffect:function(e,t){return oc(4194308,4,e,t)},useInsertionEffect:function(e,t){oc(4,2,e,t)},useMemo:function(e,t){var n=En();t=t===void 0?null:t;var i=e();if(_a){Ms(!0);try{e()}finally{Ms(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=En();if(n!==void 0){var a=n(t);if(_a){Ms(!0);try{n(t)}finally{Ms(!1)}}}else a=t;return i.memoizedState=i.baseState=a,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:a},i.queue=e,e=e.dispatch=mT.bind(null,qe,e),[i.memoizedState,e]},useRef:function(e){var t=En();return e={current:e},t.memoizedState=e},useState:function(e){e=Af(e);var t=e.queue,n=Rb.bind(null,qe,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Yh,useDeferredValue:function(e,t){var n=En();return Fh(n,e,t)},useTransition:function(){var e=Af(!1);return e=Ab.bind(null,qe,e.queue,!0,!1),En().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=qe,a=En();if(at){if(n===void 0)throw Error(le(407));n=n()}else{if(n=t(),Et===null)throw Error(le(349));st&127||lb(i,t,n)}a.memoizedState=n;var l={value:n,getSnapshot:t};return a.queue=l,Py(ob.bind(null,i,l,e),[e]),i.flags|=2048,_l(9,{destroy:void 0},rb.bind(null,i,l,n,t),null),n},useId:function(){var e=En(),t=Et.identifierPrefix;if(at){var n=$i,i=Ui;n=(i&~(1<<32-Qn(i)-1)).toString(32)+n,t="_"+t+"R_"+n,n=Bc++,0<n&&(t+="H"+n.toString(32)),t+="_"}else n=cT++,t="_"+t+"r_"+n.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:qh,useFormState:By,useActionState:By,useOptimistic:function(e){var t=En();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Wh.bind(null,qe,!0,n),n.dispatch=t,[e,t]},useMemoCache:zh,useCacheRefresh:function(){return En().memoizedState=yT.bind(null,qe)},useEffectEvent:function(e){var t=En(),n={impl:e};return t.memoizedState=n,function(){if(ot&2)throw Error(le(440));return n.impl.apply(void 0,arguments)}}},Kh={readContext:pn,use:du,useCallback:vb,useContext:pn,useEffect:Hh,useImperativeHandle:Tb,useInsertionEffect:bb,useLayoutEffect:xb,useMemo:Nb,useReducer:rc,useRef:mb,useState:function(){return rc(gs)},useDebugValue:Yh,useDeferredValue:function(e,t){var n=zt();return wb(n,yt.memoizedState,e,t)},useTransition:function(){var e=rc(gs)[0],t=zt().memoizedState;return[typeof e=="boolean"?e:lo(e),t]},useSyncExternalStore:ab,useId:Sb,useHostTransitionStatus:qh,useFormState:jy,useActionState:jy,useOptimistic:function(e,t){var n=zt();return db(n,yt,e,t)},useMemoCache:zh,useCacheRefresh:Db};Kh.useEffectEvent=gb;var Bb={readContext:pn,use:du,useCallback:vb,useContext:pn,useEffect:Hh,useImperativeHandle:Tb,useInsertionEffect:bb,useLayoutEffect:xb,useMemo:Nb,useReducer:Ad,useRef:mb,useState:function(){return Ad(gs)},useDebugValue:Yh,useDeferredValue:function(e,t){var n=zt();return yt===null?Fh(n,e,t):wb(n,yt.memoizedState,e,t)},useTransition:function(){var e=Ad(gs)[0],t=zt().memoizedState;return[typeof e=="boolean"?e:lo(e),t]},useSyncExternalStore:ab,useId:Sb,useHostTransitionStatus:qh,useFormState:My,useActionState:My,useOptimistic:function(e,t){var n=zt();return yt!==null?db(n,yt,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:zh,useCacheRefresh:Db};Bb.useEffectEvent=gb;function Cd(e,t,n,i){t=e.memoizedState,n=n(i,t),n=n==null?t:It({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Sf={enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Xn(),a=Ys(i);a.payload=t,n!=null&&(a.callback=n),t=Fs(e,a,i),t!==null&&(kn(t,e,i),Cr(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Xn(),a=Ys(i);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=Fs(e,a,i),t!==null&&(kn(t,e,i),Cr(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Xn(),i=Ys(n);i.tag=2,t!=null&&(i.callback=t),t=Fs(e,i,n),t!==null&&(kn(t,e,n),Cr(t,e,n))}};function Ly(e,t,n,i,a,l,c){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,l,c):t.prototype&&t.prototype.isPureReactComponent?!Ur(n,i)||!Ur(a,l):!0}function Uy(e,t,n,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Sf.enqueueReplaceState(t,t.state,null)}function Oa(e,t){var n=t;if("ref"in t){n={};for(var i in t)i!=="ref"&&(n[i]=t[i])}if(e=e.defaultProps){n===t&&(n=It({},n));for(var a in e)n[a]===void 0&&(n[a]=e[a])}return n}function jb(e){Cc(e)}function Mb(e){console.error(e)}function Pb(e){Cc(e)}function jc(e,t){try{var n=e.onUncaughtError;n(t.value,{componentStack:t.stack})}catch(i){setTimeout(function(){throw i})}}function $y(e,t,n){try{var i=e.onCaughtError;i(n.value,{componentStack:n.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function Df(e,t,n){return n=Ys(n),n.tag=3,n.payload={element:null},n.callback=function(){jc(e,t)},n}function Lb(e){return e=Ys(e),e.tag=3,e}function Ub(e,t,n,i){var a=n.type.getDerivedStateFromError;if(typeof a=="function"){var l=i.value;e.payload=function(){return a(l)},e.callback=function(){$y(t,n,i)}}var c=n.stateNode;c!==null&&typeof c.componentDidCatch=="function"&&(e.callback=function(){$y(t,n,i),typeof a!="function"&&(qs===null?qs=new Set([this]):qs.add(this));var u=i.stack;this.componentDidCatch(i.value,{componentStack:u!==null?u:""})})}function gT(e,t,n,i,a){if(n.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(t=n.alternate,t!==null&&Yl(t,n,a,!0),n=Jn.current,n!==null){switch(n.tag){case 31:case 13:return hi===null?$c():n.alternate===null&&Pt===0&&(Pt=3),n.flags&=-257,n.flags|=65536,n.lanes=a,i===Rc?n.flags|=16384:(t=n.updateQueue,t===null?n.updateQueue=new Set([i]):t.add(i),Pd(e,i,a)),!1;case 22:return n.flags|=65536,i===Rc?n.flags|=16384:(t=n.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):(n=t.retryQueue,n===null?t.retryQueue=new Set([i]):n.add(i)),Pd(e,i,a)),!1}throw Error(le(435,n.tag))}return Pd(e,i,a),$c(),!1}if(at)return t=Jn.current,t!==null?(!(t.flags&65536)&&(t.flags|=256),t.flags|=65536,t.lanes=a,i!==mf&&(e=Error(le(422),{cause:i}),zr(di(e,n)))):(i!==mf&&(t=Error(le(423),{cause:i}),zr(di(t,n))),e=e.current.alternate,e.flags|=65536,a&=-a,e.lanes|=a,i=di(i,n),a=Df(e.stateNode,i,a),wd(e,a),Pt!==4&&(Pt=2)),!1;var l=Error(le(520),{cause:i});if(l=di(l,n),_r===null?_r=[l]:_r.push(l),Pt!==4&&(Pt=2),t===null)return!0;i=di(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,e=Df(n.stateNode,i,e),wd(n,e),!1;case 1:if(t=n.type,l=n.stateNode,(n.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||l!==null&&typeof l.componentDidCatch=="function"&&(qs===null||!qs.has(l))))return n.flags|=65536,a&=-a,n.lanes|=a,a=Lb(a),Ub(a,e,n,i),wd(n,a),!1}n=n.return}while(n!==null);return!1}var Vh=Error(le(461)),Vt=!1;function dn(e,t,n,i){t.child=e===null?Jg(t,null,n,i):ka(t,e.child,n,i)}function zy(e,t,n,i,a){n=n.render;var l=t.ref;if("ref"in i){var c={};for(var u in i)u!=="ref"&&(c[u]=i[u])}else c=i;return Ra(t),i=Ph(e,t,n,c,l,a),u=Lh(),e!==null&&!Vt?(Uh(e,t,a),bs(e,t,a)):(at&&u&&Dh(t),t.flags|=1,dn(e,t,i,a),t.child)}function Gy(e,t,n,i,a){if(e===null){var l=n.type;return typeof l=="function"&&!Sh(l)&&l.defaultProps===void 0&&n.compare===null?(t.tag=15,t.type=l,$b(e,t,l,i,a)):(e=ac(n.type,null,i,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(l=e.child,!Qh(e,a)){var c=l.memoizedProps;if(n=n.compare,n=n!==null?n:Ur,n(c,i)&&e.ref===t.ref)return bs(e,t,a)}return t.flags|=1,e=fs(l,i),e.ref=t.ref,e.return=t,t.child=e}function $b(e,t,n,i,a){if(e!==null){var l=e.memoizedProps;if(Ur(l,i)&&e.ref===t.ref)if(Vt=!1,t.pendingProps=i=l,Qh(e,a))e.flags&131072&&(Vt=!0);else return t.lanes=e.lanes,bs(e,t,a)}return Rf(e,t,n,i,a)}function zb(e,t,n,i){var a=i.children,l=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if(t.flags&128){if(l=l!==null?l.baseLanes|n:n,e!==null){for(i=t.child=e.child,a=0;i!==null;)a=a|i.lanes|i.childLanes,i=i.sibling;i=a&~l}else i=0,t.child=null;return Hy(e,t,l,n,i)}if(n&536870912)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&lc(t,l!==null?l.cachePool:null),l!==null?ky(t,l):Nf(),nb(t);else return i=t.lanes=536870912,Hy(e,t,l!==null?l.baseLanes|n:n,n,i)}else l!==null?(lc(t,l.cachePool),ky(t,l),Bs(),t.memoizedState=null):(e!==null&&lc(t,null),Nf(),Bs());return dn(e,t,a,n),t.child}function xr(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Hy(e,t,n,i,a){var l=_h();return l=l===null?null:{parent:Wt._currentValue,pool:l},t.memoizedState={baseLanes:n,cachePool:l},e!==null&&lc(t,null),Nf(),nb(t),e!==null&&Yl(e,t,i,!0),t.childLanes=a,null}function cc(e,t){return t=Mc({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function Yy(e,t,n){return ka(t,e.child,null,n),e=cc(t,t.pendingProps),e.flags|=2,Fn(t),t.memoizedState=null,e}function bT(e,t,n){var i=t.pendingProps,a=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(at){if(i.mode==="hidden")return e=cc(t,i),t.lanes=536870912,xr(null,e);if(wf(t),(e=At)?(e=O0(e,fi),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Xs!==null?{id:Ui,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},n=qg(e),n.return=t,t.child=n,hn=t,At=null)):e=null,e===null)throw Zs(t);return t.lanes=536870912,null}return cc(t,i)}var l=e.memoizedState;if(l!==null){var c=l.dehydrated;if(wf(t),a)if(t.flags&256)t.flags&=-257,t=Yy(e,t,n);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(le(558));else if(Vt||Yl(e,t,n,!1),a=(n&e.childLanes)!==0,Vt||a){if(i=Et,i!==null&&(c=bg(i,n),c!==0&&c!==l.retryLane))throw l.retryLane=c,Pa(e,c),kn(i,e,c),Vh;$c(),t=Yy(e,t,n)}else e=l.treeContext,At=pi(c.nextSibling),hn=t,at=!0,Hs=null,fi=!1,e!==null&&Kg(t,e),t=cc(t,i),t.flags|=4096;return t}return e=fs(e.child,{mode:i.mode,children:i.children}),e.ref=t.ref,t.child=e,e.return=t,e}function uc(e,t){var n=t.ref;if(n===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(le(284));(e===null||e.ref!==n)&&(t.flags|=4194816)}}function Rf(e,t,n,i,a){return Ra(t),n=Ph(e,t,n,i,void 0,a),i=Lh(),e!==null&&!Vt?(Uh(e,t,a),bs(e,t,a)):(at&&i&&Dh(t),t.flags|=1,dn(e,t,n,a),t.child)}function Fy(e,t,n,i,a,l){return Ra(t),t.updateQueue=null,n=sb(t,i,n,a),ib(e),i=Lh(),e!==null&&!Vt?(Uh(e,t,l),bs(e,t,l)):(at&&i&&Dh(t),t.flags|=1,dn(e,t,n,l),t.child)}function qy(e,t,n,i,a){if(Ra(t),t.stateNode===null){var l=pl,c=n.contextType;typeof c=="object"&&c!==null&&(l=pn(c)),l=new n(i,l),t.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Sf,t.stateNode=l,l._reactInternals=t,l=t.stateNode,l.props=i,l.state=t.memoizedState,l.refs={},Bh(t),c=n.contextType,l.context=typeof c=="object"&&c!==null?pn(c):pl,l.state=t.memoizedState,c=n.getDerivedStateFromProps,typeof c=="function"&&(Cd(t,n,c,i),l.state=t.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(c=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),c!==l.state&&Sf.enqueueReplaceState(l,l.state,null),Sr(t,i,l,a),Ir(),l.state=t.memoizedState),typeof l.componentDidMount=="function"&&(t.flags|=4194308),i=!0}else if(e===null){l=t.stateNode;var u=t.memoizedProps,y=Oa(n,u);l.props=y;var v=l.context,g=n.contextType;c=pl,typeof g=="object"&&g!==null&&(c=pn(g));var E=n.getDerivedStateFromProps;g=typeof E=="function"||typeof l.getSnapshotBeforeUpdate=="function",u=t.pendingProps!==u,g||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(u||v!==c)&&Uy(t,l,i,c),ks=!1;var I=t.memoizedState;l.state=I,Sr(t,i,l,a),Ir(),v=t.memoizedState,u||I!==v||ks?(typeof E=="function"&&(Cd(t,n,E,i),v=t.memoizedState),(y=ks||Ly(t,n,y,i,I,v,c))?(g||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=v),l.props=i,l.state=v,l.context=c,i=y):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{l=t.stateNode,Tf(e,t),c=t.memoizedProps,g=Oa(n,c),l.props=g,E=t.pendingProps,I=l.context,v=n.contextType,y=pl,typeof v=="object"&&v!==null&&(y=pn(v)),u=n.getDerivedStateFromProps,(v=typeof u=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==E||I!==y)&&Uy(t,l,i,y),ks=!1,I=t.memoizedState,l.state=I,Sr(t,i,l,a),Ir();var R=t.memoizedState;c!==E||I!==R||ks||e!==null&&e.dependencies!==null&&Dc(e.dependencies)?(typeof u=="function"&&(Cd(t,n,u,i),R=t.memoizedState),(g=ks||Ly(t,n,g,i,I,R,y)||e!==null&&e.dependencies!==null&&Dc(e.dependencies))?(v||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(i,R,y),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(i,R,y)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=R),l.props=i,l.state=R,l.context=y,i=g):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),i=!1)}return l=i,uc(e,t),i=(t.flags&128)!==0,l||i?(l=t.stateNode,n=i&&typeof n.getDerivedStateFromError!="function"?null:l.render(),t.flags|=1,e!==null&&i?(t.child=ka(t,e.child,null,a),t.child=ka(t,null,n,a)):dn(e,t,n,a),t.memoizedState=l.state,e=t.child):e=bs(e,t,a),e}function Wy(e,t,n,i){return Da(),t.flags|=256,dn(e,t,n,i),t.child}var Id={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Sd(e){return{baseLanes:e,cachePool:Qg()}}function Dd(e,t,n){return e=e!==null?e.childLanes&~n:0,t&&(e|=Wn),e}function Gb(e,t,n){var i=t.pendingProps,a=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:($t.current&2)!==0),c&&(a=!0,t.flags&=-129),c=(t.flags&32)!==0,t.flags&=-33,e===null){if(at){if(a?Os(t):Bs(),(e=At)?(e=O0(e,fi),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Xs!==null?{id:Ui,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},n=qg(e),n.return=t,t.child=n,hn=t,At=null)):e=null,e===null)throw Zs(t);return Yf(e)?t.lanes=32:t.lanes=536870912,null}var u=i.children;return i=i.fallback,a?(Bs(),a=t.mode,u=Mc({mode:"hidden",children:u},a),i=wa(i,a,n,null),u.return=t,i.return=t,u.sibling=i,t.child=u,i=t.child,i.memoizedState=Sd(n),i.childLanes=Dd(e,c,n),t.memoizedState=Id,xr(null,i)):(Os(t),kf(t,u))}var y=e.memoizedState;if(y!==null&&(u=y.dehydrated,u!==null)){if(l)t.flags&256?(Os(t),t.flags&=-257,t=Rd(e,t,n)):t.memoizedState!==null?(Bs(),t.child=e.child,t.flags|=128,t=null):(Bs(),u=i.fallback,a=t.mode,i=Mc({mode:"visible",children:i.children},a),u=wa(u,a,n,null),u.flags|=2,i.return=t,u.return=t,i.sibling=u,t.child=i,ka(t,e.child,null,n),i=t.child,i.memoizedState=Sd(n),i.childLanes=Dd(e,c,n),t.memoizedState=Id,t=xr(null,i));else if(Os(t),Yf(u)){if(c=u.nextSibling&&u.nextSibling.dataset,c)var v=c.dgst;c=v,i=Error(le(419)),i.stack="",i.digest=c,zr({value:i,source:null,stack:null}),t=Rd(e,t,n)}else if(Vt||Yl(e,t,n,!1),c=(n&e.childLanes)!==0,Vt||c){if(c=Et,c!==null&&(i=bg(c,n),i!==0&&i!==y.retryLane))throw y.retryLane=i,Pa(e,i),kn(c,e,i),Vh;Hf(u)||$c(),t=Rd(e,t,n)}else Hf(u)?(t.flags|=192,t.child=e.child,t=null):(e=y.treeContext,At=pi(u.nextSibling),hn=t,at=!0,Hs=null,fi=!1,e!==null&&Kg(t,e),t=kf(t,i.children),t.flags|=4096);return t}return a?(Bs(),u=i.fallback,a=t.mode,y=e.child,v=y.sibling,i=fs(y,{mode:"hidden",children:i.children}),i.subtreeFlags=y.subtreeFlags&65011712,v!==null?u=fs(v,u):(u=wa(u,a,n,null),u.flags|=2),u.return=t,i.return=t,i.sibling=u,t.child=i,xr(null,i),i=t.child,u=e.child.memoizedState,u===null?u=Sd(n):(a=u.cachePool,a!==null?(y=Wt._currentValue,a=a.parent!==y?{parent:y,pool:y}:a):a=Qg(),u={baseLanes:u.baseLanes|n,cachePool:a}),i.memoizedState=u,i.childLanes=Dd(e,c,n),t.memoizedState=Id,xr(e.child,i)):(Os(t),n=e.child,e=n.sibling,n=fs(n,{mode:"visible",children:i.children}),n.return=t,n.sibling=null,e!==null&&(c=t.deletions,c===null?(t.deletions=[e],t.flags|=16):c.push(e)),t.child=n,t.memoizedState=null,n)}function kf(e,t){return t=Mc({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Mc(e,t){return e=qn(22,e,null,t),e.lanes=0,e}function Rd(e,t,n){return ka(t,e.child,null,n),e=kf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ky(e,t,n){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),bf(e.return,t,n)}function kd(e,t,n,i,a,l){var c=e.memoizedState;c===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:a,treeForkCount:l}:(c.isBackwards=t,c.rendering=null,c.renderingStartTime=0,c.last=i,c.tail=n,c.tailMode=a,c.treeForkCount=l)}function Hb(e,t,n){var i=t.pendingProps,a=i.revealOrder,l=i.tail;i=i.children;var c=$t.current,u=(c&2)!==0;if(u?(c=c&1|2,t.flags|=128):c&=1,Nt($t,c),dn(e,t,i,n),i=at?$r:0,!u&&e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ky(e,n,t);else if(e.tag===19)Ky(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&_c(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),kd(t,!1,a,n,l,i);break;case"backwards":case"unstable_legacy-backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&_c(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}kd(t,!0,n,null,l,i);break;case"together":kd(t,!1,null,null,void 0,i);break;default:t.memoizedState=null}return t.child}function bs(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),ea|=t.lanes,!(n&t.childLanes))if(e!==null){if(Yl(e,t,n,!1),(n&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(le(153));if(t.child!==null){for(e=t.child,n=fs(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=fs(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Qh(e,t){return e.lanes&t?!0:(e=e.dependencies,!!(e!==null&&Dc(e)))}function xT(e,t,n){switch(t.tag){case 3:vc(t,t.stateNode.containerInfo),_s(t,Wt,e.memoizedState.cache),Da();break;case 27:case 5:af(t);break;case 4:vc(t,t.stateNode.containerInfo);break;case 10:_s(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,wf(t),null;break;case 13:var i=t.memoizedState;if(i!==null)return i.dehydrated!==null?(Os(t),t.flags|=128,null):n&t.child.childLanes?Gb(e,t,n):(Os(t),e=bs(e,t,n),e!==null?e.sibling:null);Os(t);break;case 19:var a=(e.flags&128)!==0;if(i=(n&t.childLanes)!==0,i||(Yl(e,t,n,!1),i=(n&t.childLanes)!==0),a){if(i)return Hb(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Nt($t,$t.current),i)break;return null;case 22:return t.lanes=0,zb(e,t,n,t.pendingProps);case 24:_s(t,Wt,e.memoizedState.cache)}return bs(e,t,n)}function Yb(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps)Vt=!0;else{if(!Qh(e,n)&&!(t.flags&128))return Vt=!1,xT(e,t,n);Vt=!!(e.flags&131072)}else Vt=!1,at&&t.flags&1048576&&Wg(t,$r,t.index);switch(t.lanes=0,t.tag){case 16:e:{var i=t.pendingProps;if(e=ya(t.elementType),t.type=e,typeof e=="function")Sh(e)?(i=Oa(e,i),t.tag=1,t=qy(null,t,e,i,n)):(t.tag=0,t=Rf(null,t,e,i,n));else{if(e!=null){var a=e.$$typeof;if(a===ph){t.tag=11,t=zy(null,t,e,i,n);break e}else if(a===yh){t.tag=14,t=Gy(null,t,e,i,n);break e}}throw t=nf(e)||e,Error(le(306,t,""))}}return t;case 0:return Rf(e,t,t.type,t.pendingProps,n);case 1:return i=t.type,a=Oa(i,t.pendingProps),qy(e,t,i,a,n);case 3:e:{if(vc(t,t.stateNode.containerInfo),e===null)throw Error(le(387));i=t.pendingProps;var l=t.memoizedState;a=l.element,Tf(e,t),Sr(t,i,null,n);var c=t.memoizedState;if(i=c.cache,_s(t,Wt,i),i!==l.cache&&xf(t,[Wt],n,!0),Ir(),i=c.element,l.isDehydrated)if(l={element:i,isDehydrated:!1,cache:c.cache},t.updateQueue.baseState=l,t.memoizedState=l,t.flags&256){t=Wy(e,t,i,n);break e}else if(i!==a){a=di(Error(le(424)),t),zr(a),t=Wy(e,t,i,n);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(At=pi(e.firstChild),hn=t,at=!0,Hs=null,fi=!0,n=Jg(t,null,i,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(Da(),i===a){t=bs(e,t,n);break e}dn(e,t,i,n)}t=t.child}return t;case 26:return uc(e,t),e===null?(n=pm(t.type,null,t.pendingProps,null))?t.memoizedState=n:at||(n=t.type,e=t.pendingProps,i=Yc(Gs.current).createElement(n),i[fn]=t,i[On]=e,yn(i,n,e),ln(i),t.stateNode=i):t.memoizedState=pm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return af(t),e===null&&at&&(i=t.stateNode=B0(t.type,t.pendingProps,Gs.current),hn=t,fi=!0,a=At,ia(t.type)?(Ff=a,At=pi(i.firstChild)):At=a),dn(e,t,t.pendingProps.children,n),uc(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&at&&((a=i=At)&&(i=VT(i,t.type,t.pendingProps,fi),i!==null?(t.stateNode=i,hn=t,At=pi(i.firstChild),fi=!1,a=!0):a=!1),a||Zs(t)),af(t),a=t.type,l=t.pendingProps,c=e!==null?e.memoizedProps:null,i=l.children,zf(a,l)?i=null:c!==null&&zf(a,c)&&(t.flags|=32),t.memoizedState!==null&&(a=Ph(e,t,uT,null,null,n),Wr._currentValue=a),uc(e,t),dn(e,t,i,n),t.child;case 6:return e===null&&at&&((e=n=At)&&(n=QT(n,t.pendingProps,fi),n!==null?(t.stateNode=n,hn=t,At=null,e=!0):e=!1),e||Zs(t)),null;case 13:return Gb(e,t,n);case 4:return vc(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=ka(t,null,i,n):dn(e,t,i,n),t.child;case 11:return zy(e,t,t.type,t.pendingProps,n);case 7:return dn(e,t,t.pendingProps,n),t.child;case 8:return dn(e,t,t.pendingProps.children,n),t.child;case 12:return dn(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,_s(t,t.type,i.value),dn(e,t,i.children,n),t.child;case 9:return a=t.type._context,i=t.pendingProps.children,Ra(t),a=pn(a),i=i(a),t.flags|=1,dn(e,t,i,n),t.child;case 14:return Gy(e,t,t.type,t.pendingProps,n);case 15:return $b(e,t,t.type,t.pendingProps,n);case 19:return Hb(e,t,n);case 31:return bT(e,t,n);case 22:return zb(e,t,n,t.pendingProps);case 24:return Ra(t),i=pn(Wt),e===null?(a=_h(),a===null&&(a=Et,l=kh(),a.pooledCache=l,l.refCount++,l!==null&&(a.pooledCacheLanes|=n),a=l),t.memoizedState={parent:i,cache:a},Bh(t),_s(t,Wt,a)):(e.lanes&n&&(Tf(e,t),Sr(t,null,null,n),Ir()),a=e.memoizedState,l=t.memoizedState,a.parent!==i?(a={parent:i,cache:i},t.memoizedState=a,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=a),_s(t,Wt,i)):(i=l.cache,_s(t,Wt,i),i!==a.cache&&xf(t,[Wt],n,!0))),dn(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(le(156,t.tag))}function Zi(e){e.flags|=4}function _d(e,t,n,i,a){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(a&335544128)===a)if(e.stateNode.complete)e.flags|=8192;else if(p0())e.flags|=8192;else throw Ca=Rc,Oh}else e.flags&=-16777217}function Vy(e,t){if(t.type!=="stylesheet"||t.state.loading&4)e.flags&=-16777217;else if(e.flags|=16777216,!P0(t))if(p0())e.flags|=8192;else throw Ca=Rc,Oh}function Uo(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?yg():536870912,e.lanes|=t,Ol|=t)}function hr(e,t){if(!at)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function wt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,i=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,i|=a.subtreeFlags&65011712,i|=a.flags&65011712,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function ET(e,t,n){var i=t.pendingProps;switch(Rh(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wt(t),null;case 1:return wt(t),null;case 3:return n=t.stateNode,i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),hs(Wt),Il(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Za(t)?Zi(t):e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Nd())),wt(t),null;case 26:var a=t.type,l=t.memoizedState;return e===null?(Zi(t),l!==null?(wt(t),Vy(t,l)):(wt(t),_d(t,a,null,i,n))):l?l!==e.memoizedState?(Zi(t),wt(t),Vy(t,l)):(wt(t),t.flags&=-16777217):(e=e.memoizedProps,e!==i&&Zi(t),wt(t),_d(t,a,e,i,n)),null;case 27:if(Nc(t),n=Gs.current,a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==i&&Zi(t);else{if(!i){if(t.stateNode===null)throw Error(le(166));return wt(t),null}e=Gi.current,Za(t)?wy(t):(e=B0(a,i,n),t.stateNode=e,Zi(t))}return wt(t),null;case 5:if(Nc(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==i&&Zi(t);else{if(!i){if(t.stateNode===null)throw Error(le(166));return wt(t),null}if(l=Gi.current,Za(t))wy(t);else{var c=Yc(Gs.current);switch(l){case 1:l=c.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:l=c.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":l=c.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":l=c.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":l=c.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof i.is=="string"?c.createElement("select",{is:i.is}):c.createElement("select"),i.multiple?l.multiple=!0:i.size&&(l.size=i.size);break;default:l=typeof i.is=="string"?c.createElement(a,{is:i.is}):c.createElement(a)}}l[fn]=t,l[On]=i;e:for(c=t.child;c!==null;){if(c.tag===5||c.tag===6)l.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break e;for(;c.sibling===null;){if(c.return===null||c.return===t)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}t.stateNode=l;e:switch(yn(l,a,i),a){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Zi(t)}}return wt(t),_d(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==i&&Zi(t);else{if(typeof i!="string"&&t.stateNode===null)throw Error(le(166));if(e=Gs.current,Za(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,a=hn,a!==null)switch(a.tag){case 27:case 5:i=a.memoizedProps}e[fn]=t,e=!!(e.nodeValue===n||i!==null&&i.suppressHydrationWarning===!0||R0(e.nodeValue,n)),e||Zs(t,!0)}else e=Yc(e).createTextNode(i),e[fn]=t,t.stateNode=e}return wt(t),null;case 31:if(n=t.memoizedState,e===null||e.memoizedState!==null){if(i=Za(t),n!==null){if(e===null){if(!i)throw Error(le(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(le(557));e[fn]=t}else Da(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;wt(t),e=!1}else n=Nd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return t.flags&256?(Fn(t),t):(Fn(t),null);if(t.flags&128)throw Error(le(558))}return wt(t),null;case 13:if(i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(a=Za(t),i!==null&&i.dehydrated!==null){if(e===null){if(!a)throw Error(le(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(le(317));a[fn]=t}else Da(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;wt(t),a=!1}else a=Nd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return t.flags&256?(Fn(t),t):(Fn(t),null)}return Fn(t),t.flags&128?(t.lanes=n,t):(n=i!==null,e=e!==null&&e.memoizedState!==null,n&&(i=t.child,a=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(a=i.alternate.memoizedState.cachePool.pool),l=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),l!==a&&(i.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),Uo(t,t.updateQueue),wt(t),null);case 4:return Il(),e===null&&ip(t.stateNode.containerInfo),wt(t),null;case 10:return hs(t.type),wt(t),null;case 19:if(rn($t),i=t.memoizedState,i===null)return wt(t),null;if(a=(t.flags&128)!==0,l=i.rendering,l===null)if(a)hr(i,!1);else{if(Pt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=_c(e),l!==null){for(t.flags|=128,hr(i,!1),e=l.updateQueue,t.updateQueue=e,Uo(t,e),t.subtreeFlags=0,e=n,n=t.child;n!==null;)Fg(n,e),n=n.sibling;return Nt($t,$t.current&1|2),at&&as(t,i.treeForkCount),t.child}e=e.sibling}i.tail!==null&&Kn()>Lc&&(t.flags|=128,a=!0,hr(i,!1),t.lanes=4194304)}else{if(!a)if(e=_c(l),e!==null){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,Uo(t,e),hr(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!at)return wt(t),null}else 2*Kn()-i.renderingStartTime>Lc&&n!==536870912&&(t.flags|=128,a=!0,hr(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(e=i.last,e!==null?e.sibling=l:t.child=l,i.last=l)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Kn(),e.sibling=null,n=$t.current,Nt($t,a?n&1|2:n&1),at&&as(t,i.treeForkCount),e):(wt(t),null);case 22:case 23:return Fn(t),jh(),i=t.memoizedState!==null,e!==null?e.memoizedState!==null!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?n&536870912&&!(t.flags&128)&&(wt(t),t.subtreeFlags&6&&(t.flags|=8192)):wt(t),n=t.updateQueue,n!==null&&Uo(t,n.retryQueue),n=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),i=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),e!==null&&rn(Aa),null;case 24:return n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),hs(Wt),wt(t),null;case 25:return null;case 30:return null}throw Error(le(156,t.tag))}function TT(e,t){switch(Rh(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return hs(Wt),Il(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Nc(t),null;case 31:if(t.memoizedState!==null){if(Fn(t),t.alternate===null)throw Error(le(340));Da()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(Fn(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(le(340));Da()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return rn($t),null;case 4:return Il(),null;case 10:return hs(t.type),null;case 22:case 23:return Fn(t),jh(),e!==null&&rn(Aa),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return hs(Wt),null;case 25:return null;default:return null}}function Fb(e,t){switch(Rh(t),t.tag){case 3:hs(Wt),Il();break;case 26:case 27:case 5:Nc(t);break;case 4:Il();break;case 31:t.memoizedState!==null&&Fn(t);break;case 13:Fn(t);break;case 19:rn($t);break;case 10:hs(t.type);break;case 22:case 23:Fn(t),jh(),e!==null&&rn(Aa);break;case 24:hs(Wt)}}function ro(e,t){try{var n=t.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var a=i.next;n=a;do{if((n.tag&e)===e){i=void 0;var l=n.create,c=n.inst;i=l(),c.destroy=i}n=n.next}while(n!==a)}}catch(u){ht(t,t.return,u)}}function Js(e,t,n){try{var i=t.updateQueue,a=i!==null?i.lastEffect:null;if(a!==null){var l=a.next;i=l;do{if((i.tag&e)===e){var c=i.inst,u=c.destroy;if(u!==void 0){c.destroy=void 0,a=t;var y=n,v=u;try{v()}catch(g){ht(a,y,g)}}}i=i.next}while(i!==l)}}catch(g){ht(t,t.return,g)}}function qb(e){var t=e.updateQueue;if(t!==null){var n=e.stateNode;try{tb(t,n)}catch(i){ht(e,e.return,i)}}}function Wb(e,t,n){n.props=Oa(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){ht(e,t,i)}}function Rr(e,t){try{var n=e.ref;if(n!==null){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;case 30:i=e.stateNode;break;default:i=e.stateNode}typeof n=="function"?e.refCleanup=n(i):n.current=i}}catch(a){ht(e,t,a)}}function zi(e,t){var n=e.ref,i=e.refCleanup;if(n!==null)if(typeof i=="function")try{i()}catch(a){ht(e,t,a)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(a){ht(e,t,a)}else n.current=null}function Kb(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(a){ht(e,e.return,a)}}function Od(e,t,n){try{var i=e.stateNode;HT(i,e.type,n,t),i[On]=t}catch(a){ht(e,e.return,a)}}function Vb(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ia(e.type)||e.tag===4}function Bd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Vb(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ia(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function _f(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(e,t):(t=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,t.appendChild(e),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=cs));else if(i!==4&&(i===27&&ia(e.type)&&(n=e.stateNode,t=null),e=e.child,e!==null))for(_f(e,t,n),e=e.sibling;e!==null;)_f(e,t,n),e=e.sibling}function Pc(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(i!==4&&(i===27&&ia(e.type)&&(n=e.stateNode),e=e.child,e!==null))for(Pc(e,t,n),e=e.sibling;e!==null;)Pc(e,t,n),e=e.sibling}function Qb(e){var t=e.stateNode,n=e.memoizedProps;try{for(var i=e.type,a=t.attributes;a.length;)t.removeAttributeNode(a[0]);yn(t,i,n),t[fn]=e,t[On]=n}catch(l){ht(e,e.return,l)}}var ls=!1,qt=!1,jd=!1,Qy=typeof WeakSet=="function"?WeakSet:Set,sn=null;function vT(e,t){if(e=e.containerInfo,Uf=Kc,e=Pg(e),Ah(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var a=i.anchorOffset,l=i.focusNode;i=i.focusOffset;try{n.nodeType,l.nodeType}catch{n=null;break e}var c=0,u=-1,y=-1,v=0,g=0,E=e,I=null;t:for(;;){for(var R;E!==n||a!==0&&E.nodeType!==3||(u=c+a),E!==l||i!==0&&E.nodeType!==3||(y=c+i),E.nodeType===3&&(c+=E.nodeValue.length),(R=E.firstChild)!==null;)I=E,E=R;for(;;){if(E===e)break t;if(I===n&&++v===a&&(u=c),I===l&&++g===i&&(y=c),(R=E.nextSibling)!==null)break;E=I,I=E.parentNode}E=R}n=u===-1||y===-1?null:{start:u,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for($f={focusedElem:e,selectionRange:n},Kc=!1,sn=t;sn!==null;)if(t=sn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,sn=e;else for(;sn!==null;){switch(t=sn,l=t.alternate,e=t.flags,t.tag){case 0:if(e&4&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(n=0;n<e.length;n++)a=e[n],a.ref.impl=a.nextImpl;break;case 11:case 15:break;case 1:if(e&1024&&l!==null){e=void 0,n=t,a=l.memoizedProps,l=l.memoizedState,i=n.stateNode;try{var q=Oa(n.type,a);e=i.getSnapshotBeforeUpdate(q,l),i.__reactInternalSnapshotBeforeUpdate=e}catch(J){ht(n,n.return,J)}}break;case 3:if(e&1024){if(e=t.stateNode.containerInfo,n=e.nodeType,n===9)Gf(e);else if(n===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Gf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(e&1024)throw Error(le(163))}if(e=t.sibling,e!==null){e.return=t.return,sn=e;break}sn=t.return}}function Xb(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:es(e,n),i&4&&ro(5,n);break;case 1:if(es(e,n),i&4)if(e=n.stateNode,t===null)try{e.componentDidMount()}catch(c){ht(n,n.return,c)}else{var a=Oa(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(a,t,e.__reactInternalSnapshotBeforeUpdate)}catch(c){ht(n,n.return,c)}}i&64&&qb(n),i&512&&Rr(n,n.return);break;case 3:if(es(e,n),i&64&&(e=n.updateQueue,e!==null)){if(t=null,n.child!==null)switch(n.child.tag){case 27:case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}try{tb(e,t)}catch(c){ht(n,n.return,c)}}break;case 27:t===null&&i&4&&Qb(n);case 26:case 5:es(e,n),t===null&&i&4&&Kb(n),i&512&&Rr(n,n.return);break;case 12:es(e,n);break;case 31:es(e,n),i&4&&e0(e,n);break;case 13:es(e,n),i&4&&t0(e,n),i&64&&(e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(n=kT.bind(null,n),XT(e,n))));break;case 22:if(i=n.memoizedState!==null||ls,!i){t=t!==null&&t.memoizedState!==null||qt,a=ls;var l=qt;ls=i,(qt=t)&&!l?ts(e,n,(n.subtreeFlags&8772)!==0):es(e,n),ls=a,qt=l}break;case 30:break;default:es(e,n)}}function Zb(e){var t=e.alternate;t!==null&&(e.alternate=null,Zb(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&xh(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var kt=null,Dn=!1;function Ji(e,t,n){for(n=n.child;n!==null;)Jb(e,t,n),n=n.sibling}function Jb(e,t,n){if(Vn&&typeof Vn.onCommitFiberUnmount=="function")try{Vn.onCommitFiberUnmount(eo,n)}catch{}switch(n.tag){case 26:qt||zi(n,t),Ji(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:qt||zi(n,t);var i=kt,a=Dn;ia(n.type)&&(kt=n.stateNode,Dn=!1),Ji(e,t,n),Br(n.stateNode),kt=i,Dn=a;break;case 5:qt||zi(n,t);case 6:if(i=kt,a=Dn,kt=null,Ji(e,t,n),kt=i,Dn=a,kt!==null)if(Dn)try{(kt.nodeType===9?kt.body:kt.nodeName==="HTML"?kt.ownerDocument.body:kt).removeChild(n.stateNode)}catch(l){ht(n,t,l)}else try{kt.removeChild(n.stateNode)}catch(l){ht(n,t,l)}break;case 18:kt!==null&&(Dn?(e=kt,cm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,n.stateNode),Pl(e)):cm(kt,n.stateNode));break;case 4:i=kt,a=Dn,kt=n.stateNode.containerInfo,Dn=!0,Ji(e,t,n),kt=i,Dn=a;break;case 0:case 11:case 14:case 15:Js(2,n,t),qt||Js(4,n,t),Ji(e,t,n);break;case 1:qt||(zi(n,t),i=n.stateNode,typeof i.componentWillUnmount=="function"&&Wb(n,t,i)),Ji(e,t,n);break;case 21:Ji(e,t,n);break;case 22:qt=(i=qt)||n.memoizedState!==null,Ji(e,t,n),qt=i;break;default:Ji(e,t,n)}}function e0(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Pl(e)}catch(n){ht(t,t.return,n)}}}function t0(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Pl(e)}catch(n){ht(t,t.return,n)}}function NT(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Qy),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Qy),t;default:throw Error(le(435,e.tag))}}function $o(e,t){var n=NT(e);t.forEach(function(i){if(!n.has(i)){n.add(i);var a=_T.bind(null,e,i);i.then(a,a)}})}function Cn(e,t){var n=t.deletions;if(n!==null)for(var i=0;i<n.length;i++){var a=n[i],l=e,c=t,u=c;e:for(;u!==null;){switch(u.tag){case 27:if(ia(u.type)){kt=u.stateNode,Dn=!1;break e}break;case 5:kt=u.stateNode,Dn=!1;break e;case 3:case 4:kt=u.stateNode.containerInfo,Dn=!0;break e}u=u.return}if(kt===null)throw Error(le(160));Jb(l,c,a),kt=null,Dn=!1,l=a.alternate,l!==null&&(l.return=null),a.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)n0(t,e),t=t.sibling}var wi=null;function n0(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Cn(t,e),In(e),i&4&&(Js(3,e,e.return),ro(3,e),Js(5,e,e.return));break;case 1:Cn(t,e),In(e),i&512&&(qt||n===null||zi(n,n.return)),i&64&&ls&&(e=e.updateQueue,e!==null&&(i=e.callbacks,i!==null&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=n===null?i:n.concat(i))));break;case 26:var a=wi;if(Cn(t,e),In(e),i&512&&(qt||n===null||zi(n,n.return)),i&4){var l=n!==null?n.memoizedState:null;if(i=e.memoizedState,n===null)if(i===null)if(e.stateNode===null){e:{i=e.type,n=e.memoizedProps,a=a.ownerDocument||a;t:switch(i){case"title":l=a.getElementsByTagName("title")[0],(!l||l[io]||l[fn]||l.namespaceURI==="http://www.w3.org/2000/svg"||l.hasAttribute("itemprop"))&&(l=a.createElement(i),a.head.insertBefore(l,a.querySelector("head > title"))),yn(l,i,n),l[fn]=e,ln(l),i=l;break e;case"link":var c=mm("link","href",a).get(i+(n.href||""));if(c){for(var u=0;u<c.length;u++)if(l=c[u],l.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&l.getAttribute("rel")===(n.rel==null?null:n.rel)&&l.getAttribute("title")===(n.title==null?null:n.title)&&l.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){c.splice(u,1);break t}}l=a.createElement(i),yn(l,i,n),a.head.appendChild(l);break;case"meta":if(c=mm("meta","content",a).get(i+(n.content||""))){for(u=0;u<c.length;u++)if(l=c[u],l.getAttribute("content")===(n.content==null?null:""+n.content)&&l.getAttribute("name")===(n.name==null?null:n.name)&&l.getAttribute("property")===(n.property==null?null:n.property)&&l.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&l.getAttribute("charset")===(n.charSet==null?null:n.charSet)){c.splice(u,1);break t}}l=a.createElement(i),yn(l,i,n),a.head.appendChild(l);break;default:throw Error(le(468,i))}l[fn]=e,ln(l),i=l}e.stateNode=i}else gm(a,e.type,e.stateNode);else e.stateNode=ym(a,i,e.memoizedProps);else l!==i?(l===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):l.count--,i===null?gm(a,e.type,e.stateNode):ym(a,i,e.memoizedProps)):i===null&&e.stateNode!==null&&Od(e,e.memoizedProps,n.memoizedProps)}break;case 27:Cn(t,e),In(e),i&512&&(qt||n===null||zi(n,n.return)),n!==null&&i&4&&Od(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Cn(t,e),In(e),i&512&&(qt||n===null||zi(n,n.return)),e.flags&32){a=e.stateNode;try{Dl(a,"")}catch(q){ht(e,e.return,q)}}i&4&&e.stateNode!=null&&(a=e.memoizedProps,Od(e,a,n!==null?n.memoizedProps:a)),i&1024&&(jd=!0);break;case 6:if(Cn(t,e),In(e),i&4){if(e.stateNode===null)throw Error(le(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(q){ht(e,e.return,q)}}break;case 3:if(hc=null,a=wi,wi=Fc(t.containerInfo),Cn(t,e),wi=a,In(e),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Pl(t.containerInfo)}catch(q){ht(e,e.return,q)}jd&&(jd=!1,i0(e));break;case 4:i=wi,wi=Fc(e.stateNode.containerInfo),Cn(t,e),In(e),wi=i;break;case 12:Cn(t,e),In(e);break;case 31:Cn(t,e),In(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,$o(e,i)));break;case 13:Cn(t,e),In(e),e.child.flags&8192&&e.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(pu=Kn()),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,$o(e,i)));break;case 22:a=e.memoizedState!==null;var y=n!==null&&n.memoizedState!==null,v=ls,g=qt;if(ls=v||a,qt=g||y,Cn(t,e),qt=g,ls=v,In(e),i&8192)e:for(t=e.stateNode,t._visibility=a?t._visibility&-2:t._visibility|1,a&&(n===null||y||ls||qt||ma(e)),n=null,t=e;;){if(t.tag===5||t.tag===26){if(n===null){y=n=t;try{if(l=y.stateNode,a)c=l.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none";else{u=y.stateNode;var E=y.memoizedProps.style,I=E!=null&&E.hasOwnProperty("display")?E.display:null;u.style.display=I==null||typeof I=="boolean"?"":(""+I).trim()}}catch(q){ht(y,y.return,q)}}}else if(t.tag===6){if(n===null){y=t;try{y.stateNode.nodeValue=a?"":y.memoizedProps}catch(q){ht(y,y.return,q)}}}else if(t.tag===18){if(n===null){y=t;try{var R=y.stateNode;a?um(R,!0):um(y.stateNode,!1)}catch(q){ht(y,y.return,q)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}i&4&&(i=e.updateQueue,i!==null&&(n=i.retryQueue,n!==null&&(i.retryQueue=null,$o(e,n))));break;case 19:Cn(t,e),In(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,$o(e,i)));break;case 30:break;case 21:break;default:Cn(t,e),In(e)}}function In(e){var t=e.flags;if(t&2){try{for(var n,i=e.return;i!==null;){if(Vb(i)){n=i;break}i=i.return}if(n==null)throw Error(le(160));switch(n.tag){case 27:var a=n.stateNode,l=Bd(e);Pc(e,l,a);break;case 5:var c=n.stateNode;n.flags&32&&(Dl(c,""),n.flags&=-33);var u=Bd(e);Pc(e,u,c);break;case 3:case 4:var y=n.stateNode.containerInfo,v=Bd(e);_f(e,v,y);break;default:throw Error(le(161))}}catch(g){ht(e,e.return,g)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function i0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;i0(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function es(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Xb(e,t.alternate,t),t=t.sibling}function ma(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Js(4,t,t.return),ma(t);break;case 1:zi(t,t.return);var n=t.stateNode;typeof n.componentWillUnmount=="function"&&Wb(t,t.return,n),ma(t);break;case 27:Br(t.stateNode);case 26:case 5:zi(t,t.return),ma(t);break;case 22:t.memoizedState===null&&ma(t);break;case 30:ma(t);break;default:ma(t)}e=e.sibling}}function ts(e,t,n){for(n=n&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var i=t.alternate,a=e,l=t,c=l.flags;switch(l.tag){case 0:case 11:case 15:ts(a,l,n),ro(4,l);break;case 1:if(ts(a,l,n),i=l,a=i.stateNode,typeof a.componentDidMount=="function")try{a.componentDidMount()}catch(v){ht(i,i.return,v)}if(i=l,a=i.updateQueue,a!==null){var u=i.stateNode;try{var y=a.shared.hiddenCallbacks;if(y!==null)for(a.shared.hiddenCallbacks=null,a=0;a<y.length;a++)eb(y[a],u)}catch(v){ht(i,i.return,v)}}n&&c&64&&qb(l),Rr(l,l.return);break;case 27:Qb(l);case 26:case 5:ts(a,l,n),n&&i===null&&c&4&&Kb(l),Rr(l,l.return);break;case 12:ts(a,l,n);break;case 31:ts(a,l,n),n&&c&4&&e0(a,l);break;case 13:ts(a,l,n),n&&c&4&&t0(a,l);break;case 22:l.memoizedState===null&&ts(a,l,n),Rr(l,l.return);break;case 30:break;default:ts(a,l,n)}t=t.sibling}}function Xh(e,t){var n=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==n&&(e!=null&&e.refCount++,n!=null&&ao(n))}function Zh(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ao(e))}function Ni(e,t,n,i){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)s0(e,t,n,i),t=t.sibling}function s0(e,t,n,i){var a=t.flags;switch(t.tag){case 0:case 11:case 15:Ni(e,t,n,i),a&2048&&ro(9,t);break;case 1:Ni(e,t,n,i);break;case 3:Ni(e,t,n,i),a&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ao(e)));break;case 12:if(a&2048){Ni(e,t,n,i),e=t.stateNode;try{var l=t.memoizedProps,c=l.id,u=l.onPostCommit;typeof u=="function"&&u(c,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(y){ht(t,t.return,y)}}else Ni(e,t,n,i);break;case 31:Ni(e,t,n,i);break;case 13:Ni(e,t,n,i);break;case 23:break;case 22:l=t.stateNode,c=t.alternate,t.memoizedState!==null?l._visibility&2?Ni(e,t,n,i):kr(e,t):l._visibility&2?Ni(e,t,n,i):(l._visibility|=2,il(e,t,n,i,(t.subtreeFlags&10256)!==0||!1)),a&2048&&Xh(c,t);break;case 24:Ni(e,t,n,i),a&2048&&Zh(t.alternate,t);break;default:Ni(e,t,n,i)}}function il(e,t,n,i,a){for(a=a&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var l=e,c=t,u=n,y=i,v=c.flags;switch(c.tag){case 0:case 11:case 15:il(l,c,u,y,a),ro(8,c);break;case 23:break;case 22:var g=c.stateNode;c.memoizedState!==null?g._visibility&2?il(l,c,u,y,a):kr(l,c):(g._visibility|=2,il(l,c,u,y,a)),a&&v&2048&&Xh(c.alternate,c);break;case 24:il(l,c,u,y,a),a&&v&2048&&Zh(c.alternate,c);break;default:il(l,c,u,y,a)}t=t.sibling}}function kr(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var n=e,i=t,a=i.flags;switch(i.tag){case 22:kr(n,i),a&2048&&Xh(i.alternate,i);break;case 24:kr(n,i),a&2048&&Zh(i.alternate,i);break;default:kr(n,i)}t=t.sibling}}var Er=8192;function Ja(e,t,n){if(e.subtreeFlags&Er)for(e=e.child;e!==null;)a0(e,t,n),e=e.sibling}function a0(e,t,n){switch(e.tag){case 26:Ja(e,t,n),e.flags&Er&&e.memoizedState!==null&&cv(n,wi,e.memoizedState,e.memoizedProps);break;case 5:Ja(e,t,n);break;case 3:case 4:var i=wi;wi=Fc(e.stateNode.containerInfo),Ja(e,t,n),wi=i;break;case 22:e.memoizedState===null&&(i=e.alternate,i!==null&&i.memoizedState!==null?(i=Er,Er=16777216,Ja(e,t,n),Er=i):Ja(e,t,n));break;default:Ja(e,t,n)}}function l0(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function pr(e){var t=e.deletions;if(e.flags&16){if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];sn=i,o0(i,e)}l0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)r0(e),e=e.sibling}function r0(e){switch(e.tag){case 0:case 11:case 15:pr(e),e.flags&2048&&Js(9,e,e.return);break;case 3:pr(e);break;case 12:pr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,dc(e)):pr(e);break;default:pr(e)}}function dc(e){var t=e.deletions;if(e.flags&16){if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];sn=i,o0(i,e)}l0(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Js(8,t,t.return),dc(t);break;case 22:n=t.stateNode,n._visibility&2&&(n._visibility&=-3,dc(t));break;default:dc(t)}e=e.sibling}}function o0(e,t){for(;sn!==null;){var n=sn;switch(n.tag){case 0:case 11:case 15:Js(8,n,t);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var i=n.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:ao(n.memoizedState.cache)}if(i=n.child,i!==null)i.return=n,sn=i;else e:for(n=e;sn!==null;){i=sn;var a=i.sibling,l=i.return;if(Zb(i),i===n){sn=null;break e}if(a!==null){a.return=l,sn=a;break e}sn=l}}}var wT={getCacheForType:function(e){var t=pn(Wt),n=t.data.get(e);return n===void 0&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return pn(Wt).controller.signal}},AT=typeof WeakMap=="function"?WeakMap:Map,ot=0,Et=null,nt=null,st=0,ft=0,Yn=null,Ls=!1,ql=!1,Jh=!1,xs=0,Pt=0,ea=0,Ia=0,ep=0,Wn=0,Ol=0,_r=null,Rn=null,Of=!1,pu=0,c0=0,Lc=1/0,Uc=null,qs=null,Qt=0,Ws=null,Bl=null,ps=0,Bf=0,jf=null,u0=null,Or=0,Mf=null;function Xn(){return ot&2&&st!==0?st&-st:$e.T!==null?np():xg()}function d0(){if(Wn===0)if(!(st&536870912)||at){var e=_o;_o<<=1,!(_o&3932160)&&(_o=262144),Wn=e}else Wn=536870912;return e=Jn.current,e!==null&&(e.flags|=32),Wn}function kn(e,t,n){(e===Et&&(ft===2||ft===9)||e.cancelPendingCommit!==null)&&(jl(e,0),Us(e,st,Wn,!1)),no(e,n),(!(ot&2)||e!==Et)&&(e===Et&&(!(ot&2)&&(Ia|=n),Pt===4&&Us(e,st,Wn,!1)),Fi(e))}function f0(e,t,n){if(ot&6)throw Error(le(327));var i=!n&&(t&127)===0&&(t&e.expiredLanes)===0||to(e,t),a=i?ST(e,t):Md(e,t,!0),l=i;do{if(a===0){ql&&!i&&Us(e,t,0,!1);break}else{if(n=e.current.alternate,l&&!CT(n)){a=Md(e,t,!1),l=!1;continue}if(a===2){if(l=t,e.errorRecoveryDisabledLanes&l)var c=0;else c=e.pendingLanes&-536870913,c=c!==0?c:c&536870912?536870912:0;if(c!==0){t=c;e:{var u=e;a=_r;var y=u.current.memoizedState.isDehydrated;if(y&&(jl(u,c).flags|=256),c=Md(u,c,!1),c!==2){if(Jh&&!y){u.errorRecoveryDisabledLanes|=l,Ia|=l,a=4;break e}l=Rn,Rn=a,l!==null&&(Rn===null?Rn=l:Rn.push.apply(Rn,l))}a=c}if(l=!1,a!==2)continue}}if(a===1){jl(e,0),Us(e,t,0,!0);break}e:{switch(i=e,l=a,l){case 0:case 1:throw Error(le(345));case 4:if((t&4194048)!==t)break;case 6:Us(i,t,Wn,!Ls);break e;case 2:Rn=null;break;case 3:case 5:break;default:throw Error(le(329))}if((t&62914560)===t&&(a=pu+300-Kn(),10<a)){if(Us(i,t,Wn,!Ls),iu(i,0,!0)!==0)break e;ps=t,i.timeoutHandle=_0(Xy.bind(null,i,n,Rn,Uc,Of,t,Wn,Ia,Ol,Ls,l,"Throttled",-0,0),a);break e}Xy(i,n,Rn,Uc,Of,t,Wn,Ia,Ol,Ls,l,null,-0,0)}}break}while(!0);Fi(e)}function Xy(e,t,n,i,a,l,c,u,y,v,g,E,I,R){if(e.timeoutHandle=-1,E=t.subtreeFlags,E&8192||(E&16785408)===16785408){E={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:cs},a0(t,l,E);var q=(l&62914560)===l?pu-Kn():(l&4194048)===l?c0-Kn():0;if(q=uv(E,q),q!==null){ps=l,e.cancelPendingCommit=q(Jy.bind(null,e,t,l,n,i,a,c,u,y,g,E,null,I,R)),Us(e,l,c,!v);return}}Jy(e,t,l,n,i,a,c,u,y)}function CT(e){for(var t=e;;){var n=t.tag;if((n===0||n===11||n===15)&&t.flags&16384&&(n=t.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var i=0;i<n.length;i++){var a=n[i],l=a.getSnapshot;a=a.value;try{if(!Zn(l(),a))return!1}catch{return!1}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Us(e,t,n,i){t&=~ep,t&=~Ia,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var a=t;0<a;){var l=31-Qn(a),c=1<<l;i[l]=-1,a&=~c}n!==0&&mg(e,n,t)}function yu(){return ot&6?!0:(oo(0),!1)}function tp(){if(nt!==null){if(ft===0)var e=nt.return;else e=nt,us=La=null,$h(e),Nl=null,Gr=0,e=nt;for(;e!==null;)Fb(e.alternate,e),e=e.return;nt=null}}function jl(e,t){var n=e.timeoutHandle;n!==-1&&(e.timeoutHandle=-1,qT(n)),n=e.cancelPendingCommit,n!==null&&(e.cancelPendingCommit=null,n()),ps=0,tp(),Et=e,nt=n=fs(e.current,null),st=t,ft=0,Yn=null,Ls=!1,ql=to(e,t),Jh=!1,Ol=Wn=ep=Ia=ea=Pt=0,Rn=_r=null,Of=!1,t&8&&(t|=t&32);var i=e.entangledLanes;if(i!==0)for(e=e.entanglements,i&=t;0<i;){var a=31-Qn(i),l=1<<a;t|=e[a],i&=~l}return xs=t,ru(),n}function h0(e,t){qe=null,$e.H=Yr,t===Fl||t===cu?(t=Dy(),ft=3):t===Oh?(t=Dy(),ft=4):ft=t===Vh?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Yn=t,nt===null&&(Pt=1,jc(e,di(t,e.current)))}function p0(){var e=Jn.current;return e===null?!0:(st&4194048)===st?hi===null:(st&62914560)===st||st&536870912?e===hi:!1}function y0(){var e=$e.H;return $e.H=Yr,e===null?Yr:e}function m0(){var e=$e.A;return $e.A=wT,e}function $c(){Pt=4,Ls||(st&4194048)!==st&&Jn.current!==null||(ql=!0),!(ea&134217727)&&!(Ia&134217727)||Et===null||Us(Et,st,Wn,!1)}function Md(e,t,n){var i=ot;ot|=2;var a=y0(),l=m0();(Et!==e||st!==t)&&(Uc=null,jl(e,t)),t=!1;var c=Pt;e:do try{if(ft!==0&&nt!==null){var u=nt,y=Yn;switch(ft){case 8:tp(),c=6;break e;case 3:case 2:case 9:case 6:Jn.current===null&&(t=!0);var v=ft;if(ft=0,Yn=null,gl(e,u,y,v),n&&ql){c=0;break e}break;default:v=ft,ft=0,Yn=null,gl(e,u,y,v)}}IT(),c=Pt;break}catch(g){h0(e,g)}while(!0);return t&&e.shellSuspendCounter++,us=La=null,ot=i,$e.H=a,$e.A=l,nt===null&&(Et=null,st=0,ru()),c}function IT(){for(;nt!==null;)g0(nt)}function ST(e,t){var n=ot;ot|=2;var i=y0(),a=m0();Et!==e||st!==t?(Uc=null,Lc=Kn()+500,jl(e,t)):ql=to(e,t);e:do try{if(ft!==0&&nt!==null){t=nt;var l=Yn;t:switch(ft){case 1:ft=0,Yn=null,gl(e,t,l,1);break;case 2:case 9:if(Sy(l)){ft=0,Yn=null,Zy(t);break}t=function(){ft!==2&&ft!==9||Et!==e||(ft=7),Fi(e)},l.then(t,t);break e;case 3:ft=7;break e;case 4:ft=5;break e;case 7:Sy(l)?(ft=0,Yn=null,Zy(t)):(ft=0,Yn=null,gl(e,t,l,7));break;case 5:var c=null;switch(nt.tag){case 26:c=nt.memoizedState;case 5:case 27:var u=nt;if(c?P0(c):u.stateNode.complete){ft=0,Yn=null;var y=u.sibling;if(y!==null)nt=y;else{var v=u.return;v!==null?(nt=v,mu(v)):nt=null}break t}}ft=0,Yn=null,gl(e,t,l,5);break;case 6:ft=0,Yn=null,gl(e,t,l,6);break;case 8:tp(),Pt=6;break e;default:throw Error(le(462))}}DT();break}catch(g){h0(e,g)}while(!0);return us=La=null,$e.H=i,$e.A=a,ot=n,nt!==null?0:(Et=null,st=0,ru(),Pt)}function DT(){for(;nt!==null&&!Z1();)g0(nt)}function g0(e){var t=Yb(e.alternate,e,xs);e.memoizedProps=e.pendingProps,t===null?mu(e):nt=t}function Zy(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Fy(n,t,t.pendingProps,t.type,void 0,st);break;case 11:t=Fy(n,t,t.pendingProps,t.type.render,t.ref,st);break;case 5:$h(t);default:Fb(n,t),t=nt=Fg(t,xs),t=Yb(n,t,xs)}e.memoizedProps=e.pendingProps,t===null?mu(e):nt=t}function gl(e,t,n,i){us=La=null,$h(t),Nl=null,Gr=0;var a=t.return;try{if(gT(e,a,t,n,st)){Pt=1,jc(e,di(n,e.current)),nt=null;return}}catch(l){if(a!==null)throw nt=a,l;Pt=1,jc(e,di(n,e.current)),nt=null;return}t.flags&32768?(at||i===1?e=!0:ql||st&536870912?e=!1:(Ls=e=!0,(i===2||i===9||i===3||i===6)&&(i=Jn.current,i!==null&&i.tag===13&&(i.flags|=16384))),b0(t,e)):mu(t)}function mu(e){var t=e;do{if(t.flags&32768){b0(t,Ls);return}e=t.return;var n=ET(t.alternate,t,xs);if(n!==null){nt=n;return}if(t=t.sibling,t!==null){nt=t;return}nt=t=e}while(t!==null);Pt===0&&(Pt=5)}function b0(e,t){do{var n=TT(e.alternate,e);if(n!==null){n.flags&=32767,nt=n;return}if(n=e.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&(e=e.sibling,e!==null)){nt=e;return}nt=e=n}while(e!==null);Pt=6,nt=null}function Jy(e,t,n,i,a,l,c,u,y){e.cancelPendingCommit=null;do gu();while(Qt!==0);if(ot&6)throw Error(le(327));if(t!==null){if(t===e.current)throw Error(le(177));if(l=t.lanes|t.childLanes,l|=Ch,oE(e,n,l,c,u,y),e===Et&&(nt=Et=null,st=0),Bl=t,Ws=e,ps=n,Bf=l,jf=a,u0=i,t.subtreeFlags&10256||t.flags&10256?(e.callbackNode=null,e.callbackPriority=0,OT(wc,function(){return N0(),null})):(e.callbackNode=null,e.callbackPriority=0),i=(t.flags&13878)!==0,t.subtreeFlags&13878||i){i=$e.T,$e.T=null,a=ct.p,ct.p=2,c=ot,ot|=4;try{vT(e,t,n)}finally{ot=c,ct.p=a,$e.T=i}}Qt=1,x0(),E0(),T0()}}function x0(){if(Qt===1){Qt=0;var e=Ws,t=Bl,n=(t.flags&13878)!==0;if(t.subtreeFlags&13878||n){n=$e.T,$e.T=null;var i=ct.p;ct.p=2;var a=ot;ot|=4;try{n0(t,e);var l=$f,c=Pg(e.containerInfo),u=l.focusedElem,y=l.selectionRange;if(c!==u&&u&&u.ownerDocument&&Mg(u.ownerDocument.documentElement,u)){if(y!==null&&Ah(u)){var v=y.start,g=y.end;if(g===void 0&&(g=v),"selectionStart"in u)u.selectionStart=v,u.selectionEnd=Math.min(g,u.value.length);else{var E=u.ownerDocument||document,I=E&&E.defaultView||window;if(I.getSelection){var R=I.getSelection(),q=u.textContent.length,J=Math.min(y.start,q),K=y.end===void 0?J:Math.min(y.end,q);!R.extend&&J>K&&(c=K,K=J,J=c);var O=Ty(u,J),k=Ty(u,K);if(O&&k&&(R.rangeCount!==1||R.anchorNode!==O.node||R.anchorOffset!==O.offset||R.focusNode!==k.node||R.focusOffset!==k.offset)){var j=E.createRange();j.setStart(O.node,O.offset),R.removeAllRanges(),J>K?(R.addRange(j),R.extend(k.node,k.offset)):(j.setEnd(k.node,k.offset),R.addRange(j))}}}}for(E=[],R=u;R=R.parentNode;)R.nodeType===1&&E.push({element:R,left:R.scrollLeft,top:R.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<E.length;u++){var P=E[u];P.element.scrollLeft=P.left,P.element.scrollTop=P.top}}Kc=!!Uf,$f=Uf=null}finally{ot=a,ct.p=i,$e.T=n}}e.current=t,Qt=2}}function E0(){if(Qt===2){Qt=0;var e=Ws,t=Bl,n=(t.flags&8772)!==0;if(t.subtreeFlags&8772||n){n=$e.T,$e.T=null;var i=ct.p;ct.p=2;var a=ot;ot|=4;try{Xb(e,t.alternate,t)}finally{ot=a,ct.p=i,$e.T=n}}Qt=3}}function T0(){if(Qt===4||Qt===3){Qt=0,J1();var e=Ws,t=Bl,n=ps,i=u0;t.subtreeFlags&10256||t.flags&10256?Qt=5:(Qt=0,Bl=Ws=null,v0(e,e.pendingLanes));var a=e.pendingLanes;if(a===0&&(qs=null),bh(n),t=t.stateNode,Vn&&typeof Vn.onCommitFiberRoot=="function")try{Vn.onCommitFiberRoot(eo,t,void 0,(t.current.flags&128)===128)}catch{}if(i!==null){t=$e.T,a=ct.p,ct.p=2,$e.T=null;try{for(var l=e.onRecoverableError,c=0;c<i.length;c++){var u=i[c];l(u.value,{componentStack:u.stack})}}finally{$e.T=t,ct.p=a}}ps&3&&gu(),Fi(e),a=e.pendingLanes,n&261930&&a&42?e===Mf?Or++:(Or=0,Mf=e):Or=0,oo(0)}}function v0(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,ao(t)))}function gu(){return x0(),E0(),T0(),N0()}function N0(){if(Qt!==5)return!1;var e=Ws,t=Bf;Bf=0;var n=bh(ps),i=$e.T,a=ct.p;try{ct.p=32>n?32:n,$e.T=null,n=jf,jf=null;var l=Ws,c=ps;if(Qt=0,Bl=Ws=null,ps=0,ot&6)throw Error(le(331));var u=ot;if(ot|=4,r0(l.current),s0(l,l.current,c,n),ot=u,oo(0,!1),Vn&&typeof Vn.onPostCommitFiberRoot=="function")try{Vn.onPostCommitFiberRoot(eo,l)}catch{}return!0}finally{ct.p=a,$e.T=i,v0(e,t)}}function em(e,t,n){t=di(n,t),t=Df(e.stateNode,t,2),e=Fs(e,t,2),e!==null&&(no(e,2),Fi(e))}function ht(e,t,n){if(e.tag===3)em(e,e,n);else for(;t!==null;){if(t.tag===3){em(t,e,n);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(qs===null||!qs.has(i))){e=di(n,e),n=Lb(2),i=Fs(t,n,2),i!==null&&(Ub(n,i,t,e),no(i,2),Fi(i));break}}t=t.return}}function Pd(e,t,n){var i=e.pingCache;if(i===null){i=e.pingCache=new AT;var a=new Set;i.set(t,a)}else a=i.get(t),a===void 0&&(a=new Set,i.set(t,a));a.has(n)||(Jh=!0,a.add(n),e=RT.bind(null,e,t,n),t.then(e,e))}function RT(e,t,n){var i=e.pingCache;i!==null&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,Et===e&&(st&n)===n&&(Pt===4||Pt===3&&(st&62914560)===st&&300>Kn()-pu?!(ot&2)&&jl(e,0):ep|=n,Ol===st&&(Ol=0)),Fi(e)}function w0(e,t){t===0&&(t=yg()),e=Pa(e,t),e!==null&&(no(e,t),Fi(e))}function kT(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),w0(e,n)}function _T(e,t){var n=0;switch(e.tag){case 31:case 13:var i=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(le(314))}i!==null&&i.delete(t),w0(e,n)}function OT(e,t){return mh(e,t)}var zc=null,sl=null,Pf=!1,Gc=!1,Ld=!1,$s=0;function Fi(e){e!==sl&&e.next===null&&(sl===null?zc=sl=e:sl=sl.next=e),Gc=!0,Pf||(Pf=!0,jT())}function oo(e,t){if(!Ld&&Gc){Ld=!0;do for(var n=!1,i=zc;i!==null;){if(e!==0){var a=i.pendingLanes;if(a===0)var l=0;else{var c=i.suspendedLanes,u=i.pingedLanes;l=(1<<31-Qn(42|e)+1)-1,l&=a&~(c&~u),l=l&201326741?l&201326741|1:l?l|2:0}l!==0&&(n=!0,tm(i,l))}else l=st,l=iu(i,i===Et?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(l&3)||to(i,l)||(n=!0,tm(i,l));i=i.next}while(n);Ld=!1}}function BT(){A0()}function A0(){Gc=Pf=!1;var e=0;$s!==0&&FT()&&(e=$s);for(var t=Kn(),n=null,i=zc;i!==null;){var a=i.next,l=C0(i,t);l===0?(i.next=null,n===null?zc=a:n.next=a,a===null&&(sl=n)):(n=i,(e!==0||l&3)&&(Gc=!0)),i=a}Qt!==0&&Qt!==5||oo(e),$s!==0&&($s=0)}function C0(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,l=e.pendingLanes&-62914561;0<l;){var c=31-Qn(l),u=1<<c,y=a[c];y===-1?(!(u&n)||u&i)&&(a[c]=rE(u,t)):y<=t&&(e.expiredLanes|=u),l&=~u}if(t=Et,n=st,n=iu(e,e===t?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i=e.callbackNode,n===0||e===t&&(ft===2||ft===9)||e.cancelPendingCommit!==null)return i!==null&&i!==null&&fd(i),e.callbackNode=null,e.callbackPriority=0;if(!(n&3)||to(e,n)){if(t=n&-n,t===e.callbackPriority)return t;switch(i!==null&&fd(i),bh(n)){case 2:case 8:n=hg;break;case 32:n=wc;break;case 268435456:n=pg;break;default:n=wc}return i=I0.bind(null,e),n=mh(n,i),e.callbackPriority=t,e.callbackNode=n,t}return i!==null&&i!==null&&fd(i),e.callbackPriority=2,e.callbackNode=null,2}function I0(e,t){if(Qt!==0&&Qt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(gu()&&e.callbackNode!==n)return null;var i=st;return i=iu(e,e===Et?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i===0?null:(f0(e,i,t),C0(e,Kn()),e.callbackNode!=null&&e.callbackNode===n?I0.bind(null,e):null)}function tm(e,t){if(gu())return null;f0(e,t,!0)}function jT(){WT(function(){ot&6?mh(fg,BT):A0()})}function np(){if($s===0){var e=Rl;e===0&&(e=ko,ko<<=1,!(ko&261888)&&(ko=256)),$s=e}return $s}function nm(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:nc(""+e)}function im(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}function MT(e,t,n,i,a){if(t==="submit"&&n&&n.stateNode===a){var l=nm((a[On]||null).action),c=i.submitter;c&&(t=(t=c[On]||null)?nm(t.formAction):c.getAttribute("formAction"),t!==null&&(l=t,c=null));var u=new su("action","action",null,i,a);e.push({event:u,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if($s!==0){var y=c?im(a,c):new FormData(a);If(n,{pending:!0,data:y,method:a.method,action:l},null,y)}}else typeof l=="function"&&(u.preventDefault(),y=c?im(a,c):new FormData(a),If(n,{pending:!0,data:y,method:a.method,action:l},l,y))},currentTarget:a}]})}}for(var Ud=0;Ud<yf.length;Ud++){var $d=yf[Ud],PT=$d.toLowerCase(),LT=$d[0].toUpperCase()+$d.slice(1);Ai(PT,"on"+LT)}Ai(Ug,"onAnimationEnd");Ai($g,"onAnimationIteration");Ai(zg,"onAnimationStart");Ai("dblclick","onDoubleClick");Ai("focusin","onFocus");Ai("focusout","onBlur");Ai(eT,"onTransitionRun");Ai(tT,"onTransitionStart");Ai(nT,"onTransitionCancel");Ai(Gg,"onTransitionEnd");Sl("onMouseEnter",["mouseout","mouseover"]);Sl("onMouseLeave",["mouseout","mouseover"]);Sl("onPointerEnter",["pointerout","pointerover"]);Sl("onPointerLeave",["pointerout","pointerover"]);Ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ba("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),UT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fr));function S0(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var i=e[n],a=i.event;i=i.listeners;e:{var l=void 0;if(t)for(var c=i.length-1;0<=c;c--){var u=i[c],y=u.instance,v=u.currentTarget;if(u=u.listener,y!==l&&a.isPropagationStopped())break e;l=u,a.currentTarget=v;try{l(a)}catch(g){Cc(g)}a.currentTarget=null,l=y}else for(c=0;c<i.length;c++){if(u=i[c],y=u.instance,v=u.currentTarget,u=u.listener,y!==l&&a.isPropagationStopped())break e;l=u,a.currentTarget=v;try{l(a)}catch(g){Cc(g)}a.currentTarget=null,l=y}}}}function tt(e,t){var n=t[rf];n===void 0&&(n=t[rf]=new Set);var i=e+"__bubble";n.has(i)||(D0(t,e,2,!1),n.add(i))}function zd(e,t,n){var i=0;t&&(i|=4),D0(n,e,i,t)}var zo="_reactListening"+Math.random().toString(36).slice(2);function ip(e){if(!e[zo]){e[zo]=!0,Eg.forEach(function(n){n!=="selectionchange"&&(UT.has(n)||zd(n,!1,e),zd(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[zo]||(t[zo]=!0,zd("selectionchange",!1,t))}}function D0(e,t,n,i){switch(G0(t)){case 2:var a=hv;break;case 8:a=pv;break;default:a=rp}n=a.bind(null,t,n,e),a=void 0,!ff||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),i?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Gd(e,t,n,i,a){var l=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var c=i.tag;if(c===3||c===4){var u=i.stateNode.containerInfo;if(u===a)break;if(c===4)for(c=i.return;c!==null;){var y=c.tag;if((y===3||y===4)&&c.stateNode.containerInfo===a)return;c=c.return}for(;u!==null;){if(c=ol(u),c===null)return;if(y=c.tag,y===5||y===6||y===26||y===27){i=l=c;continue e}u=u.parentNode}}i=i.return}Sg(function(){var v=l,g=Th(n),E=[];e:{var I=Hg.get(e);if(I!==void 0){var R=su,q=e;switch(e){case"keypress":if(sc(n)===0)break e;case"keydown":case"keyup":R=_E;break;case"focusin":q="focus",R=gd;break;case"focusout":q="blur",R=gd;break;case"beforeblur":case"afterblur":R=gd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":R=dy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":R=EE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":R=jE;break;case Ug:case $g:case zg:R=NE;break;case Gg:R=PE;break;case"scroll":case"scrollend":R=bE;break;case"wheel":R=UE;break;case"copy":case"cut":case"paste":R=AE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":R=hy;break;case"toggle":case"beforetoggle":R=zE}var J=(t&4)!==0,K=!J&&(e==="scroll"||e==="scrollend"),O=J?I!==null?I+"Capture":null:I;J=[];for(var k=v,j;k!==null;){var P=k;if(j=P.stateNode,P=P.tag,P!==5&&P!==26&&P!==27||j===null||O===null||(P=Pr(k,O),P!=null&&J.push(qr(k,P,j))),K)break;k=k.return}0<J.length&&(I=new R(I,q,null,n,g),E.push({event:I,listeners:J}))}}if(!(t&7)){e:{if(I=e==="mouseover"||e==="pointerover",R=e==="mouseout"||e==="pointerout",I&&n!==df&&(q=n.relatedTarget||n.fromElement)&&(ol(q)||q[Gl]))break e;if((R||I)&&(I=g.window===g?g:(I=g.ownerDocument)?I.defaultView||I.parentWindow:window,R?(q=n.relatedTarget||n.toElement,R=v,q=q?ol(q):null,q!==null&&(K=Jr(q),J=q.tag,q!==K||J!==5&&J!==27&&J!==6)&&(q=null)):(R=null,q=v),R!==q)){if(J=dy,P="onMouseLeave",O="onMouseEnter",k="mouse",(e==="pointerout"||e==="pointerover")&&(J=hy,P="onPointerLeave",O="onPointerEnter",k="pointer"),K=R==null?I:br(R),j=q==null?I:br(q),I=new J(P,k+"leave",R,n,g),I.target=K,I.relatedTarget=j,P=null,ol(g)===v&&(J=new J(O,k+"enter",q,n,g),J.target=j,J.relatedTarget=K,P=J),K=P,R&&q)t:{for(J=$T,O=R,k=q,j=0,P=O;P;P=J(P))j++;P=0;for(var ee=k;ee;ee=J(ee))P++;for(;0<j-P;)O=J(O),j--;for(;0<P-j;)k=J(k),P--;for(;j--;){if(O===k||k!==null&&O===k.alternate){J=O;break t}O=J(O),k=J(k)}J=null}else J=null;R!==null&&sm(E,I,R,J,!1),q!==null&&K!==null&&sm(E,K,q,J,!0)}}e:{if(I=v?br(v):window,R=I.nodeName&&I.nodeName.toLowerCase(),R==="select"||R==="input"&&I.type==="file")var ne=gy;else if(my(I))if(Bg)ne=XE;else{ne=VE;var te=KE}else R=I.nodeName,!R||R.toLowerCase()!=="input"||I.type!=="checkbox"&&I.type!=="radio"?v&&Eh(v.elementType)&&(ne=gy):ne=QE;if(ne&&(ne=ne(e,v))){Og(E,ne,n,g);break e}te&&te(e,I,v),e==="focusout"&&v&&I.type==="number"&&v.memoizedProps.value!=null&&uf(I,"number",I.value)}switch(te=v?br(v):window,e){case"focusin":(my(te)||te.contentEditable==="true")&&(dl=te,hf=v,wr=null);break;case"focusout":wr=hf=dl=null;break;case"mousedown":pf=!0;break;case"contextmenu":case"mouseup":case"dragend":pf=!1,vy(E,n,g);break;case"selectionchange":if(JE)break;case"keydown":case"keyup":vy(E,n,g)}var se;if(wh)e:{switch(e){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else ul?kg(e,n)&&(Q="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(Q="onCompositionStart");Q&&(Rg&&n.locale!=="ko"&&(ul||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&ul&&(se=Dg()):(Ps=g,vh="value"in Ps?Ps.value:Ps.textContent,ul=!0)),te=Hc(v,Q),0<te.length&&(Q=new fy(Q,e,null,n,g),E.push({event:Q,listeners:te}),se?Q.data=se:(se=_g(n),se!==null&&(Q.data=se)))),(se=HE?YE(e,n):FE(e,n))&&(Q=Hc(v,"onBeforeInput"),0<Q.length&&(te=new fy("onBeforeInput","beforeinput",null,n,g),E.push({event:te,listeners:Q}),te.data=se)),MT(E,e,v,n,g)}S0(E,t)})}function qr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hc(e,t){for(var n=t+"Capture",i=[];e!==null;){var a=e,l=a.stateNode;if(a=a.tag,a!==5&&a!==26&&a!==27||l===null||(a=Pr(e,n),a!=null&&i.unshift(qr(e,a,l)),a=Pr(e,t),a!=null&&i.push(qr(e,a,l))),e.tag===3)return i;e=e.return}return[]}function $T(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function sm(e,t,n,i,a){for(var l=t._reactName,c=[];n!==null&&n!==i;){var u=n,y=u.alternate,v=u.stateNode;if(u=u.tag,y!==null&&y===i)break;u!==5&&u!==26&&u!==27||v===null||(y=v,a?(v=Pr(n,l),v!=null&&c.unshift(qr(n,v,y))):a||(v=Pr(n,l),v!=null&&c.push(qr(n,v,y)))),n=n.return}c.length!==0&&e.push({event:t,listeners:c})}var zT=/\r\n?/g,GT=/\u0000|\uFFFD/g;function am(e){return(typeof e=="string"?e:""+e).replace(zT,`
`).replace(GT,"")}function R0(e,t){return t=am(t),am(e)===t}function pt(e,t,n,i,a,l){switch(n){case"children":typeof i=="string"?t==="body"||t==="textarea"&&i===""||Dl(e,i):(typeof i=="number"||typeof i=="bigint")&&t!=="body"&&Dl(e,""+i);break;case"className":Bo(e,"class",i);break;case"tabIndex":Bo(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Bo(e,n,i);break;case"style":Ig(e,i,l);break;case"data":if(t!=="object"){Bo(e,"data",i);break}case"src":case"href":if(i===""&&(t!=="a"||n!=="href")){e.removeAttribute(n);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(n);break}i=nc(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if(typeof i=="function"){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof l=="function"&&(n==="formAction"?(t!=="input"&&pt(e,t,"name",a.name,a,null),pt(e,t,"formEncType",a.formEncType,a,null),pt(e,t,"formMethod",a.formMethod,a,null),pt(e,t,"formTarget",a.formTarget,a,null)):(pt(e,t,"encType",a.encType,a,null),pt(e,t,"method",a.method,a,null),pt(e,t,"target",a.target,a,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(n);break}i=nc(""+i),e.setAttribute(n,i);break;case"onClick":i!=null&&(e.onclick=cs);break;case"onScroll":i!=null&&tt("scroll",e);break;case"onScrollEnd":i!=null&&tt("scrollend",e);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(le(61));if(n=i.__html,n!=null){if(a.children!=null)throw Error(le(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":e.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){e.removeAttribute("xlink:href");break}n=nc(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":i===!0?e.setAttribute(n,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":tt("beforetoggle",e),tt("toggle",e),tc(e,"popover",i);break;case"xlinkActuate":Xi(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":Xi(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":Xi(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":Xi(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":Xi(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":Xi(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":Xi(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":Xi(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":Xi(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":tc(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=mE.get(n)||n,tc(e,n,i))}}function Lf(e,t,n,i,a,l){switch(n){case"style":Ig(e,i,l);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(le(61));if(n=i.__html,n!=null){if(a.children!=null)throw Error(le(60));e.innerHTML=n}}break;case"children":typeof i=="string"?Dl(e,i):(typeof i=="number"||typeof i=="bigint")&&Dl(e,""+i);break;case"onScroll":i!=null&&tt("scroll",e);break;case"onScrollEnd":i!=null&&tt("scrollend",e);break;case"onClick":i!=null&&(e.onclick=cs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Tg.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),l=e[On]||null,l=l!=null?l[n]:null,typeof l=="function"&&e.removeEventListener(t,l,a),typeof i=="function")){typeof l!="function"&&l!==null&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,a);break e}n in e?e[n]=i:i===!0?e.setAttribute(n,""):tc(e,n,i)}}}function yn(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":tt("error",e),tt("load",e);var i=!1,a=!1,l;for(l in n)if(n.hasOwnProperty(l)){var c=n[l];if(c!=null)switch(l){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(le(137,t));default:pt(e,t,l,c,n,null)}}a&&pt(e,t,"srcSet",n.srcSet,n,null),i&&pt(e,t,"src",n.src,n,null);return;case"input":tt("invalid",e);var u=l=c=a=null,y=null,v=null;for(i in n)if(n.hasOwnProperty(i)){var g=n[i];if(g!=null)switch(i){case"name":a=g;break;case"type":c=g;break;case"checked":y=g;break;case"defaultChecked":v=g;break;case"value":l=g;break;case"defaultValue":u=g;break;case"children":case"dangerouslySetInnerHTML":if(g!=null)throw Error(le(137,t));break;default:pt(e,t,i,g,n,null)}}wg(e,l,u,y,v,c,a,!1);return;case"select":tt("invalid",e),i=c=l=null;for(a in n)if(n.hasOwnProperty(a)&&(u=n[a],u!=null))switch(a){case"value":l=u;break;case"defaultValue":c=u;break;case"multiple":i=u;default:pt(e,t,a,u,n,null)}t=l,n=c,e.multiple=!!i,t!=null?El(e,!!i,t,!1):n!=null&&El(e,!!i,n,!0);return;case"textarea":tt("invalid",e),l=a=i=null;for(c in n)if(n.hasOwnProperty(c)&&(u=n[c],u!=null))switch(c){case"value":i=u;break;case"defaultValue":a=u;break;case"children":l=u;break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(le(91));break;default:pt(e,t,c,u,n,null)}Cg(e,i,a,l);return;case"option":for(y in n)if(n.hasOwnProperty(y)&&(i=n[y],i!=null))switch(y){case"selected":e.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:pt(e,t,y,i,n,null)}return;case"dialog":tt("beforetoggle",e),tt("toggle",e),tt("cancel",e),tt("close",e);break;case"iframe":case"object":tt("load",e);break;case"video":case"audio":for(i=0;i<Fr.length;i++)tt(Fr[i],e);break;case"image":tt("error",e),tt("load",e);break;case"details":tt("toggle",e);break;case"embed":case"source":case"link":tt("error",e),tt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(v in n)if(n.hasOwnProperty(v)&&(i=n[v],i!=null))switch(v){case"children":case"dangerouslySetInnerHTML":throw Error(le(137,t));default:pt(e,t,v,i,n,null)}return;default:if(Eh(t)){for(g in n)n.hasOwnProperty(g)&&(i=n[g],i!==void 0&&Lf(e,t,g,i,n,void 0));return}}for(u in n)n.hasOwnProperty(u)&&(i=n[u],i!=null&&pt(e,t,u,i,n,null))}function HT(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,l=null,c=null,u=null,y=null,v=null,g=null;for(R in n){var E=n[R];if(n.hasOwnProperty(R)&&E!=null)switch(R){case"checked":break;case"value":break;case"defaultValue":y=E;default:i.hasOwnProperty(R)||pt(e,t,R,null,i,E)}}for(var I in i){var R=i[I];if(E=n[I],i.hasOwnProperty(I)&&(R!=null||E!=null))switch(I){case"type":l=R;break;case"name":a=R;break;case"checked":v=R;break;case"defaultChecked":g=R;break;case"value":c=R;break;case"defaultValue":u=R;break;case"children":case"dangerouslySetInnerHTML":if(R!=null)throw Error(le(137,t));break;default:R!==E&&pt(e,t,I,R,i,E)}}cf(e,c,u,y,v,g,l,a);return;case"select":R=c=u=I=null;for(l in n)if(y=n[l],n.hasOwnProperty(l)&&y!=null)switch(l){case"value":break;case"multiple":R=y;default:i.hasOwnProperty(l)||pt(e,t,l,null,i,y)}for(a in i)if(l=i[a],y=n[a],i.hasOwnProperty(a)&&(l!=null||y!=null))switch(a){case"value":I=l;break;case"defaultValue":u=l;break;case"multiple":c=l;default:l!==y&&pt(e,t,a,l,i,y)}t=u,n=c,i=R,I!=null?El(e,!!n,I,!1):!!i!=!!n&&(t!=null?El(e,!!n,t,!0):El(e,!!n,n?[]:"",!1));return;case"textarea":R=I=null;for(u in n)if(a=n[u],n.hasOwnProperty(u)&&a!=null&&!i.hasOwnProperty(u))switch(u){case"value":break;case"children":break;default:pt(e,t,u,null,i,a)}for(c in i)if(a=i[c],l=n[c],i.hasOwnProperty(c)&&(a!=null||l!=null))switch(c){case"value":I=a;break;case"defaultValue":R=a;break;case"children":break;case"dangerouslySetInnerHTML":if(a!=null)throw Error(le(91));break;default:a!==l&&pt(e,t,c,a,i,l)}Ag(e,I,R);return;case"option":for(var q in n)if(I=n[q],n.hasOwnProperty(q)&&I!=null&&!i.hasOwnProperty(q))switch(q){case"selected":e.selected=!1;break;default:pt(e,t,q,null,i,I)}for(y in i)if(I=i[y],R=n[y],i.hasOwnProperty(y)&&I!==R&&(I!=null||R!=null))switch(y){case"selected":e.selected=I&&typeof I!="function"&&typeof I!="symbol";break;default:pt(e,t,y,I,i,R)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var J in n)I=n[J],n.hasOwnProperty(J)&&I!=null&&!i.hasOwnProperty(J)&&pt(e,t,J,null,i,I);for(v in i)if(I=i[v],R=n[v],i.hasOwnProperty(v)&&I!==R&&(I!=null||R!=null))switch(v){case"children":case"dangerouslySetInnerHTML":if(I!=null)throw Error(le(137,t));break;default:pt(e,t,v,I,i,R)}return;default:if(Eh(t)){for(var K in n)I=n[K],n.hasOwnProperty(K)&&I!==void 0&&!i.hasOwnProperty(K)&&Lf(e,t,K,void 0,i,I);for(g in i)I=i[g],R=n[g],!i.hasOwnProperty(g)||I===R||I===void 0&&R===void 0||Lf(e,t,g,I,i,R);return}}for(var O in n)I=n[O],n.hasOwnProperty(O)&&I!=null&&!i.hasOwnProperty(O)&&pt(e,t,O,null,i,I);for(E in i)I=i[E],R=n[E],!i.hasOwnProperty(E)||I===R||I==null&&R==null||pt(e,t,E,I,i,R)}function lm(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function YT(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,n=performance.getEntriesByType("resource"),i=0;i<n.length;i++){var a=n[i],l=a.transferSize,c=a.initiatorType,u=a.duration;if(l&&u&&lm(c)){for(c=0,u=a.responseEnd,i+=1;i<n.length;i++){var y=n[i],v=y.startTime;if(v>u)break;var g=y.transferSize,E=y.initiatorType;g&&lm(E)&&(y=y.responseEnd,c+=g*(y<u?1:(u-v)/(y-v)))}if(--i,t+=8*(l+c)/(a.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Uf=null,$f=null;function Yc(e){return e.nodeType===9?e:e.ownerDocument}function rm(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function k0(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function zf(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Hd=null;function FT(){var e=window.event;return e&&e.type==="popstate"?e===Hd?!1:(Hd=e,!0):(Hd=null,!1)}var _0=typeof setTimeout=="function"?setTimeout:void 0,qT=typeof clearTimeout=="function"?clearTimeout:void 0,om=typeof Promise=="function"?Promise:void 0,WT=typeof queueMicrotask=="function"?queueMicrotask:typeof om<"u"?function(e){return om.resolve(null).then(e).catch(KT)}:_0;function KT(e){setTimeout(function(){throw e})}function ia(e){return e==="head"}function cm(e,t){var n=t,i=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"||n==="/&"){if(i===0){e.removeChild(a),Pl(t);return}i--}else if(n==="$"||n==="$?"||n==="$~"||n==="$!"||n==="&")i++;else if(n==="html")Br(e.ownerDocument.documentElement);else if(n==="head"){n=e.ownerDocument.head,Br(n);for(var l=n.firstChild;l;){var c=l.nextSibling,u=l.nodeName;l[io]||u==="SCRIPT"||u==="STYLE"||u==="LINK"&&l.rel.toLowerCase()==="stylesheet"||n.removeChild(l),l=c}}else n==="body"&&Br(e.ownerDocument.body);n=a}while(n);Pl(t)}function um(e,t){var n=e;e=0;do{var i=n.nextSibling;if(n.nodeType===1?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",n.getAttribute("style")===""&&n.removeAttribute("style")):n.nodeType===3&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(e===0)break;e--}else n!=="$"&&n!=="$?"&&n!=="$~"&&n!=="$!"||e++;n=i}while(n)}function Gf(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Gf(n),xh(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}e.removeChild(n)}}function VT(e,t,n,i){for(;e.nodeType===1;){var a=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(i){if(!e[io])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(l=e.getAttribute("rel"),l==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(l!==a.rel||e.getAttribute("href")!==(a.href==null||a.href===""?null:a.href)||e.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin)||e.getAttribute("title")!==(a.title==null?null:a.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(l=e.getAttribute("src"),(l!==(a.src==null?null:a.src)||e.getAttribute("type")!==(a.type==null?null:a.type)||e.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin))&&l&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var l=a.name==null?null:""+a.name;if(a.type==="hidden"&&e.getAttribute("name")===l)return e}else return e;if(e=pi(e.nextSibling),e===null)break}return null}function QT(e,t,n){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=pi(e.nextSibling),e===null))return null;return e}function O0(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=pi(e.nextSibling),e===null))return null;return e}function Hf(e){return e.data==="$?"||e.data==="$~"}function Yf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function XT(e,t){var n=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||n.readyState!=="loading")t();else{var i=function(){t(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}function pi(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var Ff=null;function dm(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"||n==="/&"){if(t===0)return pi(e.nextSibling);t--}else n!=="$"&&n!=="$!"&&n!=="$?"&&n!=="$~"&&n!=="&"||t++}e=e.nextSibling}return null}function fm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"){if(t===0)return e;t--}else n!=="/$"&&n!=="/&"||t++}e=e.previousSibling}return null}function B0(e,t,n){switch(t=Yc(n),e){case"html":if(e=t.documentElement,!e)throw Error(le(452));return e;case"head":if(e=t.head,!e)throw Error(le(453));return e;case"body":if(e=t.body,!e)throw Error(le(454));return e;default:throw Error(le(451))}}function Br(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);xh(e)}var yi=new Map,hm=new Set;function Fc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ts=ct.d;ct.d={f:ZT,r:JT,D:ev,C:tv,L:nv,m:iv,X:av,S:sv,M:lv};function ZT(){var e=Ts.f(),t=yu();return e||t}function JT(e){var t=Hl(e);t!==null&&t.tag===5&&t.type==="form"?Ib(t):Ts.r(e)}var Wl=typeof document>"u"?null:document;function j0(e,t,n){var i=Wl;if(i&&typeof t=="string"&&t){var a=ui(t);a='link[rel="'+e+'"][href="'+a+'"]',typeof n=="string"&&(a+='[crossorigin="'+n+'"]'),hm.has(a)||(hm.add(a),e={rel:e,crossOrigin:n,href:t},i.querySelector(a)===null&&(t=i.createElement("link"),yn(t,"link",e),ln(t),i.head.appendChild(t)))}}function ev(e){Ts.D(e),j0("dns-prefetch",e,null)}function tv(e,t){Ts.C(e,t),j0("preconnect",e,t)}function nv(e,t,n){Ts.L(e,t,n);var i=Wl;if(i&&e&&t){var a='link[rel="preload"][as="'+ui(t)+'"]';t==="image"&&n&&n.imageSrcSet?(a+='[imagesrcset="'+ui(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(a+='[imagesizes="'+ui(n.imageSizes)+'"]')):a+='[href="'+ui(e)+'"]';var l=a;switch(t){case"style":l=Ml(e);break;case"script":l=Kl(e)}yi.has(l)||(e=It({rel:"preload",href:t==="image"&&n&&n.imageSrcSet?void 0:e,as:t},n),yi.set(l,e),i.querySelector(a)!==null||t==="style"&&i.querySelector(co(l))||t==="script"&&i.querySelector(uo(l))||(t=i.createElement("link"),yn(t,"link",e),ln(t),i.head.appendChild(t)))}}function iv(e,t){Ts.m(e,t);var n=Wl;if(n&&e){var i=t&&typeof t.as=="string"?t.as:"script",a='link[rel="modulepreload"][as="'+ui(i)+'"][href="'+ui(e)+'"]',l=a;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":l=Kl(e)}if(!yi.has(l)&&(e=It({rel:"modulepreload",href:e},t),yi.set(l,e),n.querySelector(a)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(uo(l)))return}i=n.createElement("link"),yn(i,"link",e),ln(i),n.head.appendChild(i)}}}function sv(e,t,n){Ts.S(e,t,n);var i=Wl;if(i&&e){var a=xl(i).hoistableStyles,l=Ml(e);t=t||"default";var c=a.get(l);if(!c){var u={loading:0,preload:null};if(c=i.querySelector(co(l)))u.loading=5;else{e=It({rel:"stylesheet",href:e,"data-precedence":t},n),(n=yi.get(l))&&sp(e,n);var y=c=i.createElement("link");ln(y),yn(y,"link",e),y._p=new Promise(function(v,g){y.onload=v,y.onerror=g}),y.addEventListener("load",function(){u.loading|=1}),y.addEventListener("error",function(){u.loading|=2}),u.loading|=4,fc(c,t,i)}c={type:"stylesheet",instance:c,count:1,state:u},a.set(l,c)}}}function av(e,t){Ts.X(e,t);var n=Wl;if(n&&e){var i=xl(n).hoistableScripts,a=Kl(e),l=i.get(a);l||(l=n.querySelector(uo(a)),l||(e=It({src:e,async:!0},t),(t=yi.get(a))&&ap(e,t),l=n.createElement("script"),ln(l),yn(l,"link",e),n.head.appendChild(l)),l={type:"script",instance:l,count:1,state:null},i.set(a,l))}}function lv(e,t){Ts.M(e,t);var n=Wl;if(n&&e){var i=xl(n).hoistableScripts,a=Kl(e),l=i.get(a);l||(l=n.querySelector(uo(a)),l||(e=It({src:e,async:!0,type:"module"},t),(t=yi.get(a))&&ap(e,t),l=n.createElement("script"),ln(l),yn(l,"link",e),n.head.appendChild(l)),l={type:"script",instance:l,count:1,state:null},i.set(a,l))}}function pm(e,t,n,i){var a=(a=Gs.current)?Fc(a):null;if(!a)throw Error(le(446));switch(e){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(t=Ml(n.href),n=xl(a).hoistableStyles,i=n.get(t),i||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){e=Ml(n.href);var l=xl(a).hoistableStyles,c=l.get(e);if(c||(a=a.ownerDocument||a,c={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},l.set(e,c),(l=a.querySelector(co(e)))&&!l._p&&(c.instance=l,c.state.loading=5),yi.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},yi.set(e,n),l||rv(a,e,n,c.state))),t&&i===null)throw Error(le(528,""));return c}if(t&&i!==null)throw Error(le(529,""));return null;case"script":return t=n.async,n=n.src,typeof n=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Kl(n),n=xl(a).hoistableScripts,i=n.get(t),i||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(le(444,e))}}function Ml(e){return'href="'+ui(e)+'"'}function co(e){return'link[rel="stylesheet"]['+e+"]"}function M0(e){return It({},e,{"data-precedence":e.precedence,precedence:null})}function rv(e,t,n,i){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?i.loading=1:(t=e.createElement("link"),i.preload=t,t.addEventListener("load",function(){return i.loading|=1}),t.addEventListener("error",function(){return i.loading|=2}),yn(t,"link",n),ln(t),e.head.appendChild(t))}function Kl(e){return'[src="'+ui(e)+'"]'}function uo(e){return"script[async]"+e}function ym(e,t,n){if(t.count++,t.instance===null)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+ui(n.href)+'"]');if(i)return t.instance=i,ln(i),i;var a=It({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return i=(e.ownerDocument||e).createElement("style"),ln(i),yn(i,"style",a),fc(i,n.precedence,e),t.instance=i;case"stylesheet":a=Ml(n.href);var l=e.querySelector(co(a));if(l)return t.state.loading|=4,t.instance=l,ln(l),l;i=M0(n),(a=yi.get(a))&&sp(i,a),l=(e.ownerDocument||e).createElement("link"),ln(l);var c=l;return c._p=new Promise(function(u,y){c.onload=u,c.onerror=y}),yn(l,"link",i),t.state.loading|=4,fc(l,n.precedence,e),t.instance=l;case"script":return l=Kl(n.src),(a=e.querySelector(uo(l)))?(t.instance=a,ln(a),a):(i=n,(a=yi.get(l))&&(i=It({},n),ap(i,a)),e=e.ownerDocument||e,a=e.createElement("script"),ln(a),yn(a,"link",i),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error(le(443,t.type))}else t.type==="stylesheet"&&!(t.state.loading&4)&&(i=t.instance,t.state.loading|=4,fc(i,n.precedence,e));return t.instance}function fc(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=i.length?i[i.length-1]:null,l=a,c=0;c<i.length;c++){var u=i[c];if(u.dataset.precedence===t)l=u;else if(l!==a)break}l?l.parentNode.insertBefore(e,l.nextSibling):(t=n.nodeType===9?n.head:n,t.insertBefore(e,t.firstChild))}function sp(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function ap(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var hc=null;function mm(e,t,n){if(hc===null){var i=new Map,a=hc=new Map;a.set(n,i)}else a=hc,i=a.get(n),i||(i=new Map,a.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),a=0;a<n.length;a++){var l=n[a];if(!(l[io]||l[fn]||e==="link"&&l.getAttribute("rel")==="stylesheet")&&l.namespaceURI!=="http://www.w3.org/2000/svg"){var c=l.getAttribute(t)||"";c=e+c;var u=i.get(c);u?u.push(l):i.set(c,[l])}}return i}function gm(e,t,n){e=e.ownerDocument||e,e.head.insertBefore(n,t==="title"?e.querySelector("head > title"):null)}function ov(e,t,n){if(n===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function P0(e){return!(e.type==="stylesheet"&&!(e.state.loading&3))}function cv(e,t,n,i){if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&!(n.state.loading&4)){if(n.instance===null){var a=Ml(i.href),l=t.querySelector(co(a));if(l){t=l._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=qc.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=l,ln(l);return}l=t.ownerDocument||t,i=M0(i),(a=yi.get(a))&&sp(i,a),l=l.createElement("link"),ln(l);var c=l;c._p=new Promise(function(u,y){c.onload=u,c.onerror=y}),yn(l,"link",i),n.instance=l}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(n.state.loading&3)&&(e.count++,n=qc.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}var Yd=0;function uv(e,t){return e.stylesheets&&e.count===0&&pc(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var i=setTimeout(function(){if(e.stylesheets&&pc(e,e.stylesheets),e.unsuspend){var l=e.unsuspend;e.unsuspend=null,l()}},6e4+t);0<e.imgBytes&&Yd===0&&(Yd=62500*YT());var a=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&pc(e,e.stylesheets),e.unsuspend)){var l=e.unsuspend;e.unsuspend=null,l()}},(e.imgBytes>Yd?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(i),clearTimeout(a)}}:null}function qc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Wc=null;function pc(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Wc=new Map,t.forEach(dv,e),Wc=null,qc.call(e))}function dv(e,t){if(!(t.state.loading&4)){var n=Wc.get(e);if(n)var i=n.get(null);else{n=new Map,Wc.set(e,n);for(var a=e.querySelectorAll("link[data-precedence],style[data-precedence]"),l=0;l<a.length;l++){var c=a[l];(c.nodeName==="LINK"||c.getAttribute("media")!=="not all")&&(n.set(c.dataset.precedence,c),i=c)}i&&n.set(null,i)}a=t.instance,c=a.getAttribute("data-precedence"),l=n.get(c)||i,l===i&&n.set(null,a),n.set(c,a),this.count++,i=qc.bind(this),a.addEventListener("load",i),a.addEventListener("error",i),l?l.parentNode.insertBefore(a,l.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(a,e.firstChild)),t.state.loading|=4}}var Wr={$$typeof:os,Provider:null,Consumer:null,_currentValue:Na,_currentValue2:Na,_threadCount:0};function fv(e,t,n,i,a,l,c,u,y){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=hd(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hd(0),this.hiddenUpdates=hd(null),this.identifierPrefix=i,this.onUncaughtError=a,this.onCaughtError=l,this.onRecoverableError=c,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=y,this.incompleteTransitions=new Map}function L0(e,t,n,i,a,l,c,u,y,v,g,E){return e=new fv(e,t,n,c,y,v,g,E,u),t=1,l===!0&&(t|=24),l=qn(3,null,null,t),e.current=l,l.stateNode=e,t=kh(),t.refCount++,e.pooledCache=t,t.refCount++,l.memoizedState={element:i,isDehydrated:n,cache:t},Bh(l),e}function U0(e){return e?(e=pl,e):pl}function $0(e,t,n,i,a,l){a=U0(a),i.context===null?i.context=a:i.pendingContext=a,i=Ys(t),i.payload={element:n},l=l===void 0?null:l,l!==null&&(i.callback=l),n=Fs(e,i,t),n!==null&&(kn(n,e,t),Cr(n,e,t))}function bm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function lp(e,t){bm(e,t),(e=e.alternate)&&bm(e,t)}function z0(e){if(e.tag===13||e.tag===31){var t=Pa(e,67108864);t!==null&&kn(t,e,67108864),lp(e,67108864)}}function xm(e){if(e.tag===13||e.tag===31){var t=Xn();t=gh(t);var n=Pa(e,t);n!==null&&kn(n,e,t),lp(e,t)}}var Kc=!0;function hv(e,t,n,i){var a=$e.T;$e.T=null;var l=ct.p;try{ct.p=2,rp(e,t,n,i)}finally{ct.p=l,$e.T=a}}function pv(e,t,n,i){var a=$e.T;$e.T=null;var l=ct.p;try{ct.p=8,rp(e,t,n,i)}finally{ct.p=l,$e.T=a}}function rp(e,t,n,i){if(Kc){var a=qf(i);if(a===null)Gd(e,t,i,Vc,n),Em(e,i);else if(mv(a,e,t,n,i))i.stopPropagation();else if(Em(e,i),t&4&&-1<yv.indexOf(e)){for(;a!==null;){var l=Hl(a);if(l!==null)switch(l.tag){case 3:if(l=l.stateNode,l.current.memoizedState.isDehydrated){var c=pa(l.pendingLanes);if(c!==0){var u=l;for(u.pendingLanes|=2,u.entangledLanes|=2;c;){var y=1<<31-Qn(c);u.entanglements[1]|=y,c&=~y}Fi(l),!(ot&6)&&(Lc=Kn()+500,oo(0))}}break;case 31:case 13:u=Pa(l,2),u!==null&&kn(u,l,2),yu(),lp(l,2)}if(l=qf(i),l===null&&Gd(e,t,i,Vc,n),l===a)break;a=l}a!==null&&i.stopPropagation()}else Gd(e,t,i,null,n)}}function qf(e){return e=Th(e),op(e)}var Vc=null;function op(e){if(Vc=null,e=ol(e),e!==null){var t=Jr(e);if(t===null)e=null;else{var n=t.tag;if(n===13){if(e=rg(t),e!==null)return e;e=null}else if(n===31){if(e=og(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Vc=e,null}function G0(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(eE()){case fg:return 2;case hg:return 8;case wc:case tE:return 32;case pg:return 268435456;default:return 32}default:return 32}}var Wf=!1,Ks=null,Vs=null,Qs=null,Kr=new Map,Vr=new Map,js=[],yv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Em(e,t){switch(e){case"focusin":case"focusout":Ks=null;break;case"dragenter":case"dragleave":Vs=null;break;case"mouseover":case"mouseout":Qs=null;break;case"pointerover":case"pointerout":Kr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vr.delete(t.pointerId)}}function yr(e,t,n,i,a,l){return e===null||e.nativeEvent!==l?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:l,targetContainers:[a]},t!==null&&(t=Hl(t),t!==null&&z0(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function mv(e,t,n,i,a){switch(t){case"focusin":return Ks=yr(Ks,e,t,n,i,a),!0;case"dragenter":return Vs=yr(Vs,e,t,n,i,a),!0;case"mouseover":return Qs=yr(Qs,e,t,n,i,a),!0;case"pointerover":var l=a.pointerId;return Kr.set(l,yr(Kr.get(l)||null,e,t,n,i,a)),!0;case"gotpointercapture":return l=a.pointerId,Vr.set(l,yr(Vr.get(l)||null,e,t,n,i,a)),!0}return!1}function H0(e){var t=ol(e.target);if(t!==null){var n=Jr(t);if(n!==null){if(t=n.tag,t===13){if(t=rg(n),t!==null){e.blockedOn=t,sy(e.priority,function(){xm(n)});return}}else if(t===31){if(t=og(n),t!==null){e.blockedOn=t,sy(e.priority,function(){xm(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function yc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=qf(e.nativeEvent);if(n===null){n=e.nativeEvent;var i=new n.constructor(n.type,n);df=i,n.target.dispatchEvent(i),df=null}else return t=Hl(n),t!==null&&z0(t),e.blockedOn=n,!1;t.shift()}return!0}function Tm(e,t,n){yc(e)&&n.delete(t)}function gv(){Wf=!1,Ks!==null&&yc(Ks)&&(Ks=null),Vs!==null&&yc(Vs)&&(Vs=null),Qs!==null&&yc(Qs)&&(Qs=null),Kr.forEach(Tm),Vr.forEach(Tm)}function Go(e,t){e.blockedOn===t&&(e.blockedOn=null,Wf||(Wf=!0,Xt.unstable_scheduleCallback(Xt.unstable_NormalPriority,gv)))}var Ho=null;function vm(e){Ho!==e&&(Ho=e,Xt.unstable_scheduleCallback(Xt.unstable_NormalPriority,function(){Ho===e&&(Ho=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],a=e[t+2];if(typeof i!="function"){if(op(i||n)===null)continue;break}var l=Hl(n);l!==null&&(e.splice(t,3),t-=3,If(l,{pending:!0,data:a,method:n.method,action:i},i,a))}}))}function Pl(e){function t(y){return Go(y,e)}Ks!==null&&Go(Ks,e),Vs!==null&&Go(Vs,e),Qs!==null&&Go(Qs,e),Kr.forEach(t),Vr.forEach(t);for(var n=0;n<js.length;n++){var i=js[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<js.length&&(n=js[0],n.blockedOn===null);)H0(n),n.blockedOn===null&&js.shift();if(n=(e.ownerDocument||e).$$reactFormReplay,n!=null)for(i=0;i<n.length;i+=3){var a=n[i],l=n[i+1],c=a[On]||null;if(typeof l=="function")c||vm(n);else if(c){var u=null;if(l&&l.hasAttribute("formAction")){if(a=l,c=l[On]||null)u=c.formAction;else if(op(a)!==null)continue}else u=c.action;typeof u=="function"?n[i+1]=u:(n.splice(i,3),i-=3),vm(n)}}}function Y0(){function e(l){l.canIntercept&&l.info==="react-transition"&&l.intercept({handler:function(){return new Promise(function(c){return a=c})},focusReset:"manual",scroll:"manual"})}function t(){a!==null&&(a(),a=null),i||setTimeout(n,20)}function n(){if(!i&&!navigation.transition){var l=navigation.currentEntry;l&&l.url!=null&&navigation.navigate(l.url,{state:l.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,a=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){i=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),a!==null&&(a(),a=null)}}}function cp(e){this._internalRoot=e}bu.prototype.render=cp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(le(409));var n=t.current,i=Xn();$0(n,i,e,t,null,null)};bu.prototype.unmount=cp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;$0(e.current,2,null,e,null,null),yu(),t[Gl]=null}};function bu(e){this._internalRoot=e}bu.prototype.unstable_scheduleHydration=function(e){if(e){var t=xg();e={blockedOn:null,target:e,priority:t};for(var n=0;n<js.length&&t!==0&&t<js[n].priority;n++);js.splice(n,0,e),n===0&&H0(e)}};var Nm=ag.version;if(Nm!=="19.2.4")throw Error(le(527,Nm,"19.2.4"));ct.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(le(188)):(e=Object.keys(e).join(","),Error(le(268,e)));return e=W1(t),e=e!==null?cg(e):null,e=e===null?null:e.stateNode,e};var bv={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:$e,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yo.isDisabled&&Yo.supportsFiber)try{eo=Yo.inject(bv),Vn=Yo}catch{}}tu.createRoot=function(e,t){if(!lg(e))throw Error(le(299));var n=!1,i="",a=jb,l=Mb,c=Pb;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onUncaughtError!==void 0&&(a=t.onUncaughtError),t.onCaughtError!==void 0&&(l=t.onCaughtError),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=L0(e,1,!1,null,null,n,i,null,a,l,c,Y0),e[Gl]=t.current,ip(e),new cp(t)};tu.hydrateRoot=function(e,t,n){if(!lg(e))throw Error(le(299));var i=!1,a="",l=jb,c=Mb,u=Pb,y=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onUncaughtError!==void 0&&(l=n.onUncaughtError),n.onCaughtError!==void 0&&(c=n.onCaughtError),n.onRecoverableError!==void 0&&(u=n.onRecoverableError),n.formState!==void 0&&(y=n.formState)),t=L0(e,1,!0,t,n??null,i,a,y,l,c,u,Y0),t.context=U0(null),n=t.current,i=Xn(),i=gh(i),a=Ys(i),a.callback=null,Fs(n,a,i),n=i,t.current.lanes=n,no(t,n),Fi(t),e[Gl]=t.current,ip(e),new bu(t)};tu.version="19.2.4";function F0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(F0)}catch(e){console.error(e)}}F0(),Jm.exports=tu;var xv=Jm.exports;const Ev=Hm(xv);let mc=null,Tv=1;const Be=e=>`${e}_${Tv++}`;function al(e,t,n){var u;const i=e.players[t],a=i.runesInPlay.findIndex(y=>y.instanceId===n);if(a<0)return!1;const l=i.runesInPlay[a];i.runesInPlay.splice(a,1),i.runePool.power[l.domain]+=1,i.runeDeck.push({...l,isReady:!0}),e.log.unshift(`${t} recycled a ${l.domain} rune to add 1 ${l.domain} power.`);const c=i.legend;if(i.legendReady&&c){const y=((u=c.ability)==null?void 0:u.raw_text)||"";if(/when you recycle a rune,?\s*you may exhaust me to/i.test(y)){const v=y.match(/when you recycle a rune,?\s*you may exhaust me to\s+([^.]+)/i);v&&(e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${c.name} (Recycle)`,effectText:`You may exhaust your legend to ${v[1].trim()}.`,targets:[{kind:"NONE"}],needsTargets:!1,sourceInstanceId:c.id,sourceCardType:"Legend"}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0)}}return!0}function gc(e){return(e.power.Body||0)+(e.power.Calm||0)+(e.power.Chaos||0)+(e.power.Fury||0)+(e.power.Mind||0)+(e.power.Order||0)+(e.power.Colorless||0)}const wm=e=>e==="P1"||e==="P2",is=e=>{const t=globalThis.structuredClone;if(typeof t=="function")try{return t(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{const n=new WeakSet,i=JSON.stringify(e,(a,l)=>{if(typeof l=="function"||typeof Event<"u"&&l instanceof Event)return;const c=globalThis.Node;if(!(typeof c<"u"&&l instanceof c)){if(l&&typeof l=="object"){if(n.has(l))return;n.add(l)}return l}});return JSON.parse(i)}},Fo=(e,t,n)=>({id:"HIDDEN",name:"Hidden Card",domain:"Colorless",cost:0,type:"Spell",stats:{might:null,power:null},tags:[],ability:void 0,rarity:"Unknown",image:void 0,image_url:void 0,instanceId:`HIDDEN_${e}_${t}_${n}`,owner:e,controller:e,isReady:!1,damage:0,buffs:0,tempMightBonus:0,stunned:!1,stunnedUntilTurn:0,moveCountThisTurn:0,conditionalKeywords:[],createdTurn:0}),vv=(e,t,n)=>({instanceId:`HIDDEN_RUNE_${e}_${t}_${n}`,owner:e,controller:e,domain:"Colorless",isReady:!1,createdTurn:0}),Nv=(e,t,n)=>{const i=is(e),a=u=>t===u?!0:n.revealHands,l=u=>t===u?!0:n.revealFacedown,c=()=>n.revealDecks;for(const u of["P1","P2"]){const y=i.players[u];a(u)||(y.hand=y.hand.map((v,g)=>Fo(u,"HAND",g))),c()||(y.mainDeck=y.mainDeck.map((v,g)=>Fo(u,"MAIN_DECK",g)),y.runeDeck=y.runeDeck.map((v,g)=>vv(u,"RUNE_DECK",g)))}for(let u=0;u<i.battlefields.length;u++){const y=i.battlefields[u];y.facedown&&!l(y.facedown.owner)&&(y.facedown={...y.facedown,card:Fo(y.facedown.owner,`FACEDOWN_BF${u}`,0)}),y.facedownExtra&&!l(y.facedownExtra.owner)&&(y.facedownExtra={...y.facedownExtra,card:Fo(y.facedownExtra.owner,`FACEDOWN_BF${u}_EXTRA`,0)})}return i},xt=e=>e==="P1"?"P2":"P1",Yt=e=>e.split(",").map(t=>t.trim()).filter(Boolean).map(t=>t),ut=e=>{const t=e.trim();return["Body","Calm","Chaos","Fury","Mind","Order","Colorless"].includes(t)?t:"Colorless"},fo=["Body","Calm","Chaos","Fury","Mind","Order"],wv={ahri:"Calm, Mind",annie:"Fury, Chaos",azir:"Mind, Order",darius:"Fury, Order",draven:"Fury, Chaos",ezreal:"Mind, Chaos",fiora:"Body, Order",garen:"Body, Order",irelia:"Calm, Body",jax:"Body, Fury",jinx:"Fury, Chaos",kaisa:"Fury, Mind",leesin:"Calm, Body",leona:"Calm, Order",lucian:"Order, Fury",lux:"Mind, Order",masteryi:"Calm, Body",missfortune:"Body, Chaos",ornn:"Body, Fury",reksai:"Fury, Chaos",renataglasc:"Mind, Chaos",rumble:"Fury, Mind",sett:"Body, Order",sivir:"Fury, Body",teemo:"Mind, Chaos",viktor:"Mind, Order",volibear:"Fury, Body",yasuo:"Calm, Chaos",bandlecity:"Mind, Chaos",bilgewater:"Fury, Chaos",demacia:"Order, Body",freljord:"Fury, Body",ionia:"Calm, Mind",ixtal:"Body, Calm",mounttargon:"Calm, Order",noxus:"Fury, Order",piltover:"Mind, Order",shadowisles:"Chaos, Mind",shurima:"Mind, Order",thevoid:"Fury, Chaos",zaun:"Mind, Chaos",bird:"Calm",cat:"Body",dog:"Body",dragon:"Fury",elite:"Order",fae:"Calm",mech:"Mind, Fury",pirate:"Fury, Chaos",poro:"Calm",recruit:"Colorless",spirit:"Calm",trifarian:"Fury",yordle:"Mind",akshan:"Body, Order",aphelios:"Calm, Mind",bard:"Calm, Mind",blitzcrank:"Mind",caitlyn:"Mind, Order","dr.mundo":"Body, Chaos",ekko:"Mind, Chaos",heimerdinger:"Mind",janna:"Calm",jayce:"Mind, Order",karthus:"Chaos, Mind",kayn:"Chaos, Body",kogmaw:"Fury, Chaos",malzahar:"Mind, Chaos",nocturne:"Chaos",qiyana:"Body, Calm",rell:"Order, Body",shen:"Order, Calm",sona:"Calm, Mind",soraka:"Calm, Order",taric:"Calm, Order",tryndamere:"Fury, Body",twistedfate:"Chaos, Mind",udyr:"Body, Fury",vayne:"Order, Fury",vi:"Fury, Body",warwick:"Body, Chaos",yone:"Calm, Chaos",equipment:"Colorless"},Av=e=>{if(!e||!e.includes("-"))return null;const[,t]=e.split("-",2);if(!t)return null;const n=t.split(/[,/]/).map(i=>i.trim().toLowerCase().replace(/\s+/g,"").replace(/'/g,"")).filter(i=>i&&i!=="nan");for(const i of n){const a=wv[i];if(a)return a}return null},Am=e=>e.replace(/\bNaN\b/g,"null"),Ll=e=>e.toLowerCase().replace(/\s+/g," ").replace(/[^\w\s-]/g,"").trim(),Fd=e=>e.toLowerCase().replace(/[^a-z0-9]/g,"").trim(),Cv=e=>{if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e!="string")return null;const t=e.trim();return t?/^\d+$/.test(t)?parseInt(t,10):/^c+$/i.test(t)?t.length:null:null},Iv=e=>e.split(/\s+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ").trim(),Sv=e=>{if(!e||!e.includes("-"))return[];const[,t]=e.split("-",2);return t?t.split(/[,/]/).map(n=>Iv(n.trim())).filter(n=>n&&n.toLowerCase()!=="nan"):[]},Dv=e=>{const t=e.toLowerCase();return fo.find(i=>t.includes(i.toLowerCase()))||null},Ul=e=>e.replace(/^(\s*\[[^\]]+\]\s*)+/g,"").trim(),Qr=e=>(e||"").replace(/\\/g,"").replace(/_/g," ").replace(/[]/g,'"').replace(/[]/g,"").replace(/\s+/g," ").trim(),Rv=e=>(e||"").replace(/\\/g,"").replace(/_/g," ").replace(/[]/g,'"').replace(/[]/g,"").split(/\.(?:\s+|$)|\n+/).map(n=>Qr(n)).filter(Boolean),up=e=>{const t=[],n=Rv(e);for(const i of n){const a=/\[\s*legion\s*\]/i.test(i)||/^\s*legion\b/i.test(i);let l=Ul(i).trim();if(l=l.replace(/^[-]\s*/,"").trim(),!/^(when|whenever|as you play|at the start|at the beginning|at the end|after|while)\b/i.test(l))continue;let c=l,u="";const y=l.match(/^(.*?)(?:,|||-|:)\s*(.+)$/);if(y&&(c=y[1].trim(),u=y[2].trim()),!u)continue;u=u.replace(/^[-]\s*/,"").trim();const v=c.split(/\s+(?:and|or)\s+(?=when\b|whenever\b|as you play|at the start|at the beginning|at the end|after|while)/i);for(const g of v){const E=g.replace(/^[-]\s*/,"").trim();E&&t.push({trigger:E,effectText:u,isLegion:a})}}return t},Cm=(e,t)=>{const n=Qr(e).toLowerCase();switch(t){case"PLAY_ME":return/when you play (me|this)\b/.test(n)||/as you play (me|this)\b/.test(n)||/when this is played\b/.test(n)||/when i'?m played\b/.test(n)||/when i'm played\b/.test(n);case"PLAY_TO_BF":return/when you play me to a battlefield\b/.test(n);case"ATTACK":return/when i attack\b/.test(n)||/when i attack or defend\b/.test(n);case"DEFEND":return/when i defend\b/.test(n)||/when i attack or defend\b/.test(n)||/when i defend or i'm played from\b/.test(n);case"CHOOSE_ME":return/when you choose me\b/.test(n)||/when you choose or ready me\b/.test(n);case"READY_ME":return/when you ready me\b/.test(n)||/when you choose or ready me\b/.test(n);case"MOVE":return/when i move\b/.test(n)&&!/when i move to a battlefield\b/.test(n);case"MOVE_TO_BF":return/when i move to a battlefield\b/.test(n);case"CONQUER":return/when i conquer\b/.test(n);case"HOLD":return/when i hold\b/.test(n);case"DISCARD_ME":return/when you discard me\b/.test(n);default:return!1}},dp=e=>{let t=(e||"").trim();return t?(t=t.replace(/\bKill\s+this[:\s-]+[^.]*\.?/gi,"").trim(),t=t.replace(/\bExhaust\s+this[:\s-]+[^.]*\.?/gi,"").trim(),t=t.replace(/\bSpend\s+my\s+buff[:\s-]+[^.]*\.?/gi,"").trim(),t=t.replace(/^[.\s]+|[.\s]+$/g,"").trim(),t):""},Es=(e,t,n)=>{var u,y,v,g,E;const i=new Set,a=(((u=e==null?void 0:e.ability)==null?void 0:u.raw_text)||((y=e==null?void 0:e.ability)==null?void 0:y.effect_text)||"").toString(),l=up(a),c=I=>{const R=dp(Ul(I||""));R&&i.add(R)};for(const I of l)I.isLegion||Cm(I.trigger,t)&&c(I.effectText);if(i.size===0){const I=((v=e==null?void 0:e.ability)==null?void 0:v.trigger)||"";I&&Cm(I,t)&&c(((g=e==null?void 0:e.ability)==null?void 0:g.effect_text)||((E=e==null?void 0:e.ability)==null?void 0:E.raw_text)||"")}return Array.from(i)},Im=(e,t)=>{const n=Qr(e).toLowerCase();switch(t){case"CONQUER_HERE":return/when you conquer here/.test(n);case"HOLD_HERE":return/when you hold here/.test(n);case"ATTACK_HERE":return/when you attack here/.test(n);case"DEFEND_HERE":return/when you defend here/.test(n);case"MOVE_FROM_HERE":return/when a unit moves from here/.test(n)||/when a friendly unit moves from here/.test(n);case"START_FIRST_BEGINNING":return/at the start of each player's first beginning phase/.test(n);default:return!1}},$l=(e,t)=>{var c,u,y,v,g;const n=new Set,i=(((c=e==null?void 0:e.ability)==null?void 0:c.raw_text)||((u=e==null?void 0:e.ability)==null?void 0:u.effect_text)||"").toString(),a=up(i),l=E=>{const I=dp(Ul(E||""));I&&n.add(I)};for(const E of a)Im(E.trigger,t)&&l(E.effectText);if(n.size===0){const E=((y=e==null?void 0:e.ability)==null?void 0:y.trigger)||"";E&&Im(E,t)&&l(((v=e==null?void 0:e.ability)==null?void 0:v.effect_text)||((g=e==null?void 0:e.ability)==null?void 0:g.raw_text)||"")}return Array.from(n)},kv=(e,t)=>{const n=e.trim();if(!n)return{};const i=((t==null?void 0:t.chain)||[]).map(u=>{var y;return u.type==="TRIGGERED_ABILITY"?(y=u.condition)==null?void 0:y.trim():""}).filter(Boolean),a=/^(when|whenever|at the start|at the beginning|at the end|after)\b/i;let l=i.find(u=>a.test(u));if(!l){const y=Ul(n).match(/^(when|whenever|at the start|at the beginning|at the end|after)\b[^.,]*[.,]/i);y&&(l=y[0].replace(/[.,]$/,"").trim())}if(!l)return{effectText:n};const c=Ul(n);if(c.toLowerCase().startsWith(l.toLowerCase())){let u=c.slice(l.length).trim();return/^[,-]/.test(u)&&(u=u.slice(1).trim()),{trigger:l,effectText:u||n}}return{trigger:l,effectText:n}},_v=(e,t=[])=>{const n=new Map,i=new Map;return t.forEach(a=>{n.set(Fd(a.id),a),i.set(Ll(a.name),a)}),e.map(a=>{var j,P,ee,ne,te,se,Q,ce,We,Ue,Ke;const l=((j=a.id)==null?void 0:j.split("/")[0])??a.id,c=n.get(Fd(l))||n.get(Fd(a.id))||i.get(Ll(a.name)),u=a.type_line||"",y=(P=u.split("-")[0])==null?void 0:P.trim().toLowerCase(),v={unit:"Unit",spell:"Spell",gear:"Gear",rune:"Rune",battlefield:"Battlefield",legend:"Legend"},g=(((ne=(ee=a.rules_text)==null?void 0:ee.raw)==null?void 0:ne.toString())??"").replace(/\\/g,"").trim(),E=[...((te=a.rules_text)==null?void 0:te.keywords)||[],...jr(g)].filter(ze=>ze&&!W0(ze)),{trigger:I,effectText:R}=kv(g,a.game_logic),q=Sv(u),J=(a.supertypes||"").toString(),K=/\btoken\b/i.test(J),O=Array.from(new Set([...(c==null?void 0:c.tags)||[],...q,...K?["Token"]:[]])),k=a.domain||(c==null?void 0:c.domain)||Av(u)||(v[y]==="Rune"?Dv(a.name):null)||"Colorless";return{id:a.id,name:a.name,rarity:a.rarity||(c==null?void 0:c.rarity),domain:k,cost:Number.isFinite((se=a.stats)==null?void 0:se.energy)?Number((Q=a.stats)==null?void 0:Q.energy):(c==null?void 0:c.cost)??0,type:v[y]||(c==null?void 0:c.type)||"Unit",tags:O,image_url:a.image_url||(c==null?void 0:c.image_url),image:c==null?void 0:c.image,stats:{might:Number.isFinite((ce=a.stats)==null?void 0:ce.might)?Number((We=a.stats)==null?void 0:We.might):(c==null?void 0:c.stats.might)??null,power:Cv((Ue=a.stats)==null?void 0:Ue.power)??(c==null?void 0:c.stats.power)??null},ability:g||E.length?{trigger:I||((Ke=c==null?void 0:c.ability)==null?void 0:Ke.trigger),effect_text:(R==null?void 0:R.trim())||g.trim(),raw_text:g.trim(),keywords:Array.from(new Set(E))}:c==null?void 0:c.ability}})},Li=()=>({energy:0,power:{Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0}}),ds=(e,t)=>{var i;const n=(((i=e.players[t])==null?void 0:i.domains)||[]).map(ut).filter(a=>a!=="Colorless");return n.length>0?n:fo},Hi=(e,t=0)=>{const n=[...e];let i=(t||Date.now())+Math.floor(Math.random()*1e9);for(let a=n.length-1;a>0;a--){i=(i*9301+49297)%233280;const l=i/233280,c=Math.floor(l*(a+1));[n[a],n[c]]=[n[c],n[a]]}return n},fp=e=>{var l;const t=(((l=e==null?void 0:e.ability)==null?void 0:l.keywords)||[]).filter(c=>typeof c=="string"),n=((e==null?void 0:e.extraKeywords)||[]).filter(c=>typeof c=="string"),i=((e==null?void 0:e.tempKeywords)||[]).filter(c=>typeof c=="string"),a=((e==null?void 0:e.conditionalKeywords)||[]).filter(c=>typeof c=="string");return[...t,...n,...i,...a]},lt=(e,t)=>{const n=fp(e),i=t.toLowerCase();return n.some(a=>(a||"").toLowerCase().startsWith(i))},ga=e=>{var t,n;return`${((t=e==null?void 0:e.ability)==null?void 0:t.raw_text)||""} ${((n=e==null?void 0:e.ability)==null?void 0:n.effect_text)||""}`.trim()},Sm=e=>!!e&&lt(e,"Hidden"),ss=e=>!e||e.type!=="Gear"?!1:lt(e,"Equip")||(e.type_line||"").toLowerCase().includes("equipment")?!0:/\[\s*equip\s*\]/i.test(ga(e)),Kf=e=>{if(!e)return!1;const t=e.tags||[];return Array.isArray(t)&&t.some(i=>String(i||"").toLowerCase()==="token")?!0:String(e.id||"").startsWith("token_")},Ov=e=>!!e&&lt(e,"Quick-Draw"),Dm=e=>{var c,u;if(!ss(e))return null;const t=(((c=e.ability)==null?void 0:c.raw_text)||((u=e.ability)==null?void 0:u.effect_text)||"").toLowerCase(),n=t.match(/\[equip\].*?\[(\d+)\].*?\[c\]/i)||t.match(/\[equip\]\s*\\?\[(\d+)\]\\?\[c\]/i),i=n?parseInt(n[1],10):0,a=t.match(/\[equip\].*?\[(c+)\]/i),l=a?a[1].length:1;return!a&&!t.includes("[equip]")?null:{energy:i,power:l,powerDomain:"CLASS"}},Vf=(e,t)=>{const n=fp(e),i=t.toLowerCase();let a=0;for(const l of n)if(l&&l.toLowerCase().startsWith(i)){const c=l.split(" ").filter(Boolean),u=parseInt(c[c.length-1],10);a+=Number.isFinite(u)?u:1}return a},Me=(e,t,n)=>{const a=e.players[t].base.units.find(l=>l.instanceId===n);if(a)return{zone:"BASE",unit:a};for(const l of e.battlefields){const c=l.units[t].find(u=>u.instanceId===n);if(c)return{zone:"BF",battlefieldIndex:l.index,unit:c}}return null},Pe=(e,t)=>{var g,E,I,R,q,J;const n=(t==null?void 0:t.battlefieldIndex)!=null?t.battlefieldIndex:t!=null&&t.game?(()=>{const K=Me(t.game,e.owner,e.instanceId);return K&&K.zone==="BF"?K.battlefieldIndex??null:null})():null,i=e.stats.might??0,a=e.buffs||0,l=e.tempMightBonus||0;let u=(e.attachedGear||[]).reduce((K,O)=>{var j;const k=((j=O.stats)==null?void 0:j.might)??0;return K+k},0);(t==null?void 0:t.role)==="ATTACKER"&&(u+=Vf(e,"Assault")),(t==null?void 0:t.role)==="DEFENDER"&&(u+=Vf(e,"Shield"));const y=`${((g=e.ability)==null?void 0:g.effect_text)||""} ${((E=e.ability)==null?void 0:E.raw_text)||""}`,v=y.match(/(?:^|[.!?]\s*)i have (?:an additional )?\+(\d+) might\b/i);if(v){const K=parseInt(v[1],10);Number.isFinite(K)&&(u+=K)}if(e.buffs>0){const K=y.match(/while i'm buffed,?\s*i have (?:an additional )?\+(\d+) might\b/i);if(K){const O=parseInt(K[1],10);Number.isFinite(O)&&(u+=O)}}if(t!=null&&t.alone){const K=y.match(/while i'm attacking or defending alone,?\s*i have \+(\d+) might\b/i);if(K){const O=parseInt(K[1],10);Number.isFinite(O)&&(u+=O)}}if(t!=null&&t.game){const O=t.game.players[e.controller].runesInPlay.length;if(/while you have 8\+ runes/i.test(y)&&O>=8){const P=y.match(/while you have 8\+ runes,?\s*i have \+(\d+) might/i),ee=P?parseInt(P[1],10):0;Number.isFinite(ee)&&(u+=ee)}const k=y.match(/i have \+(\d+)\s+might\s+for each friendly gear/i);if(k){const P=parseInt(k[1],10);if(Number.isFinite(P)&&P>0){const ee=Q0(t.game,e.controller).length;u+=P*ee}}const j=y.match(/i get \+(\d+)\s*\[?s\]?\s+for each buffed friendly unit at my battlefield/i);if(j&&n!=null){const P=parseInt(j[1],10);if(Number.isFinite(P)&&P>0){const ne=t.game.battlefields[n].units[e.controller].filter(te=>(te.buffs||0)>0).length;u+=P*ne}}if(n!=null){const P=t.game.battlefields[n],ne=(((I=P.card.rules_text)==null?void 0:I.raw)||((R=P.card.ability)==null?void 0:R.effect_text)||"").match(/units here have \+(\d+)\s*\[?s\]?/i);if(ne){const te=parseInt(ne[1],10);Number.isFinite(te)&&(u+=te)}}if(n!=null&&e.stunned){const P=t.game.battlefields[n],ee=xt(e.controller),ne=P.units[ee].find(te=>{var se,Q;return/stunned enemy units here have -\d+ might/i.test(`${((se=te.ability)==null?void 0:se.effect_text)||""} ${((Q=te.ability)==null?void 0:Q.raw_text)||""}`)});if(ne){const te=`${((q=ne.ability)==null?void 0:q.effect_text)||""} ${((J=ne.ability)==null?void 0:J.raw_text)||""}`;if(/within 3 points of the victory score/i.test(te)){const We=xt(ne.controller);if(t.game.players[We].points<t.game.victoryScore-3)return Math.max(0,i+a+l+u)}const se=te.match(/stunned enemy units here have -(\d+) might/i),Q=se?parseInt(se[1],10):0;Number.isFinite(Q)&&Q>0&&(u-=Q);const ce=te.match(/minimum of (\d+) might/i);if(ce){const We=parseInt(ce[1],10),Ue=i+a+l+u;return Math.max(We,Ue)}}}}return Math.max(0,i+a+l+u)},Cl=e=>e==="Unit"||e==="Spell"||e==="Gear",bc=8,ho=(e,t)=>Pe(e,{role:"NONE",game:t})>=5,Sa=(e,t,n)=>{var c,u,y;const i=Pe(t,{role:"NONE",game:e}),a=n>=5,l=i>=5;if(!a&&l){e.log.unshift(`${t.name} became Mighty (${n}  ${i} might).`);const v=e.players[t.controller].legend,g=e.players[t.controller].legendReady;if(v&&g){const E=(((c=v.ability)==null?void 0:c.trigger)||"").toLowerCase(),I=((u=v.ability)==null?void 0:u.effect_text)||"",R=((y=v.ability)==null?void 0:y.raw_text)||"",q=`${E}
${I}
${R}`,J=/when (one of your units|a unit you control) becomes \[?mighty\]?/i.test(q),K=I||R;if(J&&K){const O=dt(K);e.chain.push({id:Be("chain"),controller:t.controller,kind:"TRIGGERED_ABILITY",label:`Trigger: ${v.name} (Unit became Mighty)`,effectText:K,targets:[{kind:"NONE"}],needsTargets:O.kind!=="NONE",targetRequirement:O,sourceInstanceId:v.id,sourceCardType:"Legend"}),e.state="CLOSED",e.priorityPlayer=t.controller,e.passesInRow=0,e.log.unshift(`${v.name} triggered: ${t.name} became Mighty.`)}}}},vt=(e,t)=>[...e.players[t].base.units,...e.battlefields.flatMap(n=>n.units[t])],Bv=(e,t)=>vt(e,t).some(n=>Ll(n.name)===Ll("Void Hatchling")),qo=(e,t,n)=>{if(!Bv(e,t))return!1;const i=e.players[t],a=n==="RUNE"?i.runeDeck:i.mainDeck;if(!a||a.length===0)return!1;const l=a.shift();return l?(a.push(l),e.log.unshift(`${t} used Void Hatchling: recycled top ${n==="RUNE"?"rune":"main deck"} card before reveal.`),!0):!1},q0=e=>{const t=e.pendingCullChoice;if(t){for(;t.index<t.order.length;){const n=t.order[t.index];if(vt(e,n).length>0)return;t.choices[n]=null,t.index+=1}e.cullChoiceResults||(e.cullChoiceResults={}),e.cullChoiceResults[t.resolutionId]={...t.choices},e.pendingCullChoice=null}},W0=e=>{const t=String(e||"").trim();if(!t)return!1;if(/^\d+$/.test(t))return!0;const n=t.toUpperCase();return["S","A","C","T","E","R","B","Y"].includes(n)},jr=e=>{const t=[],n=/\[([^\]]+)\]/g;let i;for(;i=n.exec(e);){const a=(i[1]||"").trim();a&&!W0(a)&&t.push(a)}return t},jv=e=>{for(const t of["P1","P2"]){const n=e.players[t].discardedThisTurn>0,i=(a,l=[])=>{var y,v;const c=`${((y=a.ability)==null?void 0:y.effect_text)||""} ${((v=a.ability)==null?void 0:v.raw_text)||""}`,u=[];if(a.buffs>0&&/while i'm buffed/i.test(c)){const g=c.split(/while i'm buffed/i)[1]||"";u.push(...jr(g))}if(ho(a,e)&&/while i'm\s*\[mighty\]/i.test(c)){const g=c.split(/while i'm\s*\[mighty\]/i)[1]||"";u.push(...jr(g))}if(n&&/if you've discarded a card this turn/i.test(c)){const g=c.split(/if you've discarded a card this turn/i)[1]||"";u.push(...jr(g))}l.length>0&&u.push(...l),a.conditionalKeywords=Array.from(new Set(u))};for(const a of e.players[t].base.units)i(a);for(const a of e.battlefields){const l=Gv(a)?["Ganking"]:[];for(const c of a.units[t])i(c,l)}}},Mv=e=>{var t;return(e.windowKind==="SHOWDOWN"||e.windowKind==="COMBAT"&&((t=e.combat)==null?void 0:t.step)==="SHOWDOWN")&&e.state==="OPEN"&&e.chain.length===0},Pv=e=>e.chain.length>0||e.state==="CLOSED",hp=(e,t="HAND")=>{const n=lt(e,"Reaction")||t==="FACEDOWN",i=lt(e,"Action");return n?"REACTION":i?"ACTION":"NORMAL"},Wo=e=>{const t=String(e||"").toLowerCase();return/\[\s*reaction\s*\]/i.test(t)||/^\s*reaction\b/i.test(t)?"REACTION":/\[\s*action\s*\]/i.test(t)||/^\s*action\b/i.test(t)?"ACTION":"NORMAL"},Ta=(e,t,n)=>e.priorityPlayer!==t?!1:Pv(e)?n==="REACTION":Mv(e)?n==="ACTION"||n==="REACTION":e.windowKind==="NONE"&&e.state==="OPEN"&&e.chain.length===0&&e.step==="ACTION"&&e.turnPlayer===t,Lv=(e,t,n)=>e.type!=="Spell"?!1:Ta(t,n,hp(e,"HAND")),Ko=(e,t,n,i="HAND")=>e.type==="Spell"?Lv(e,t,n):["Unit","Gear"].includes(e.type)?Ta(t,n,hp(e,i)):!1,Vo=e=>e.step==="ACTION"&&e.windowKind==="NONE"&&e.state==="OPEN"&&e.chain.length===0,el=e=>e.step==="ACTION"&&e.windowKind==="NONE"&&e.state==="OPEN"&&e.chain.length===0,Rm=(e,t)=>(t&&t.length>0?t:Object.keys(e.power)).reduce((i,a)=>i+(e.power[a]||0),0),Kt=(e,t,n)=>{const i={Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0};let a=t;const l=[...n].sort((c,u)=>(e.power[u]||0)-(e.power[c]||0));for(const c of l){if(a<=0)break;const u=e.power[c]||0;if(u<=0)continue;const y=Math.min(u,a);i[c]+=y,a-=y}return a>0?null:{payment:i}},dt=(e,t)=>{const n=(e||"").toLowerCase();if(!n.trim())return{kind:"NONE"};if(/\beach\s+player\s+kills\s+one\s+of\s+their\s+units\b/i.test(n))return{kind:"NONE"};if(/\bwhen\s+a\s+friendly\s+unit\s+is\s+played\s+this\s+turn\b/i.test(n))return{kind:"NONE"};if(/(^|[.?!]\s*)when\s+[^.]*\bthis\s+turn\b\s*,/i.test(n))return{kind:"NONE"};const i=/\bup\s+to\b/.test(n),a=/\byou may\b/.test(n)||/\bmay\s+(ready|buff|kill|move|return|recall|play|draw|channel|exhaust)\b/.test(n)||/\bbuff\s+another\s+friendly\s+unit\b/.test(n)||i;if(/choose\s+a\s+unit\s+and\s+an?\s+equipment\b/i.test(n)||/choose\s+an?\s+equipment\s+and\s+a\s+unit\b/i.test(n))return{kind:"UNIT_AND_GEAR_SAME_CONTROLLER",optional:a};if(/attach\s+an?\s+equipment\s+you\s+control\s+to\s+a\s+unit\s+you\s+control/i.test(n)||/attach\s+equipment\s+you\s+control\s+to\s+a\s+unit\s+you\s+control/i.test(n))return{kind:"UNIT_AND_GEAR_FRIENDLY",optional:a};const u=n.match(/\bup\s+to\s+(one|two|three|four|five|\d+)\s+(friendly\s+|enemy\s+)?units?\b/);if(u){const se={one:1,two:2,three:3,four:4,five:5},Q=u[1],ce=/^\d+$/.test(Q)?parseInt(Q,10):se[Q]??1,We=u[2]||"",Ue=/friendly/.test(We),Ke=/enemy/.test(We);return Ue&&!Ke?{kind:"UNIT_FRIENDLY",count:ce,optional:!0}:Ke&&!Ue?{kind:"UNIT_ENEMY",count:ce,optional:!0}:{kind:"UNIT_ANYWHERE",count:ce,optional:!0}}if(/\bplay\s+(?:(\d+|one|two|three|four|five|six|seven|eight|nine|ten)\s+)?(?:an?\s+)?\d+\s+might\s+[a-z]+\s+unit\s+token(?:s)?\b/i.test(n)&&!/\bhere\b/i.test(n)&&!/\b(in|into|to)\s+your\s+base\b/i.test(n)&&!/\bat\s+(?:a|that)\s+battlefield\b/i.test(n))return{kind:"BATTLEFIELD",count:1,optional:!0};if(/choose\s+a\s+friendly\s+unit\s+and\s+an?\s+enemy\s+unit/i.test(n)||/choose\s+an?\s+enemy\s+unit\s+and\s+a\s+friendly\s+unit/i.test(n))return{kind:"UNIT_FRIENDLY_AND_ENEMY",optional:a};if(/choose\s+a\s+friendly\s+unit\s+in\s+your\s+base/i.test(n)&&/at\s+a\s+battlefield/i.test(n))return{kind:"UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD",optional:a};const E=/\bgear\b|\bequipment\b/.test(n),I=/\b(all|each)\s+(friendly\s+)?gear\b/i.test(n)||/\ball\s+equipment\b/i.test(n),R=/\b(play|create)\s+(?:a|an|\d+)?\s*(?:[a-z]+\s+)?(?:gear|equipment)\s+token\b/i.test(n)||/\bplay\s+(?:a|an)\s+gold\s+token\b/i.test(n);if(E&&!I&&!R){if(!(/\b(choose|target|kill|destroy|banish|detach|attach|ready|return|recall|move|exhaust|stun|give|buff|deal)\b[^.]{0,60}\b(gear|equipment)\b/i.test(n)||/\b(gear|equipment)\b[^.]{0,60}\b(you\s+control|friendly|enemy|that|this)\b/i.test(n)))return{kind:"NONE"};if(/\bfriendly\s+gear\b/i.test(n)||/\bgear\s+you\s+control\b/i.test(n)||/\bequipment\s+you\s+control\b/i.test(n))return{kind:"GEAR_FRIENDLY",count:1,optional:a};if(/\bequipment\b/i.test(n))return{kind:"GEAR_FRIENDLY_EQUIPMENT",count:1,optional:a};if(/\bgear\b/i.test(n)||/\bequipment\b/i.test(n))return{kind:"GEAR_ANY",count:1,optional:a}}const q=/\b(stun|kill|banish|ready|buff|deal|give|move|return|recall|heal|double)\b/.test(n)&&/\bunit\b/.test(n),J=/\bbattlefield\b/.test(n)&&/\bchoose\b/.test(n),K=/\bat\s+a\s+battlefield\b/.test(n)&&/\b(all|each)\s+enemy\s+units?\b/.test(n);if(J||K)return{kind:"BATTLEFIELD",count:1,optional:a};if(!q)return{kind:"NONE"};const O=/\b(another|other)\s+(friendly|enemy)?\s*(unit|units)\b/.test(n);if(/\bat\s+(?:a\s+)?battlefields?\b/.test(n)||/\bat\s+that\s+battlefield\b/.test(n)){const se=/\benemy\s+units?\s+at\s+(?:a\s+)?battlefields?\b/.test(n)||/\bto\s+an?\s+enemy\s+unit\s+at\s+(?:a\s+)?battlefield\b/.test(n)||/\bat\s+(?:a\s+)?battlefields?\b/.test(n)&&/\benemy\s+unit\b/.test(n),Q=/\bfriendly\s+units?\s+at\s+(?:a\s+)?battlefields?\b/.test(n)||/\bto\s+a\s+friendly\s+unit\s+at\s+(?:a\s+)?battlefield\b/.test(n)||/\bat\s+(?:a\s+)?battlefields?\b/.test(n)&&/\bfriendly\s+unit\b/.test(n);return se&&!Q?{kind:"UNIT_ENEMY_AT_BATTLEFIELD",count:1,excludeSelf:O,optional:a}:Q&&!se?{kind:"UNIT_FRIENDLY_AT_BATTLEFIELD",count:1,excludeSelf:O,optional:a}:{kind:"UNIT_AT_BATTLEFIELD",count:1,excludeSelf:O,optional:a}}const j=/\benemy unit here\b/.test(n)||/\bunit here\b/.test(n)&&/\benemy\b/.test(n),P=/\byour unit here\b/.test(n)||/\bunit here\b/.test(n)&&/\byour\b/.test(n)||/\bfriendly unit here\b/.test(n);if(j)return{kind:"UNIT_HERE_ENEMY",count:1,optional:a};if(P)return{kind:"UNIT_HERE_FRIENDLY",count:1,optional:a};const ee=/\b(a|another)\s+friendly\s+unit\b/.test(n)||/\bfriendly\s+unit's\b/.test(n)||/\byour\s+unit\b/.test(n)||/\bone\s+of\s+your\s+units\b/.test(n)||/\bother\s+friendly\s+units?\b/.test(n),ne=/\ban?(other)?\s+enemy\s+unit\b/.test(n)||/\benemy\s+unit's\b/.test(n)||/\bother\s+enemy\s+units?\b/.test(n);if(ee&&!ne)return{kind:"UNIT_FRIENDLY",count:1,excludeSelf:O,optional:a};if(ne&&!ee)return{kind:"UNIT_ENEMY",count:1,excludeSelf:O,optional:a};if(/\bmove\s+any\s+number\s+of\s+your\s+units?\b/.test(n)||/\bmove\s+any\s+number\s+of\s+friendly\s+units?\b/.test(n))return{kind:"UNIT_FRIENDLY",count:1,optional:!0};const te=n.match(/\bmove\s+(?:up\s+to\s+)?(\d+|one|two|three|four|five)\s+(?:friendly|your)?\s*units?\b/);if(te){const se={one:1,two:2,three:3,four:4,five:5},Q=te[1],ce=/^\d+$/.test(Q)?parseInt(Q,10):se[Q]??1;return{kind:"UNIT_FRIENDLY",count:Number.isFinite(ce)?ce:1,optional:a}}return{kind:"UNIT_ANYWHERE",count:1,optional:a}},zs=(e,t,n)=>{var l,c;const i=[];["P1","P2"].forEach(u=>{const y=e.players[u];i.push(...y.base.units,...y.base.gear),e.battlefields.forEach(v=>{i.push(...v.units[u],...v.gear[u])})});const a=u=>u.instanceId===n.card.instanceId;for(const u of i){if(a(u))continue;const y=(((l=u.ability)==null?void 0:l.trigger)||"").toLowerCase(),v=(c=u.ability)==null?void 0:c.effect_text;if(!y||!v)continue;let g=!1;if(t==="PLAY_CARD"&&u.controller===n.player&&(y.includes("when you play a spell")&&n.card.type==="Spell"&&(g=!0),y.includes("when you play a spell that costs 5 energy or more")&&n.card.type==="Spell"&&(n.card.cost||0)>=5&&(g=!0),y.includes("when you play a gear")&&n.card.type==="Gear"&&(g=!0),y.includes("when you play another unit")&&n.card.type==="Unit"&&(g=!0),y.includes("when you play a unit")&&n.card.type==="Unit"&&(g=!0),y.includes("when you play a [mighty] unit")&&n.card.type==="Unit"&&ho(n.card,e)&&(g=!0),y.includes("play your second card")&&e.players[n.player].mainDeckCardsPlayedThisTurn===2&&(g=!0),y.includes("when you play a card on an opponent's turn")&&e.turnPlayer!==n.player&&(g=!0)),t==="DISCARD_CARD"&&u.controller===n.player&&(y.includes("when you discard one or more cards")&&(g=!0),y.includes("when you discard a card")&&(g=!0)),t==="KILL_UNIT"&&u.controller===n.player&&y.includes("when you kill")){const I=n.card.stunned;y.includes("stunned")&&!I?g=!1:g=!0}if(g){const E=dt(v);e.chain.push({id:Be("chain"),controller:u.controller,kind:"TRIGGERED_ABILITY",label:`Trigger: ${u.name}`,effectText:v,targets:[{kind:"NONE"}],needsTargets:E.kind!=="NONE",targetRequirement:E,sourceInstanceId:u.instanceId,sourceCardType:u.type}),e.state="CLOSED",e.priorityPlayer=u.controller,e.passesInRow=0,e.log.unshift(`${u.name} triggered.`)}}},Xr=(e,t,n,i,a)=>{const l=new Set((a==null?void 0:a.skipTriggerIds)||[]),c=e.delayedTriggers.filter(v=>v.event===t&&v.untilTurn>=e.turnNumber&&!l.has(v.id)&&(!v.targetFilter||v.targetFilter==="ANY"||v.targetFilter==="FRIENDLY"&&v.controller===n.controller||v.targetFilter==="ENEMY"&&v.controller!==n.controller));if(c.length===0)return;const u=new Set,y=new Set;for(const v of c){let g=v.effect||"";if(/\(if alone\)/i.test(g)&&!i.alone||(g=g.replace(/\s*\(if alone\)/i,"").trim(),!g))continue;const I=Me(e,n.owner,n.instanceId);if(!I)continue;const R={kind:"UNIT",owner:n.owner,instanceId:n.instanceId,battlefieldIndex:I.zone==="BF"?I.battlefieldIndex:void 0,zone:I.zone};if(Ea(e,v.controller,g,[R],{battlefieldIndex:i.battlefieldIndex??null,sourceCardName:v.sourceCardName,sourceInstanceId:n.instanceId,resolutionId:v.id})==="PENDING_OPTIONAL"){e.pendingOptionalChoice&&(e.pendingOptionalChoice.resumeDelayedEvent={event:t,unitOwner:n.owner,unitInstanceId:n.instanceId,battlefieldIndex:i.battlefieldIndex??null,alone:i.alone,skipTriggerIds:[...y,v.id]}),v.onlyOnce&&u.add(v.id),u.size>0&&(e.delayedTriggers=e.delayedTriggers.filter(J=>!u.has(J.id))),e.state="CLOSED",e.priorityPlayer=v.controller,e.passesInRow=0;return}y.add(v.id),v.onlyOnce&&u.add(v.id)}u.size>0&&(e.delayedTriggers=e.delayedTriggers.filter(v=>!u.has(v.id)))},km=(e,t)=>{var c,u,y,v,g;const n=(((c=e==null?void 0:e.ability)==null?void 0:c.raw_text)||((u=e==null?void 0:e.ability)==null?void 0:u.effect_text)||"").toString(),i=up(n),a=new Set,l=E=>{const I=dp(Ul(E||""));I&&a.add(I)};for(const E of i){const I=Qr(E.trigger).toLowerCase();(t==="FRIENDLY"?/when you choose a friendly unit\b/.test(I):t==="ENEMY"?/when you choose an enemy unit\b/.test(I):/when you choose a unit\b/.test(I))&&l(E.effectText)}if(a.size===0){const E=(((y=e==null?void 0:e.ability)==null?void 0:y.trigger)||"").toString(),I=Qr(E).toLowerCase();(t==="FRIENDLY"?/when you choose a friendly unit\b/.test(I):t==="ENEMY"?/when you choose an enemy unit\b/.test(I):/when you choose a unit\b/.test(I))&&l(((v=e==null?void 0:e.ability)==null?void 0:v.effect_text)||((g=e==null?void 0:e.ability)==null?void 0:g.raw_text)||"")}return Array.from(a)},Uv=(e,t,n,i)=>{const a=n.filter(u=>u.kind==="UNIT");if(a.length===0)return;if(i.sourceCardType==="Spell"){const u=new Set;for(const y of a){const v=Me(e,y.owner,y.instanceId);!v||v.zone!=="BF"||v.battlefieldIndex==null||v.unit.controller===t&&u.add(v.battlefieldIndex)}for(const y of u){const v=e.battlefields[y];Ci(v,"The Dreaming Tree")&&(v.dreamingTreeChosenThisTurn[t]||(v.dreamingTreeChosenThisTurn[t]=!0,an(e,t,1),e.log.unshift(`${v.card.name} triggered: ${t} drew 1.`)))}}const l=e.players[t],c=[...l.base.units,...l.base.gear,...e.battlefields.flatMap(u=>[...u.units[t],...u.gear[t]])];l.legend&&c.push(l.legend);for(const u of a){const y=Me(e,u.owner,u.instanceId);if(!y)continue;const v=y.unit.controller===t?"FRIENDLY":"ENEMY";for(const g of c){const E=(g==null?void 0:g.controller)||t,I=new Set([...km(g,v),...km(g,"ANY")]);if(g!=null&&g.instanceId&&g.instanceId===y.unit.instanceId)for(const R of Es(g,"CHOOSE_ME"))I.add(R);for(const R of I){const q=dt(R,{here:y.zone==="BF"}),J={id:Be("chain"),controller:E,kind:"TRIGGERED_ABILITY",label:`${(g==null?void 0:g.name)||"Trigger"}  Choose`,effectText:R,contextBattlefieldIndex:i.battlefieldIndex??(y.zone==="BF"?y.battlefieldIndex:null),needsTargets:q.kind!=="NONE",targetRequirement:q,targets:q.kind==="NONE"?[{kind:"NONE"}]:[{kind:"UNIT",owner:y.unit.owner,instanceId:y.unit.instanceId,battlefieldIndex:y.zone==="BF"?y.battlefieldIndex:void 0,zone:y.zone}],sourceInstanceId:g==null?void 0:g.instanceId,sourceCardType:g==null?void 0:g.type};e.chain.push(J),e.state="CLOSED",e.priorityPlayer=E,e.passesInRow=0,e.log.unshift(`${(g==null?void 0:g.name)||"Trigger"} triggered (Choose).`)}}}},Hn=(e,t,n,i,a,l,c=!1)=>{var v;const u=[],y=e.players[t];u.push(...y.base.units,...y.base.gear),e.battlefields.forEach(g=>u.push(...g.units[t],...g.gear[t])),y.legend&&u.push({...y.legend,instanceId:`legend_${t}`,owner:t,controller:t}),c&&u.push(...y.trash);for(const g of u){const E=(((v=g.ability)==null?void 0:v.trigger)||"").toLowerCase();if(!E||!n(E,g))continue;const I=i(g);if(!I)continue;const R=dt(I);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${g.name}`,effectText:I,contextBattlefieldIndex:l??null,targets:a&&a.length>0?a:[{kind:"NONE"}],needsTargets:R.kind!=="NONE",targetRequirement:R,sourceInstanceId:g.instanceId,sourceCardType:g.type}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${g.name} triggered.`)}},xc=(e,t,n)=>{var c;const i=(e||"").toLowerCase();if(/damage\s+equal\s+to\s+(my|its|their)\s+might/i.test(i)&&t)return n?Pe(t,{role:"NONE",game:n}):((c=t.stats)==null?void 0:c.might)||0;if(/damage\s+equal\s+to\s+my\s+\[?assault\]?/i.test(i)&&t)return lt(t,"Assault")?1:0;const a=i.match(/\bdeal\s+(\d+)\b/);if(!a)return null;const l=parseInt(a[1],10);return Number.isFinite(l)?l:null},Qf=e=>{const n=(e||"").toLowerCase().match(/\bdraw\s+(\d+)\b/);if(!n)return null;const i=parseInt(n[1],10);return Number.isFinite(i)?i:null},Xf=e=>{const n=(e||"").toLowerCase().match(/\bchannel\s+(\d+)\b/);if(!n)return null;const i=parseInt(n[1],10);return Number.isFinite(i)?i:null},Zf=e=>{const n=(e||"").toLowerCase().match(/\bdiscard\s+(\d+)\b/);if(!n)return null;const i=parseInt(n[1],10);return Number.isFinite(i)?i:null},$v=e=>{var l,c;const t=`${((l=e==null?void 0:e.ability)==null?void 0:l.effect_text)||""} ${((c=e==null?void 0:e.ability)==null?void 0:c.raw_text)||""}`.replace(/_/g," ").replace(/\[(\d+)\]/g,"$1").toLowerCase(),n=t.match(/\bcost\s+(\d+)\s+energy\s+less\b/);if(n){const u=parseInt(n[1],10);return Number.isFinite(u)?u:0}const i=t.match(/\bcost\s+(\d+)\s+less\b/);if(i){const u=parseInt(i[1],10);return Number.isFinite(u)?u:0}const a=t.match(/\breduce\s+my\s+cost\s+by\s+(\d+)\s+energy\b/);if(a){const u=parseInt(a[1],10);return Number.isFinite(u)?u:0}return 0},zv=e=>{var i,a;const t=(((i=e==null?void 0:e.ability)==null?void 0:i.effect_text)||"").trim()||(((a=e==null?void 0:e.ability)==null?void 0:a.raw_text)||"").trim();if(!t)return"";let n=t.replace(/_/g," ").trim();return n=n.replace(/\[\s*legion\s*\]\s*/gi,"").trim(),n=n.replace(/\(\s*get\s+the\s+effect[\s\S]*?\)\s*$/i,"").trim(),n=n.replace(/^[-]\s*/,"").trim(),n},Jf=e=>/\bstun\b/i.test(e||""),eh=e=>/\bready\b/i.test(e||""),th=e=>/\bkill\b/i.test(e||""),nh=e=>/\bbanish\b/i.test(e||""),ih=e=>/\bbuff\b/i.test(e||""),sh=e=>/\breturn\b/i.test(e||"")||/\brecall\b/i.test(e||""),K0="__TEMP_CONQUER_MOVE_BASE__",Qo=(e,t)=>{if(!t||t.buffs>=1)return!1;const n=Pe(t,{role:"NONE",game:e});return t.buffs=1,Sa(e,t,n),!0},Xo=(e,t,n)=>{if(!t||!Number.isFinite(n)||n===0)return;const i=Pe(t,{role:"NONE",game:e});t.tempMightBonus+=n,Sa(e,t,i)},Qc=e=>{var n,i;const t=`${((n=e.ability)==null?void 0:n.effect_text)||""} ${((i=e.ability)==null?void 0:i.raw_text)||""}`.toLowerCase();return e.moveCountThisTurn>=2&&t.includes("if i have moved twice this turn")&&t.includes("don't take damage")},Xc=e=>e.damageKillEffects.some(t=>t.untilTurn>=e.turnNumber),Ci=(e,t)=>Ll(e.card.name)===Ll(t),_n=e=>{var t,n;return(((t=e.card.ability)==null?void 0:t.raw_text)||((n=e.card.ability)==null?void 0:n.effect_text)||"").toLowerCase()},qd=e=>Ci(e,"Bandle Tree")||_n(e).includes("hide an additional card here"),bl=e=>Ci(e,"Rockfall Path")||_n(e).includes("units can't be played here"),ns=e=>Ci(e,"Vilemaw's Lair")||_n(e).includes("can't move from here to base"),Gv=e=>Ci(e,"Windswept Hillock")||_n(e).includes("units here have [ganking]"),Hv=e=>Ci(e,"Void Gate")||_n(e).includes("bonus damage"),Yv=e=>Ci(e,"Ornn's Forge")||_n(e).includes("first")&&_n(e).includes("gear")&&_n(e).includes("cost"),Fv=e=>Ci(e,"Marai Spire")||_n(e).includes("repeat")&&_n(e).includes("cost")&&_n(e).includes("less"),Wd=e=>Ci(e,"Forge of the Fluft")||_n(e).includes("legends you control")&&_n(e).includes("attach equipment"),V0=e=>{const t=bc,n=e.battlefields.filter(a=>a.controller!==null&&(Ci(a,"Aspirant's Climb")||_n(a).includes("victory score is increased by 1"))).length,i=t+n;e.victoryScore!==i&&(e.victoryScore=i,e.log.unshift(`Victory score set to ${i} (Aspirant's Climb bonus: +${n}).`))},rs=(e,t,n)=>{const a=e.players[t].base.gear.find(c=>c.instanceId===n);if(a)return{zone:"BASE",gear:a};for(const c of e.battlefields){const u=c.gear[t].find(y=>y.instanceId===n);if(u)return{zone:"BF",battlefieldIndex:c.index,gear:u}}const l=vt(e,t);for(const c of l){const u=(c.attachedGear||[]).find(y=>y.instanceId===n);if(u)return{zone:"ATTACHED",unit:c,gear:u}}return null},Ec=(e,t,n)=>{const i=e.players[t],a=i.base.gear.findIndex(c=>c.instanceId===n);if(a>=0)return i.base.gear.splice(a,1)[0];for(const c of e.battlefields){const u=c.gear[t].findIndex(y=>y.instanceId===n);if(u>=0)return c.gear[t].splice(u,1)[0]}const l=vt(e,t);for(const c of l){const u=(c.attachedGear||[]).findIndex(y=>y.instanceId===n);if(u>=0)return c.attachedGear.splice(u,1)[0]}return null},_m=(e,t)=>{if(!e.attachedGear||e.attachedGear.length===0)return null;const n=e.attachedGear.findIndex(i=>i.instanceId===t);return n<0?null:e.attachedGear.splice(n,1)[0]},Om=(e,t,n)=>{const i=Pe(t,{role:"NONE",game:e});t.attachedGear||(t.attachedGear=[]),t.attachedGear.push(n),Sa(e,t,i)},Q0=(e,t)=>{const n=e.players[t],i=vt(e,t).flatMap(l=>l.attachedGear||[]),a=e.battlefields.flatMap(l=>l.gear[t]);return[...n.base.gear,...a,...i]},Gn=(e,t,n)=>{const i=e.players[t],a=i.base.units.findIndex(l=>l.instanceId===n);if(a>=0){const l=i.base.units[a];return l.prevMightSnapshot=Pe(l,{role:"NONE",game:e}),i.base.units.splice(a,1)[0]}for(const l of e.battlefields){const c=l.units[t].findIndex(u=>u.instanceId===n);if(c>=0){const u=l.units[t][c];return u.prevMightSnapshot=Pe(u,{role:"NONE",game:e,battlefieldIndex:l.index}),l.units[t].splice(c,1)[0]}}return null},ai=(e,t,n,i)=>{var l;const a=e.players[t];if(i.kind==="BASE")a.base.units.push(n);else{let c=!1;const u=[a.base.units,...e.battlefields.map(g=>g.units[t])];for(const g of u)for(const E of g){if(E.instanceId===n.instanceId)continue;(((l=E.ability)==null?void 0:l.raw_text)||"").toLowerCase().includes("other friendly units enter ready")&&(c=!0)}(c||a.unitsEnterReadyThisTurn)&&(n.isReady=!0,a.unitsEnterReadyThisTurn&&e.log.unshift(`${n.name} enters ready (units enter ready this turn).`));const y=n.prevMightSnapshot??Pe(n,{role:"NONE",game:e});e.battlefields[i.index].units[t].push(n),n.prevMightSnapshot=void 0,Sa(e,n,y)}},ah=e=>{e.buffs=0,e.tempMightBonus=0,e.tempKeywords=[],e.damage=0,e.stunned=!1,e.stunnedUntilTurn=0,e.preventNextDamageUntilTurn=0,e.killOnDamageUntilTurn=0,e.deathReplacement=void 0},ta=(e,t,n,i="killed")=>{var I,R,q,J;const a=e.players[t],l=xt(t),c=n.buffs>0,u=(n.tags||[]).some(K=>String(K||"").toLowerCase()==="recruit");if(n.deathReplacement&&e.turnNumber<=n.deathReplacement.untilTurn){const K=n.deathReplacement,O=K.payRuneDomain,k=e.players[n.controller].runePool,j=O?(k.power[O]||0)>=1:!1,P=K.payRuneAny?Object.values(k.power).some(ne=>ne>0):!1;if(O?j:K.payRuneAny?P:!0){if(O&&(k.power[O]-=1),!O&&K.payRuneAny){const ne=Object.keys(k.power).find(te=>k.power[te]>0);ne&&(k.power[ne]-=1)}n.isReady=!1,n.damage=0,n.deathReplacement=void 0,e.players[t].base.units.push(n),e.log.unshift(`${n.name} was recalled to base instead of dying.`);return}}const y=e.recallOnDeathEffects.find(K=>K.unitInstanceId===n.instanceId&&K.untilTurn>=e.turnNumber);if(y)if(e.recallOnDeathEffects=e.recallOnDeathEffects.filter(K=>K!==y),y.payCost){const K=e.players[y.controller].runePool;if(Object.values(K.power).some(k=>k>0)){const k=Object.keys(K.power).find(j=>K.power[j]>0);k&&(K.power[k]-=1),n.isReady=!1,n.damage=0,e.players[t].base.units.push(n),e.log.unshift(`${n.name} was recalled to base instead of dying (paid [C]).`);return}}else{n.isReady=!1,n.damage=0,e.players[t].base.units.push(n),e.log.unshift(`${n.name} was recalled to base instead of dying.`);return}const v=e.players[t].legend;if((v==null?void 0:v.name)==="The Boss"&&n.controller===t&&n.buffs>0&&e.players[t].legendReady){const K=e.players[t].runePool;if(Object.values(K.power).some(k=>k>0)){const k=Object.keys(K.power).find(j=>K.power[j]>0);if(k){K.power[k]-=1,e.players[t].legendReady=!1,n.buffs=Math.max(0,n.buffs-1),n.isReady=!1,n.damage=0,e.players[t].base.units.push(n),e.log.unshift(`${n.name} was recalled to base by The Boss instead of dying.`);return}}}if(lt(n,"Deathknell")){const K=((I=n.ability)==null?void 0:I.effect_text)||"",O=((R=n.ability)==null?void 0:R.raw_text)||"",k=`${K} ${O}`.toLowerCase(),j=/if i was \[?mighty\]?/i.test(k),P=ho(n,e);if(K&&(!j||P)){const ne={id:Be("chain"),controller:n.controller,kind:"TRIGGERED_ABILITY",label:`Deathknell: ${n.name}`,effectText:K,contextBattlefieldIndex:null,targets:[],needsTargets:!1,sourceInstanceId:n.instanceId};e.chain.push(ne),e.log.unshift(`${n.name}'s Deathknell ability triggered.`)}else K&&j&&!P&&e.log.unshift(`${n.name}'s Deathknell did not trigger (was not Mighty).`)}if(n.attachedGear&&n.attachedGear.length>0){for(const K of n.attachedGear)a.base.gear.push({...K,isReady:!1}),e.log.unshift(`${K.name} (attached equipment) returned to ${t}'s Base.`);n.attachedGear=[]}ah(n),Jc(e,n,"trash")||(a.trash.push({...n,isReady:!1}),e.log.unshift(`${n.name} (${t}) was ${i} and put into Trash.`)),e.players[l].enemyUnitsDiedThisTurn+=1,zs(e,"KILL_UNIT",{player:t,card:n});const g=e.players[l].legend,E=((q=g==null?void 0:g.ability)==null?void 0:q.raw_text)||((J=g==null?void 0:g.rules_text)==null?void 0:J.raw)||"";/when one or more enemy units die,?\s*ready me/i.test(E)&&(e.players[l].legendReady=!0,e.log.unshift(`${g==null?void 0:g.name} readied (enemy unit died).`)),c&&Hn(e,t,K=>K.includes("when a buffed friendly unit dies"),K=>{var O;return(O=K.ability)==null?void 0:O.effect_text}),u||Hn(e,t,(K,O)=>K.includes("when another non-recruit unit you control dies")&&O.instanceId!==n.instanceId,K=>{var O;return(O=K.ability)==null?void 0:O.effect_text})},ba=(e,t,n,i)=>{for(const a of n){const l=typeof i=="number"?i:null,c=Es(a,"MOVE");for(const u of c){const y=dt(u);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Move Trigger: ${a.name}`,effectText:u,contextBattlefieldIndex:l,targets:[{kind:"NONE"}],needsTargets:y.kind!=="NONE",targetRequirement:y,sourceInstanceId:a.instanceId}),e.log.unshift(`${a.name} triggered on move.`)}if(typeof i=="number"){const u=Es(a,"MOVE_TO_BF");for(const y of u){const v=dt(y);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Move Trigger: ${a.name}`,effectText:y,contextBattlefieldIndex:i,targets:[{kind:"NONE"}],needsTargets:v.kind!=="NONE",targetRequirement:v,sourceInstanceId:a.instanceId}),e.log.unshift(`${a.name} triggered on move to battlefield.`)}}}},xa=(e,t,n,i,a)=>{var c,u;if(n.length===0)return;if(i.kind==="BF"){const y=e.battlefields[i.index],v=$l(y.card,"MOVE_FROM_HERE");for(const g of n)for(const E of v){const I=E.trim();if(!I)continue;const R=dt(I),q={kind:"UNIT",owner:g.owner,instanceId:g.instanceId,battlefieldIndex:i.index,zone:"BF"},J=R.kind==="NONE"&&/\b(it|this)\b/i.test(I),K=(()=>{switch(R.kind){case"UNIT_ANYWHERE":case"UNIT_AT_BATTLEFIELD":return!0;case"UNIT_FRIENDLY":case"UNIT_FRIENDLY_AT_BATTLEFIELD":case"UNIT_HERE_FRIENDLY":return g.owner===t;case"UNIT_ENEMY":case"UNIT_ENEMY_AT_BATTLEFIELD":case"UNIT_HERE_ENEMY":return g.owner!==t;default:return!1}})();e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`${y.card.name}  Trigger`,effectText:I,contextBattlefieldIndex:i.index,restrictTargetsToBattlefieldIndex:i.index,targets:K||J?[q]:[{kind:"NONE"}],needsTargets:R.kind!=="NONE"&&!K,targetRequirement:R,sourceInstanceId:g.instanceId})}}if((y=>{var g;const v=vt(e,y);for(const E of v){if(!(((g=E.ability)==null?void 0:g.trigger)||"").toLowerCase().includes("when a friendly unit moves from my location"))continue;const R=Me(e,y,E.instanceId);if(!(!R||!(i.kind==="BASE"?R.zone==="BASE":R.zone==="BF"&&R.battlefieldIndex===i.index)))for(const J of n){if(J.owner!==y)continue;const K=Gn(e,y,E.instanceId);K&&(K.isReady=!1,K.moveCountThisTurn+=1,ai(e,y,K,a),e.log.unshift(`${E.name} moved with a friendly unit.`))}}})(t),a.kind==="BF"){const y=xt(t),v=vt(e,y);for(const g of v){if(!(((c=g.ability)==null?void 0:c.trigger)||"").toLowerCase().includes("when an opponent moves to a battlefield other than mine"))continue;const I=Me(e,y,g.instanceId);if(!(!I||I.zone!=="BF")&&I.battlefieldIndex!==a.index&&(u=g.ability)!=null&&u.effect_text){const R=dt(g.ability.effect_text);e.chain.push({id:Be("chain"),controller:y,kind:"TRIGGERED_ABILITY",label:`Move Trigger: ${g.name}`,effectText:g.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:R.kind!=="NONE",targetRequirement:R}),e.state="CLOSED",e.priorityPlayer=y,e.passesInRow=0}}}},gt=e=>{for(const t of["P1","P2"]){const n=e.players[t],i=[];for(const a of n.base.units){const l=Pe(a,{role:"NONE",game:e});a.damage>=l&&l>0?ta(e,t,a,"destroyed (lethal damage)"):i.push(a)}n.base.units=i;for(const a of e.battlefields){const l=[];for(const c of a.units[t]){const u=Pe(c,{role:"NONE",game:e});c.damage>=u&&u>0?ta(e,t,c,"destroyed (lethal damage)"):l.push(c)}a.units[t]=l}}if(e.windowKind==="NONE")for(const t of e.battlefields){if(t.contestedBy)continue;const n=t.units.P1.length>0,i=t.units.P2.length>0;n&&!i?t.controller="P1":i&&!n?t.controller="P2":!n&&!i&&(t.controller=null)}for(const t of e.battlefields){if(t.facedown){const n=t.facedown.owner,i=t.controller===n;if(t.facedown.markedForRemoval=!i,!i){const a=t.facedown.card;t.facedown=null,e.players[n].trash.push(a),e.log.unshift(`Facedown card ${a.name} was removed from Battlefield ${t.index+1} (lost control).`)}}if(t.facedownExtra){const n=t.facedownExtra.owner,i=t.controller===n;if(t.facedownExtra.markedForRemoval=!i,!i){const a=t.facedownExtra.card;t.facedownExtra=null,e.players[n].trash.push(a),e.log.unshift(`Extra facedown card ${a.name} was removed from Battlefield ${t.index+1} (lost control).`)}}}for(const t of e.battlefields)for(const n of["P1","P2"]){if(t.gear[n].length===0)continue;const i=t.gear[n].splice(0,t.gear[n].length);e.players[n].base.gear.push(...i),e.log.unshift(`${n} recalled ${i.length} gear to base (gear can't remain at a battlefield).`)}for(const t of["P1","P2"]){const n=e.players[t].runePool;n.energy=Math.max(0,n.energy);for(const i of Object.keys(n.power))n.power[i]=Math.max(0,n.power[i]||0)}V0(e),jv(e)},qv=(e,t,n,i)=>{const l=e.battlefields[t].units[n];for(const c of l){const u=Es(c,"ATTACK");for(const y of u){const v=dt(y);e.chain.push({id:Be("chain"),controller:n,kind:"TRIGGERED_ABILITY",label:`${c.name} (Attack)`,effectText:y,contextBattlefieldIndex:t,needsTargets:v.kind!=="NONE",targetRequirement:v,targets:[{kind:"NONE"}],sourceInstanceId:c.instanceId}),e.state="CLOSED",e.priorityPlayer=n,e.passesInRow=0,e.log.unshift(`Triggered ability: ${c.name} (Combat).`)}}},Wv=e=>e.battlefields.filter(t=>t.contestedBy&&t.controller===null).map(t=>t.index),Kv=e=>e.battlefields.filter(t=>t.units.P1.length>0&&t.units.P2.length>0&&t.contestedBy!==null).map(t=>t.index),bn=e=>{if(e.windowKind!=="NONE"||e.state!=="OPEN"||e.chain.length!==0)return;const t=Wv(e);if(t.length>0){const i=t[0];e.windowKind="SHOWDOWN",e.windowBattlefieldIndex=i;const a=xt(e.turnPlayer);e.focusPlayer=a,e.priorityPlayer=a,e.passesInRow=0,e.log.unshift(`Showdown opened at Battlefield ${i+1}. ${a} has Focus.`);return}const n=Kv(e);if(n.length>0){const i=n[0],a=e.battlefields[i],l=a.contestedBy,c=xt(l);e.windowKind="COMBAT",e.windowBattlefieldIndex=i,e.combat={battlefieldIndex:i,attacker:l,defender:c,step:"SHOWDOWN"},e.focusPlayer=l,e.priorityPlayer=l,e.passesInRow=0,e.log.unshift(`Combat begins at Battlefield ${i+1} (Attacker: ${l}, Defender: ${c}).`),qv(e,i,l);const u=$l(a.card,"ATTACK_HERE");for(const q of u){const J=dt(q);e.chain.push({id:Be("chain"),controller:l,kind:"TRIGGERED_ABILITY",label:`Battlefield Trigger: ${a.card.name} (Attack)`,effectText:q,contextBattlefieldIndex:i,needsTargets:J.kind!=="NONE",targetRequirement:J,restrictTargetsToBattlefieldIndex:i,targets:[{kind:"NONE"}]}),e.state="CLOSED",e.priorityPlayer=l,e.passesInRow=0,e.log.unshift(`${a.card.name} triggered (Attack here).`)}const y=$l(a.card,"DEFEND_HERE");for(const q of y){const J=dt(q);e.chain.push({id:Be("chain"),controller:c,kind:"TRIGGERED_ABILITY",label:`Battlefield Trigger: ${a.card.name} (Defend)`,effectText:q,contextBattlefieldIndex:i,needsTargets:J.kind!=="NONE",targetRequirement:J,restrictTargetsToBattlefieldIndex:i,targets:[{kind:"NONE"}]}),e.state="CLOSED",e.priorityPlayer=c,e.passesInRow=0,e.log.unshift(`${a.card.name} triggered (Defend here).`)}const v=a.units[l].filter(q=>!q.stunned),g=a.units[c].filter(q=>!q.stunned),E=v.length===1,I=g.length===1;for(const q of v)Xr(e,"UNIT_ATTACKS",q,{battlefieldIndex:i,alone:E});for(const q of g)Xr(e,"UNIT_DEFENDS",q,{battlefieldIndex:i,alone:I});const R=(q,J,K)=>{var k,j;const O=[...e.players[q].base.units,...e.players[q].base.gear,...e.battlefields.flatMap(P=>P.units[q])];for(const P of O)if((((k=P.ability)==null?void 0:k.trigger)||"").toLowerCase().includes("when a friendly unit attacks or defends alone")&&(j=P.ability)!=null&&j.effect_text){const ne=P.ability.effect_text.trim().replace(/^[-]\s*/,"").trim();if(!ne)continue;dt(ne),e.chain.push({id:Be("chain"),controller:q,kind:"TRIGGERED_ABILITY",label:`${P.name}  Trigger`,effectText:ne,contextBattlefieldIndex:i,targets:[{kind:"UNIT",owner:q,instanceId:J.instanceId,battlefieldIndex:i,zone:"BF"}],needsTargets:!0,targetRequirement:{kind:"UNIT_ANYWHERE",count:1},sourceInstanceId:P.instanceId}),e.state="CLOSED",e.priorityPlayer=q,e.passesInRow=0,e.log.unshift(`${P.name} triggered (${K} alone).`)}};E&&R(l,v[0],"ATTACK"),I&&R(c,g[0],"DEFEND")}},Zr=(e,t,n,i)=>{var R,q,J,K,O,k;const a=e.players[t];if(a.scoredBattlefieldsThisTurn.includes(n))return;const l=e.battlefields[n];if(Ci(l,"Forgotten Monument")&&a.turnsTaken<3){e.log.unshift(`${t} cannot score at Battlefield ${n+1} yet (Forgotten Monument).`);return}const u=a.points===e.victoryScore-1;let y=1,v=!1;if(u&&i==="Conquer"){const j=e.battlefields.map(ne=>ne.index),P=[...a.scoredBattlefieldsThisTurn,n];j.every(ne=>P.includes(ne))||(y=0,v=!0,e.log.unshift(`${t} would score the Final Point via Conquer, but hasn't scored every battlefield this turn. Draw 1 instead.`))}if(i==="Conquer"||i==="Hold"){const j=[...a.base.units,...e.battlefields.flatMap(P=>P.units[t])];for(const P of j){const ee=Es(P,i==="Conquer"?"CONQUER":"HOLD");for(const ne of ee){const te=dt(ne);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${P.name} (${i})`,effectText:ne,targets:[{kind:"NONE"}],needsTargets:te.kind!=="NONE",targetRequirement:te,sourceInstanceId:P.instanceId}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${P.name} triggered (${i}).`)}i==="Conquer"&&(P.tempKeywords||[]).includes(K0)&&(e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${P.name} (Conquer)`,effectText:"You may move me to your base.",targets:[{kind:"NONE"}],needsTargets:!1,targetRequirement:{kind:"NONE"},sourceInstanceId:P.instanceId}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${P.name} gained a Conquer move-to-base trigger this turn.`))}}if(i==="Conquer"){const j=e.players[t].legend;if(e.players[t].legendReady,(R=j==null?void 0:j.ability)!=null&&R.trigger&&j.ability.trigger.toLowerCase().includes("when you conquer")&&j.ability.effect_text){const ne=dt(j.ability.effect_text);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${j.name} (Conquer)`,effectText:j.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:ne.kind!=="NONE",targetRequirement:ne}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${j.name} triggered (Conquer).`)}const P=((q=j==null?void 0:j.ability)==null?void 0:q.raw_text)||((J=j==null?void 0:j.rules_text)==null?void 0:J.raw)||"";if(/when you conquer,?\s*(you may pay \[?\d\]? to )?ready me/i.test(P)&&j){const ne=P.match(/when you conquer,?\s*you may pay \[?(\d)\]? to ready me/i);if(ne){const te=parseInt(ne[1],10);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${j.name} (Conquer - Ready)`,effectText:`You may pay [${te}] to ready your legend.`,targets:[{kind:"NONE"}],needsTargets:!1,targetRequirement:{kind:"NONE"}}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${j.name} triggered (Conquer - Ready option).`)}else e.players[t].legendReady=!0,e.log.unshift(`${j.name} readied (Conquer).`)}}a.scoredBattlefieldsThisTurn.push(n);const g=(((K=l.card.rules_text)==null?void 0:K.raw)||((O=l.card.ability)==null?void 0:O.raw_text)||((k=l.card.ability)==null?void 0:k.effect_text)||"").toLowerCase(),E=/conquer\s+here\s+with\s+one\s+or\s+more\s+\[?mighty\]?/i.test(g)||/conquer\s+here\s+with\s+a\s+\[?mighty\]?/i.test(g),I=i==="Hold"?$l(l.card,"HOLD_HERE"):$l(l.card,"CONQUER_HERE");if(I.length>0){const j=e.battlefields[n].units[t].some(P=>ho(P,e));for(const P of I){if(i==="Conquer"&&E&&!j||/with one or more \[?mighty\] units/i.test(P)&&!j||/if you have mighty units/i.test(P)&&!j)continue;const ee=dt(P);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Battlefield Trigger: ${l.card.name} (${i})`,effectText:P,contextBattlefieldIndex:n,needsTargets:ee.kind!=="NONE",targetRequirement:ee,restrictTargetsToBattlefieldIndex:null,targets:[{kind:"NONE"}]}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`Triggered ability added to chain: ${l.card.name} (${i}).`)}}y>0?(a.points+=y,e.log.unshift(`${t} scored 1 point by ${i} at Battlefield ${n+1}. (Total: ${a.points})`)):v&&an(e,t,1),V0(e),a.points>=e.victoryScore&&(e.step="GAME_OVER",e.log.unshift(`${t} wins! Reached ${a.points} points.`))},Vv=(e,t)=>{for(const n of e.battlefields)if(n.controller===t&&(Zr(e,t,n.index,"Hold"),e.step==="GAME_OVER"))return},Qv=(e,t)=>{const n=e.players[t];if(n.mainDeck.length>0)return!0;if(n.trash.length===0){const a=xt(t);return e.step="GAME_OVER",e.log.unshift(`${t} tried to draw with empty deck and empty trash. ${a} wins by Burn Out.`),!1}const i=xt(t);return n.mainDeck=Hi(n.trash.map(a=>({...a})),e.turnNumber),n.trash=[],e.log.unshift(`${t} Burned Out! Shuffled Trash into main deck. ${i} scores 1 point.`),e.players[i].points+=1,e.players[i].points>=e.victoryScore?(e.step="GAME_OVER",e.log.unshift(`${i} wins! (Burn Out point reached victory score)`),!1):!0},an=(e,t,n)=>{const i=e.players[t];for(let a=0;a<n;a++){if(!Qv(e,t)||i.mainDeck.length===0)return;const l=i.mainDeck.shift();i.hand.push(l),e.log.unshift(`${t} drew a card.`)}},lh=(e,t,n)=>{const i=e.players[t],a=Math.min(n,i.runeDeck.length);for(let l=0;l<a;l++){const c=i.runeDeck.shift();i.runesInPlay.push({...c,isReady:!0})}a>0&&e.log.unshift(`${t} channeled ${a} rune(s).`)},Ds=(e,t,n)=>{const i=e.players[t],a=Math.min(n,i.runeDeck.length);for(let l=0;l<a;l++){const c=i.runeDeck.shift();i.runesInPlay.push({...c,isReady:!1})}return a>0&&e.log.unshift(`${t} channeled ${a} rune(s) exhausted.`),a},Xv=e=>{const t=e.turnPlayer;e.players[t].runePool=Li(),e.log.unshift(`${t}'s Rune Pool emptied (end of Draw Phase).`)},Zv=(e,t)=>{e.players[t].runePool=Li(),e.log.unshift(`${t}'s Rune Pool emptied (end of turn).`)},Jv=e=>{for(const t of["P1","P2"]){const n=e.players[t];for(const i of n.base.units)i.stunned&&e.turnNumber>=i.stunnedUntilTurn&&(i.stunned=!1,i.stunnedUntilTurn=0);for(const i of e.battlefields)for(const a of i.units[t])a.stunned&&e.turnNumber>=a.stunnedUntilTurn&&(a.stunned=!1,a.stunnedUntilTurn=0)}},eN=e=>{for(const t of["P1","P2"]){const n=e.players[t],i=n.base.units.filter(a=>lt(a,"Ephemeral"));for(const a of i){const l=n.base.units.findIndex(c=>c.instanceId===a.instanceId);l>=0&&(n.base.units.splice(l,1),ta(e,t,a,"killed (Ephemeral)"))}for(const a of e.battlefields){const l=a.units[t].filter(c=>lt(c,"Ephemeral"));for(const c of l){const u=a.units[t].findIndex(y=>y.instanceId===c.instanceId);u>=0&&(a.units[t].splice(u,1),ta(e,t,c,"killed (Ephemeral)"))}}}for(const t of["P1","P2"]){const n=e.players[t];for(const i of n.base.units)i.damage=0,i.tempMightBonus=0,i.tempKeywords=[];for(const i of e.battlefields)for(const a of i.units[t])a.damage=0,a.tempMightBonus=0,a.tempKeywords=[]}},tN=(e,t)=>{var c,u;const n=e.players[t],i=n.base.units.filter(y=>lt(y,"Temporary"));for(const y of i){const v=n.base.units.findIndex(g=>g.instanceId===y.instanceId);v>=0&&(n.base.units.splice(v,1),ta(e,t,y,"killed (Temporary)"))}for(const y of e.battlefields){const v=y.units[t].filter(g=>lt(g,"Temporary"));for(const g of v){const E=y.units[t].findIndex(I=>I.instanceId===g.instanceId);E>=0&&(y.units[t].splice(E,1),ta(e,t,g,"killed (Temporary)"))}}n.legendReady=!0;for(const y of n.base.units)y.isReady=!0;for(const y of n.base.gear)y.isReady=!0;for(const y of e.battlefields)for(const v of y.units[t])v.isReady=!0;for(const y of n.runesInPlay)y.isReady=!0;e.log.unshift(`${t} awoke: readied legend/units/gear/runes.`);const a=[...n.base.units,...e.battlefields.flatMap(y=>y.units[t])];for(const y of a){const v=(((c=y.ability)==null?void 0:c.trigger)||"").toLowerCase();if((v.includes("at the start of your beginning phase")||v.includes("at start of your beginning phase"))&&((u=y.ability)!=null&&u.effect_text)){const g=dt(y.ability.effect_text);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`${y.name}  Beginning Phase Trigger`,effectText:y.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:g.kind!=="NONE",targetRequirement:g,sourceInstanceId:y.instanceId}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${y.name} triggered (Beginning Phase).`)}}if(e.players[t].turnsTaken===1)for(const y of e.battlefields){const v=$l(y.card,"START_FIRST_BEGINNING");for(const g of v){const E=dt(g);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`${y.card.name}  First Beginning Phase Trigger`,effectText:g,contextBattlefieldIndex:y.index,targets:[{kind:"NONE"}],needsTargets:E.kind!=="NONE",targetRequirement:E}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${y.card.name} triggered (First Beginning Phase for ${t}).`)}}},Bm=e=>e?Vf(e,"Deflect"):0,jm=(e,t,n,i)=>{const a=e.players[t],l=(i.overrideEnergyCost??n.cost)+(i.additionalEnergy??0),c=i.overridePowerCost??n.stats.power??0,u=i.additionalPowerByDomain||{},y=i.additionalPowerClass??0,v=i.additionalPowerAny??0;if(a.runePool.energy<l)return!1;const g=a.runePool;if(!(Kt(g,c,i.powerDomainsAllowed)!==null))return!1;const I=is(g),R=Kt(g,c,i.powerDomainsAllowed);for(const K of Object.keys(R.payment))I.power[K]-=R.payment[K];for(const K of Object.keys(u)){const O=u[K]||0;if(!(O<=0)){if((I.power[K]||0)<O)return!1;I.power[K]-=O}}if(y>0){const K=ds(e,t);if(!(Kt(I,y,K)!==null))return!1;const k=Kt(I,y,K);for(const j of Object.keys(k.payment))I.power[j]-=k.payment[j]}return Kt(I,v,["Body","Calm","Chaos","Fury","Mind","Order","Colorless"])!==null},nN=(e,t,n,i)=>{const a=e.players[t],l=(i.overrideEnergyCost??n.cost)+(i.additionalEnergy??0),c=i.overridePowerCost??n.stats.power??0,u=i.additionalPowerByDomain||{},y=i.additionalPowerClass??0,v=i.additionalPowerAny??0;a.runePool.energy-=l;const g=Kt(a.runePool,c,i.powerDomainsAllowed);if(!g)throw new Error("Cost payment failed (base power).");for(const R of Object.keys(g.payment))a.runePool.power[R]-=g.payment[R];for(const R of Object.keys(u)){const q=u[R]||0;if(!(q<=0)){if((a.runePool.power[R]||0)<q)throw new Error("Cost payment failed (domain-specific add-on).");a.runePool.power[R]-=q}}if(y>0){const R=ds(e,t),q=Kt(a.runePool,y,R);if(!q)throw new Error("Cost payment failed (class power add-on).");for(const J of R){const K=q.payment[J]||0;K>0&&(a.runePool.power[J]-=K)}}const E=["Body","Calm","Chaos","Fury","Mind","Order","Colorless"],I=Kt(a.runePool,v,E);if(!I)throw new Error("Cost payment failed (any power).");for(const R of Object.keys(I.payment))a.runePool.power[R]-=I.payment[R]},X0=e=>(e||"").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\]\s*\[/g,"] [").replace(/_/g," ").replace(/\[\s*add\s*\]\s*/gi,"add ").replace(/\[\s*s\s*\]/gi,"might").replace(/\[\s*a\s*\]/gi,"any-rune").replace(/\[\s*c\s*\]/gi,"class-rune").replace(/\[\s*t\s*\]/gi,"tap").replace(/\[\s*e\s*\]/gi,"exhaust").replace(/\[(\d+)\]/g,"$1 energy").replace(/\s+/g," ").trim(),iN=e=>e.replace(/^(?:you may\s+)?[^.]*additional\s+cost[^.]*\.\s*/i,"").trim(),Z0=e=>{const t=e.match(/(?:you may\s+)?[^.]*additional\s+cost[^.]*\./i);return t?t[0]:""},J0=e=>{const t=(e||"").toLowerCase().trim();return/^\d+$/.test(t)?Math.max(0,parseInt(t,10)):{one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,a:1,an:1}[t]||0},Mm=e=>{const t=X0(e||""),n=Z0(t);if(!n||!/additional\s+cost/i.test(n))return{hasAdditionalCost:!1,isOptional:!1,discardCount:0,clause:"",clauseLower:""};const i=n.toLowerCase(),a=/\byou may\b/.test(i),l=i.match(/\bdiscard\s+(\d+)\b/),c=i.match(/\bdiscard\s+(one|two|three|four|five|six|seven|eight|nine|ten|a|an)\b/),u=l?parseInt(l[1],10):c?J0(c[1]):0;return{hasAdditionalCost:!0,isOptional:a,discardCount:Math.max(0,u),clause:n,clauseLower:i}},rh=(e,t)=>{let n=t;for(const i of e){if(n<=0)break;const a=Math.min(n,i.buffs||0);a>0&&(i.buffs-=a,n-=a)}return t-n},sN=(e,t,n,i)=>{var u,y;const a=e.players[t],l=[],c=a.hand.filter(v=>v.instanceId!==n);for(let v=0;v<Math.min(i,c.length);v++){const g=c[v],E=a.hand.findIndex(I=>I.instanceId===g.instanceId);E>=0&&(a.hand.splice(E,1),a.trash.push(g),l.push(g),a.discardedThisTurn+=1,e.log.unshift(`${t} discarded ${g.name} (additional cost).`),(((u=g.ability)==null?void 0:u.trigger)||"").toLowerCase().includes("when you discard me")&&((y=g.ability)!=null&&y.effect_text)&&(e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Discard Trigger: ${g.name}`,effectText:g.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:!1,sourceCard:g}),e.log.unshift(`${g.name} triggered from discard.`)),zs(e,"DISCARD_CARD",{player:t,card:g}))}return l},aN=(e,t,n,i,a)=>{var y,v;const l=e.players[t],c=[],u=Array.from(new Set(i)).filter(g=>g!==n).slice(0,Math.max(0,a));for(const g of u){if(c.length>=a)break;const E=l.hand.findIndex(q=>q.instanceId===g&&q.instanceId!==n);if(E<0)continue;const I=l.hand[E];l.hand.splice(E,1),l.trash.push(I),c.push(I),l.discardedThisTurn+=1,e.log.unshift(`${t} discarded ${I.name} (additional cost).`),(((y=I.ability)==null?void 0:y.trigger)||"").toLowerCase().includes("when you discard me")&&((v=I.ability)!=null&&v.effect_text)&&(e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Discard Trigger: ${I.name}`,effectText:I.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:!1,sourceCard:I}),e.log.unshift(`${I.name} triggered from discard.`)),zs(e,"DISCARD_CARD",{player:t,card:I})}return c},lN=(e,t,n,i,a,l,c)=>{const u=X0(i||""),y=u.toLowerCase(),v=Z0(u);if(!v||!y.includes("additional cost"))return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{}};const g=v.toLowerCase(),E=/\byou may\b/.test(g),I=(c==null?void 0:c.payOptionalAdditionalCost)??!0;let R=!1,q={},J,K;const O=_e=>E?I?_e:!1:_e,k=g.match(/\bdiscard\s+(\d+)/),j=g.match(/\bdiscard\s+(one|two|three|four|five|six|seven|eight|nine|ten|a|an)\b/),P=k?parseInt(k[1],10):j?J0(j[1]):0;if(P>0){const _e=P,V=e.players[t].hand.length-1>=_e;if(!V&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: discard unavailable"};if(O(V)&&_e>0){const we=Array.isArray(c==null?void 0:c.additionalDiscardIds)?c.additionalDiscardIds:[];if((we.length>0?aN(e,t,n.instanceId,we,_e):sN(e,t,n.instanceId,_e)).length<_e)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: choose discard card(s)"};R=!0}}const ee=g.match(/\bpay\s+(\d+)\s+(body|calm|chaos|fury|mind|order)\s+rune\b/);if(ee){const _e=parseInt(ee[1],10),V=ut(ee[2]);if(_e>0){const ve=(e.players[t].runePool.power[V]||0)>=_e;if(!ve&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: rune unavailable"};O(ve)&&(q={...q,[V]:(q[V]||0)+_e},R=!0)}}const ne=g.match(/\bpay\s+(\d+)?\s*class(?:-|\s+)rune\b/),te=g.match(/\bpay\s+((?:class-rune\s*)+)\b/),se=te?(te[1].match(/class-rune/g)||[]).length:0,Q=ne?ne[1]?parseInt(ne[1],10):1:se;if(Q>0){const _e=Q;if(_e>0){const V=ds(e,t),we=Kt(e.players[t].runePool,_e,V),ve=!!we;if(!ve&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: class rune unavailable"};if(O(ve)&&we){q={...q};for(const Ne of V){const Ce=we.payment[Ne]||0;Ce>0&&(q[Ne]=(q[Ne]||0)+Ce)}R=!0}}}const ce=g.match(/\bpay\s+(\d+)\s+rune\s+of\s+any\s+type\b/),We=g.match(/\bpay\s+((?:any-rune\s*)+)\b/),Ue=We?(We[1].match(/any-rune/g)||[]).length:0,Ke=ce?parseInt(ce[1],10):Ue;if(Ke>0){const _e=Ke;if(_e>0){const V=[...fo,"Colorless"],we=Kt(e.players[t].runePool,_e,V),ve=!!we;if(!ve&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: any rune unavailable"};if(O(ve)&&we){q={...q};for(const Ne of V){const Ce=we.payment[Ne]||0;Ce>0&&(q[Ne]=(q[Ne]||0)+Ce)}R=!0}}}if(g.includes("exhaust a friendly unit")){const we=[...e.players[t].base.units,...e.battlefields.flatMap(Ne=>Ne.units[t])].find(Ne=>Ne.isReady),ve=!!we;if(!ve&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: no ready unit to exhaust"};O(ve)&&we&&(we.isReady=!1,R=!0,e.log.unshift(`${t} exhausted ${we.name} (additional cost).`))}if(g.includes("exhaust your legend")){const _e=e.players[t].legendReady;if(!_e&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: legend not ready"};O(_e)&&_e&&(e.players[t].legendReady=!1,R=!0,e.log.unshift(`${t} exhausted legend (additional cost).`))}if(g.includes("spend a buff")||g.includes("spend any number of buffs")){const _e=[...e.players[t].base.units,...e.battlefields.flatMap(Ce=>Ce.units[t])],V=_e.reduce((Ce,ei)=>Ce+(ei.buffs||0),0),ve=g.includes("any number of buffs")?Math.min(V,l):Math.min(V,1),Ne=ve>0;if(!Ne&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: no buffs to spend"};if(O(Ne)&&ve>0){const Ce=rh(_e,ve);R=!0,g.includes("reduce my cost")&&(K=Math.max(0,l-Ce)),e.log.unshift(`${t} spent ${Ce} buff(s) (additional cost).`)}}if(g.includes("kill a friendly unit")||g.includes("kill any number of friendly units")){const _e=[...e.players[t].base.units,...e.battlefields.flatMap(Ne=>Ne.units[t])],we=g.includes("any number of friendly units")?Math.min(_e.length,l):Math.min(_e.length,1),ve=we>0;if(!ve&&!E)return{effectText:i,additionalCostPaid:!1,additionalPowerByDomain:{},error:"Additional cost: no friendly unit to kill"};if(O(ve)&&we>0){const Ne=_e.slice(0,we);for(const Ce of Ne)Gn(e,Ce.owner,Ce.instanceId),ta(e,Ce.owner,Ce,"sacrificed (additional cost)");R=!0,g.includes("reduce my cost")&&(K=Math.max(0,l-Ne.length))}}if(R&&/ignore this spell's cost/i.test(y))J=0,K=0;else if(R){const _e=y.match(/reduce my cost by (\d+) energy/);if(_e){const V=parseInt(_e[1],10);Number.isFinite(V)&&(J=Math.max(0,a-V))}}let ze=iN(u);if(ze=ze.replace(/if you do,?\s*reduce my cost[^.]*\.\s*/i,""),ze=ze.replace(/if you do,?\s*ignore this spell's cost\.\s*/i,""),ze=ze.replace(/reduce my cost by [^.]*\.\s*/i,""),/if you do/i.test(ze)){const _e=ze.match(/if you do,?\s*([^]*?)(?:otherwise,?\s*([^]*))?$/i);if(_e){const V=(_e[1]||"").trim().replace(/\.$/,""),we=(_e[2]||"").trim().replace(/\.$/,"");ze=R?V:we}}return/if you paid (?:the )?additional cost/i.test(ze)&&(R?ze=ze.replace(/,\s*if you paid (?:the )?additional cost,\s*/gi,", ").replace(/\bif you paid (?:the )?additional cost,\s*/gi,"").replace(/\s+/g," ").trim():ze=ze.replace(/(?:^|[.!?]\s*)[^.!?]*if you paid (?:the )?additional cost[^.!?]*(?:[.!?]\s*|$)/gi," ").replace(/\s+/g," ").trim()),{effectText:ze,additionalCostPaid:R,additionalPowerByDomain:q,overrideEnergyCost:J,overridePowerCost:K}},ex=["Body","Calm","Chaos","Fury","Mind","Order","Colorless"],tx=e=>({energy:e.energy,power:{...e.power}}),rN=(e,t)=>{const n={...e};for(const i of Object.keys(t))n[i]=(n[i]||0)+(t[i]||0);return n},Pm=()=>({Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0}),Lm=(e,t)=>{if(e.energy<t.energyNeed)return!1;const n=Kt(e,t.basePowerNeed,t.powerDomainsAllowed);if(!n)return!1;const i=tx(e);for(const l of Object.keys(n.payment))i.power[l]-=n.payment[l];for(const l of Object.keys(t.additionalPowerByDomain)){const c=t.additionalPowerByDomain[l]||0;if(!(c<=0)){if((i.power[l]||0)<c)return!1;i.power[l]-=c}}return Kt(i,t.additionalPowerAny,ex)!==null},Zc=(e,t)=>{var u,y,v;const n=(((u=e.ability)==null?void 0:u.raw_text)||((y=e.ability)==null?void 0:y.effect_text)||"").toString(),i=n.toLowerCase().replace(/_/g," ").replace(/\[[^\]]+\]/g,g=>g.slice(1,-1)).replace(/[]/g,"-").replace(/[:.]/g," ").replace(/\s+/g," ").trim(),a=i.match(/\badd\s+(\d+)?\s*(body|calm|chaos|fury|mind|order|class)\s+(?:rune|power)\b/);if(a){const g=Math.max(1,parseInt(a[1]||"1",10)||1);return a[2]==="class"?{domain:t[0]||"Fury",amount:g}:{domain:ut(a[2]),amount:g}}const l=i.match(/\badd\s+(\d+)\s+(?:rune|power)\s+of\s+any\s+(?:type|domain|color)\b/)||i.match(/\badd\s+(\d+)\s+any\s+(?:rune|power)\b/);if(l){const g=Math.max(1,parseInt(l[1],10)||1);return{domain:Yt(e.domain).map(ut).filter(R=>R!=="Colorless")[0]||t[0]||"Fury",amount:g}}return e.name.toLowerCase().includes("seal")||/\bseal\b/i.test(n)||(((v=e.ability)==null?void 0:v.keywords)||[]).some(g=>g.toLowerCase().includes("add"))?{domain:Yt(e.domain).map(ut).filter(I=>I!=="Colorless")[0]||t[0]||"Fury",amount:1}:null},Zo=(e,t,n,i)=>{const a=(i==null?void 0:i.sealExhaustedThisTurn)??!1,l=(i==null?void 0:i.seals)||[],c=(i==null?void 0:i.playerDomains)||["Fury"];if(Lm(e,n))return{runeUses:{},sealUses:[],recycleCount:0,exhaustCount:0,exhaustOnlyCount:0,addsEnergy:0,addsPower:Pm()};const u=t.length,y=l.filter(J=>J.isReady&&Zc(J,c)!==null);if(u===0&&y.length===0)return null;const v=Math.max(0,n.energyNeed-e.energy),g=t.filter(J=>J.isReady).map(J=>J.instanceId);if(v>g.length)return null;let E=null;const I=J=>{let K=0;for(;J;)J&=J-1,K++;return K},R=1<<y.length,q=1<<u;for(let J=0;J<R;J++){const K=I(J),O=[],k=Pm();for(let P=0;P<y.length;P++)if(J&1<<P){const ee=y[P],ne=Zc(ee,c);ne&&(O.push({instanceId:ee.instanceId,domain:ne.domain,amount:ne.amount}),k[ne.domain]=(k[ne.domain]||0)+ne.amount)}const j=a||K>0;for(let P=0;P<q;P++){const ee=I(P);if(j&&P!==0||E&&K>E.score[0]||E&&K===E.score[0]&&ee>E.score[1])continue;const ne={...k},te=[],se=[],Q=[];for(let Ne=0;Ne<u;Ne++){const Ce=t[Ne];(P&1<<Ne)!==0?(te.push(Ce.instanceId),ne[Ce.domain]=(ne[Ce.domain]||0)+1,Ce.isReady&&se.push(Ce.instanceId)):Ce.isReady&&Q.push(Ce.instanceId)}let ce=v;const We=[],Ue=[],Ke=Math.min(ce,se.length);for(let Ne=0;Ne<Ke;Ne++)We.push(se[Ne]);if(ce-=Ke,ce>Q.length)continue;for(let Ne=0;Ne<ce;Ne++)Ue.push(Q[Ne]);const ze=We.length+Ue.length,_e=tx(e);if(_e.energy+=ze,_e.power=rN(_e.power,ne),!Lm(_e,n))continue;const V={};for(const Ne of te)V[Ne]="RECYCLE";for(const Ne of We)V[Ne]="BOTH";for(const Ne of Ue)V[Ne]="EXHAUST";const we={runeUses:V,sealUses:O,recycleCount:ee,exhaustCount:ze,exhaustOnlyCount:Ue.length,addsEnergy:ze,addsPower:ne},ve=[ee,Ue.length,ee+ze,-K];(!E||ve[0]<E.score[0]||ve[0]===E.score[0]&&ve[1]<E.score[1]||ve[0]===E.score[0]&&ve[1]===E.score[1]&&ve[2]<E.score[2]||ve[0]===E.score[0]&&ve[1]===E.score[1]&&ve[2]===E.score[2]&&ve[3]<E.score[3])&&(E={plan:we,score:ve})}}return E?E.plan:null},Kd=(e,t,n)=>{const i=e.players[t];for(const c of n.sealUses){const u=i.base.gear.findIndex(v=>v.instanceId===c.instanceId);if(u<0)continue;const y=i.base.gear[u];y.isReady&&(y.isReady=!1,i.runePool.power[c.domain]=(i.runePool.power[c.domain]||0)+c.amount,i.sealExhaustedThisTurn=!0,e.log.unshift(`${t} auto-exhausted ${y.name} to add ${c.amount} ${c.domain} power.`))}const a=n.runeUses,l=Object.entries(a);for(const[c,u]of l){if(u!=="EXHAUST"&&u!=="BOTH")continue;const y=i.runesInPlay.find(v=>v.instanceId===c);y&&y.isReady&&(y.isReady=!1,i.runePool.energy+=1)}for(const[c,u]of l){if(u!=="RECYCLE"&&u!=="BOTH")continue;const y=i.runesInPlay.findIndex(g=>g.instanceId===c);if(y<0)continue;const v=i.runesInPlay.splice(y,1)[0];i.runePool.power[v.domain]=(i.runePool.power[v.domain]||0)+1,i.runeDeck.push({...v,isReady:!0})}},Ea=(e,t,n,i,a={})=>{var ki,mo,Ei,go,$a,za,_i,aa,Qi,Oi,ni,St,Dt,mn,Pn,Tu,vu,Nu;const l=xt(t),c=e.players[t],u=(a==null?void 0:a.battlefieldIndex)??null,y=x=>(x||"").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\]\s*\[/g,"] [").replace(/_/g," ").replace(/\[\s*add\s*\]\s*/gi,"add ").replace(/\[\s*s\s*\]/gi,"might").replace(/\[\s*a\s*\]/gi,"any-rune").replace(/\[\s*c\s*\]/gi,"class-rune").replace(/\[\s*t\s*\]/gi,"tap").replace(/\[\s*e\s*\]/gi,"exhaust").replace(/\[(\d+)\]/g,"$1 energy").replace(/\s+/g," ").trim(),v=(n||"").toLowerCase(),g=y(n||"");if(!g)return!1;const E=g.toLowerCase(),I=/exhaust me to channel \d+ rune(?:s)? exhausted/i.test(E),R=mc,q=x=>R?R.isAiControlled(x):!1,J=a.resolutionId||a.chainItemId||Be("res"),K=/\byou may\b/i.test(E),O=typeof window<"u"&&!!R&&R.viewerId===t&&R.canActAs(t)&&!q(t),k=e.optionalChoiceResults||(e.optionalChoiceResults={}),j=vt(e,t).some(x=>(x.tags||[]).some(T=>String(T||"").toLowerCase()==="poro")),P=e.battlefields.some(x=>x.facedown&&x.facedown.owner===t);u!=null&&e.battlefields[u].units[t].length;const ee=Array.isArray(i)?i:[],ne=ee.length>0?ee[0]:{kind:"NONE"},se=ee.filter(x=>(x==null?void 0:x.kind)==="UNIT").map(x=>({t:x,loc:Me(e,x.owner,x.instanceId)})).filter(x=>!!x.loc),Q=se.map(x=>x.loc.unit),ce=Q.length>0?Q[0]:null,We=ee.find(x=>x.kind==="BATTLEFIELD"),Ue=We?We.index:null,Ke=/\bup\s+to\b/i.test(g),ze=x=>{for(const T of se)x(T.loc.unit,T.t,T.loc)},_e=a!=null&&a.sourceInstanceId?Me(e,t,a.sourceInstanceId)||Me(e,l,a.sourceInstanceId):null,V=(_e==null?void 0:_e.unit)||null,we=x=>`${J}:${x}`,ve=()=>a.chainItemId?{kind:"CHAIN",chainItemId:a.chainItemId}:{kind:"DIRECT",controller:t,effectText:n||"",targets:ee,ctx:{...a,resolutionId:J},post:a.resumePost},Ne=x=>{if(!K)return{accepted:x.defaultYes??!0,value:x.defaultValue};const T=we(x.suffix),w=k[T];if(w)return w;if(q(t)||!O){const S={accepted:x.defaultYes??!0,value:x.defaultValue};return k[T]=S,S}return e.pendingOptionalChoice||(e.pendingOptionalChoice={id:T,player:t,kind:x.kind,prompt:x.prompt,min:x.min,max:x.max,defaultValue:x.defaultValue,resume:ve()}),"PENDING_OPTIONAL"},Ce=(x,T=!0)=>{if(!K)return!0;const w=k[we(x)];return w?!!w.accepted:T},ei=(x,T)=>{if(!K)return T;const w=k[we(x)],S=w==null?void 0:w.value;return Number.isFinite(S)?S:T};let F=!1,mi=!1,jn=!1,gi=!1,Vl=!1;if((()=>{var x;if(!K)return null;if(/pay\s+\d+\s+energy\s+to\s+draw\s+\d+/i.test(E)){const T=E.match(/pay\s+(\d+)\s+energy\s+to\s+draw\s+(\d+)/i),w=T?parseInt(T[1],10):1,S=T?parseInt(T[2],10):1,U=Ne({suffix:`PAY_ENERGY_DRAW_${w}_${S}`,kind:"CONFIRM",prompt:`Pay ${w} energy to draw ${S}?`});if(U==="PENDING_OPTIONAL")return U}if(/pay\s+(?:any-rune\s+){4}to\s+score\s+1\s+point/i.test(E)||/pay\s+4\s+any-rune\s+to\s+score\s+1\s+point/i.test(E)){const T=Ne({suffix:"PAY_POWER_SCORE",kind:"CONFIRM",prompt:"Pay 4 power to score 1 point?"});if(T==="PENDING_OPTIONAL")return T}if(/pay\s+\d+\s+energy\s+to\s+ready\s+your\s+legend/i.test(E)){const T=E.match(/pay\s+(\d+)\s+energy\s+to\s+ready\s+your\s+legend/i),w=T?parseInt(T[1],10):1,S=Ne({suffix:`PAY_ENERGY_READY_LEGEND_${w}`,kind:"CONFIRM",prompt:`Pay ${w} energy to ready your legend?`});if(S==="PENDING_OPTIONAL")return S}if(!I&&/channel\s+1\s+rune\s+exhausted/i.test(E)){const T=Ne({suffix:"CHANNEL_1_EXHAUSTED",kind:"CONFIRM",prompt:"Channel 1 rune exhausted?"});if(T==="PENDING_OPTIONAL")return T}if(/you\s+may\s+detach\s+equipment\s+you\s+control/i.test(E)&&ee.find(w=>w.kind==="GEAR")){const w=Ne({suffix:"DETACH_EQUIPMENT",kind:"CONFIRM",prompt:"Detach the chosen equipment?"});if(w==="PENDING_OPTIONAL")return w}if(/pay\s+\d+\s+energy.*return\s+a\s+unit\s+here\s+to\s+its\s+owner'?s\s+hand.*play\s+two\s+2\s+might\s+sand\s+soldier\s+unit\s+tokens?\s+here/i.test(E)&&u!=null){const T=E.match(/pay\s+(\d+)\s+energy/i),w=T?parseInt(T[1],10):1,S=Q.length>0?Q[0]:null;if(S){const U=Ne({suffix:`PAY_ENERGY_SAND_${w}`,kind:"CONFIRM",prompt:`Pay ${w} energy to return ${S.name} and create Sand Soldiers?`});if(U==="PENDING_OPTIONAL")return U}}if(/you may spend a buff to draw \d+/i.test(E)){const T=E.match(/you may spend a buff to draw (\d+)/i),w=T?parseInt(T[1],10):1;if(vt(e,t).reduce((G,X)=>G+(X.buffs||0),0)>0){const G=Ne({suffix:`SPEND_BUFF_DRAW_${w}`,kind:"CONFIRM",prompt:`Spend a buff to draw ${w}?`});if(G==="PENDING_OPTIONAL")return G}}if(/exhaust me to channel \d+ rune(?:s)? exhausted/i.test(E)&&(V&&V.isReady||a.sourceCardType==="Legend"&&e.players[t].legendReady)){const T=E.match(/exhaust me to channel (\d+) rune/),w=T?parseInt(T[1],10):1,S=(V==null?void 0:V.name)||((x=e.players[t].legend)==null?void 0:x.name)||"Legend",U=Ne({suffix:`EXHAUST_ME_CHANNEL_${w}`,kind:"CONFIRM",prompt:`Exhaust ${S} to channel ${Number.isFinite(w)?w:1} rune(s) exhausted?`});if(U==="PENDING_OPTIONAL")return U}if(/spend any number of buffs/i.test(E)&&/for each buff spent, channel/i.test(E)){const w=vt(e,t).reduce((S,U)=>S+(U.buffs||0),0);if(w>0){const S=Ne({suffix:"SPEND_BUFFS_ANY",kind:"NUMBER",prompt:`Spend how many buffs? (0-${w})`,min:0,max:w,defaultValue:w});if(S==="PENDING_OPTIONAL")return S}}if(/\bplay\s+(?:a|an)\s+gold\s+gear\s+token\b/i.test(E)||/\bplay\s+(?:a|an)\s+gold\s+token\b/i.test(E)){const T=E.match(/pay\s+(\d+)\s+energy/i);if(T){const w=parseInt(T[1],10),S=Ne({suffix:`PAY_ENERGY_GOLD_${w}`,kind:"CONFIRM",prompt:`Pay ${w} energy to play a Gold token?`});if(S==="PENDING_OPTIONAL")return S}}if(/for each friendly unit, you may spend its buff to ready it/i.test(E)&&vt(e,t).some(S=>S.buffs>0)){const S=Ne({suffix:"SPEND_BUFFS_READY_ALL",kind:"CONFIRM",prompt:"Spend buffs to ready all eligible friendly units?"});if(S==="PENDING_OPTIONAL")return S}return null})()==="PENDING_OPTIONAL")return"PENDING_OPTIONAL";se.length>0&&Uv(e,t,ee,{battlefieldIndex:u??null,sourceCardType:a==null?void 0:a.sourceCardType});const qi=x=>c.runePool.energy<x?!1:(c.runePool.energy-=x,!0),Ql=x=>{for(let T=0;T<x;T++){const w=Object.keys(c.runePool.power).find(S=>c.runePool.power[S]>0);if(!w)return!1;c.runePool.power[w]-=1}return!0},xu=(x,T)=>(c.runePool.power[x]||0)<T?!1:(c.runePool.power[x]-=T,!0),ti=x=>{var w,S;x.isReady=!1,x.damage=0;const T=`${((w=x.ability)==null?void 0:w.effect_text)||""} ${((S=x.ability)==null?void 0:S.raw_text)||""}`.toLowerCase();if(T.includes("if an opponent controls a battlefield")&&T.includes("i enter ready")){const U=xt(t);e.battlefields.some(X=>X.controller===U)&&(x.isReady=!0)}if(T.includes("if an opponent's score is within 3 points of the victory score")&&T.includes("i enter ready")){const U=xt(t);e.players[U].points>=e.victoryScore-3&&(x.isReady=!0)}};if(/\beach\s+player\s+kills\s+one\s+of\s+their\s+units\b/i.test(E)||/\beach\s+player\s+kills\s+one\s+of\s+their\s+units\b/i.test(v)||/\beach\s+player\s+kills\s+a\s+unit\b/i.test(E)||/\beach\s+player\s+kills\s+a\s+unit\b/i.test(v)){const x=(ki=e.cullChoiceResults)==null?void 0:ki[J];if(x){(mo=e.cullChoiceResults)==null||delete mo[J];const T=[];for(const w of["P1","P2"]){const S=x[w];if(!S)continue;const U=Gn(e,w,S);U&&(ta(e,w,U,"killed (Cull the Weak)"),T.push(U))}T.length>0?(gt(e),e.log.unshift(`Cull the Weak resolved: ${T.length} unit(s) killed.`),a.sourceCardType==="Spell"&&Hn(e,t,w=>w.includes("when you kill a unit with a spell"),w=>{var S;return(S=w.ability)==null?void 0:S.effect_text},[{kind:"NONE"}],void 0,!0),T.some(w=>w.stunned&&w.owner!==t)&&Hn(e,t,w=>w.includes("when you kill a stunned enemy unit"),w=>{var S;return(S=w.ability)==null?void 0:S.effect_text})):e.log.unshift("Cull the Weak resolved: no units to kill."),F=!0}else return!e.pendingCullChoice&&(e.pendingCullChoice={resolutionId:J,order:[t,l],index:0,choices:{P1:null,P2:null}},q0(e),!e.pendingCullChoice)?(e.log.unshift("Cull the Weak resolved: no units to kill."),F=!0,F):"PENDING_OPTIONAL"}if(/pay\s+\d+\s+energy\s+to\s+draw\s+\d+/i.test(E)){const x=E.match(/pay\s+(\d+)\s+energy\s+to\s+draw\s+(\d+)/i),T=x?parseInt(x[1],10):1,w=x?parseInt(x[2],10):1;Ce(`PAY_ENERGY_DRAW_${T}_${w}`)?(qi(T)?(an(e,t,w),e.log.unshift(`${t} paid ${T} energy to draw ${w}.`)):e.log.unshift(`${t} cannot pay ${T} energy to draw.`),F=!0):(e.log.unshift(`${t} chose not to pay ${T} energy to draw.`),F=!0)}if((/pay\s+(?:any-rune\s+){4}to\s+score\s+1\s+point/i.test(E)||/pay\s+4\s+any-rune\s+to\s+score\s+1\s+point/i.test(E))&&(Ce("PAY_POWER_SCORE")?(gc(c.runePool)>=4?(Ql(4),e.players[t].points+=1,e.log.unshift(`${t} paid 4 power to score 1 point.`),e.players[t].points>=e.victoryScore&&(e.step="GAME_OVER",e.log.unshift(`${t} wins! Reached ${e.players[t].points} points.`))):e.log.unshift(`${t} cannot pay 4 power to score a point.`),F=!0):(e.log.unshift(`${t} chose not to pay 4 power to score a point.`),F=!0)),/pay\s+\d+\s+energy\s+to\s+ready\s+your\s+legend/i.test(E)){const x=E.match(/pay\s+(\d+)\s+energy\s+to\s+ready\s+your\s+legend/i),T=x?parseInt(x[1],10):1;Ce(`PAY_ENERGY_READY_LEGEND_${T}`)?(c.legend?qi(T)?(c.legendReady=!0,e.log.unshift(`${t} paid ${T} energy to ready their legend.`)):e.log.unshift(`${t} cannot pay ${T} energy to ready their legend.`):e.log.unshift(`${t} has no legend to ready.`),F=!0):(e.log.unshift(`${t} chose not to pay ${T} energy to ready their legend.`),F=!0)}if((/ready\s+2\s+runes\s+at\s+end\s+of\s+turn/i.test(E)||/ready\s+two\s+runes\s+at\s+end\s+of\s+turn/i.test(E))&&(c.pendingReadyRunesEndOfTurn=(c.pendingReadyRunesEndOfTurn||0)+2,e.log.unshift(`${t} will ready 2 runes at end of turn.`),F=!0),/draw\s+a\s+card\s+for\s+each\s+other\s+battlefield\s+you\s+control/i.test(E)){const x=e.battlefields.filter(S=>S.controller===t).length,T=u!=null&&e.battlefields[u].controller===t?1:0,w=Math.max(0,x-T);w>0&&an(e,t,w),e.log.unshift(`${t} drew ${w} card(s) (Seat of Power).`),F=!0}if(/put\s+the\s+top\s+2\s+cards?\s+of\s+your\s+deck\s+into\s+your\s+trash/i.test(E)||/mill\s+2\b/i.test(E)){let x=0;for(;x<2&&c.mainDeck.length>0;){const T=c.mainDeck.shift();c.trash.push(T),x+=1}e.log.unshift(`${t} milled ${x} card(s) to trash.`),F=!0}if(/reveal\s+the\s+top\s+card\s+of\s+your\s+deck/i.test(E)&&/if\s+it'?s\s+a\s+spell/i.test(E)){qo(e,t,"MAIN");const x=c.mainDeck.shift();x&&(x.type==="Spell"?(c.hand.push(x),e.log.unshift(`${t} revealed ${x.name} (Spell) and put it into hand.`)):(c.mainDeck.push(x),e.log.unshift(`${t} revealed ${x.name} (not a Spell) and recycled it.`))),F=!0}if(/look\s+at\s+the\s+top\s+two\s+cards\s+of\s+your\s+main\s+deck/i.test(E)&&/recycle\s+one\s+or\s+both/i.test(E)){const x=Math.min(2,c.mainDeck.length),T=c.mainDeck.splice(0,x);if(T.length===0)e.log.unshift(`${t} looked at the top cards but the deck was empty.`);else if(e.pendingCandlelitChoice)c.mainDeck=T.concat(c.mainDeck),e.log.unshift(`${t} looked at the top ${T.length} cards but already has a pending choice.`);else if(q(t)){c.mainDeck=T.concat(c.mainDeck);const w=T.map(S=>S.name).join(", ");e.log.unshift(`${t} looked at the top ${T.length}: ${w}. (AI kept all)`)}else{e.pendingCandlelitChoice={player:t,cards:T,choices:{},order:T.map(S=>S.instanceId)};const w=T.map(S=>S.name).join(", ");e.log.unshift(`${t} looked at the top ${T.length}: ${w}. Choose which to recycle.`)}F=!0}if(/return\s+(?:your\s+)?(?:chosen\s+)?champion(?:\s+card)?\s+from\s+your\s+trash\s+to\s+your\s+champion\s+zone/i.test(E))if(c.championZone)e.log.unshift(`${t} already has a champion.`),F=!0;else{const x=((go=(Ei=c.legend)==null?void 0:Ei.tags)==null?void 0:go[0])||"",T=c.trash.findIndex(w=>w.type==="Unit"&&(x?(w.tags||[]).includes(x):!0));if(T>=0){const w=c.trash.splice(T,1)[0];c.championZone=w,e.log.unshift(`${t} returned ${w.name} to the champion zone.`)}else e.log.unshift(`${t} has no champion card in trash.`);F=!0}if(!I&&/channel\s+1\s+rune\s+exhausted/i.test(E)&&(Ce("CHANNEL_1_EXHAUSTED")?(Ds(e,t,1),F=!0):(e.log.unshift(`${t} chose not to channel a rune.`),F=!0)),/both\s+players?\s+channel\s+1\s+rune\s+exhausted/i.test(E)&&(Ds(e,"P1",1),Ds(e,"P2",1),F=!0),/\brecycle\s+(?:one\s+of\s+your|a)\s+runes?\b/i.test(E)){const x=c.runesInPlay[0];x?al(e,t,x.instanceId):e.log.unshift(`${t} has no runes to recycle.`),F=!0}if(/activate\s+the\s+conquer\s+effects\s+of\s+units\s+here/i.test(E)&&u!=null){const x=e.battlefields[u];let T=!1;for(const w of["P1","P2"])for(const S of x.units[w]){const U=Es(S,"CONQUER");for(const G of U){const X=dt(G);e.chain.push({id:Be("chain"),controller:w,kind:"TRIGGERED_ABILITY",label:`Conquer Trigger: ${S.name}`,effectText:G,contextBattlefieldIndex:u,targets:[{kind:"NONE"}],needsTargets:X.kind!=="NONE",targetRequirement:X,sourceInstanceId:S.instanceId}),T=!0}}T&&(e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0),F=!0}if(/ready\s+each\s+friendly\s+gear\s+you\s+control/i.test(E)){const x=Q0(e,t);x.forEach(T=>T.isReady=!0),e.log.unshift(`${t} readied ${x.length} gear.`),F=!0}if(/you\s+may\s+detach\s+equipment\s+you\s+control/i.test(E)){const x=ee.find(T=>T.kind==="GEAR");if(x)if(Ce("DETACH_EQUIPMENT")){const T=rs(e,x.owner,x.instanceId);if(T&&T.zone==="ATTACHED"&&T.unit){const w=_m(T.unit,T.gear.instanceId);w&&(e.players[w.owner].base.gear.push({...w,isReady:!1}),e.log.unshift(`${t} detached ${w.name}.`),F=!0)}}else e.log.unshift(`${t} chose not to detach equipment.`),F=!0;else F=!0}if(/pay\s+\d+\s+energy.*return\s+a\s+unit\s+here\s+to\s+its\s+owner'?s\s+hand.*play\s+two\s+2\s+might\s+sand\s+soldier\s+unit\s+tokens?\s+here/i.test(E)&&u!=null){const x=E.match(/pay\s+(\d+)\s+energy/i),T=x?parseInt(x[1],10):1,w=e.battlefields[u],S=Q.length>0?Q[0]:null;if(!S)e.log.unshift("No unit chosen to return."),F=!0;else if(Ce(`PAY_ENERGY_SAND_${T}`))if(!qi(T))e.log.unshift(`${t} cannot pay ${T} energy.`),F=!0;else{const U=Gn(e,S.owner,S.instanceId);if(U){ah(U),e.players[S.owner].hand.push(U);const G=$m("Sand Soldier Token",2,"Sand Soldier"),X=[bt(G,t,e.turnNumber),bt(G,t,e.turnNumber)];w.units[t].push(...X),e.log.unshift(`${t} returned ${U.name} and played two Sand Soldier tokens here.`)}F=!0}else e.log.unshift(`${t} chose not to pay ${T} energy for Sand Soldiers.`),F=!0;mi=!0}const Xl=x=>{ti(x)};if(/if it is stunned, kill it\. otherwise, stun it/i.test(E)){const x=Q.length>0?Q:ce?[ce]:[];if(x.length>0){for(const T of x)T.stunned?T.damage=999:(T.stunned=!0,T.isReady=!1,T.stunnedUntilTurn=e.turnNumber+1);gt(e),F=!0}}if(/\breveal\s+the\s+top\s+2\s+cards?\s+of\s+your\s+main\s+deck\b/i.test(E)&&/\byou\s+may\s+play\s+one\b/i.test(E)&&/\brecycle\s+the\s+rest\b/i.test(E))if(Vl=!0,!Ce("REKSAI_REVEAL_TOP_2",!0))e.log.unshift(`${t} chose not to reveal cards.`),F=!0;else{qo(e,t,"MAIN");const T=c.mainDeck.splice(0,Math.min(2,c.mainDeck.length));if(T.length===0)e.log.unshift(`${t} revealed no cards (main deck empty).`),F=!0;else{e.log.unshift(`${t} revealed top ${T.length}: ${T.map(ue=>ue.name).join(", ")}.`);const w=ue=>{const pe=Number(ue.cost||0);return(ue.type==="Unit"?30:ue.type==="Gear"?20:ue.type==="Spell"?10:0)+pe},S=ue=>{var pe,Ee;return ue.type==="Unit"||ue.type==="Gear"?!0:ue.type==="Spell"?dt(((pe=ue.ability)==null?void 0:pe.effect_text)||((Ee=ue.ability)==null?void 0:Ee.raw_text)||"").kind==="NONE":!1},U=Ce("REKSAI_PLAY_ONE",!0),G=U?T.filter(ue=>S(ue)).sort((ue,pe)=>w(pe)-w(ue)):[],X=G.length>0?G[0]:null;if(X){const ue=T.findIndex(Ie=>Ie.instanceId===X.instanceId);ue>=0&&T.splice(ue,1);let pe={kind:"BASE"};const Ee=/\bif\s+the\s+played\s+card\s+is\s+a\s+unit,\s*you\s+may\s+play\s+it\s+here\b/i.test(E);X.type==="Unit"&&u!=null&&(!Ee||Ce("REKSAI_PLAY_UNIT_HERE",!0))&&(pe={kind:"BF",index:u}),(pe==null?void 0:pe.kind)==="BF"&&bl(e.battlefields[pe.index])&&(pe={kind:"BASE"}),X.type==="Unit"?ti(X):X.type==="Gear"&&(X.isReady=!0),c.mainDeckCardsPlayedThisTurn+=1,e.chain.push({id:Be("chain"),controller:t,kind:"PLAY_CARD",label:`Play ${X.name}`,sourceCard:X,sourceZone:"HAND",playDestination:X.type==="Unit"||X.type==="Gear"?pe:null,effectText:(($a=X.ability)==null?void 0:$a.effect_text)||"",contextBattlefieldIndex:(pe==null?void 0:pe.kind)==="BF"?pe.index:null,targets:[{kind:"NONE"}]}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,zs(e,"PLAY_CARD",{player:t,card:X}),e.log.unshift(`${t} played ${X.name} from the revealed cards.`)}else U?e.log.unshift(`${t} revealed cards but did not play one.`):e.log.unshift(`${t} chose not to play a revealed card.`);for(const ue of T)c.mainDeck.push(ue);T.length>0&&e.log.unshift(`${t} recycled ${T.length} revealed card(s).`),F=!0}}const Mn=g.match(/\b(?:reveal|look at)\s+(?:the\s+)?top\s+(\d+)\s+(?:cards?|runes?)/i);if(!Vl&&Mn){const x=parseInt(Mn[1],10),T=g.toLowerCase().includes("rune");/\breveal\b/i.test(g)&&qo(e,t,T?"RUNE":"MAIN");const U=(T?c.runeDeck:c.mainDeck).slice(0,x),G=U.map(X=>T?X.domain:X.name).join(", ");if(e.log.unshift(`${t} revealed top ${x}: ${G}.`),!T)for(const X of U){const ue=(((za=X.ability)==null?void 0:za.trigger)||"").toLowerCase(),pe=(_i=X.ability)==null?void 0:_i.effect_text;if(ue.includes("when you look at cards from the top of your deck and see me")&&pe){const Ee=dt(pe);e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Trigger: ${X.name}`,effectText:pe,targets:[{kind:"NONE"}],needsTargets:Ee.kind!=="NONE",targetRequirement:Ee,sourceInstanceId:X.instanceId}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,e.log.unshift(`${X.name} triggered from the top of the deck.`)}}F=!0}const Zl=[],sa=Zf(g);if(sa&&sa>0){const x=Math.min(sa,c.hand.length);for(let T=0;T<x;T++){const w=c.hand.pop();w&&(c.trash.push(w),Zl.push(w),c.discardedThisTurn+=1,F=!0,e.log.unshift(`${t} discarded ${w.name}.`),(((aa=w.ability)==null?void 0:aa.trigger)||"").toLowerCase().includes("when you discard me")&&((Qi=w.ability)!=null&&Qi.effect_text)&&(e.chain.push({id:Be("chain"),controller:t,kind:"TRIGGERED_ABILITY",label:`Discard Trigger: ${w.name}`,effectText:w.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:!1,sourceCard:w}),e.log.unshift(`${w.name} triggered from discard.`)),zs(e,"DISCARD_CARD",{player:t,card:w}))}}if(/you may spend a buff to draw \d+/i.test(E)){jn=!0;const x=E.match(/you may spend a buff to draw (\d+)/i),T=x?parseInt(x[1],10):1,w=vt(e,t);w.reduce((U,G)=>U+(G.buffs||0),0)>0?Ce(`SPEND_BUFF_DRAW_${T}`)?(rh(w,1),an(e,t,T),e.log.unshift(`${t} spent a buff to draw ${T}.`)):e.log.unshift(`${t} chose not to spend a buff.`):e.log.unshift(`${t} has no buffs to spend.`),F=!0}const Wi=Qf(g);if(!jn&&Wi&&Wi>0){const x=E.includes("if you control a poro")?j:!0,T=E.includes("if you control a facedown card at a battlefield")?P:!0,w=/draw 1 if you have one or fewer cards in your hand/i.test(E)?c.hand.length<=1:!0,S=/if you have 4\+ units at that battlefield/i.test(E)&&u!=null?e.battlefields[u].units[t].length>=4:!0;x&&T&&w&&S&&(an(e,t,Wi),F=!0)}if(/\bdraw\s+1\s+for\s+each\s+of\s+your\s+mighty\s+units\b/i.test(E)){let x=0;[c.base.units,...e.battlefields.map(T=>T.units[t])].forEach(T=>{T.forEach(w=>{ho(w)&&(x+=1)})}),x>0&&(an(e,t,x),e.log.unshift(`${t} drew ${x} (Mighty scaling).`),F=!0)}if(/\breveal\s+the\s+top\s+card\s+of\s+your\s+main\s+deck\b/i.test(E)){qo(e,t,"MAIN");const x=c.mainDeck.shift();if(!x)e.log.unshift(`${t} couldn't reveal (main deck empty).`),F=!0;else{const T=/\bif\s+it'?s\s+a\s+spell\b/i.test(E),w=/\bif\s+it'?s\s+a\s+gear\b/i.test(E),S=/\bif\s+it'?s\s+a\s+unit\b/i.test(E),U=/\bput\s+it\s+in\s+your\s+hand\b/i.test(E)||/\bdraw\s+it\b/i.test(E),G=T&&x.type==="Spell"||w&&x.type==="Gear"||S&&x.type==="Unit";e.log.unshift(`${t} revealed ${x.name}.`),G&&U?(c.hand.push(x),e.log.unshift(`${t} put ${x.name} into hand.`)):(c.mainDeck.push(x),e.log.unshift(`${t} recycled ${x.name}.`)),F=!0}}const Ki=Xf(g);if(!I&&Ki&&Ki>0){const T=/\bchannel\s+\d+\s+runes?\s+exhausted\b/i.test(E)?Ds(e,t,Ki):(lh(e,t,Ki),Ki);F=!0,T<Ki&&/\bif\s+you\s+can't\b|\bif\s+you\s+couldn't\b/i.test(E)&&(an(e,t,1),e.log.unshift(`${t} drew 1 (failed to channel enough runes).`))}const Vi=a.sourceCardType==="Legend"&&e.players[t].legendReady;if(/exhaust me to channel \d+ rune(?:s)? exhausted/i.test(E)&&(V&&V.isReady||Vi)){const x=E.match(/exhaust me to channel (\d+) rune/),T=x?parseInt(x[1],10):1,w=(V==null?void 0:V.name)||((Oi=e.players[t].legend)==null?void 0:Oi.name)||"Legend";Ce(`EXHAUST_ME_CHANNEL_${T}`)?(V&&V.isReady?V.isReady=!1:Vi&&(e.players[t].legendReady=!1),Ds(e,t,Number.isFinite(T)?T:1),e.log.unshift(`${t} exhausted ${w} to channel ${Number.isFinite(T)?T:1} rune(s) exhausted.`),F=!0):(e.log.unshift(`${t} chose not to exhaust ${w}.`),F=!0)}if(/spend any number of buffs/i.test(E)&&/for each buff spent, channel/i.test(E)){const x=vt(e,t),T=x.reduce((w,S)=>w+(S.buffs||0),0);if(T>0){let w=T;if(K){const S=ei("SPEND_BUFFS_ANY",T);w=Number.isFinite(S)?Math.max(0,Math.min(T,Math.floor(S))):0}w>0?(rh(x,w),Ds(e,t,w),e.log.unshift(`${t} spent ${w} buff(s) to channel runes.`)):e.log.unshift(`${t} chose not to spend buffs.`),F=!0}else e.log.unshift(`${t} has no buffs to spend.`),F=!0}const mt=E.match(/\badd\s+(\d+)\s+energy\b/);if(mt){const x=parseInt(mt[1],10);Number.isFinite(x)&&x>0&&(c.runePool.energy+=x,e.log.unshift(`${t} added ${x} Energy to the Rune Pool.`),F=!0)}const vs=E.match(/\badd\s+(\d+)?\s*([a-z]+)\s+rune\b/);if(vs){const x=vs[1]?parseInt(vs[1],10):1,T=vs[2];if(Number.isFinite(x)&&x>0){if(T==="class"){const S=ds(e,t)[0]||"Colorless";c.runePool.power[S]+=x,e.log.unshift(`${t} added ${x} ${S} power (class rune).`)}else{const w=ut(T);c.runePool.power[w]+=x,e.log.unshift(`${t} added ${x} ${w} Power to the Rune Pool.`)}F=!0}}const bi=E.match(/\badd\s+(\d+)\s+rune\s+of\s+any\s+type\b/);if(bi){const x=parseInt(bi[1],10);Number.isFinite(x)&&x>0&&(c.runePool.power.Colorless+=x,e.log.unshift(`${t} added ${x} power (any-type rune simplified as Colorless).`),F=!0)}const Eu=x=>{const T={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10};if(!x)return null;if(/^\d+$/.test(x)){const w=parseInt(x,10);return Number.isFinite(w)?w:null}return T[x.toLowerCase()]??null},Ii=g.match(/\bplay\s+(?:(\d+|one|two|three|four|five|six|seven|eight|nine|ten)\s+)?(?:an?\s+)?(?:ready\s+)?(\d+)\s+might\s+([a-z]+)\s+unit\s+token(?:s)?\b/i);if(Ii&&!mi){const x=Ii[1]||"",T=Eu(x)??1,w=parseInt(Ii[2],10),S=Ii[3]||"Token",U=Number.isFinite(T)&&T>0?T:1,G=Number.isFinite(w)&&w>=0?w:1,X=S[0].toUpperCase()+S.slice(1).toLowerCase(),ue=/\bwith\s+\[?temporary\]?\b/i.test(g),pe=/\bready\b/i.test(g),Ee=$m(`${X} Token`,G,X);Ee.rules_text||(Ee.rules_text={raw:"",keywords:[]}),ue&&(Ee.rules_text.raw+=" [Temporary]",Ee.rules_text.keywords=[...Ee.rules_text.keywords||[],"Temporary"]);const Ie=Array.from({length:U},()=>{const Nn=bt(Ee,t,e.turnNumber);return pe&&(Nn.isReady=!0),Nn}),Tt=/\bhere\b/i.test(g)||/\b(in|into|to)\s+your\s+base\b/i.test(g)||/\bat\s+(?:a|that)\s+battlefield\b/i.test(g),Ti=/\bhere\b/i.test(g);let xn=Ue??(Ti?u:null);xn!=null&&!Tt&&e.battlefields[xn].controller!==t&&(e.log.unshift(`${t} can only play this token to a battlefield they control; played at Base instead.`),xn=null);const Ln=(Nn,wn)=>(Xr(e,"UNIT_PLAYED",Nn,{battlefieldIndex:wn,alone:!1}),e.pendingOptionalChoice?"PENDING_OPTIONAL":!0);if(xn!=null){const Nn=e.battlefields[xn];if(bl(Nn)){c.base.units.push(...Ie),e.log.unshift(`${Nn.card.name} prevents playing units there; tokens played at Base instead.`);for(const wn of Ie){const Zt=Ln(wn,null);if(Zt==="PENDING_OPTIONAL")return F=!0,Zt}}else{e.battlefields[xn].units[t].push(...Ie),e.log.unshift(`${t} played ${U} ${G} might ${X} token(s) at Battlefield ${xn+1}.`);for(const wn of Ie){const Zt=Ln(wn,xn);if(Zt==="PENDING_OPTIONAL")return F=!0,Zt}}}else{c.base.units.push(...Ie),e.log.unshift(`${t} played ${U} ${G} might ${X} token(s) at Base.`);for(const Nn of Ie){const wn=Ln(Nn,null);if(wn==="PENDING_OPTIONAL")return F=!0,wn}}F=!0}if(/\bplay\s+(?:a|an)\s+gold\s+gear\s+token\b/i.test(E)||/\bplay\s+(?:a|an)\s+gold\s+token\b/i.test(E)){let x=!0;const T=E.match(/pay\s+(\d+)\s+energy/i);if(T){const w=parseInt(T[1],10);Ce(`PAY_ENERGY_GOLD_${w}`)||(e.log.unshift(`${t} chose not to pay ${w} energy for a Gold token.`),F=!0,x=!1),x&&(qi(w)?e.log.unshift(`${t} paid ${w} energy for a Gold token.`):(e.log.unshift(`${t} cannot pay ${w} energy for a Gold token.`),F=!0,x=!1))}if(x){const S=oN("Gold","Kill this, Exhaust: [Reaction]  [Add] Any Rune. (Abilities that add resources can't be reacted to.)"),U=bt(S,t,e.turnNumber),G=/\bexhausted\b/i.test(E);U.isReady=!G,c.base.gear.push(U),e.log.unshift(`${t} played a Gold gear token${G?" exhausted":""}.`),F=!0}}if(/\bmove\s+an?\s+enemy\s+(gear|equipment)\s+to\s+your\s+base\b/i.test(E)){const x=ee.find(T=>T.kind==="GEAR");if(x){const T=rs(e,x.owner,x.instanceId);if(T&&T.gear.controller!==t){const w=Ec(e,x.owner,x.instanceId);if(w){if(w.owner=t,w.controller=t,w.isReady=!1,c.base.gear.push(w),e.log.unshift(`${t} moved ${w.name} to base and took control of it.`),V&&/if it's an?\s+equipment,\s*attach it to me/i.test(E)&&ss(w)){const S=c.base.gear.findIndex(U=>U.instanceId===w.instanceId);if(S>=0){const U=c.base.gear.splice(S,1)[0];Om(e,V,U),e.log.unshift(`${w.name} attached to ${V.name}.`)}}F=!0}}}}if(/attach\s+.*equipment/i.test(E)){const x=Q.length>0?Q[0]:ce,T=ee.find(w=>w.kind==="GEAR");if(x&&T&&rs(e,T.owner,T.instanceId)){const S=Ec(e,T.owner,T.instanceId);S&&(Om(e,x,S),e.log.unshift(`${t} attached ${S.name} to ${x.name}.`),F=!0)}}if(/detach\s+.*equipment/i.test(E)){const x=ee.find(T=>T.kind==="GEAR");if(x){const T=rs(e,x.owner,x.instanceId);if(T&&T.zone==="ATTACHED"&&T.unit){const w=_m(T.unit,T.gear.instanceId);w&&(e.players[w.owner].base.gear.push({...w,isReady:!1}),e.log.unshift(`${t} detached ${w.name}.`),F=!0)}}}if(/play me from your trash/i.test(E)){const x=a.sourceInstanceId!=null?c.trash.findIndex(T=>T.instanceId===a.sourceInstanceId):c.trash.findIndex(T=>T.name===a.sourceCardName);if(x>=0){const T=c.trash[x],w=/\bpay\s+1\s+energy\b/i.test(g)?1:0,S=g.match(/\bpay\s+1\s+([a-z]+)\s+rune\b/i),U=S?ut(S[1]):null,G=/\bpay\s+1\s+rune\s+of\s+any\s+type\b/i.test(g),X=w===0||c.runePool.energy>=w,ue=!U||(c.runePool.power[U]||0)>=1,pe=!G||Object.values(c.runePool.power).some(Ee=>Ee>0);if(X&&ue&&pe){w>0&&qi(w),U&&xu(U,1),G&&Ql(1),c.trash.splice(x,1);let Ee=/\bhere\b/i.test(g)&&u!=null?{kind:"BF",index:u}:{kind:"BASE"};Ee.kind==="BF"&&bl(e.battlefields[Ee.index])&&(Ee={kind:"BASE"}),T.type==="Unit"?Xl(T):T.type==="Gear"&&(T.isReady=!0),c.mainDeckCardsPlayedThisTurn+=1,e.chain.push({id:Be("chain"),controller:t,kind:"PLAY_CARD",label:`Play ${T.name}`,sourceCard:T,sourceZone:"HAND",playDestination:T.type==="Unit"||T.type==="Gear"?Ee:null,effectText:((ni=T.ability)==null?void 0:ni.effect_text)||"",contextBattlefieldIndex:Ee.kind==="BF"?Ee.index:null,targets:[{kind:"NONE"}]}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,zs(e,"PLAY_CARD",{player:t,card:T}),e.log.unshift(`${t} played ${T.name} from Trash.`),F=!0}}}if(/play me for 1 rune of any type/i.test(E)){const x=a.sourceInstanceId!=null?c.mainDeck.findIndex(T=>T.instanceId===a.sourceInstanceId):c.mainDeck.findIndex(T=>T.name===a.sourceCardName);if(x>=0&&Ql(1)){const T=c.mainDeck.splice(x,1)[0];let w=/\bhere\b/i.test(g)&&u!=null?{kind:"BF",index:u}:{kind:"BASE"};w.kind==="BF"&&bl(e.battlefields[w.index])&&(w={kind:"BASE"}),T.type==="Unit"?Xl(T):T.type==="Gear"&&(T.isReady=!0),c.mainDeckCardsPlayedThisTurn+=1,e.chain.push({id:Be("chain"),controller:t,kind:"PLAY_CARD",label:`Play ${T.name}`,sourceCard:T,sourceZone:"HAND",playDestination:T.type==="Unit"||T.type==="Gear"?w:null,effectText:((St=T.ability)==null?void 0:St.effect_text)||"",contextBattlefieldIndex:w.kind==="BF"?w.index:null,targets:[{kind:"NONE"}]}),e.state="CLOSED",e.priorityPlayer=t,e.passesInRow=0,zs(e,"PLAY_CARD",{player:t,card:T}),e.log.unshift(`${t} played ${T.name} from the top of the deck.`),F=!0}}const Si=g.match(/\[([^\]]+)\]/);if((/\bgive\b/i.test(g)||/\bgains\b/i.test(g))&&Si){const x=Si[1].trim();if(x){const T=/\bthis\s+turn\b/i.test(g)||/\bthis\s+combat\b/i.test(g),w=[];if(Q.length>0?w.push(...Q):(/\bme\b/i.test(g)||/\bthis\b/i.test(g))&&V&&w.push(V),w.length>0){for(const S of w)T?S.tempKeywords=[...S.tempKeywords||[],x]:S.extraKeywords=[...S.extraKeywords||[],x];w.length===1?e.log.unshift(`${t} granted [${x}] ${T?"this turn":""} to ${w[0].name}.`):e.log.unshift(`${t} granted [${x}] ${T?"this turn":""} to ${w.length} unit(s).`),F=!0}else Ke&&(F=!0)}}if(/\bmove\s+me\s+to\s+(?:your|my|its)\s+base\b/i.test(g)&&V)if(K&&!Ce("MOVE_ME_TO_BASE",!0))e.log.unshift(`${t} chose not to move ${V.name} to base.`),F=!0;else{const x=Me(e,V.owner,V.instanceId);if(x){if(x.zone==="BF"){const w=e.battlefields[x.battlefieldIndex??-1];if(w&&ns(w))return e.log.unshift(`${w.card.name} prevents moving units from this battlefield to base.`),F=!0,F}const T=Gn(e,V.owner,V.instanceId);T&&(T.isReady=!1,ai(e,V.owner,T,{kind:"BASE"}),e.log.unshift(`${T.name} moved to base.`))}F=!0}if(/\bmove\s+me\s+to\s+its\s+location\s+and\s+it\s+to\s+my\s+original\s+location\b/i.test(g)&&V&&ce){const x=Me(e,V.owner,V.instanceId),T=Me(e,ce.owner,ce.instanceId);if(x&&T)if(V.instanceId===ce.instanceId)e.log.unshift(`${V.name} stayed in place (same unit chosen).`),F=!0;else{const w=x.zone==="BASE"?{kind:"BASE"}:{kind:"BF",index:x.battlefieldIndex},S=T.zone==="BASE"?{kind:"BASE"}:{kind:"BF",index:T.battlefieldIndex};if(w.kind===S.kind&&(w.kind==="BASE"||w.index===S.index))e.log.unshift(`${V.name} and ${ce.name} are already at the same location.`),F=!0;else{const G=S,X=w,ue=w.kind==="BF"&&G.kind==="BASE"&&ns(e.battlefields[w.index]),pe=S.kind==="BF"&&X.kind==="BASE"&&ns(e.battlefields[S.index]);if(ue||pe){const Ee=ue?w.index:S.index;e.log.unshift(`${e.battlefields[Ee].card.name} prevents moving units from this battlefield to base.`),F=!0}else{const Ee=Gn(e,V.owner,V.instanceId),Ie=Gn(e,ce.owner,ce.instanceId);if(Ee&&Ie){if(Ee.moveCountThisTurn+=1,Ie.moveCountThisTurn+=1,ai(e,Ee.owner,Ee,G),ai(e,Ie.owner,Ie,X),xa(e,Ee.owner,[Ee],w,G),xa(e,Ie.owner,[Ie],S,X),ba(e,Ee.owner,[Ee],G.kind==="BF"?G.index:"BASE"),ba(e,Ie.owner,[Ie],X.kind==="BF"?X.index:"BASE"),/if it's equipped,\s*you may attach one of its equipment to me/i.test(E)&&(Ie.attachedGear||[]).length>0&&Ce("SWAP_ATTACH_TARGET_EQUIPMENT",!0)){const Tt=Ie.attachedGear.shift();Tt&&(Ee.attachedGear||(Ee.attachedGear=[]),Ee.attachedGear.push(Tt),e.log.unshift(`${t} attached ${Tt.name} from ${Ie.name} to ${Ee.name}.`))}e.log.unshift(`${V.name} swapped locations with ${ce.name}.`)}else Ee&&!Ie&&ai(e,Ee.owner,Ee,w),!Ee&&Ie&&ai(e,Ie.owner,Ie,S),e.log.unshift("Swap failed: one of the units is no longer in play.");F=!0}}}else e.log.unshift("Swap failed: source or chosen unit is no longer in play."),F=!0}if(/\bmove\s+(?:an?\s+)?(?:enemy|opposing)\s+unit\b/i.test(g)){const x=ce;if(x&&x.owner!==t){const T=Me(e,x.owner,x.instanceId);let w=null;if(/\bto\s+here\b/i.test(g)&&u!=null?w={kind:"BF",index:u}:/\bto\s+(?:its\s+)?base\b/i.test(g)?w={kind:"BASE"}:u!=null?w={kind:"BF",index:u}:w={kind:"BASE"},w){if(T&&T.zone==="BF"&&w.kind==="BASE"){const U=e.battlefields[T.battlefieldIndex??-1];if(U&&ns(U))return!1}const S=Gn(e,x.owner,x.instanceId);if(S){if(S.moveCountThisTurn+=1,ai(e,x.owner,S,w),T){const U=T.zone==="BASE"?{kind:"BASE"}:{kind:"BF",index:T.battlefieldIndex};xa(e,x.owner,[S],U,w)}if(ba(e,x.owner,[S],w.kind==="BF"?w.index:"BASE"),/\banother\s+enemy\s+unit\s+at\s+its\s+destination\b/i.test(g)){const U=ee.find(pe=>pe.kind==="UNIT"&&pe.owner===S.owner&&pe.instanceId!==S.instanceId),X=(w.kind==="BASE"?e.players[S.owner].base.units:e.battlefields[w.index].units[S.owner]).filter(pe=>pe.instanceId!==S.instanceId).sort((pe,Ee)=>Pe(Ee,{role:"NONE",game:e})-Pe(pe,{role:"NONE",game:e}))[0],ue=U&&((Dt=Me(e,U.owner,U.instanceId))==null?void 0:Dt.unit)||X;if(ue){const pe=Pe(S,{role:"NONE",game:e}),Ee=Pe(ue,{role:"NONE",game:e});S.damage+=Ee,ue.damage+=pe,e.log.unshift(`Move clash: ${S.name} (M${pe}) and ${ue.name} (M${Ee}) dealt damage to each other.`)}}e.log.unshift(`${t} moved enemy ${x.name}.`),F=!0}}}}if(/\bmove\s+(?:an?\s+)?unit\b/i.test(g)&&!/\b(?:friendly|enemy|opposing|your)\s+unit\b/i.test(g)){const x=/\bfrom\s+a\s+battlefield\s+to\s+(?:its\s+)?base\b/i.test(g)||/\bto\s+(?:its\s+)?base\b/i.test(g),T=/\bto\s+here\b/i.test(g)&&u!=null;if(x||T){let w=0;ze((S,U,G)=>{const X=T&&u!=null?{kind:"BF",index:u}:x?{kind:"BASE"}:null;if(!X)return;const ue=G.zone==="BASE"?{kind:"BASE"}:{kind:"BF",index:G.battlefieldIndex};if(ue.kind==="BF"&&X.kind==="BASE"){const Ee=e.battlefields[ue.index];if(ns(Ee)){e.log.unshift(`${Ee.card.name} prevents moving units from this battlefield to base.`);return}}const pe=Gn(e,U.owner,S.instanceId);pe&&(pe.moveCountThisTurn+=1,ai(e,U.owner,pe,X),xa(e,U.owner,[pe],ue,X),ba(e,U.owner,[pe],X.kind==="BF"?X.index:"BASE"),w+=1)}),w>0?(e.log.unshift(`${t} moved ${w} unit(s).`),F=!0):(Ke||K)&&(F=!0)}}if(/\bmove\s+(?:up\s+to\s+)?(?:\d+|one|two|three|four|five|six|seven|eight|nine|ten)?\s*(?:friendly|your)?\s+units?\b/i.test(g)){let x=0;const T=/\bto\s+(?:their\s+)?base\b/i.test(g),w=/\bto\s+here\b/i.test(g)&&u!=null,S=/\bto\s+there\b/i.test(g)&&Ue!=null,U=/\bto\s+an?\s+open\s+battlefield\b/i.test(g),G=/\bto\s+that\s+enemy\s+unit'?s\s+battlefield\b/i.test(g),X=((mn=se.find(pe=>pe.loc.zone==="BF"&&pe.t.owner!==t))==null?void 0:mn.loc.battlefieldIndex)??null,ue=((Pn=e.battlefields.find(pe=>pe.controller==null&&pe.units.P1.length===0&&pe.units.P2.length===0))==null?void 0:Pn.index)??((Tu=e.battlefields.find(pe=>pe.controller==null))==null?void 0:Tu.index)??null;ze((pe,Ee,Ie)=>{if(Ee.owner!==t)return;let Tt=G&&X!=null?{kind:"BF",index:X}:U&&ue!=null?{kind:"BF",index:ue}:S&&Ue!=null?{kind:"BF",index:Ue}:w&&u!=null?{kind:"BF",index:u}:T?{kind:"BASE"}:null;if(!Tt)if(Ie.zone==="BASE"){const Ln=e.battlefields.filter(Zt=>Zt.controller===t).map(Zt=>Zt.index),Nn=e.battlefields.map(Zt=>Zt.index),wn=(Ln.length>0?Ln[0]:Nn[0])??null;if(wn==null)return;Tt={kind:"BF",index:wn}}else Tt={kind:"BASE"};if(!Tt)return;const Ti=Ie.zone==="BASE"?{kind:"BASE"}:{kind:"BF",index:Ie.battlefieldIndex};if(Ti.kind==="BF"&&Tt.kind==="BASE"){const Ln=e.battlefields[Ti.index];if(ns(Ln)){e.log.unshift(`${Ln.card.name} prevents moving units from this battlefield to base.`);return}}const xn=Gn(e,Ee.owner,pe.instanceId);xn&&(xn.moveCountThisTurn+=1,ai(e,Ee.owner,xn,Tt),xa(e,Ee.owner,[xn],Ti,Tt),ba(e,Ee.owner,[xn],Tt.kind==="BF"?Tt.index:"BASE"),x+=1)}),x>0?(e.log.unshift(`${t} moved ${x} friendly unit(s).`),F=!0):(Ke||K)&&(F=!0)}if(/this\s+turn,\s*that\s+unit\s+has\s+"when\s+i\s+conquer,\s*you\s+may\s+move\s+me\s+to\s+my\s+base\.?"/i.test(E)){const x=Q.filter(T=>T.owner===t);if(x.length>0){for(const T of x)T.tempKeywords=Array.from(new Set([...T.tempKeywords||[],K0]));e.log.unshift(`${t} granted ${x.length} unit(s) a temporary conquer move-to-base trigger.`),F=!0}else(Ke||K)&&(F=!0)}if(/\bmove\s+a\s+friendly\s+unit\s+to\s+or\s+from\s+its\s+base\b/i.test(g)){let x=0;ze((T,w,S)=>{if(w.owner!==t)return;const U=S.zone==="BASE"?{kind:"BASE"}:{kind:"BF",index:S.battlefieldIndex};let G=null;if(U.kind==="BASE"){const ue=e.battlefields.filter(Ie=>Ie.controller===t).map(Ie=>Ie.index),pe=e.battlefields.map(Ie=>Ie.index),Ee=(ue.length>0?ue[0]:pe[0])??null;if(Ee==null)return;G={kind:"BF",index:Ee}}else{const ue=e.battlefields[U.index];if(ns(ue)){e.log.unshift(`${ue.card.name} prevents moving units from this battlefield to base.`);return}G={kind:"BASE"}}const X=Gn(e,w.owner,T.instanceId);!X||!G||(X.moveCountThisTurn+=1,ai(e,w.owner,X,G),xa(e,w.owner,[X],U,G),ba(e,w.owner,[X],G.kind==="BF"?G.index:"BASE"),x+=1)}),x>0?(e.log.unshift(`${t} moved ${x} friendly unit(s) to or from base.`),F=!0):(K||Ke)&&(F=!0)}if(Jf(g)){const x=[];if(Q.length>0)x.push(...Q);else if(/\bme\b/i.test(g))V&&x.push(V);else if(/\ball\b/i.test(g)||/\beach\b/i.test(g)){const w=/\bhere\b/i.test(g)&&u!=null,S=/\benemy\b/i.test(g)||/\bopposing\b/i.test(g),U=/\bfriendly\b/i.test(g)||/\byour\b/i.test(g);if(w&&u!=null)S?x.push(...e.battlefields[u].units[l]):U?x.push(...e.battlefields[u].units[t]):(x.push(...e.battlefields[u].units.P1),x.push(...e.battlefields[u].units.P2));else if(S){x.push(...e.players[l].base.units);for(const G of e.battlefields)x.push(...G.units[l])}else if(U){x.push(...c.base.units);for(const G of e.battlefields)x.push(...G.units[t])}}if(x.length>0){for(const w of x)w.stunned=!0,w.isReady=!1,w.stunnedUntilTurn=e.turnNumber+1;x.length===1?e.log.unshift(`${x[0].name} was stunned.`):e.log.unshift(`${t} stunned ${x.length} unit(s).`),F=!0,x.filter(w=>w.owner===l).length>0&&Hn(e,t,w=>w.includes("when you stun an enemy unit")||w.includes("when you stun one or more enemy units"),w=>{var S;return(S=w.ability)==null?void 0:S.effect_text})}else Ke&&(F=!0)}if(eh(g)){const x=[],T=e.battlefields.some(w=>w.units[l].some(S=>{var G,X;const U=`${((G=S.ability)==null?void 0:G.effect_text)||""} ${((X=S.ability)==null?void 0:X.raw_text)||""}`.toLowerCase();return U.includes("while i'm at a battlefield")&&U.includes("spells and abilities can't ready enemy units and gear")}));if(Q.length>0)x.push(...Q);else if(/\bme\b/i.test(g))V&&x.push(V);else if(/\ball\b/i.test(g)||/\beach\b/i.test(g)){const S=/\bhere\b/i.test(g)&&u!=null,U=/\benemy\b/i.test(g)||/\bopposing\b/i.test(g),G=/\bfriendly\b/i.test(g)||/\byour\b/i.test(g);if(S&&u!=null)U?x.push(...e.battlefields[u].units[l]):G?x.push(...e.battlefields[u].units[t]):(x.push(...e.battlefields[u].units.P1),x.push(...e.battlefields[u].units.P2));else if(U){x.push(...e.players[l].base.units);for(const X of e.battlefields)x.push(...X.units[l])}else if(G){x.push(...c.base.units);for(const X of e.battlefields)x.push(...X.units[t])}}if(x.length>0){for(const S of x)T&&S.owner===l||(S.isReady=!0,S.stunned=!1);x.length===1?e.log.unshift(`${x[0].name} was readied.`):e.log.unshift(`${t} readied ${x.length} unit(s).`),F=!0;const w=x.filter(S=>S.owner===t);if(w.length>0)for(const S of w)Hn(e,t,U=>U.includes("when you ready a friendly unit"),U=>{var G;return(G=U.ability)==null?void 0:G.effect_text},[{kind:"UNIT",owner:t,instanceId:S.instanceId}],u);for(const S of x){const U=Es(S,"READY_ME");if(U.length===0)continue;const G=Me(e,S.owner,S.instanceId);for(const X of U){const ue=dt(X,{here:(G==null?void 0:G.zone)==="BF"});e.chain.push({id:Be("chain"),controller:S.controller,kind:"TRIGGERED_ABILITY",label:`Trigger: ${S.name} (Ready)`,effectText:X,contextBattlefieldIndex:(G==null?void 0:G.zone)==="BF"?G.battlefieldIndex??null:null,targets:ue.kind==="NONE"?[{kind:"NONE"}]:[{kind:"UNIT",owner:S.owner,instanceId:S.instanceId,battlefieldIndex:(G==null?void 0:G.zone)==="BF"?G.battlefieldIndex:void 0,zone:G==null?void 0:G.zone}],needsTargets:ue.kind!=="NONE",targetRequirement:ue,sourceInstanceId:S.instanceId,sourceCardType:S.type}),e.state="CLOSED",e.priorityPlayer=S.controller,e.passesInRow=0,e.log.unshift(`${S.name} triggered (Ready).`)}}}else/\bready me\b/i.test(g)&&c.legend?(c.legendReady=!0,e.log.unshift(`${t} readied their legend.`),F=!0):Ke&&(F=!0)}if(/for each friendly unit, you may spend its buff to ready it/i.test(E)){const x=vt(e,t);let T=0;const w=x.some(G=>G.buffs>0);if(w?Ce("SPEND_BUFFS_READY_ALL"):!1){for(const G of x)G.buffs>0&&(G.buffs-=1,G.isReady=!0,T+=1);T>0&&(e.log.unshift(`${t} spent buffs to ready ${T} unit(s).`),F=!0)}else w&&e.log.unshift(`${t} chose not to spend buffs.`),F=!0;let U=0;for(const G of x)Qo(e,G)&&(U+=1);U>0?(e.log.unshift(`${t} buffed ${U} friendly unit(s).`),F=!0):(e.log.unshift(`${t} has no units to buff (already buffed).`),F=!0)}const Di=E.match(/\bready\s+(\d+)\s+(?:friendly\s+)?runes?\b/);if(Di){const x=parseInt(Di[1],10);if(Number.isFinite(x)&&x>0){const T=c.runesInPlay.filter(w=>!w.isReady).slice(0,x);for(const w of T)w.isReady=!0;e.log.unshift(`${t} readied ${T.length} rune(s).`),F=!0}}const Ye=E.match(/\byou may pay\s+(?:1\s+)?class-rune\b.*\bif you do,\s*give me\s+\+(\d+)\s+might\s+this\s+turn\b/i);if(Ye&&V){const x=parseInt(Ye[1],10);if(Ce(`PAY_CLASS_FOR_SELF_BUFF_${x}`,!0)&&Number.isFinite(x)&&x>0){const w=ds(e,t),S=Kt(e.players[t].runePool,1,w);if(S){for(const U of w){const G=S.payment[U]||0;G>0&&(e.players[t].runePool.power[U]-=G)}Xo(e,V,x),e.log.unshift(`${t} paid [C]. ${V.name} gets +${x} might this turn.`)}else e.log.unshift(`${t} couldn't pay [C].`)}else e.log.unshift(`${t} chose not to pay [C].`);F=!0,gi=!0}if(/\bgive\s+(?:a\s+)?friendly\s+unit\s+my\s+keywords\s+and\s+\+?\s*(?:might|\[s\])\s+equal\s+to\s+my\s+might\s+this\s+turn\b/i.test(E)&&V){const x=Q.filter(T=>T.owner===t);if(x.length>0){const T=fp(V).map(S=>String(S||"").trim()).filter(Boolean),w=Pe(V,{role:"NONE",game:e});for(const S of x)T.length>0&&(S.tempKeywords=Array.from(new Set([...S.tempKeywords||[],...T]))),Xo(e,S,w),e.log.unshift(`${S.name} gained ${V.name}'s keywords and +${w} might this turn.`);F=!0}else(Ke||K)&&(F=!0)}const Jl=(()=>{const x=E.match(/\bminimum\s+of\s+(\d+)\s+might\b/);if(!x)return null;const T=parseInt(x[1],10);return Number.isFinite(T)?T:null})(),Ri=E.match(/\bgive\s+(?:a\s+)?(?:friendly\s+|enemy\s+|your\s+|opposing\s+)?([a-z\-]+)\s+([+-])\s*(\d+)\s+might\s+this\s+turn\b/);if(Ri&&!gi){const x=Ri[1],T=Ri[2]==="-"?-1:1,w=parseInt(Ri[3],10),S=T*(Number.isFinite(w)?w:0),U=G=>{const X=/additional \+1 might this turn if it is the only unit you control there/i.test(E);if(/if there is a ready enemy unit here/i.test(E)&&(u==null||!e.battlefields[u].units[l].some(Tt=>Tt.isReady)))return;if(!X&&/only unit you control there/i.test(E)){const Ie=Me(e,t,G.instanceId);if(!Ie||Ie.zone!=="BF"||Ie.battlefieldIndex==null||e.battlefields[Ie.battlefieldIndex].units[t].length!==1)return}const ue=Pe(G,{role:"NONE",game:e}),Ee=(Jl!=null?Math.max(Jl,ue+S):ue+S)-ue;if(Xo(e,G,Ee),e.log.unshift(`${G.name} gets ${Ee>=0?"+":""}${Ee} might this turn.`),F=!0,X){const Ie=Me(e,t,G.instanceId);(Ie&&Ie.zone==="BF"&&Ie.battlefieldIndex!=null?e.battlefields[Ie.battlefieldIndex].units[t].length:0)===1&&(Xo(e,G,1),e.log.unshift(`${G.name} gets +1 additional might (only unit there).`))}};if(x==="me"||x==="this")V&&U(V);else if(x==="unit"||x==="it")if(Q.length>0)for(const G of Q)U(G);else ce?U(ce):Ke&&(F=!0);else if(x==="units"){const G=/\b(?:up\s+to\s+)?(?:one|two|three|four|five|six|seven|eight|nine|ten|\d+)\s+(?:friendly\s+|enemy\s+|opposing\s+)?units?\b/i.test(E);if(Q.length>0||G)if(Q.length>0)for(const X of Q)U(X);else if(Ke)F=!0;else{const ue=((pe,Ee)=>{const Ie=vt(pe,Ee);return Ie.length===0?null:Ie.reduce((Tt,Ti)=>Pe(Ti,{game:pe})<Pe(Tt,{game:pe})?Ti:Tt,Ie[0])})(e,t);ue&&U(ue)}else{const X=[],ue=/\bhere\b/.test(E),pe=/\benemy\b/.test(E)||/\bopposing\b/.test(E),Ee=/\bfriendly\b/.test(E)||/\byour\b/.test(E);if(pe)if(ue&&u!=null)X.push(...e.battlefields[u].units[l]);else{X.push(...e.players[l].base.units);for(const Ie of e.battlefields)X.push(...Ie.units[l])}else if(Ee)if(ue&&u!=null)X.push(...e.battlefields[u].units[t]);else{X.push(...c.base.units);for(const Ie of e.battlefields)X.push(...Ie.units[t])}else ue&&u!=null&&(X.push(...e.battlefields[u].units.P1),X.push(...e.battlefields[u].units.P2));for(const Ie of X)U(Ie)}}else{const G=x.replace(/s$/,""),X=E.includes("enemy")||E.includes("opposing"),ue=/\bhere\b/.test(E),pe=[];if(ue&&u!=null)X?pe.push(...e.battlefields[u].units[l]):pe.push(...e.battlefields[u].units[t]);else if(X){pe.push(...e.players[l].base.units);for(const Ie of e.battlefields)pe.push(...Ie.units[l])}else{pe.push(...c.base.units);for(const Ie of e.battlefields)pe.push(...Ie.units[t])}const Ee=pe.filter(Ie=>(Ie.subtypes||[]).map(Tt=>Tt.toLowerCase()).includes(G));for(const Ie of Ee)U(Ie)}}if(ih(g)){const x=[],T=/\bbuff\s+another\s+friendly\s+unit\b/i.test(g),w=/if\s+it\s+doesn't\s+have\s+a\s+buff/i.test(g);Q.length>0?T&&V?x.push(...Q.filter(U=>U.instanceId!==V.instanceId)):x.push(...Q):/\bme\b/i.test(g)||/\bthis\b/i.test(g)?V&&x.push(V):ce?T&&V&&ce.instanceId===V.instanceId||x.push(ce):T&&(e.log.unshift(`${(a==null?void 0:a.sourceCardName)||"Effect"}: No valid target for buff (no other friendly units).`),F=!0);const S=E.includes("if you control a poro")?j:!0;if(x.length>0&&S){let U=0;for(const G of x){if(w&&G.buffs>0){e.log.unshift(`${G.name} already has a buff.`);continue}Qo(e,G)?U++:w&&e.log.unshift(`${G.name} already has a buff.`)}if(U>0){if(U===1&&x.length===1)e.log.unshift(`${x[0].name} got +1 might permanently (buff).`);else if(U===1){const X=x.find(ue=>ue.buffs>0);X&&e.log.unshift(`${X.name} got +1 might permanently (buff).`)}else e.log.unshift(`${t} buffed ${U} unit(s) (+1 might permanently).`);F=!0;const G=x.filter(X=>X.owner===t&&X.buffs>0);if(G.length>0)for(const X of G)Hn(e,t,ue=>ue.includes("when you buff a friendly unit"),ue=>{var pe;return(pe=ue.ability)==null?void 0:pe.effect_text},[{kind:"UNIT",owner:t,instanceId:X.instanceId}],u)}else(w||x.length>0)&&(F=!0)}else Ke&&(F=!0);if(/buff all other friendly units there/i.test(E)&&V){const U=Me(e,t,V.instanceId);if(U&&U.zone==="BF"&&U.battlefieldIndex!=null){const G=e.battlefields[U.battlefieldIndex].units[t].filter(ue=>ue.instanceId!==V.instanceId);let X=0;for(const ue of G)Qo(e,ue)&&(X+=1);X>0&&(e.log.unshift(`${t} buffed ${X} other friendly unit(s) there.`),F=!0)}}if(/buff (each|all) friendly units? there/i.test(E)&&V){const U=Me(e,t,V.instanceId);if(U&&U.zone==="BF"&&U.battlefieldIndex!=null){const G=e.battlefields[U.battlefieldIndex].units[t];let X=0;for(const ue of G)Qo(e,ue)&&(X+=1,Hn(e,t,pe=>pe.includes("when you buff a friendly unit"),pe=>{var Ee;return(Ee=pe.ability)==null?void 0:Ee.effect_text},[{kind:"UNIT",owner:t,instanceId:ue.instanceId}],U.battlefieldIndex));e.log.unshift(`${t} buffed ${X} friendly unit(s) there.`),F=!0}}}if(/its might becomes the might of that friendly unit this turn/i.test(E)){const x=Q.length>0?Q[0]:ce;if(x){const T=vt(e,t).filter(U=>U.instanceId!==x.instanceId),w=Pe(x,{role:"NONE",game:e}),S=T.reduce((U,G)=>Math.max(U,Pe(G,{role:"NONE",game:e})),0);S>w?(x.tempMightBonus+=S-w,e.log.unshift(`${x.name}'s Might became ${S} this turn.`)):e.log.unshift(`${x.name} had no higher friendly Might to copy.`),F=!0}}if(sh(g)){let x=0;const T=new Set,w=/return.*to.*owner's hand|return.*to.*hand/i.test(g);if(ze((S,U,G)=>{const X=Gn(e,U.owner,S.instanceId);if(X){if(w)Jc(e,X,"hand")||(ah(X),e.players[U.owner].hand.push(X));else{if(G.zone==="BF"){const ue=e.battlefields[G.battlefieldIndex??-1];if(ue&&ns(ue)){e.log.unshift(`${ue.card.name} prevents moving units from this battlefield to base.`),ai(e,U.owner,X,{kind:"BF",index:G.battlefieldIndex});return}}X.isReady=!1,e.players[U.owner].base.units.push(X)}T.add(U.owner),x+=1}}),x>0){w?x===1&&Q.length===1?e.log.unshift(`${Q[0].name} returned to hand.`):e.log.unshift(`${t} returned ${x} unit(s) to hand.`):x===1&&Q.length===1?e.log.unshift(`${Q[0].name} returned to Base.`):e.log.unshift(`${t} returned ${x} unit(s) to Base.`),F=!0;const S=E.match(/its\s+owner\s+channels?\s+(\d+)\s+runes?\s+exhausted/i);if(S){const U=parseInt(S[1],10);if(Number.isFinite(U)&&U>0)for(const G of T)Ds(e,G,U)}}else Ke&&(F=!0)}if((/next time.*would be dealt damage this turn.*prevent/i.test(g)||/prevent.*next.*damage.*this turn/i.test(g))&&(ze((x,T)=>{x.preventNextDamageUntilTurn=e.turnNumber}),Q.length>0&&(e.log.unshift(`${t} set damage prevention on ${Q.length} unit(s) this turn.`),F=!0)),/\bnext time it dies this turn\b/i.test(g)){const x=(()=>{const S=E.match(/\bpay\s+1\s+([a-z]+)\s+rune\b/);return S?ut(S[1]):null})(),T=/\bpay\s+1\s+rune\s+of\s+any\s+type\b/i.test(g),w=/\byou may pay\s*\[c\]\b/i.test(g)||!!x||T;ze((S,U)=>{U.owner===t&&(S.deathReplacement={untilTurn:e.turnNumber,recallExhausted:!0,payRuneDomain:x??void 0,payRuneAny:T,optional:/\byou may\b/i.test(g)},e.recallOnDeathEffects.push({unitInstanceId:S.instanceId,controller:t,untilTurn:e.turnNumber,payCost:w}))}),Q.length>0&&(e.log.unshift(`${t} set a death replacement effect (${Q.length} unit(s)).`),F=!0)}if(th(g)){let x=0;const T=ee.filter(S=>S.kind==="GEAR");if(T.length>0){for(const S of T){const U=Ec(e,S.owner,S.instanceId);U&&(Jc(e,U,"trash")||e.players[U.owner].trash.push(U),x+=1)}x>0&&(e.log.unshift(`${t} killed ${x} gear.`),F=!0)}let w=0;if(Q.length>0)for(const S of Q)S.damage=999,w+=1;else ce&&(ce.damage=999,w+=1);if(w>0){const S=E.match(/its\s+controller\s+draws\s+(\d+)/i),U=new Set;if(Q.length>0)for(const G of Q)U.add(G.owner);else ce&&U.add(ce.owner);if(gt(e),w===1&&ce?e.log.unshift(`${ce.name} was killed.`):e.log.unshift(`${t} killed ${w} unit(s).`),F=!0,S){const G=parseInt(S[1],10);if(Number.isFinite(G)&&G>0)for(const X of U){for(let ue=0;ue<G;ue++){const pe=e.players[X].mainDeck.shift();pe&&e.players[X].hand.push(pe)}e.log.unshift(`${X} (controller of killed unit) draws ${G}.`)}}a.sourceCardType==="Spell"&&Hn(e,t,G=>G.includes("when you kill a unit with a spell"),G=>{var X;return(X=G.ability)==null?void 0:X.effect_text},[{kind:"NONE"}],void 0,!0),(ce!=null&&ce.stunned||Q.some(G=>G.stunned))&&(ce||Q.length>0)&&Hn(e,t,G=>G.includes("when you kill a stunned enemy unit"),G=>{var X;return(X=G.ability)==null?void 0:X.effect_text})}else Ke&&(F=!0)}if(nh(g)){let x=0;ze((T,w)=>{const S=Gn(e,w.owner,T.instanceId);S&&(e.players[w.owner].banishment.push(S),x+=1)}),x>0?(x===1&&Q.length===1?e.log.unshift(`${Q[0].name} was banished.`):e.log.unshift(`${t} banished ${x} unit(s).`),F=!0):Ke&&(F=!0)}/\bwhen any unit takes damage this turn, kill it\b/i.test(g)&&(e.damageKillEffects.push({controller:t,untilTurn:e.turnNumber}),e.log.unshift(`${t} set a damage-kill effect for this turn.`),F=!0),/\bkill it the next time it takes damage this turn\b/i.test(g)&&(ze(x=>{x.killOnDamageUntilTurn=e.turnNumber}),Q.length>0&&(e.log.unshift(`${t} set a kill-on-damage effect for ${Q.length} unit(s).`),F=!0));const po=E.match(/when\s+a\s+friendly\s+unit\s+is\s+played\s+this\s+turn,\s*(.+?)(?:\.|$)/i);if(po){const x=po[1].trim();e.delayedTriggers.push({id:Be("delayed"),controller:t,event:"UNIT_PLAYED",targetFilter:"FRIENDLY",effect:x,untilTurn:e.turnNumber,sourceCardName:(a==null?void 0:a.sourceCardName)||"Unknown"}),e.log.unshift(`${t} set a delayed trigger: when a friendly unit is played this turn, ${x}.`),F=!0}const xi=E.match(/when\s+a\s+friendly\s+unit\s+attacks\s+or\s+defends\s+alone,\s*(.+?)(?:\.|$)/i);if(xi){const x=xi[1].trim();e.delayedTriggers.push({id:Be("delayed"),controller:t,event:"UNIT_ATTACKS",targetFilter:"FRIENDLY",effect:x+" (if alone)",untilTurn:e.turnNumber+999,sourceCardName:(a==null?void 0:a.sourceCardName)||"Unknown"}),e.delayedTriggers.push({id:Be("delayed"),controller:t,event:"UNIT_DEFENDS",targetFilter:"FRIENDLY",effect:x+" (if alone)",untilTurn:e.turnNumber+999,sourceCardName:(a==null?void 0:a.sourceCardName)||"Unknown"}),F=!0}if(/choose\s+a\s+friendly\s+unit\s+and\s+an?\s+enemy\s+unit.*they\s+deal\s+damage\s+equal\s+to\s+their\s+mights?\s+to\s+each\s+other/i.test(E)){const x=ee[0],T=ee[1];if((x==null?void 0:x.kind)==="UNIT"&&(T==null?void 0:T.kind)==="UNIT"){const w=Me(e,x.owner,x.instanceId),S=Me(e,T.owner,T.instanceId);if(w&&S){const U=w.unit,G=S.unit,X=U.controller===t,ue=G.controller!==t;if(!X||!ue)return e.log.unshift("Challenge: targets must be one friendly unit and one enemy unit at resolution."),F=!0,F;const pe=Pe(U,{role:"NONE",game:e}),Ee=Pe(G,{role:"NONE",game:e});U.damage+=Ee,G.damage+=pe,e.log.unshift(`Challenge: ${U.name} (M${pe}) and ${G.name} (M${Ee}) deal damage to each other.`),e.log.unshift(`${U.name} took ${Ee} damage, ${G.name} took ${pe} damage.`),F=!0}else e.log.unshift("Challenge: One or both units no longer exist."),F=!0}else e.log.unshift("Challenge: Missing friendly or enemy target."),F=!0}let er=null;if(/if you assigned 5 or more excess damage to enemy units/i.test(E)&&/deal that much to an enemy unit/i.test(E)){const x=e.lastCombatExcessDamageTurn===e.turnNumber&&e.lastCombatExcessDamage[t]||0;x<5?(e.log.unshift(`${t} did not meet the excess damage condition (needs 5+).`),F=!0):Ce("SIVIR_EXCESS_DAMAGE_FOLLOWUP",!0)?!ce||ce.owner===t?(e.log.unshift(`${t} had no enemy target for excess damage follow-up.`),F=!0):er=x:(e.log.unshift(`${t} chose not to use the excess damage follow-up.`),F=!0)}const Ns=(()=>{const x=E.match(/\bif\s+this\s+kills\s+it,\s*draw\s+(\d+)\b/);if(!x)return null;const T=parseInt(x[1],10);return Number.isFinite(T)?T:null})(),yo=/\bdeal\s+its\s+energy\s+cost\s+as\s+damage\b/i.test(g)&&Zl.length>0?Zl[0].cost:null,Re=/damage\s+equal\s+to\s+its\s+might/i.test(g)&&ce||V,_t=er??yo??xc(g,Re,e);if(_t!=null&&_t>0){const x=[],T=S=>{if(Qc(S)){e.log.unshift(`${S.name} ignored damage (moved twice this turn).`);return}if(e.players[S.owner].preventSpellAbilityDamageThisTurn){e.log.unshift(`${S.name} prevented damage (spell/ability damage prevented this turn).`);return}if(S.preventNextDamageUntilTurn&&S.preventNextDamageUntilTurn>=e.turnNumber){S.preventNextDamageUntilTurn=0,e.log.unshift(`${S.name} prevented damage (Counter Strike).`);return}let U=_t;const G=Me(e,S.owner,S.instanceId);if(G&&G.zone==="BF"){const X=e.battlefields[G.battlefieldIndex??0];X&&Hv(X)&&(U+=1)}S.damage+=U,S.killOnDamageUntilTurn&&S.killOnDamageUntilTurn>=e.turnNumber?(S.damage=999,S.killOnDamageUntilTurn=0):Xc(e)&&(S.damage=999)},w=(S,U)=>{var X;const G=!!((X=Me(e,S,U.instanceId))!=null&&X.unit);x.push({owner:S,instanceId:U.instanceId,name:U.name,existed:G,wasStunned:U.stunned})};if(/\ball\s+units\s+at\s+battlefields\b/i.test(g)){for(const S of e.battlefields)for(const U of["P1","P2"])for(const G of S.units[U])T(G);e.log.unshift(`${t} dealt ${_t} to all units at battlefields.`),F=!0}else if(/\ball\s+enemy\s+units\s+at\s+battlefields\b/i.test(g)||/\beach\s+enemy\s+unit\s+at\s+battlefields\b/i.test(g)||/\ball\s+enemy\s+creatures\s+at\s+battlefields\b/i.test(g)||/\beach\s+enemy\s+creature\s+at\s+battlefields\b/i.test(g)){for(const S of e.battlefields)for(const U of S.units[l])T(U);e.log.unshift(`${t} dealt ${_t} to all enemy units at battlefields.`),F=!0}else if((/\ball\s+enemy\s+units\s+at\s+a\s+battlefield\b/i.test(g)||/\beach\s+enemy\s+unit\s+at\s+a\s+battlefield\b/i.test(g))&&(Ue!=null||u!=null)){const S=Ue??u,U=e.battlefields[S];for(const G of U.units[l])T(G);e.log.unshift(`${t} dealt ${_t} to all enemy units at Battlefield ${S+1}.`),F=!0}else if((/\ball\s+enemy\s+units\s+at\s+a\s+battlefield\b/i.test(g)||/\beach\s+enemy\s+unit\s+at\s+a\s+battlefield\b/i.test(g))&&(Ue!=null||u!=null)){const S=Ue??u,U=e.battlefields[S];for(const G of U.units[l])T(G);e.log.unshift(`${t} dealt ${_t} to all enemy units at Battlefield ${S+1}.`),F=!0}else if(/\ball\s+friendly\s+units\s+at\s+battlefields\b/i.test(g)||/\beach\s+friendly\s+unit\s+at\s+battlefields\b/i.test(g)){for(const S of e.battlefields)for(const U of S.units[t])T(U);e.log.unshift(`${t} dealt ${_t} to all friendly units at battlefields.`),F=!0}else if(/\ball\s+units\s+here\b/i.test(g)&&u!=null){const S=e.battlefields[u];for(const U of["P1","P2"])for(const G of S.units[U])T(G);e.log.unshift(`${t} dealt ${_t} to all units here (Battlefield ${u+1}).`),F=!0}else if((/(?:\ball\s+enemy\s+units\s+here\b|\beach\s+enemy\s+unit\s+here\b)/i.test(g)||/\ball\s+enemy\s+creatures\s+here\b/i.test(g)||/\beach\s+enemy\s+creature\s+here\b/i.test(g))&&u!=null){const S=e.battlefields[u];for(const U of S.units[l])T(U);e.log.unshift(`${t} dealt ${_t} to all enemy units here (Battlefield ${u+1}).`),F=!0}else if(/(?:\ball\s+friendly\s+units\s+here\b|\beach\s+friendly\s+unit\s+here\b)/i.test(g)&&u!=null){const S=e.battlefields[u];for(const U of S.units[t])T(U);e.log.unshift(`${t} dealt ${_t} to all friendly units here (Battlefield ${u+1}).`),F=!0}else if((/\ball\s+enemy\s+units\b/i.test(g)||/\beach\s+enemy\s+unit\b/i.test(g)||/\ball\s+enemy\s+creatures\b/i.test(g))&&!/\bat\s+battlefields\b/i.test(g)&&!/\bhere\b/i.test(g)){for(const S of e.players[l].base.units)T(S);for(const S of e.battlefields)for(const U of S.units[l])T(U);e.log.unshift(`${t} dealt ${_t} to all enemy units.`),F=!0}else if(Q.length>0){for(const S of se)w(S.t.owner,S.loc.unit);ze(S=>{T(S)}),Q.length===1?e.log.unshift(`${t} dealt ${_t} to ${Q[0].name}.`):e.log.unshift(`${t} dealt ${_t} to ${Q.length} unit(s).`),F=!0}else if(ce){const S=ne.kind==="UNIT"?ne.owner:l;w(S,ce),T(ce),e.log.unshift(`${t} dealt ${_t} to ${ce.name}.`),F=!0}else Ke&&/\bunit\b/i.test(g)&&(F=!0);if(F&&Ns&&x.length>0){gt(e);let S=0,U=0;for(const G of x){if(!G.existed)continue;!!((vu=Me(e,G.owner,G.instanceId))!=null&&vu.unit)||(S+=1,G.wasStunned&&(U+=1))}S>0&&(an(e,t,Ns*S),e.log.unshift(`${t} drew ${Ns*S} (killed by effect).`)),S>0&&a.sourceCardType==="Spell"&&Hn(e,t,G=>G.includes("when you kill a unit with a spell"),G=>{var X;return(X=G.ability)==null?void 0:X.effect_text},[{kind:"NONE"}],void 0,!0),U>0&&Hn(e,t,G=>G.includes("when you kill a stunned enemy unit"),G=>{var X;return(X=G.ability)==null?void 0:X.effect_text})}}if(/reveal\s+cards\s+from\s+the\s+top\s+of\s+(?:your|my)\s+main\s+deck\s+until/i.test(E)){const x=e.players[t],T=x.mainDeck,w=[];let S=-1;const U=/\buntil\s+you\s+reveal\s+a\s+spell\b/i.test(E),G=/\buntil\s+you\s+reveal\s+a\s+unit\b/i.test(E),X=/\buntil\s+you\s+reveal\s+a\s+gear\b/i.test(E);if(U||G||X){for(let ue=0;ue<T.length;ue++){const pe=T[ue];if(w.push(pe),U&&pe.type==="Spell"){S=ue;break}if(G&&pe.type==="Unit"){S=ue;break}if(X&&pe.type==="Gear"){S=ue;break}}if(S>=0){const ue=w[S],pe=w.slice(0,S);if(x.mainDeck.splice(0,w.length),/\bput\s+the\s+rest\s+into\s+(?:your\s+)?trash\b/i.test(E)?(x.trash.push(...pe),pe.length>0&&e.log.unshift(`${t} trashed ${pe.length} revealed card(s).`)):/\bshuffle\s+the\s+rest\s+into\s+(?:your\s+)?main\s+deck\b/i.test(E)&&(x.mainDeck.push(...pe),x.mainDeck=Hi(x.mainDeck,e.turnNumber)),/\bplay\s+it\s+for\s+free\b/i.test(E)||/\bplay\s+it\s+without\s+paying\s+its\s+cost\b/i.test(E)){let Ee={kind:"BASE"};ue.type==="Unit"&&Xl(ue),ue.type==="Gear"&&(ue.isReady=!0),x.mainDeckCardsPlayedThisTurn+=1,e.chain.push({id:Be("chain"),controller:t,kind:"PLAY_CARD",label:`Play ${ue.name} (Free)`,sourceCard:ue,sourceZone:"HAND",playDestination:ue.type==="Unit"||ue.type==="Gear"?Ee:null,effectText:((Nu=ue.ability)==null?void 0:Nu.effect_text)||"",contextBattlefieldIndex:null,targets:[{kind:"NONE"}],additionalCostPaid:!0}),e.log.unshift(`${t} plays ${ue.name} for free.`)}else/\badd\s+it\s+to\s+(?:your\s+)?hand\b/i.test(E)&&(x.hand.push(ue),e.log.unshift(`${t} added ${ue.name} to hand.`));e.pendingRevealWindow={id:Be("reveal"),player:t,cards:w,sourceLabel:(a==null?void 0:a.sourceCardName)||"Effect",message:`Revealed ${w.length} cards. Matched: ${ue.name}.`},F=!0}else x.mainDeck.splice(0,w.length),/\bput\s+the\s+rest\s+into\s+(?:your\s+)?trash\b/i.test(E)&&(x.trash.push(...w),e.log.unshift(`${t} revealed entire deck (no match) and trashed all cards.`)),e.pendingRevealWindow={id:Be("reveal"),player:t,cards:w,sourceLabel:(a==null?void 0:a.sourceCardName)||"Effect",message:"Revealed entire deck. No match found."},F=!0}}if(/(?:enemy|opponent)\s+reveals\s+(?:their|his|her)\s+hand/i.test(E)){const x=xt(t),T=e.players[x].hand;e.pendingRevealWindow={id:Be("reveal"),player:t,cards:T,sourceLabel:(a==null?void 0:a.sourceCardName)||"Reveal Hand",message:`${x}'s Hand Revealed.`},e.log.unshift(`${x}'s hand was revealed.`),F=!0}if(!F){if(/\bscore\s+1\s+point\b/i.test(E)){const x=/excess damage/i.test(E),T=e.lastCombatExcessDamageTurn===e.turnNumber&&e.lastCombatExcessDamage[t]||0;!x||T>=5?(e.players[t].points+=1,e.log.unshift(`${t} scored 1 point.`),e.players[t].points>=e.victoryScore&&(e.step="GAME_OVER",e.log.unshift(`${t} wins! Reached ${e.players[t].points} points.`))):e.log.unshift(`${t} did not score (insufficient excess damage).`),F=!0}if(/\bgain[s]?\s+(\d+)\s+point/i.test(E)){const x=E.match(/\bgain[s]?\s+(\d+)\s+point/i),T=x?parseInt(x[1],10):1;Number.isFinite(T)&&T>0&&(e.players[t].points+=T,e.log.unshift(`${t} gained ${T} point${T===1?"":"s"}.`),e.players[t].points>=e.victoryScore&&(e.step="GAME_OVER",e.log.unshift(`${t} wins! Reached ${e.players[t].points} points.`))),F=!0}if(/\byou win the game\b/i.test(E)&&(!/if you have 7\+ units here/i.test(E)||u!=null&&e.battlefields[u].units[t].length>=7))return e.players[t].points=e.victoryScore,e.step="GAME_OVER",e.log.unshift(`${t} wins the game.`),!0;if(!F&&/\bchannels?\s+(\d+)\s+runes?\b/i.test(E)){const x=E.match(/\bchannels?\s+(\d+)\s+runes?\b/i),T=x?parseInt(x[1],10):1;lh(e,t,T),F=!0}if(!F&&/\bchannels?\s+(\d+)\s+runes?\s+exhausted/i.test(E)){const x=E.match(/\bchannels?\s+(\d+)\s+runes?\s+exhausted/i),T=x?parseInt(x[1],10):1;Ds(e,t,T),F=!0}if(!F&&/\bready\s+(?:your|my)\s+legend\b/i.test(E)&&(c.legendReady=!0,e.log.unshift(`${t} readied their legend.`),F=!0),!F&&/\bready\s+(\d+)\s+runes?\s+at\s+the\s+end\s+of\s+this\s+turn\b/i.test(E)){const x=E.match(/\bready\s+(\d+)\s+runes?\s+at\s+the\s+end\s+of\s+this\s+turn\b/i),T=x?parseInt(x[1],10):1;e.delayedTriggers.push({id:Be("delayed"),controller:t,event:"TURN_END",effect:`ready ${T} runes`,untilTurn:e.turnNumber,sourceCardName:(a==null?void 0:a.sourceCardName)||"Effect"}),e.log.unshift(`${t} will ready ${T} rune(s) at the end of this turn.`),F=!0}if(!F&&/\bdiscard\s+(\d+),\s+then\s+draw\s+(\d+)\b/i.test(E)){const x=E.match(/\bdiscard\s+(\d+),\s+then\s+draw\s+(\d+)\b/i),T=x?parseInt(x[1],10):1,w=x?parseInt(x[2],10):1;for(let S=0;S<T;S++)if(c.hand.length>0){const U=c.hand.shift();c.trash.push(U),e.log.unshift(`${t} discarded ${U.name}.`)}an(e,t,w),F=!0}if(!F&&/\breturn\s+(?:your|my)\s+chosen\s+champion\s+from\s+(?:your|my)\s+trash/i.test(E)){const x=c.chosenChampionId,T=c.trash.findIndex(w=>w.id===x);if(T>=0&&!c.championZone){const w=c.trash.splice(T,1)[0];c.championZone=w,e.log.unshift(`${t} returned ${w.name} to Champion Zone.`)}else e.log.unshift(`${t} could not return champion (not in trash or zone occupied).`);F=!0}if(!F&&/\bplay\s+a\s+(?:ready\s+)?(\d+)\s+(?:\[?s\]?|might)\s+(\w+)\s+unit\s+token/i.test(E)){const x=E.match(/\bplay\s+a\s+(?:ready\s+)?(\d+)\s+(?:\[?s\]?|might)\s+(\w+)\s+unit\s+token/i),T=x?parseInt(x[1],10):1,w=x?x[2]:"Token",S=/with\s+\[?(temporary)\]?/i.test(E),U=/\bready\b/i.test(E),G=bt({id:`TOKEN-${w}`,name:`${w} Token`,domain:"Colorless",cost:0,type:"Unit",stats:{might:T,power:null},rules_text:{raw:S?"[Temporary]":"",keywords:S?["Temporary"]:[]},image_url:""},t,e.turnNumber);U&&(G.isReady=!0),/in\s+your\s+base/i.test(E)?(c.base.units.push(G),e.log.unshift(`${t} played a ${T} [S] ${w} token in base.`)):u!=null?(e.battlefields[u].units[t].push(G),e.log.unshift(`${t} played a ${T} [S] ${w} token here.`)):(c.base.units.push(G),e.log.unshift(`${t} played a ${T} [S] ${w} token.`)),F=!0}if(!F){const x=a!=null&&a.sourceCardName?` from ${a.sourceCardName}`:"";e.log.unshift(`UNSUPPORTED effect${x}: ${g}`)}}if(/next\s+spell.*costs?\s*\[(\d+)\]\s*less/i.test(E)){const x=E.match(/next\s+spell.*costs?\s*\[(\d+)\]\s*less/i),T=x?parseInt(x[1],10):5;c.nextSpellDiscount=T,e.log.unshift(`${t}'s next spell costs ${T} less.`),F=!0}if(/next\s+spell\s+you\s+play\s+this\s+turn.*repeat/i.test(E)&&(c.nextSpellRepeatByCost=!0,e.log.unshift(`${t}'s next spell gains Repeat equal to its cost.`),F=!0),(/units\s+(you\s+play\s+)?this\s+turn\s+enter\s+ready/i.test(E)||/friendly\s+units\s+enter\s+ready\s+this\s+turn/i.test(E))&&(c.unitsEnterReadyThisTurn=!0,e.log.unshift(`${t}'s units enter ready this turn.`),F=!0),/prevent\s+all\s+spell\s+and\s+ability\s+damage\s+this\s+turn/i.test(E)&&(c.preventSpellAbilityDamageThisTurn=!0,e.log.unshift(`${t} prevents all spell and ability damage this turn.`),F=!0),/opponents?\s+can'?t\s+play\s+cards?\s+this\s+turn/i.test(E)){const x=t==="P1"?"P2":"P1";e.players[x].opponentCantPlayCardsThisTurn=!0,e.log.unshift(`${x} can't play cards this turn.`),F=!0}const Ua=E.match(/recycle\s+up\s+to\s+(\d+)\s+cards?\s+from\s+trashes?/i);if(Ua){const x=parseInt(Ua[1],10)||4;e.players.P1.trash,e.players.P2.trash;let T=0;for(;T<x&&c.trash.length>0;){const U=c.trash.shift();c.mainDeck.push(U),e.log.unshift(`${U.name} recycled from ${t}'s trash to bottom of deck.`),T++}const w=xt(t),S=e.players[w];for(;T<x&&S.trash.length>0;){const U=S.trash.shift();S.mainDeck.push(U),e.log.unshift(`${U.name} recycled from ${w}'s trash to bottom of deck.`),T++}T>0?e.log.unshift(`${t} recycled ${T} card(s) from trashes.`):e.log.unshift("No cards in trashes to recycle."),F=!0}if(!a.chainItemId&&e.optionalChoiceResults){const x=`${J}:`;for(const T of Object.keys(e.optionalChoiceResults))T.startsWith(x)&&delete e.optionalChoiceResults[T]}return F},Um=(e,t,n,i)=>{const a=e.battlefields[t],l=a.units[n].filter(q=>!q.stunned),c=a.units[i].filter(q=>!q.stunned),u=l.length===1,y=c.length===1,v=l.reduce((q,J)=>q+Pe(J,{role:"ATTACKER",alone:u,game:e,battlefieldIndex:t}),0),g=c.reduce((q,J)=>q+Pe(J,{role:"DEFENDER",alone:y,game:e,battlefieldIndex:t}),0),E=(q,J,K,O)=>{if(q<=0)return;const k=J.filter(te=>lt(te,"Tank")),j=J.filter(te=>!lt(te,"Tank")),P=k.length>0?[...k,...j]:[...J];let ee=q,ne=0;for(const te of P){if(ee<=0)break;if(Qc(te)){e.log.unshift(`${te.name} ignored combat damage (moved twice this turn).`);continue}if(te.preventNextDamageUntilTurn&&te.preventNextDamageUntilTurn>=e.turnNumber){te.preventNextDamageUntilTurn=0,e.log.unshift(`${te.name} prevented combat damage (Counter Strike).`);continue}const se=Pe(te,{role:K,alone:O,game:e,battlefieldIndex:t}),Q=Math.max(0,se-te.damage);if(Q<=0)continue;const ce=Math.min(Q,ee);te.damage+=ce,ee-=ce}if(ee>0&&P.length>0&&(P[P.length-1].damage+=ee,ne+=ee),Xc(e))for(const te of P)te.damage>0&&(te.damage=999);else for(const te of P)te.killOnDamageUntilTurn&&te.killOnDamageUntilTurn>=e.turnNumber&&te.damage>0&&(te.damage=999,te.killOnDamageUntilTurn=0);return ne},I=E(v,a.units[i],"DEFENDER",y)||0,R=E(g,a.units[n],"ATTACKER",u)||0;e.lastCombatExcessDamage={[n]:I,[i]:R},e.lastCombatExcessDamageTurn=e.turnNumber,e.log.unshift(`Combat damage assigned at Battlefield ${t+1}: ${n} dealt ${v}, ${i} dealt ${g}.`)},Jo=(e,t)=>{const n=e.battlefields[t];for(const i of["P1","P2"])for(const a of n.units[i])a.damage=0;e.log.unshift(`Units healed at end of combat (Battlefield ${t+1}).`)},Vd=(e,t,n)=>{const i=e.battlefields[t],a=e.players[n],l=i.units[n].splice(0,i.units[n].length);for(const c of l)c.isReady=!1,c.damage=0,a.base.units.push(c);l.length>0&&e.log.unshift(`${n} recalled ${l.length} unit(s) to base exhausted (Battlefield ${t+1}).`)},ec=e=>{if(!e.combat)return;const{battlefieldIndex:t,attacker:n,defender:i}=e.combat,a=e.battlefields[t];gt(e);const l=a.units[n].length>0,c=a.units[i].length>0;if(l&&c)vt(e,n).some(y=>{var E,I,R;const v=(((E=y.ability)==null?void 0:E.trigger)||"").toLowerCase(),g=`${((I=y.ability)==null?void 0:I.effect_text)||""} ${((R=y.ability)==null?void 0:R.raw_text)||""}`.toLowerCase();return v.includes("if a combat where you are the attacker ends in a tie")&&g.includes("recall all units instead")})?(Vd(e,t,n),Vd(e,t,i),e.log.unshift("Combat tie: recalled all units due to tie-recall effect.")):Vd(e,t,n),a.contestedBy=null,e.log.unshift("Combat ended with both sides surviving. Attacker recalled; defender retains/keeps control."),Jo(e,t),gt(e);else if(l&&!c){const u=a.controller;a.controller=n,a.contestedBy=null,e.log.unshift(`${n} conquered Battlefield ${t+1}.`),Jo(e,t),gt(e),u!==n&&Zr(e,n,t,"Conquer")}else if(!l&&c){const u=a.controller;a.controller=i,a.contestedBy=null,e.log.unshift(`${i} defended Battlefield ${t+1}.`),Jo(e,t),gt(e),u!==i&&Zr(e,i,t,"Conquer")}else a.controller=null,a.contestedBy=null,e.log.unshift(`Battlefield ${t+1} ended empty after combat.`),Jo(e,t),gt(e);e.windowKind="NONE",e.windowBattlefieldIndex=null,e.combat=null,e.priorityPlayer=e.turnPlayer,e.state="OPEN",e.passesInRow=0,bn(e)},bt=(e,t,n)=>({...e,instanceId:Be("card"),owner:t,controller:t,isReady:!1,damage:0,buffs:0,tempMightBonus:0,stunned:!1,stunnedUntilTurn:0,extraKeywords:[],tempKeywords:[],conditionalKeywords:[],createdTurn:n,moveCountThisTurn:0,killOnDamageUntilTurn:0});function $m(e,t,n){return{id:`token_${(n||e||"token").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")||"token"}_${t}`,name:e,rarity:"Token",domain:"Colorless",cost:0,type:"Unit",tags:["Token",...n?[n]:[]],image_url:"",image:"",stats:{might:t,power:null},ability:{raw_text:`${e}.`,keywords:[]}}}function oN(e,t){return{id:`token_gear_${e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}`,name:e,rarity:"Token",domain:"Colorless",cost:0,type:"Gear",tags:["Token"],image_url:"",image:"",stats:{might:null,power:null},ability:{raw_text:t,keywords:jr(t)}}}const nx=(e,t,n)=>{const i=(Yt(e.domain)[0]||e.domain||"Colorless").trim(),a=ut(i);return{instanceId:Be("rune"),owner:t,controller:t,domain:a,isReady:!0,createdTurn:n,cardId:e.id,name:e.name,image_url:e.image_url,image:e.image}},zm=(e,t,n)=>{const i=e.filter(se=>se.type==="Legend"),a=e.filter(se=>se.type==="Battlefield"),l=e.filter(se=>se.type==="Rune");if(i.length===0)throw new Error("No Legend cards found.");if(a.length===0)throw new Error("No Battlefield cards found.");if(l.length===0)throw new Error("No Rune cards found.");const c=i[Math.floor(Math.random()*i.length)],u=Yt(c.domain).map(ut).filter(se=>se!=="Colorless"),y=(c.tags||[])[0],v=e.filter(se=>se.type==="Unit"&&y&&(se.tags||[]).includes(y)),g=v.length>0?v[Math.floor(Math.random()*v.length)]:e.find(se=>se.type==="Unit"),E=bt(g,t,n),I=e.filter(se=>Cl(se.type)&&(se.domain==="Colorless"||Yt(se.domain).every(Q=>{const ce=ut(Q);return ce==="Colorless"||u.includes(ce)}))),R=I.length>0?I:e.filter(se=>Cl(se.type)),q=3,J={},K=[];for(;K.length<40&&R.length>0;){const se=R[Math.floor(Math.random()*R.length)],Q=J[se.id]||0;Q>=q||(J[se.id]=Q+1,K.push(bt(se,t,n)))}const O=Hi(K,n+(t==="P1"?1:2)),k=u.length>0?u:fo,j={};for(const se of l){const Q=(Yt(se.domain)[0]||se.domain||"Colorless").trim(),ce=ut(Q);j[ce]||(j[ce]=se)}const P=Math.floor(12/k.length),ee=12%k.length,ne=[];for(let se=0;se<k.length;se++){const Q=k[se],ce=P+(se<ee?1:0),We=j[Q]||j.Colorless||l[0];for(let Ue=0;Ue<ce;Ue++)ne.push(nx(We,t,n))}const te=Hi(ne,n+99);return{legend:c,champion:E,domains:k,mainDeck:O,runeDeck:te}},cN=e=>{const t=e.filter(i=>i.type==="Battlefield");if(t.length<2)throw new Error("Need at least 2 Battlefields.");const n=Hi(t,12345);return{p1:n[0],p2:n[1]}},tn=()=>({legendId:null,championId:null,battlefields:[],runes:{},main:{},sideboard:{}}),Sn=e=>Object.values(e).reduce((t,n)=>t+(Number.isFinite(n)?n:0),0),nn=(e,t)=>e.find(n=>n.id===t)||null,uN=(e,t)=>{const n=t.legendId?nn(e,t.legendId):null,i=t.championId?nn(e,t.championId):null,a=n!=null&&n.name?n.name.replace(/\s*\(.*\)\s*$/g,"").trim():"Legend",l=i!=null&&i.name?i.name.replace(/\s*\(.*\)\s*$/g,"").trim():"Champion";return`${a}  ${l}`},oh=e=>{const t=Yt(e.domain).map(ut).filter(n=>n!=="Colorless");return t.length>0?t:fo},va=(e,t)=>{const n=Yt(e.domain).map(ut);return n.length===0?!0:n.every(i=>i==="Colorless"||t.includes(i))},Gm=(e,t)=>e.type!=="Unit"||!t?!1:(e.tags||[]).includes(t)&&(e.name||"").includes(","),tl=(e,t,n,i)=>{const a=n.legendId?nn(e,n.legendId):null;if(!a||a.type!=="Legend")throw new Error(`${t}: Select a Legend.`);const l=oh(a),c=(a.tags||[])[0]||null,u=n.championId?nn(e,n.championId):null;if(!u||u.type!=="Unit")throw new Error(`${t}: Select a chosen Champion (Unit).`);if(c&&!(u.tags||[]).includes(c))throw new Error(`${t}: Chosen Champion must match Legend tag (${c}).`);if(!va(u,l))throw new Error(`${t}: Chosen Champion is outside the Legend's domain identity.`);const y=bt(u,t,i),v={...n.main||{}},g=Sn(v);if((v[u.id]||0)<1)throw new Error(`${t}: Main deck must include at least 1 copy of the chosen Champion.`);if(g<40)throw new Error(`${t}: Main deck must have at least 40 cards (currently ${g}).`);for(const[j,P]of Object.entries(v)){const ee=Math.floor(P||0);if(ee<0)throw new Error(`${t}: Negative card count for ${j}.`);if(ee>3)throw new Error(`${t}: Max 3 copies per card (exceeded on ${j}).`)}const E=[];for(const[j,P]of Object.entries(v)){const ee=Math.floor(P||0);if(ee<=0)continue;const ne=nn(e,j);if(!ne)throw new Error(`${t}: Unknown card id in main deck: ${j}`);if(!Cl(ne.type))throw new Error(`${t}: ${ne.name} is not a main-deck card.`);if(!va(ne,l))throw new Error(`${t}: ${ne.name} is outside the Legend's domain identity.`);const te=ne.id===u.id?Math.max(0,ee-1):ee;for(let se=0;se<te;se++)E.push(bt(ne,t,i))}const I=Hi(E,i+(t==="P1"?11:22)),R={...n.runes||{}},q=Sn(R);if(q!==12)throw new Error(`${t}: Rune deck must have exactly 12 cards (currently ${q}).`);const J=[];for(const[j,P]of Object.entries(R)){const ee=Math.floor(P||0);if(ee<=0)continue;const ne=nn(e,j);if(!ne||ne.type!=="Rune")throw new Error(`${t}: Invalid rune card id: ${j}`);const te=(Yt(ne.domain)[0]||ne.domain||"Colorless").trim(),se=ut(te);if(se!=="Colorless"&&!l.includes(se))throw new Error(`${t}: Rune ${ne.name} (${se}) is outside domain identity.`);for(let Q=0;Q<ee;Q++)J.push(nx(ne,t,i))}const K=Hi(J,i+(t==="P1"?99:199)),O=n.battlefields||[];if(O.length!==3)throw new Error(`${t}: Choose exactly 3 battlefields (currently ${O.length}).`);const k=O.map(j=>nn(e,j)).filter(Boolean);if(k.length!==3)throw new Error(`${t}: One or more chosen battlefields were not found in the database.`);for(const j of k){if(j.type!=="Battlefield")throw new Error(`${t}: ${j.name} is not a Battlefield.`);if(!va(j,l))throw new Error(`${t}: Battlefield ${j.name} is outside domain identity.`)}return{legend:a,champion:y,domains:l,mainDeck:I,runeDeck:K,battlefields:k}},Jc=(e,t,n)=>Kf(t)?(e.log.unshift(`${t.name} token ceases to exist (${n}).`),!0):!1,dN=()=>{var qp,Wp,Kp;const[e,t]=he.useState([]),[n,i]=he.useState(null),a=he.useRef(null);he.useEffect(()=>{const s=o=>{var f;o.code==="Space"&&(o.preventDefault(),(f=a.current)==null||f.call(a))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]);const l="riftbound.deckbuilder.v1",c="riftbound.decklibrary.v1",[u,y]=he.useState("SETUP"),[v,g]=he.useState("P1"),[E,I]=he.useState("BO1"),[R,q]=he.useState(null),[J,K]=he.useState(null),[O,k]=he.useState({P1:null,P2:null}),[j,P]=he.useState(null),[ee,ne]=he.useState(null),[te,se]=he.useState(null),[Q,ce]=he.useState(()=>{if(typeof window>"u")return{P1:tn(),P2:tn()};try{const s=window.localStorage.getItem(l);if(!s)return{P1:tn(),P2:tn()};const o=JSON.parse(s),f=o!=null&&o.P1?o.P1:tn(),d=o!=null&&o.P2?o.P2:tn();return{P1:f,P2:d}}catch{return{P1:tn(),P2:tn()}}});he.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(l,JSON.stringify(Q))}catch{}},[Q]);const We=()=>`deck_${Math.random().toString(36).slice(2)}_${Date.now().toString(36)}`,[Ue,Ke]=he.useState(()=>{if(typeof window>"u")return[];try{const s=window.localStorage.getItem(c);if(!s)return[];const o=JSON.parse(s);return Array.isArray(o)?o.filter(f=>f&&typeof f=="object").map(f=>({id:String(f.id||We()),name:String(f.name||"Untitled Deck"),tags:Array.isArray(f.tags)?f.tags.map(d=>String(d)).filter(Boolean):[],spec:f.spec||tn(),createdAt:Number.isFinite(f.createdAt)?Number(f.createdAt):Date.now(),updatedAt:Number.isFinite(f.updatedAt)?Number(f.updatedAt):Date.now()})):[]}catch{return[]}}),[ze,_e]=he.useState(null),[V,we]=he.useState(""),[ve,Ne]=he.useState(""),[Ce,ei]=he.useState(null),[F,mi]=he.useState(""),[jn,gi]=he.useState("");he.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(c,JSON.stringify(Ue))}catch{}},[Ue]),he.useEffect(()=>{if(u!=="DECK_BUILDER")return;const s=ze&&Ue.find(d=>d.id===ze)||null;if(s){mi(s.name||""),gi(Array.isArray(s.tags)?s.tags.join(", "):"");return}const o=Q[v]||tn(),f=uN(e,o);mi(d=>d&&d.trim().length>0?d:f)},[u,ze,Ue,Q,v,e]);const[Vl,pp]=he.useState(""),[qi,Ql]=he.useState("All"),xu=(s,o)=>{Ke(f=>{const d=f.findIndex(m=>m.id===s),h=f.findIndex(m=>m.id===o);if(d<0||h<0||d===h)return f;const p=f.slice(),[b]=p.splice(d,1);return p.splice(h,0,b),p})},ti=he.useRef([]),Xl=40,[Mn,Zl]=he.useState(!0),[sa,Wi]=he.useState(null),Ki="riftbound.ai.v1",Vi={P1:{enabled:!1,difficulty:"MEDIUM",thinkMs:650},P2:{enabled:!1,difficulty:"MEDIUM",thinkMs:650}},[mt,vs]=he.useState(()=>{if(typeof window>"u")return Vi;try{const s=window.localStorage.getItem(Ki);if(!s)return Vi;const o=JSON.parse(s),f={...Vi};return["P1","P2"].forEach(d=>{if(o!=null&&o[d]){const h=o[d];f[d]={enabled:!!h.enabled,difficulty:h.difficulty||Vi[d].difficulty,thinkMs:Number.isFinite(h.thinkMs)?Number(h.thinkMs):Vi[d].thinkMs}}}),f}catch{return Vi}}),[bi,Eu]=he.useState(!1);he.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ki,JSON.stringify(mt))}catch{}},[mt]);const Ii=s=>{var o;return!!((o=mt[s])!=null&&o.enabled)&&!bi},[Si,Di]=he.useState(null),[Ye,Jl]=he.useState("P1"),[Ri,po]=he.useState(!1),[xi,er]=he.useState(!1),[Ns,yo]=he.useState(!1),[Re,_t]=he.useState(null),[Ua,ki]=he.useState(null),[mo,Ei]=he.useState(!1),[go,$a]=he.useState("Fury"),[za,_i]=he.useState(0),[aa,Qi]=he.useState(!0),[Oi,ni]=he.useState([]),[St,Dt]=he.useState([{kind:"NONE"}]),[mn,Pn]=he.useState(null),[Tu,vu]=he.useState(null),[Nu,x]=he.useState(null),[T,w]=he.useState(null),[S,U]=he.useState(null),[G,X]=he.useState(null),[ue,pe]=he.useState(null),[Ee,Ie]=he.useState([]),[Tt,Ti]=he.useState(null),[xn,Ln]=he.useState(null),[Nn,wn]=he.useState(0),[Zt,la]=he.useState(()=>({cardId:null,battlefieldIndex:null})),[hN,pN]=he.useState(!1),[vi,ii]=he.useState({from:null,unitIds:[],to:null}),[bo,wu]=he.useState("Arena"),[ra,Gt]=he.useState(null),[Au,oa]=he.useState(null),[ix,Cu]=he.useState(!1),[Iu,sx]=he.useState(""),[ws,yp]=he.useState("UNSUPPORTED"),[tr,ax]=he.useState("PROBLEMS"),[lx,rx]=he.useState(null),[Bt,As]=he.useState(null),[xo,ca]=he.useState(null),ox=async()=>{try{const s=await fetch("riftbound_card_data.json");if(!s.ok)return[];const o=Am(await s.text()),f=JSON.parse(o);return Array.isArray(f)?f:[]}catch{return[]}},mp=async s=>{const o=JSON.parse(Am(s));if(!Array.isArray(o))throw new Error("Card JSON must be an array.");if(o.length>0&&typeof o[0]=="object"&&"type_line"in o[0]){let h=o;const p=h.some(N=>typeof N.id=="string"&&N.id.includes("/")),b=h.some(N=>typeof N.id=="string"&&!N.id.includes("/"));if(p&&b){const N=h.length;h=h.filter(H=>{const W=typeof H.id=="string"?H.id:"",$=/\btoken\b/i.test(String(H.supertypes||""));return W.includes("/")||$});const _=N-h.length;_>0&&console.log(`[RBEXP] Filtered ${_} legacy cards (no slash ids) from expert data.`)}const m=await ox(),C=_v(h,m);return t(C),C}const d=o;return t(d),d},cx=async s=>{const o=await s.text();return mp(o)},Su=async s=>{const o=await fetch(s);if(!o.ok)throw new Error(`Failed to load card data (${o.status}).`);const f=await o.text();return mp(f)},Du=s=>{const o=s??e;if(o.length===0)return;ti.current=[];const f=1,d=zm(o,"P1",f),h=zm(o,"P2",f),p=cN(o),b={P1:{id:"P1",legend:d.legend,legendReady:!0,championZone:d.champion,base:{units:[],gear:[]},mainDeck:d.mainDeck,hand:[],trash:[],banishment:[],runeDeck:d.runeDeck,runesInPlay:[],runePool:Li(),points:0,domains:d.domains,mainDeckCardsPlayedThisTurn:0,scoredBattlefieldsThisTurn:[],discardedThisTurn:0,enemyUnitsDiedThisTurn:0,sealExhaustedThisTurn:!1,nextSpellDiscount:0,nextSpellRepeatByCost:!1,unitsEnterReadyThisTurn:!1,preventSpellAbilityDamageThisTurn:!1,opponentCantPlayCardsThisTurn:!1,nonTokenGearPlayedThisTurn:!1,pendingReadyRunesEndOfTurn:0,turnsTaken:0,mulliganSelectedIds:[],mulliganDone:!1},P2:{id:"P2",legend:h.legend,legendReady:!0,championZone:h.champion,base:{units:[],gear:[]},mainDeck:h.mainDeck,hand:[],trash:[],banishment:[],runeDeck:h.runeDeck,runesInPlay:[],runePool:Li(),points:0,domains:h.domains,mainDeckCardsPlayedThisTurn:0,scoredBattlefieldsThisTurn:[],discardedThisTurn:0,enemyUnitsDiedThisTurn:0,sealExhaustedThisTurn:!1,nextSpellDiscount:0,nextSpellRepeatByCost:!1,unitsEnterReadyThisTurn:!1,preventSpellAbilityDamageThisTurn:!1,opponentCantPlayCardsThisTurn:!1,nonTokenGearPlayedThisTurn:!1,pendingReadyRunesEndOfTurn:0,turnsTaken:0,mulliganSelectedIds:[],mulliganDone:!1}},m=[{index:0,card:p.p1,owner:"P1",controller:null,contestedBy:null,facedown:null,facedownExtra:null,dreamingTreeChosenThisTurn:{P1:!1,P2:!1},units:{P1:[],P2:[]},gear:{P1:[],P2:[]}},{index:1,card:p.p2,owner:"P2",controller:null,contestedBy:null,facedown:null,facedownExtra:null,dreamingTreeChosenThisTurn:{P1:!1,P2:!1},units:{P1:[],P2:[]},gear:{P1:[],P2:[]}}],C=Math.random()<.5?"P1":"P2",N={step:"MULLIGAN",turnNumber:1,turnPlayer:C,startingPlayer:C,windowKind:"NONE",windowBattlefieldIndex:null,focusPlayer:null,combat:null,chain:[],priorityPlayer:C,passesInRow:0,state:"OPEN",victoryScore:bc,log:[`Auto Duel setup complete. First player: ${C}.`,`P1 Legend: ${d.legend.name} | Champion: ${d.champion.name}`,`P2 Legend: ${h.legend.name} | Champion: ${h.champion.name}`,`Battlefield 1: ${p.p1.name} | Battlefield 2: ${p.p2.name}`],actionHistory:[],damageKillEffects:[],recallOnDeathEffects:[],lastCombatExcessDamage:{P1:0,P2:0},lastCombatExcessDamageTurn:0,pendingCandlelitChoice:null,pendingOptionalChoice:null,optionalChoiceResults:{},pendingCullChoice:null,cullChoiceResults:{},players:b,battlefields:m,delayedTriggers:[],pendingPlayHint:null};an(N,"P1",4),an(N,"P2",4),gt(N),i(N),Di(null),_t(null),ki(null),Dt([{kind:"NONE"}]),Pn(null),Ln(null),Ei(!1),la({cardId:null,battlefieldIndex:null}),ii({from:null,unitIds:[],to:null}),As(null),ca(null),Gt(null)},Eo=(s,o,f)=>{const d=s.filter(p=>!o.includes(p.id)),h=d.length>0?d:s;if(h.length===0)throw new Error("Deck has no battlefields.");if(f){const p=h.find(b=>b.id===f);if(p)return p}return h[Math.floor(Math.random()*h.length)]},Ru=s=>{const o=s.players.P1.points>=s.victoryScore,f=s.players.P2.points>=s.victoryScore;return o&&!f?"P1":f&&!o?"P2":null},Ga=s=>{var f;return(((f=Q[s])==null?void 0:f.battlefields)||[]).map(d=>nn(e,d)).filter(d=>!!d)},ku=s=>{if(e.length===0)return;ti.current=[],wo(),K(null);const o=1;try{const f=tl(e,"P1",Q.P1,o),d=tl(e,"P2",Q.P2,o),h=s??E;let p=h==="BO3"?{format:"BO3",gamesCompleted:0,wins:{P1:0,P2:0},usedBattlefieldIds:{P1:[],P2:[]},lastGameWinner:null}:null;const b=(p==null?void 0:p.usedBattlefieldIds)??{P1:[],P2:[]},m=h==="BO1"?f.battlefields[Math.floor(Math.random()*f.battlefields.length)]:Eo(f.battlefields,b.P1,O.P1),C=h==="BO1"?d.battlefields[Math.floor(Math.random()*d.battlefields.length)]:Eo(d.battlefields,b.P2,O.P2);h==="BO3"?(p={...p,usedBattlefieldIds:{P1:[...p.usedBattlefieldIds.P1,m.id],P2:[...p.usedBattlefieldIds.P2,C.id]}},q(p),k({P1:null,P2:null})):(q(null),k({P1:null,P2:null}));const N={P1:{id:"P1",legend:f.legend,legendReady:!0,championZone:f.champion,base:{units:[],gear:[]},mainDeck:f.mainDeck,hand:[],trash:[],banishment:[],runeDeck:f.runeDeck,runesInPlay:[],runePool:Li(),points:0,domains:f.domains,mainDeckCardsPlayedThisTurn:0,scoredBattlefieldsThisTurn:[],discardedThisTurn:0,enemyUnitsDiedThisTurn:0,sealExhaustedThisTurn:!1,nextSpellDiscount:0,nextSpellRepeatByCost:!1,unitsEnterReadyThisTurn:!1,preventSpellAbilityDamageThisTurn:!1,opponentCantPlayCardsThisTurn:!1,nonTokenGearPlayedThisTurn:!1,pendingReadyRunesEndOfTurn:0,turnsTaken:0,mulliganSelectedIds:[],mulliganDone:!1},P2:{id:"P2",legend:d.legend,legendReady:!0,championZone:d.champion,base:{units:[],gear:[]},mainDeck:d.mainDeck,hand:[],trash:[],banishment:[],runeDeck:d.runeDeck,runesInPlay:[],runePool:Li(),points:0,domains:d.domains,mainDeckCardsPlayedThisTurn:0,scoredBattlefieldsThisTurn:[],discardedThisTurn:0,enemyUnitsDiedThisTurn:0,sealExhaustedThisTurn:!1,nextSpellDiscount:0,nextSpellRepeatByCost:!1,unitsEnterReadyThisTurn:!1,preventSpellAbilityDamageThisTurn:!1,opponentCantPlayCardsThisTurn:!1,nonTokenGearPlayedThisTurn:!1,pendingReadyRunesEndOfTurn:0,turnsTaken:0,mulliganSelectedIds:[],mulliganDone:!1}},_=[{index:0,card:m,owner:"P1",controller:null,contestedBy:null,units:{P1:[],P2:[]},gear:{P1:[],P2:[]},facedown:null,facedownExtra:null,dreamingTreeChosenThisTurn:{P1:!1,P2:!1}},{index:1,card:C,owner:"P2",controller:null,contestedBy:null,units:{P1:[],P2:[]},gear:{P1:[],P2:[]},facedown:null,facedownExtra:null,dreamingTreeChosenThisTurn:{P1:!1,P2:!1}}],H=Math.floor(Math.random()*6)+1,W=Math.floor(Math.random()*6)+1;let $=H,Z=W;for(;$===Z;)$=Math.floor(Math.random()*6)+1,Z=Math.floor(Math.random()*6)+1;const M=$>Z?"P1":"P2";P({P1:$,P2:Z,winner:M});const B=M,Y=h==="BO3"&&p?[`Match: Best of 3  Game ${p.gamesCompleted+1}  Score P1 ${p.wins.P1}-${p.wins.P2} P2`]:[],L={step:"MULLIGAN",turnNumber:1,turnPlayer:B,startingPlayer:B,pendingPlayHint:null,priorityPlayer:B,passesInRow:0,state:"OPEN",windowKind:"NONE",windowBattlefieldIndex:null,focusPlayer:null,combat:null,chain:[],victoryScore:bc,log:[...Y,`Deck Builder Duel setup complete. First player: ${B}.`,`P1 Legend: ${f.legend.name} | Champion: ${f.champion.name}`,`P2 Legend: ${d.legend.name} | Champion: ${d.champion.name}`,`Battlefield 1 (P1 choice): ${m.name}`,`Battlefield 2 (P2 choice): ${C.name}`],actionHistory:[],damageKillEffects:[],recallOnDeathEffects:[],lastCombatExcessDamage:{P1:0,P2:0},lastCombatExcessDamageTurn:0,pendingCandlelitChoice:null,pendingOptionalChoice:null,optionalChoiceResults:{},pendingCullChoice:null,cullChoiceResults:{},players:N,battlefields:_,delayedTriggers:[]};an(L,"P1",4),an(L,"P2",4),gt(L),se({startingPlayer:B,gameState:L,matchState:p}),ne({chooser:M,gameNumber:1})}catch(f){alert(String((f==null?void 0:f.message)||f))}},_u=s=>{if(!te)return;const o=te.gameState,f=te.matchState;o.turnPlayer=s,o.startingPlayer=s,o.priorityPlayer=s,o.log.unshift(`${s} will go first.`),i(o),y("SETUP"),Di(null),_t(null),ki(null),Dt([{kind:"NONE"}]),Pn(null),Ei(!1),la({cardId:null,battlefieldIndex:null}),ii({from:null,unitIds:[],to:null}),As(null),ca(null),Gt(null),P(null),ne(null),se(null),K(null),f&&q(f)},ux=()=>{if(!A||!R||R.format!=="BO3"||A.step!=="GAME_OVER")return;const s=Ru(A),o={...R.wins};s&&(o[s]=(o[s]||0)+1);const f={...R,wins:o,gamesCompleted:R.gamesCompleted+1,lastGameWinner:s};if(o.P1>=2||o.P2>=2){q(f),K(null);return}q(f),K({matchStateAfterCommit:f,lastGameWinner:s})},dx=()=>{if(!A||!R||R.format!=="BO3"||A.step!=="GAME_OVER"||!J)return;const s=J.matchStateAfterCommit,o=J.lastGameWinner;ti.current=[],wo();const f=1;try{const d=tl(e,"P1",Q.P1,f),h=tl(e,"P2",Q.P2,f),p=Eo(d.battlefields,s.usedBattlefieldIds.P1,O.P1),b=Eo(h.battlefields,s.usedBattlefieldIds.P2,O.P2),m={...s,usedBattlefieldIds:{P1:[...s.usedBattlefieldIds.P1,p.id],P2:[...s.usedBattlefieldIds.P2,b.id]}};q(m),k({P1:null,P2:null}),K(null);const C={P1:{id:"P1",legend:d.legend,legendReady:!0,championZone:d.champion,base:{units:[],gear:[]},mainDeck:d.mainDeck,hand:[],trash:[],banishment:[],runeDeck:d.runeDeck,runesInPlay:[],runePool:Li(),points:0,domains:d.domains,mainDeckCardsPlayedThisTurn:0,scoredBattlefieldsThisTurn:[],discardedThisTurn:0,enemyUnitsDiedThisTurn:0,sealExhaustedThisTurn:!1,nextSpellDiscount:0,nextSpellRepeatByCost:!1,unitsEnterReadyThisTurn:!1,preventSpellAbilityDamageThisTurn:!1,opponentCantPlayCardsThisTurn:!1,nonTokenGearPlayedThisTurn:!1,pendingReadyRunesEndOfTurn:0,turnsTaken:0,mulliganSelectedIds:[],mulliganDone:!1},P2:{id:"P2",legend:h.legend,legendReady:!0,championZone:h.champion,base:{units:[],gear:[]},mainDeck:h.mainDeck,hand:[],trash:[],banishment:[],runeDeck:h.runeDeck,runesInPlay:[],runePool:Li(),points:0,domains:h.domains,mainDeckCardsPlayedThisTurn:0,scoredBattlefieldsThisTurn:[],discardedThisTurn:0,enemyUnitsDiedThisTurn:0,sealExhaustedThisTurn:!1,nextSpellDiscount:0,nextSpellRepeatByCost:!1,unitsEnterReadyThisTurn:!1,preventSpellAbilityDamageThisTurn:!1,opponentCantPlayCardsThisTurn:!1,nonTokenGearPlayedThisTurn:!1,pendingReadyRunesEndOfTurn:0,turnsTaken:0,mulliganSelectedIds:[],mulliganDone:!1}},N=[{index:0,card:p,owner:"P1",controller:null,contestedBy:null,units:{P1:[],P2:[]},gear:{P1:[],P2:[]},facedown:null,facedownExtra:null,dreamingTreeChosenThisTurn:{P1:!1,P2:!1}},{index:1,card:b,owner:"P2",controller:null,contestedBy:null,units:{P1:[],P2:[]},gear:{P1:[],P2:[]},facedown:null,facedownExtra:null,dreamingTreeChosenThisTurn:{P1:!1,P2:!1}}],_=o==="P1"?"P2":"P1",H=_,W=[`Match: Best of 3  Game ${m.gamesCompleted+1}  Score P1 ${m.wins.P1}-${m.wins.P2} P2`],$={step:"MULLIGAN",turnNumber:1,turnPlayer:H,startingPlayer:H,pendingPlayHint:null,priorityPlayer:H,passesInRow:0,state:"OPEN",windowKind:"NONE",windowBattlefieldIndex:null,focusPlayer:null,combat:null,chain:[],victoryScore:bc,log:[...W,`Previous game winner: ${o??"Unknown"}.`,`${_} (loser) chooses who goes first.`,`P1 Legend: ${d.legend.name} | Champion: ${d.champion.name}`,`P2 Legend: ${h.legend.name} | Champion: ${h.champion.name}`,`Battlefield 1 (P1 choice): ${p.name}`,`Battlefield 2 (P2 choice): ${b.name}`],actionHistory:[],damageKillEffects:[],recallOnDeathEffects:[],lastCombatExcessDamage:{P1:0,P2:0},lastCombatExcessDamageTurn:0,pendingCandlelitChoice:null,pendingOptionalChoice:null,optionalChoiceResults:{},pendingCullChoice:null,cullChoiceResults:{},players:C,battlefields:N,delayedTriggers:[]};an($,"P1",4),an($,"P2",4),gt($),se({startingPlayer:H,gameState:$,matchState:m}),ne({chooser:_,gameNumber:m.gamesCompleted+1}),P(null)}catch(d){q(s),K({matchStateAfterCommit:s,lastGameWinner:o}),alert(String((d==null?void 0:d.message)||d))}},on=(s,o)=>{ce(f=>({...f,[s]:o(f[s]||tn())}))},gn=(s,o,f,d=0,h=null)=>{const p={...s};let m=Math.floor(p[o]||0)+f;return m<d&&(m=d),h!=null&&(m=Math.min(h,m)),m===0?delete p[o]:p[o]=m,p},gp=he.useMemo(()=>({revealHands:Ri,revealFacedown:xi,revealDecks:Ns}),[Ri,xi,Ns]),A=he.useMemo(()=>n?Nv(n,Ye,gp):null,[n,Ye,gp]);he.useEffect(()=>{if(!(A!=null&&A.pendingOptionalChoice)||A.pendingOptionalChoice.kind!=="NUMBER")return;const s=A.pendingOptionalChoice.min??0,o=Math.max(s,A.pendingOptionalChoice.max??s),f=A.pendingOptionalChoice.defaultValue??o??s,d=Math.max(s,Math.min(o,f));wn(d)},[(qp=A==null?void 0:A.pendingOptionalChoice)==null?void 0:qp.id]),he.useEffect(()=>{var d;if(!(A!=null&&A.pendingCullChoice)){Ln(null);return}const s=A.pendingCullChoice,o=s.order[s.index],f=vt(A,o);Ln(((d=f[0])==null?void 0:d.instanceId)||null)},[(Wp=A==null?void 0:A.pendingCullChoice)==null?void 0:Wp.resolutionId,(Kp=A==null?void 0:A.pendingCullChoice)==null?void 0:Kp.index]),he.useEffect(()=>{if(!Re||!A){Oi.length>0&&ni([]);return}const s=A.players[Re.player],o=new Set(s.hand.filter(f=>f.instanceId!==Re.cardId).map(f=>f.instanceId));ni(f=>{const d=f.filter(h=>o.has(h));return d.length===f.length?f:d})},[A,Re,Oi.length]),A&&A.players[Ye],A&&A.players[A.turnPlayer];const Le=s=>!A||Ii(s)?!1:A.chain.length>0||A.state==="CLOSED"||A.windowKind!=="NONE"?A.priorityPlayer===s:A.step==="MULLIGAN"?!0:(A.step==="ACTION",A.turnPlayer===s);he.useEffect(()=>{const s={viewerId:Ye,canActAs:Le,isAiControlled:Ii};return mc=s,()=>{mc===s&&(mc=null)}},[Ye,Le,Ii]);const nr=(s,o,f,d,h,p)=>{const b=[];["P1","P2"].forEach(C=>{s.players[C].base.units.forEach(N=>{b.push({label:`${C} Base: ${N.name}`,t:{kind:"UNIT",owner:C,instanceId:N.instanceId,zone:"BASE"}})}),s.battlefields.forEach((N,_)=>{N.units[C].forEach(H=>{b.push({label:`${C} BF${_+1}: ${H.name}`,t:{kind:"UNIT",owner:C,instanceId:H.instanceId,zone:"BF",battlefieldIndex:_}})})})});const m=b.filter(C=>{if(C.t.kind!=="UNIT")return!1;const N=Me(s,C.t.owner,C.t.instanceId);if(!N||f.excludeSelf&&p&&C.t.instanceId===p)return!1;const H=C.t.owner,W=H===o,$=H!==o,Z=d??h,M=Z!=null&&N.zone==="BF"&&N.battlefieldIndex===Z,B=N.zone==="BF";switch(f.kind){case"UNIT_HERE_FRIENDLY":return M&&W;case"UNIT_HERE_ENEMY":return M&&$;case"UNIT_AT_BATTLEFIELD":return B;case"UNIT_ENEMY_AT_BATTLEFIELD":return B&&$;case"UNIT_FRIENDLY_AT_BATTLEFIELD":return B&&W;case"UNIT_FRIENDLY":return W;case"UNIT_ENEMY":return $;case"UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD":return W&&N.zone==="BASE";case"UNIT_FRIENDLY_AND_ENEMY":return!0;case"UNIT_ANYWHERE":return!0;case"NONE":case"BATTLEFIELD":return!1;default:return!0}});if(h!=null){const C=m.filter(N=>{if(N.t.kind!=="UNIT")return!1;const _=Me(s,N.t.owner,N.t.instanceId);return _&&_.zone==="BF"&&_.battlefieldIndex===h});return C.length>0?C:m}return m},bp=(s,o)=>{const f=s.battlefields.map((d,h)=>({label:`Battlefield ${h+1}: ${d.card.name}`,t:{kind:"BATTLEFIELD",index:h}}));if(o!=null){const d=f.filter(h=>h.t.kind==="BATTLEFIELD"&&h.t.index===o);return d.length>0?d:f}return f},xp=(s,o,f,d)=>{const h=[];["P1","P2"].forEach(b=>{s.players[b].base.gear.forEach(C=>{h.push({label:`${b} Base: ${C.name}`,t:{kind:"GEAR",owner:b,instanceId:C.instanceId}})}),s.battlefields.forEach((C,N)=>{C.gear[b].forEach(_=>{h.push({label:`${b} BF${N+1}: ${_.name}`,t:{kind:"GEAR",owner:b,instanceId:_.instanceId}})})});const m=vt(s,b);for(const C of m)for(const N of C.attachedGear||[])h.push({label:`${b} ${C.name}: ${N.name} (attached)`,t:{kind:"GEAR",owner:b,instanceId:N.instanceId}})});const p=h.filter(b=>{if(b.t.kind!=="GEAR")return!1;const m=rs(s,b.t.owner,b.t.instanceId);if(!m)return!1;const C=b.t.owner===o,N=f.kind==="GEAR_FRIENDLY_EQUIPMENT"||f.kind==="UNIT_AND_GEAR_FRIENDLY"||f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER",_=m.gear;switch(f.kind){case"GEAR_FRIENDLY":return C;case"GEAR_FRIENDLY_EQUIPMENT":return C&&ss(_);case"GEAR_ANY":return!0;case"UNIT_AND_GEAR_FRIENDLY":case"UNIT_AND_GEAR_SAME_CONTROLLER":return N?ss(_):!0;default:return!1}});if(d!=null){const b=p.filter(m=>{if(m.t.kind!=="GEAR")return!1;const C=rs(s,m.t.owner,m.t.instanceId);return!C||C.zone!=="BF"?!1:C.battlefieldIndex===d});return b.length>0?b:p}return p},Ha=(s,o,f,d,h,p,b)=>{var W,$,Z,M;if(f.kind==="NONE")return[{kind:"NONE"}];const m=Math.max(1,Number(f.count||1));if(f.kind==="BATTLEFIELD"){const B=bp(s,h);return B.length===0?[{kind:"NONE"}]:p==="HARD"||p==="VERY_HARD"?B.map(L=>{const ie=L.t.index,de=s.battlefields[ie],me=xt(o),ae=de.units[me].reduce((Qe,Je)=>Qe+Pe(Je,{role:"NONE",game:s,battlefieldIndex:de.index}),0),Ve=de.units[o].reduce((Qe,Je)=>Qe+Pe(Je,{role:"NONE",game:s,battlefieldIndex:de.index}),0),Se=ae*10-Ve*2;return{o:L,want:Se}}).sort((L,ie)=>ie.want-L.want).slice(0,m).map(L=>L.o.t):B.slice(0,m).map(Y=>Y.t)}if(f.kind==="UNIT_FRIENDLY_AND_ENEMY"){const B=nr(s,o,{kind:"UNIT_FRIENDLY"},d,h,b),Y=nr(s,o,{kind:"UNIT_ENEMY"},d,h,b);if(B.length===0||Y.length===0)return[{kind:"NONE"}];if(p==="HARD"||p==="VERY_HARD"){const L=B.map(de=>{var ae;const me=de.t.kind==="UNIT"?(ae=Me(s,de.t.owner,de.t.instanceId))==null?void 0:ae.unit:null;return{o:de,might:me?Pe(me,{role:"NONE",game:s}):0}}).sort((de,me)=>me.might-de.might),ie=Y.map(de=>{var ae;const me=de.t.kind==="UNIT"?(ae=Me(s,de.t.owner,de.t.instanceId))==null?void 0:ae.unit:null;return{o:de,might:me?Pe(me,{role:"NONE",game:s}):0}}).sort((de,me)=>me.might-de.might);return[L[0].o.t,ie[0].o.t]}return[B[0].t,Y[0].t]}if(f.kind==="UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD"){const B=nr(s,o,{kind:"UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD"},d,h,b),Y=bp(s,h);if(B.length===0||Y.length===0)return[{kind:"NONE"}];const L=(p==="HARD"||p==="VERY_HARD")&&(($=(W=B.map(de=>{var ae;const me=de.t.kind==="UNIT"?(ae=Me(s,de.t.owner,de.t.instanceId))==null?void 0:ae.unit:null;return{o:de,might:me?Pe(me,{role:"NONE",game:s}):0}}).sort((de,me)=>me.might-de.might)[0])==null?void 0:W.o)==null?void 0:$.t)||B[0].t,ie=(p==="HARD"||p==="VERY_HARD")&&((M=(Z=Y.map(de=>{const me=de.t.index,ae=s.battlefields[me],Ve=xt(o),Se=ae.units[Ve].reduce((Qe,Je)=>Qe+Pe(Je,{role:"NONE",game:s,battlefieldIndex:ae.index}),0);return{o:de,score:Se}}).sort((de,me)=>me.score-de.score)[0])==null?void 0:Z.o)==null?void 0:M.t)||Y[0].t;return[L,ie]}if(f.kind==="UNIT_AND_GEAR_FRIENDLY"||f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER"){const B=f.kind==="UNIT_AND_GEAR_FRIENDLY"?{kind:"UNIT_FRIENDLY"}:{kind:"UNIT_ANYWHERE"},Y=nr(s,o,B,d,h,b);if(Y.length===0)return[{kind:"NONE"}];const L=Y[0].t,ie=f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER"?L.owner:o,me=xp(s,ie,{kind:"GEAR_FRIENDLY_EQUIPMENT"},h);return me.length===0?[{kind:"NONE"}]:[L,me[0].t]}if(f.kind==="GEAR_FRIENDLY"||f.kind==="GEAR_ANY"||f.kind==="GEAR_FRIENDLY_EQUIPMENT"){const B=xp(s,o,f,h);return B.length===0?[{kind:"NONE"}]:B.slice(0,m).map(Y=>Y.t)}const C=nr(s,o,f,d,h,b);if(C.length===0)return[{kind:"NONE"}];if(p==="EASY"||p==="MEDIUM")return C.slice(0,m).map(B=>B.t);const N=f.kind==="UNIT_HERE_ENEMY"||f.kind==="UNIT_ENEMY"||f.kind==="UNIT_ENEMY_AT_BATTLEFIELD",_=f.kind==="UNIT_HERE_FRIENDLY"||f.kind==="UNIT_FRIENDLY"||f.kind==="UNIT_FRIENDLY_AT_BATTLEFIELD";return C.map(B=>{var Ve;const Y=B.t;if(Y.kind!=="UNIT")return{o:B,score:-9999};const L=((Ve=Me(s,Y.owner,Y.instanceId))==null?void 0:Ve.unit)||null,ie=L?Pe(L,{role:"NONE",game:s}):0,de=Y.owner!==o,me=Y.owner===o;let ae=ie;return N&&!de&&(ae-=9999),_&&!me&&(ae-=9999),!_&&de&&(ae+=2),{o:B,score:ae}}).sort((B,Y)=>Y.score-B.score).slice(0,m).map(B=>B.o.t)},Ou=he.useRef(new Set);he.useEffect(()=>{var o,f;if(!n||Re||mn)return;const s=n.chain[n.chain.length-1];if(s)if(s.needsTargets&&(!((o=s.targets)!=null&&o[0])||s.targets[0].kind==="NONE")){if(Ii(s.controller)){if(Ou.current.has(s.id))return;Ou.current.add(s.id);const d=((f=mt[s.controller])==null?void 0:f.difficulty)||"MEDIUM",h=Ha(n,s.controller,s.targetRequirement,s.contextBattlefieldIndex??null,s.restrictTargetsToBattlefieldIndex??null,d,s.sourceInstanceId);Ge({type:"SET_CHAIN_TARGETS",player:s.controller,chainItemId:s.id,targets:h});return}Pn({chainItemId:s.id}),Dt(s.targets&&s.targets.length>0?s.targets:[{kind:"NONE"}])}else s&&!s.needsTargets&&Ou.current.delete(s.id)},[n,Re,mn,mt,bi]);const Bu=()=>{if(!A||!mn)return;const s=A.chain.find(o=>o.id===mn.chainItemId);if(!s){Pn(null);return}s.controller===Ye&&(Ge({type:"SET_CHAIN_TARGETS",player:Ye,chainItemId:mn.chainItemId,targets:St}),Pn(null))},Lt=s=>{i(o=>{if(!o)return o;ti.current.push(o),ti.current.length>Xl&&ti.current.shift();const f=is(o);return s(f),f.log=f.log.slice(0,400),f})},Ep=(s,o)=>{if(s.step==="GAME_OVER")return!1;if(s.turnPlayer!==o)return s.log.unshift("Only the turn player can advance the step."),!1;if(s.chain.length>0||s.windowKind!=="NONE"||s.state!=="OPEN")return s.log.unshift("Cannot advance step while a chain/window is active."),!1;const f=()=>{s.players.P1.scoredBattlefieldsThisTurn=[],s.players.P2.scoredBattlefieldsThisTurn=[],s.players.P1.mainDeckCardsPlayedThisTurn=0,s.players.P2.mainDeckCardsPlayedThisTurn=0,s.players.P1.discardedThisTurn=0,s.players.P2.discardedThisTurn=0,s.players.P1.enemyUnitsDiedThisTurn=0,s.players.P2.enemyUnitsDiedThisTurn=0,s.players.P1.sealExhaustedThisTurn=!1,s.players.P2.sealExhaustedThisTurn=!1,s.players.P1.unitsEnterReadyThisTurn=!1,s.players.P2.unitsEnterReadyThisTurn=!1,s.players.P1.preventSpellAbilityDamageThisTurn=!1,s.players.P2.preventSpellAbilityDamageThisTurn=!1,s.players.P1.opponentCantPlayCardsThisTurn=!1,s.players.P2.opponentCantPlayCardsThisTurn=!1,s.players.P1.nextSpellDiscount=0,s.players.P2.nextSpellDiscount=0,s.players.P1.nextSpellRepeatByCost=!1,s.players.P2.nextSpellRepeatByCost=!1,s.players.P1.nonTokenGearPlayedThisTurn=!1,s.players.P2.nonTokenGearPlayedThisTurn=!1,s.players.P1.pendingReadyRunesEndOfTurn=0,s.players.P2.pendingReadyRunesEndOfTurn=0;for(const d of s.battlefields)d.dreamingTreeChosenThisTurn={P1:!1,P2:!1};for(const d of["P1","P2"])for(const h of vt(s,d))h.moveCountThisTurn=0,h.killOnDamageUntilTurn=0;s.damageKillEffects=[],s.recallOnDeathEffects=s.recallOnDeathEffects.filter(d=>d.untilTurn>s.turnNumber),s.delayedTriggers=s.delayedTriggers.filter(d=>d.untilTurn>s.turnNumber)};switch(s.step){case"MULLIGAN":s.log.unshift("Use Confirm Mulligan for each player (or confirm with 0 selected) to start the game.");break;case"AWAKEN":s.players[s.turnPlayer].turnsTaken+=1,tN(s,s.turnPlayer),s.step="SCORING";break;case"SCORING":if(Vv(s,s.turnPlayer),s.step==="GAME_OVER")return!0;s.step="CHANNEL";break;case"CHANNEL":{const h=2+(s.turnNumber===2&&s.turnPlayer!==s.startingPlayer?1:0);lh(s,s.turnPlayer,h),s.step="DRAW";break}case"DRAW":if(an(s,s.turnPlayer,1),s.step==="GAME_OVER")return!0;Xv(s),s.step="ACTION";break;case"ACTION":s.step="ENDING",["P1","P2"].forEach(d=>{[...s.players[d].base.units,...s.players[d].base.gear,...s.battlefields.flatMap(h=>h.units[d])].forEach(h=>{var b,m,C,N,_;(((b=h.ability)==null?void 0:b.trigger)||"").toLowerCase().includes("at the end of your turn")&&d===s.turnPlayer&&(m=h.ability)!=null&&m.effect_text&&(s.chain.push({id:Be("chain"),controller:d,kind:"TRIGGERED_ABILITY",label:`End Turn: ${h.name}`,effectText:h.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:!1}),s.state="CLOSED",s.priorityPlayer=d,s.passesInRow=0);const p=`${((C=h.ability)==null?void 0:C.effect_text)||""} ${((N=h.ability)==null?void 0:N.raw_text)||""}`.toLowerCase();if(d===s.turnPlayer&&p.includes("while i'm at a battlefield")&&p.includes("ready 4 friendly runes at the end of your turn")){const H=Me(s,d,h.instanceId);H&&H.zone==="BF"&&((_=h.ability)!=null&&_.effect_text)&&(s.chain.push({id:Be("chain"),controller:d,kind:"TRIGGERED_ABILITY",label:`End Turn: ${h.name}`,effectText:h.ability.effect_text,contextBattlefieldIndex:H.battlefieldIndex??null,targets:[{kind:"NONE"}],needsTargets:!1}),s.state="CLOSED",s.priorityPlayer=d,s.passesInRow=0)}})}),Jv(s),s.log.unshift(`Ending Step begins for ${s.turnPlayer}.`);break;case"ENDING":{const d=s.players[s.turnPlayer].pendingReadyRunesEndOfTurn||0;if(d>0){const h=s.players[s.turnPlayer].runesInPlay.filter(b=>!b.isReady),p=Math.min(d,h.length);for(let b=0;b<p;b++)h[b].isReady=!0;s.players[s.turnPlayer].pendingReadyRunesEndOfTurn=0,p>0&&s.log.unshift(`${s.turnPlayer} readied ${p} rune(s) (end of turn effect).`)}eN(s),Zv(s,s.turnPlayer),s.turnPlayer=xt(s.turnPlayer),s.turnNumber+=1,f(),s.step="AWAKEN",s.priorityPlayer=s.turnPlayer,s.state="OPEN",s.passesInRow=0,["P1","P2"].forEach(h=>{h===s.turnPlayer&&[...s.players[h].base.units,...s.players[h].base.gear,...s.battlefields.flatMap(p=>p.units[h])].forEach(p=>{var m,C;const b=(((m=p.ability)==null?void 0:m.trigger)||"").toLowerCase();(b.includes("at the start of your beginning phase")||b.includes("at start of your beginning phase"))&&(C=p.ability)!=null&&C.effect_text&&(s.chain.push({id:Be("chain"),controller:h,kind:"TRIGGERED_ABILITY",label:`Start Phase: ${p.name}`,effectText:p.ability.effect_text,targets:[{kind:"NONE"}],needsTargets:!1}),s.state="CLOSED",s.priorityPlayer=h,s.passesInRow=0)})}),s.log.unshift(`Turn ${s.turnNumber} begins for ${s.turnPlayer}.`);break}}return gt(s),bn(s),!0},Un=(s,o)=>{var h,p;if(s.priorityPlayer!==o)return!1;const f=s.chain[s.chain.length-1];if(f&&f.needsTargets&&f.controller===o){const b=(h=f.targets)==null?void 0:h[0];if(!b||b.kind==="NONE")return s.log.unshift("Choose targets before passing."),!1}s.passesInRow+=1,s.log.unshift(`${o} passes.`);const d=s.windowKind==="SHOWDOWN"||s.windowKind==="COMBAT"&&((p=s.combat)==null?void 0:p.step)==="SHOWDOWN";if(s.passesInRow<2)return d&&s.chain.length===0&&s.state==="OPEN"?(s.focusPlayer=xt(o),s.priorityPlayer=s.focusPlayer,s.log.unshift(`Focus passes to ${s.focusPlayer}.`)):s.priorityPlayer=xt(o),!0;if(s.chain.length>0)return Wa(s),!0;if(s.windowKind==="SHOWDOWN"){const b=s.windowBattlefieldIndex,m=s.battlefields[b];s.log.unshift(`Showdown at Battlefield ${b+1} ends (all players passed).`),s.windowKind="NONE",s.windowBattlefieldIndex=null,s.focusPlayer=null,s.passesInRow=0,s.state="OPEN",s.priorityPlayer=s.turnPlayer;const C=m.units.P1.length,N=m.units.P2.length;if(C>0&&N>0){const _=m.contestedBy,H=xt(_);s.windowKind="COMBAT",s.windowBattlefieldIndex=b,s.combat={battlefieldIndex:b,attacker:_,defender:H,step:"SHOWDOWN"},s.focusPlayer=_,s.priorityPlayer=_,s.passesInRow=0,s.log.unshift(`Combat begins at Battlefield ${b+1}: ${_} attacks, ${H} defends.`)}else{const _=C>0?"P1":N>0?"P2":null,H=m.controller;_?(m.controller=_,m.contestedBy=null,s.log.unshift(`${_} took control of Battlefield ${b+1} (unopposed).`),H!==_&&Zr(s,_,b,"Conquer")):(m.controller=null,m.contestedBy=null),gt(s),bn(s)}return!0}if(s.windowKind==="COMBAT"&&s.combat&&s.combat.step==="SHOWDOWN"){s.passesInRow=0,s.focusPlayer=null;const b=s.combat.battlefieldIndex,m=s.combat.attacker,C=s.combat.defender,N=s.battlefields[b],_=N.units[m].filter(L=>!L.stunned),H=N.units[C].filter(L=>!L.stunned),W=_.length===1,$=H.length===1,Z=_.reduce((L,ie)=>L+Pe(ie,{role:"ATTACKER",alone:W,game:s,battlefieldIndex:b}),0),M=H.reduce((L,ie)=>L+Pe(ie,{role:"DEFENDER",alone:$,game:s,battlefieldIndex:b}),0),B=H.length>1&&Z>0,Y=_.length>1&&M>0;return B||Y?(s.log.unshift("Combat showdown ends. Players assign damage..."),s.combat.step="DAMAGE_ASSIGNMENT",s.pendingDamageAssignment={battlefieldIndex:b,attacker:m,defender:C,attackerTotalDamage:Z,defenderTotalDamage:M,attackerAssignment:{},defenderAssignment:{},attackerConfirmed:!B,defenderConfirmed:!Y},!B&&H.length===1&&Z>0&&(s.pendingDamageAssignment.attackerAssignment[H[0].instanceId]=Z),!Y&&_.length===1&&M>0&&(s.pendingDamageAssignment.defenderAssignment[_[0].instanceId]=M)):(s.log.unshift("Combat showdown ends. Assigning damage..."),Um(s,b,m,C),s.combat.step="DAMAGE",ec(s)),!0}return s.passesInRow=0,s.priorityPlayer=s.turnPlayer,!0},fx=(s,o,f)=>{const d=s.players[o],h=d.runesInPlay.find(p=>p.instanceId===f);return h?h.isReady?(h.isReady=!1,d.runePool.energy+=1,s.log.unshift(`${o} exhausted a ${h.domain} rune to add 1 energy.`),!0):(s.log.unshift("Rune is exhausted."),!1):!1},hx=(s,o,f)=>{var W,$,Z;const d=s.players[o],h=d.base.gear.findIndex(M=>M.instanceId===f);if(h<0)return!1;const p=d.base.gear[h];if(!p.isReady)return s.log.unshift("Gear is exhausted."),!1;const b=(((W=p.ability)==null?void 0:W.raw_text)||(($=p.ability)==null?void 0:$.effect_text)||"").toString(),m=b.toLowerCase().replace(/_/g," ").replace(/\[[^\]]+\]/g,M=>M.slice(1,-1)).replace(/[]/g,"-").replace(/[:.]/g," ").replace(/\s+/g," ").trim(),C=m.match(/\badd\s+(\d+)\s+energy\b/);if(C){const M=Math.max(0,parseInt(C[1],10)||0);return M<=0?!1:(p.isReady=!1,d.runePool.energy+=M,d.sealExhaustedThisTurn=!0,s.log.unshift(`${o} exhausted ${p.name} to add ${M} energy.`),!0)}const N=m.match(/\badd\s+(\d+)?\s*(body|calm|chaos|fury|mind|order|class)\s+(?:rune|power)\b/);if(N){const M=Math.max(0,parseInt(N[1]||"1",10)||0);if(M<=0)return!1;if(p.isReady=!1,N[2]==="class"){const Y=ds(s,o)[0]||"Colorless";d.runePool.power[Y]+=M,s.log.unshift(`${o} exhausted ${p.name} to add ${M} ${Y} power (class rune).`)}else{const B=ut(N[2]);d.runePool.power[B]+=M,s.log.unshift(`${o} exhausted ${p.name} to add ${M} ${B} power.`)}return d.sealExhaustedThisTurn=!0,!0}const _=m.match(/\badd\s+(\d+)\s+(?:rune|power)\s+of\s+any\s+(?:type|domain|color)\b/)||m.match(/\badd\s+(\d+)\s+any\s+(?:rune|power)\b/);if(_){const M=Math.max(0,parseInt(_[1],10)||0);if(M<=0)return!1;const Y=Yt(p.domain).map(ut).filter(L=>L!=="Colorless")[0]||d.domains[0]||"Fury";return p.isReady=!1,d.runePool.power[Y]+=M,d.sealExhaustedThisTurn=!0,s.log.unshift(`${o} exhausted ${p.name} to add ${M} ${Y} power (any-domain add).`),!0}if(p.name.toLowerCase().includes("seal")||/\bseal\b/i.test(b)||(((Z=p.ability)==null?void 0:Z.keywords)||[]).some(M=>M.toLowerCase().includes("add"))){const B=Yt(p.domain).map(ut).filter(Y=>Y!=="Colorless")[0]||d.domains[0]||"Fury";return p.isReady=!1,d.runePool.power[B]+=1,d.sealExhaustedThisTurn=!0,s.log.unshift(`${o} exhausted ${p.name} to add 1 ${B} power (fallback parse).`),!0}return s.log.unshift("This gear doesn't look like a Seal that adds resources (auto-detect failed)."),!1},Tp=(s,o,f)=>{const d=s.players[o];if(s.step!=="ACTION"||s.turnPlayer!==o||s.windowKind!=="NONE"||s.chain.length>0||s.state!=="OPEN")return s.log.unshift("Equip can only be used during your Action step when the game is open."),!1;const h=d.base.gear.findIndex(N=>N.instanceId===f);if(h<0)return s.log.unshift("Equipment not found in base."),!1;const p=d.base.gear[h];if(!ss(p))return s.log.unshift(`${p.name} is not equipment.`),!1;if(!p.isReady)return s.log.unshift(`${p.name} is exhausted.`),!1;if(vt(s,o).length===0)return s.log.unshift("No units to attach equipment to."),!1;const m=Dm(p);if(!m)return s.log.unshift(`Could not parse equip cost for ${p.name}.`),!1;const C=d.runePool;return C.energy<m.energy?(s.log.unshift(`Cannot afford ${m.energy} energy for equip cost.`),!1):m.power>0&&!d.domains.some(H=>(C.power[H]||0)>=m.power)?(s.log.unshift(`Cannot afford ${m.power} power for equip cost.`),!1):(s.pendingEquipChoice={gearInstanceId:f,gearOwner:o,equipCost:m},s.log.unshift(`Select a unit to attach ${p.name} to.`),!0)},vp=(s,o,f)=>{var $;if(!s.pendingEquipChoice||s.pendingEquipChoice.gearOwner!==o)return s.log.unshift("No pending equip choice."),!1;const d=s.pendingEquipChoice,h=s.players[o],p=h.base.gear.findIndex(Z=>Z.instanceId===d.gearInstanceId);if(p<0)return s.pendingEquipChoice=null,s.log.unshift("Equipment no longer in base."),!1;const b=h.base.gear[p],m=Me(s,o,f);if(!m)return s.log.unshift("Unit not found."),!1;const C=m.unit,N=h.runePool,_=d.equipCost,H=ds(s,o);if(Mn){const Z=Zo(N,h.runesInPlay,{energyNeed:_.energy,basePowerNeed:_.power,powerDomainsAllowed:H,additionalPowerByDomain:{},additionalPowerAny:0},{sealExhaustedThisTurn:h.sealExhaustedThisTurn,seals:h.base.gear,playerDomains:h.domains});Z&&Kd(s,o,Z)}if(N.energy<_.energy)return s.pendingEquipChoice=null,s.log.unshift("Cannot afford energy cost."),!1;if(N.energy-=_.energy,_.power>0){const M=h.domains.find(B=>(N.power[B]||0)>=_.power);if(!M)return N.energy+=_.energy,s.pendingEquipChoice=null,s.log.unshift("Cannot afford power cost."),!1;N.power[M]-=_.power,s.log.unshift(`${o} paid ${_.energy>0?_.energy+" energy + ":""}${_.power} ${M} power to equip.`)}else _.energy>0&&s.log.unshift(`${o} paid ${_.energy} energy to equip.`);const W=Pe(C,{role:"NONE",game:s});return h.base.gear.splice(p,1),C.attachedGear||(C.attachedGear=[]),C.attachedGear.push(b),s.log.unshift(`${b.name} attached to ${C.name} (+${(($=b.stats)==null?void 0:$.might)||0} might).`),s.pendingEquipChoice=null,Sa(s,C,W),!0},Np=s=>{var d,h;const f=(((d=s.ability)==null?void 0:d.raw_text)||((h=s.ability)==null?void 0:h.effect_text)||"").match(/Kill\s+this[^:]*:\s*([^.]+\.?)/i);return f?f[1].trim():null},To=s=>{var h,p;const o=((h=s.ability)==null?void 0:h.raw_text)||((p=s.ability)==null?void 0:p.effect_text)||"",f=o.match(/Spend\s+my\s+buff[:\s-]+Choose\s+one[^\n]*([\s\S]*?)(?=\n\n|$)/i);if(f)return"Choose one"+f[1].trim();const d=o.match(/Spend\s+my\s+buff[:\s-]+([^.]+\.?)/i);return d?d[1].trim():null},px=(s,o,f)=>{const d=s.players[o],h=d.base.gear.findIndex(N=>N.instanceId===f);if(h<0)return s.log.unshift("Gear not found in base."),!1;const p=d.base.gear[h],b=Np(p);if(!b)return s.log.unshift(`${p.name} has no 'Kill this' ability.`),!1;d.base.gear.splice(h,1),Jc(s,p,"trash")?s.log.unshift(`${o} sacrificed ${p.name} to activate its ability.`):(d.trash.push(p),s.log.unshift(`${o} sacrificed ${p.name} to activate its ability.`));const m=dt(b),C={id:Be("chain"),controller:o,kind:"ACTIVATED_ABILITY",label:`${p.name}  Kill this`,effectText:b,contextBattlefieldIndex:null,needsTargets:m.kind!=="NONE",targetRequirement:m,targets:[{kind:"NONE"}],sourceInstanceId:p.instanceId};return s.chain.push(C),s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o,s.log.unshift(`Activated ability queued: ${p.name} (Kill this).`),!0},yx=(s,o,f)=>{const d=Me(s,o,f);if(!d)return s.log.unshift("Unit not found."),!1;const h=d.zone==="BASE"?s.players[o].base.units.find(C=>C.instanceId===f):s.battlefields[d.battlefieldIndex].units[o].find(C=>C.instanceId===f);if(!h)return s.log.unshift("Unit not found."),!1;const p=To(h);if(!p)return s.log.unshift(`${h.name} has no 'Spend my buff' ability.`),!1;if(!h.buffs||h.buffs<=0)return s.log.unshift(`${h.name} has no buff to spend.`),!1;h.buffs-=1,s.log.unshift(`${o} spent ${h.name}'s buff to activate its ability.`);const b=dt(p,{here:d.zone==="BF"}),m={id:Be("chain"),controller:o,kind:"ACTIVATED_ABILITY",label:`${h.name}  Spend my buff`,effectText:p,contextBattlefieldIndex:d.zone==="BF"?d.battlefieldIndex:null,needsTargets:b.kind!=="NONE",targetRequirement:b,targets:[{kind:"NONE"}],sourceInstanceId:h.instanceId};return s.chain.push(m),s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o,s.log.unshift(`Activated ability queued: ${h.name} (Spend my buff).`),!0},ju=(s,o,f)=>{const d=s.pendingCullChoice;if(!d||d.order[d.index]!==o)return!1;if(vt(s,o).length===0)d.choices[o]=null;else{const b=Me(s,o,f);if(!b||b.unit.owner!==o)return s.log.unshift("Invalid cull choice."),!1;d.choices[o]=b.unit.instanceId,s.log.unshift(`${o} chose ${b.unit.name} for Cull the Weak.`)}return d.index+=1,q0(s),s.pendingCullChoice||Wa(s),!0},mx=(s,o,f)=>{if(!s.pendingDamageAssignment||!s.combat||s.combat.step!=="DAMAGE_ASSIGNMENT")return s.log.unshift("No pending damage assignment."),!1;const d=s.pendingDamageAssignment,h=o===d.attacker,p=o===d.defender;if(!h&&!p)return s.log.unshift("Player not in combat."),!1;const b=s.battlefields[d.battlefieldIndex],m=h?d.attackerTotalDamage:d.defenderTotalDamage,C=h?b.units[d.defender]:b.units[d.attacker],N=new Set(C.filter($=>!$.stunned).map($=>$.instanceId));let _=0;for(const[$,Z]of Object.entries(f)){if(!N.has($))return s.log.unshift(`Invalid target unit: ${$}`),!1;if(Z<0)return s.log.unshift("Cannot assign negative damage."),!1;_+=Z}if(_!==m)return s.log.unshift(`Must assign exactly ${m} damage (assigned ${_}).`),!1;const H=C.filter($=>!$.stunned&&lt($,"Tank")),W=C.filter($=>!$.stunned&&!lt($,"Tank"));if(H.length>0){const $=H.reduce((B,Y)=>B+(f[Y.instanceId]||0),0),Z=H.reduce((B,Y)=>B+Pe(Y,{role:h?"DEFENDER":"ATTACKER",alone:C.length===1,game:s,battlefieldIndex:d.battlefieldIndex}),0);if(W.reduce((B,Y)=>B+(f[Y.instanceId]||0),0)>0&&$<Z)return s.log.unshift("Must assign lethal damage to Tanks before damaging other units."),!1}return h?d.attackerAssignment=f:d.defenderAssignment=f,s.log.unshift(`${o} assigned ${m} damage.`),!0},gx=(s,o)=>{if(!s.pendingDamageAssignment||!s.combat||s.combat.step!=="DAMAGE_ASSIGNMENT")return s.log.unshift("No pending damage assignment."),!1;const f=s.pendingDamageAssignment,d=o===f.attacker,h=o===f.defender;if(!d&&!h)return s.log.unshift("Player not in combat."),!1;const p=d?f.attackerTotalDamage:f.defenderTotalDamage,b=d?f.attackerAssignment:f.defenderAssignment;return Object.values(b).reduce((C,N)=>C+N,0)!==p?(s.log.unshift(`Must assign all ${p} damage before confirming.`),!1):(d?f.attackerConfirmed=!0:f.defenderConfirmed=!0,s.log.unshift(`${o} confirmed damage assignment.`),f.attackerConfirmed&&f.defenderConfirmed&&wp(s),!0)},Mu=(s,o)=>{if(!s.pendingDamageAssignment||!s.combat||s.combat.step!=="DAMAGE_ASSIGNMENT")return s.log.unshift("No pending damage assignment."),!1;const f=s.pendingDamageAssignment,d=o===f.attacker,h=o===f.defender;if(!d&&!h)return s.log.unshift("Player not in combat."),!1;const p=s.battlefields[f.battlefieldIndex],b=d?f.attackerTotalDamage:f.defenderTotalDamage,m=d?p.units[f.defender]:p.units[f.attacker],C=d?"DEFENDER":"ATTACKER",N=m.length===1,_=m.filter(M=>!M.stunned&&lt(M,"Tank")),H=m.filter(M=>!M.stunned&&!lt(M,"Tank")),W=_.length>0?[..._,...H]:[...m.filter(M=>!M.stunned)],$={};let Z=b;for(const M of W){if(Z<=0)break;const B=Pe(M,{role:C,alone:N,game:s,battlefieldIndex:f.battlefieldIndex}),Y=Math.max(0,B-M.damage),L=Math.min(Y,Z);L>0&&($[M.instanceId]=L,Z-=L)}if(Z>0&&W.length>0){const M=W[W.length-1].instanceId;$[M]=($[M]||0)+Z}return d?(f.attackerAssignment=$,f.attackerConfirmed=!0):(f.defenderAssignment=$,f.defenderConfirmed=!0),s.log.unshift(`${o} auto-assigned ${b} damage.`),f.attackerConfirmed&&f.defenderConfirmed&&wp(s),!0},wp=s=>{if(!s.pendingDamageAssignment||!s.combat)return;const o=s.pendingDamageAssignment,f=s.battlefields[o.battlefieldIndex];for(const[p,b]of Object.entries(o.attackerAssignment)){const m=f.units[o.defender].find(C=>C.instanceId===p);if(m&&b>0){if(Qc(m)){s.log.unshift(`${m.name} ignored combat damage (moved twice this turn).`);continue}if(m.preventNextDamageUntilTurn&&m.preventNextDamageUntilTurn>=s.turnNumber){m.preventNextDamageUntilTurn=0,s.log.unshift(`${m.name} prevented combat damage (Counter Strike).`);continue}m.damage+=b,m.killOnDamageUntilTurn&&m.killOnDamageUntilTurn>=s.turnNumber&&m.damage>0?(m.damage=999,m.killOnDamageUntilTurn=0):Xc(s)&&(m.damage=999)}}for(const[p,b]of Object.entries(o.defenderAssignment)){const m=f.units[o.attacker].find(C=>C.instanceId===p);if(m&&b>0){if(Qc(m)){s.log.unshift(`${m.name} ignored combat damage (moved twice this turn).`);continue}if(m.preventNextDamageUntilTurn&&m.preventNextDamageUntilTurn>=s.turnNumber){m.preventNextDamageUntilTurn=0,s.log.unshift(`${m.name} prevented combat damage (Counter Strike).`);continue}m.damage+=b,m.killOnDamageUntilTurn&&m.killOnDamageUntilTurn>=s.turnNumber&&m.damage>0?(m.damage=999,m.killOnDamageUntilTurn=0):Xc(s)&&(m.damage=999)}}const d=Object.entries(o.attackerAssignment).reduce((p,[b,m])=>{const C=f.units[o.defender].find(_=>_.instanceId===b);if(!C)return p;const N=Pe(C,{role:"DEFENDER",alone:f.units[o.defender].length===1,game:s,battlefieldIndex:o.battlefieldIndex});return p+Math.max(0,m-N)},0),h=Object.entries(o.defenderAssignment).reduce((p,[b,m])=>{const C=f.units[o.attacker].find(_=>_.instanceId===b);if(!C)return p;const N=Pe(C,{role:"ATTACKER",alone:f.units[o.attacker].length===1,game:s,battlefieldIndex:o.battlefieldIndex});return p+Math.max(0,m-N)},0);s.lastCombatExcessDamage={[o.attacker]:d,[o.defender]:h},s.lastCombatExcessDamageTurn=s.turnNumber,s.log.unshift(`Combat damage applied at Battlefield ${o.battlefieldIndex+1}: ${o.attacker} dealt ${o.attackerTotalDamage}, ${o.defender} dealt ${o.defenderTotalDamage}.`),s.pendingDamageAssignment=null,s.combat.step="DAMAGE",ec(s)},bx=(s,o,f)=>f?!s.battlefields.some(h=>h.controller===o&&Fv(h))||f.energy<=0?f:{...f,energy:Math.max(0,f.energy-1)}:null,Pu=s=>{var de,me;if(!s)return null;const o=((((de=s.ability)==null?void 0:de.raw_text)||"")+`
`+(((me=s.ability)==null?void 0:me.effect_text)||"")).trim();if(!o)return null;const f=o.split(/\n+/).map(ae=>ae.trim()).filter(Boolean),d=f.find(ae=>/\bexhaust\b\s*:/i.test(ae))||f.find(ae=>/^\s*\[e\]\s*:/i.test(ae))||f.find(ae=>/^\s*\[t\]\s*:/i.test(ae))||f.find(ae=>/\bexhaust\b/i.test(ae)&&ae.includes(":"))||f.find(ae=>/\[\d+\]\s*,\s*\[t\]\s*:/i.test(ae))||f.find(ae=>/,\s*\[t\]\s*:/i.test(ae))||null;if(!d)return null;const h=/\bexhaust\b\s*:/i.exec(d)||/^\s*\[e\]\s*:/i.exec(d)||/^\s*\[t\]\s*:/i.exec(d)||/\[\d+\]\s*,\s*\[t\]\s*:/i.exec(d)||/,\s*\[t\]\s*:/i.exec(d);if(!h)return null;const p=d.slice(0,h.index).trim(),m=h[0].replace(/\[t\]\s*:/i,"").replace(/\[e\]\s*:/i,"").replace(/\bexhaust\b\s*:/i,"").trim(),C=(p+" "+m).trim(),N={energy:0,powerByDomain:{},powerClass:0,powerAny:0},_=C.match(/(\d+)\s*energy\b/i);if(_){const ae=parseInt(_[1],10);Number.isFinite(ae)&&ae>0&&(N.energy+=ae)}const H=C.match(/\[(\d+)\]/g);if(H)for(const ae of H){const Ve=ae.match(/\[(\d+)\]/);if(Ve){const Se=parseInt(Ve[1],10);Number.isFinite(Se)&&Se>0&&(N.energy+=Se)}}const W=/(\d+)\s*(body|calm|chaos|fury|mind|order)\s*rune\b/gi;let $;for(;$=W.exec(C);){const ae=parseInt($[1],10),Ve=ut($[2]);Number.isFinite(ae)&&ae>0&&(N.powerByDomain[Ve]=(N.powerByDomain[Ve]||0)+ae)}const Z=C.match(/(\d+)?\s*class\s*rune\b/i);if(Z){const ae=Z[1]?parseInt(Z[1],10):1;Number.isFinite(ae)&&ae>0&&(N.powerClass+=ae)}const M=(C.match(/\[C\]/gi)||[]).length;M>0&&(N.powerClass+=M);const B=C.match(/(\d+)\s*rune\s+of\s+any\s+type\b/i);if(B){const ae=parseInt(B[1],10);Number.isFinite(ae)&&ae>0&&(N.powerAny+=ae)}const Y=(C.match(/\[A\]/gi)||[]).length;Y>0&&(N.powerAny+=Y);let L=d;if(L=L.replace(/^\s*\[e\]\s*:/i,"").trim(),L=L.replace(/^\s*\[t\]\s*:/i,"").trim(),L=L.replace(/^[\s\S]*?\bexhaust\b\s*:/i,"").trim(),L=L.replace(/^\s*\[\d+\]\s*,\s*\[t\]\s*:/i,"").trim(),L=L.replace(/^[\s\S]*?,\s*\[t\]\s*:/i,"").trim(),L=L.replace(/^\s*(action|reaction)\s*[-]\s*/i,"").trim(),L=L.replace(/^\s*(?:\[[^\]]+\]\s*,?\s*)+\s*/i,"").trim(),L=L.replace(/^\s*(?:\[[^\]]+\]\s*,?\s*)+/i,"").trim(),L=L.replace(/^\s*[-]\s*/i,"").trim(),!L)return null;const ie=dt(L);return{rawLine:d,effectText:L,req:ie,cost:N}},Ap=s=>{var Z,M;const o=((((Z=s.ability)==null?void 0:Z.raw_text)||"")+" "+(((M=s.ability)==null?void 0:M.effect_text)||"")).toString();if(!o)return null;const f=o.replace(/\\/g," ").replace(/_/g," ").replace(/\s+/g," ").trim(),d=f.match(/\[repeat\]\s*([^.)\n]+)/i)||f.match(/\brepeat\b\s*([^.)\n]+)/i);if(!d)return null;const h=d[1].replace(/\(([^)]*)\)/g,"").replace(/[]/g," ").replace(/\s+/g," ").trim();if(!h)return null;const p={energy:0,powerByDomain:{},powerClass:0,powerAny:0},b=h.match(/(\d+)\s*energy\b/i);if(b){const B=parseInt(b[1],10);Number.isFinite(B)&&B>0&&(p.energy+=B)}const m=h.match(/\[(\d+)\]/g);if(m)for(const B of m){const Y=B.match(/\[(\d+)\]/);if(Y){const L=parseInt(Y[1],10);Number.isFinite(L)&&L>0&&(p.energy+=L)}}const C=/(\d+)\s*(body|calm|chaos|fury|mind|order)\s*rune\b/gi;let N;for(;N=C.exec(h);){const B=parseInt(N[1],10),Y=ut(N[2]);Number.isFinite(B)&&B>0&&(p.powerByDomain[Y]=(p.powerByDomain[Y]||0)+B)}const _=h.match(/(\d+)?\s*class\s*rune\b/i);if(_){const B=_[1]?parseInt(_[1],10):1;Number.isFinite(B)&&B>0&&(p.powerClass+=B)}const H=(h.match(/\[C\]/gi)||[]).length;H>0&&(p.powerClass+=H);const W=h.match(/(\d+)\s*(?:any\s+rune|rune\s+of\s+any\s+type)\b/i);if(W){const B=parseInt(W[1],10);Number.isFinite(B)&&B>0&&(p.powerAny+=B)}const $=(h.match(/\[A\]/gi)||[]).length;return $>0&&(p.powerAny+=$),p.energy===0&&p.powerClass===0&&p.powerAny===0&&Object.keys(p.powerByDomain).length===0?null:p},Lu=s=>{var ie,de;if(!s)return null;const o=((((ie=s.ability)==null?void 0:ie.raw_text)||"")+`
`+(((de=s.ability)==null?void 0:de.effect_text)||"")).trim();if(!o)return null;const f=o.split(/\n+/).map(me=>me.trim()).filter(Boolean),d=f.find(me=>/exhaust\s*:/i.test(me)||/^\s*\[t\]\s*:/i.test(me)||/^\s*\[e\]\s*:/i.test(me)||/\bkill this\b/i.test(me))||f.find(me=>me.includes(":"))||null;if(!d||!d.includes(":"))return null;const h=d.split(":"),p=h[0]||"",b=h.slice(1).join(":")||"",m=p.replace(/\s+/g," ").trim(),C={energy:0,powerByDomain:{},powerClass:0,powerAny:0,exhaustSelf:/\bexhaust\b|\[t\]|\[e\]/i.test(m),killSelf:/\bkill\s+this\b|\bsacrifice\b/i.test(m)},N=m.match(/(\d+)\s*energy\b/i);if(N){const me=parseInt(N[1],10);Number.isFinite(me)&&me>0&&(C.energy+=me)}const _=m.match(/\[(\d+)\]/g);if(_)for(const me of _){const ae=me.match(/\[(\d+)\]/);if(ae){const Ve=parseInt(ae[1],10);Number.isFinite(Ve)&&Ve>0&&(C.energy+=Ve)}}const H=/(\d+)\s*(body|calm|chaos|fury|mind|order)\s*rune\b/gi;let W;for(;W=H.exec(m);){const me=parseInt(W[1],10),ae=ut(W[2]);Number.isFinite(me)&&me>0&&(C.powerByDomain[ae]=(C.powerByDomain[ae]||0)+me)}const $=m.match(/(\d+)?\s*class\s*rune\b/i);if($){const me=$[1]?parseInt($[1],10):1;Number.isFinite(me)&&me>0&&(C.powerClass+=me)}const Z=(m.match(/\[C\]/gi)||[]).length;Z>0&&(C.powerClass+=Z);const M=m.match(/(\d+)\s*(?:any\s+rune|rune\s+of\s+any\s+type)\b/i);if(M){const me=parseInt(M[1],10);Number.isFinite(me)&&me>0&&(C.powerAny+=me)}const B=(m.match(/\[A\]/gi)||[]).length;B>0&&(C.powerAny+=B);let Y=b.trim();if(Y=Y.replace(/^\s*(action|reaction)\s*[-]\s*/i,"").trim(),Y=Y.replace(/^\s*(?:\[[^\]]+\]\s*,?\s*)+\s*/i,"").trim(),Y=Y.replace(/^\s*(?:\[[^\]]+\]\s*,?\s*)+/i,"").trim(),Y=Y.replace(/^\s*[-]\s*/i,"").trim(),!Y)return null;const L=dt(Y);return{rawLine:d,effectText:Y,req:L,cost:C}},Cp=(s,o,f,d)=>{var me,ae,Ve;const h=s.players[o];if(!h.legend)return!1;if(s.priorityPlayer!==o)return s.log.unshift("You must have priority to activate your Legend."),!1;const p=s.chain[s.chain.length-1];if(p&&p.needsTargets&&p.controller===o){const Se=(me=p.targets)==null?void 0:me[0];if(!Se||Se.kind==="NONE")return s.log.unshift("Choose targets for your pending chain item first."),!1}if(!h.legendReady)return s.log.unshift("Legend is exhausted."),!1;if(!h.legend)return!1;const b=`${((ae=h.legend.ability)==null?void 0:ae.raw_text)||""} ${((Ve=h.legend.ability)==null?void 0:Ve.effect_text)||""}`;if(/\[\s*legion\s*\]/i.test(b)&&/\[t\]\s*:|\[e\]\s*:|\bexhaust\b\s*:/i.test(b)&&h.mainDeckCardsPlayedThisTurn<1)return s.log.unshift("Legend Legion ability is inactive (play another card this turn first)."),!1;let C=Pu(h.legend);if(C||s.battlefields.some(Qe=>Qe.controller===o&&Wd(Qe))&&(C={rawLine:"Forge of the Fluft",effectText:"Attach an equipment you control to a unit you control.",req:{kind:"UNIT_AND_GEAR_FRIENDLY"},cost:{energy:0,powerByDomain:{},powerClass:0,powerAny:0}}),!C)return s.log.unshift("Legend has no activated Exhaust ability the emulator can parse yet."),!1;const N=Wo(C.rawLine);if(!Ta(s,o,N))return N==="REACTION"?s.log.unshift("Legend ability can only be used as a Reaction right now."):N==="ACTION"?s.log.unshift("Legend ability can only be used as an Action (your turn or showdown with priority)."):s.log.unshift("Legend ability can only be used at main action speed."),!1;const _=C.effectText,H=C.req,W=f&&f.length?f:[{kind:"NONE"}],$=!!(d!=null&&d.autoPay),Z=C.cost.energy||0;if(Z>0){if(h.runePool.energy<Z&&$){let Se=Z-h.runePool.energy;const Qe=h.runesInPlay.filter(it=>it.isReady);let Je=0;for(const it of Qe){if(Se<=0)break;it.isReady=!1,h.runePool.energy+=1,Se-=1,Je+=1}Je>0&&s.log.unshift(`${o} auto-exhausted ${Je} rune(s) to pay Legend energy cost.`)}if(h.runePool.energy<Z)return s.log.unshift(`Not enough energy to activate Legend (need ${Z}).`),!1;h.runePool.energy-=Z,s.log.unshift(`${o} paid ${Z} energy for Legend activation.`)}const M=C.cost.powerByDomain||{};for(const Se of Object.keys(M)){const Qe=M[Se]||0;if(!(Qe<=0)){if((h.runePool.power[Se]||0)<Qe&&$){let Je=Qe-(h.runePool.power[Se]||0);const it=h.runesInPlay.filter(Rt=>Rt.domain===Se);let He=0;for(const Rt of it){if(Je<=0)break;al(s,o,Rt.instanceId),Je-=1,He+=1}He>0&&s.log.unshift(`${o} auto-recycled ${He} ${Se} rune(s) to pay Legend power cost.`)}if((h.runePool.power[Se]||0)<Qe)return s.log.unshift(`Not enough ${Se} power to activate Legend (need ${Qe}).`),!1;h.runePool.power[Se]-=Qe,s.log.unshift(`${o} paid ${Qe} ${Se} power for Legend activation.`)}}const B=C.cost.powerClass||0;if(B>0){const Se=ds(s,o);if(Rm(h.runePool,Se)<B&&$){let Je=B-Rm(h.runePool,Se);const it=h.runesInPlay.filter(Rt=>Se.includes(Rt.domain));let He=0;for(const Rt of it){if(Je<=0)break;al(s,o,Rt.instanceId),Je-=1,He+=1}He>0&&s.log.unshift(`${o} auto-recycled ${He} rune(s) to pay Legend class power cost.`)}const Qe=Kt(h.runePool,B,Se);if(!Qe)return s.log.unshift(`Not enough class power to activate Legend (need ${B}).`),!1;for(const Je of Se){const it=Qe.payment[Je]||0;it>0&&(h.runePool.power[Je]-=it)}s.log.unshift(`${o} paid ${B} class power for Legend activation.`)}const Y=C.cost.powerAny||0;if(Y>0){const Se=["Body","Calm","Chaos","Fury","Mind","Order","Colorless"];if(gc(h.runePool)<Y&&$){let Je=Y-gc(h.runePool);const it=[...h.runesInPlay];let He=0;for(const Rt of it){if(Je<=0)break;al(s,o,Rt.instanceId),Je-=1,He+=1}He>0&&s.log.unshift(`${o} auto-recycled ${He} rune(s) to pay Legend any-power cost.`)}const Qe=Kt(h.runePool,Y,Se);if(!Qe)return s.log.unshift(`Not enough power to activate Legend (need ${Y}).`),!1;for(const Je of Se){const it=Qe.payment[Je]||0;it>0&&(h.runePool.power[Je]-=it)}s.log.unshift(`${o} paid ${Y} power (any) for Legend activation.`)}h.legendReady=!1;const L=_.replace(/\[\s*add\s*\]\s*/gi,"add ");if(/\badd\s+\d+\s+energy\b/i.test(L)||/\badd\s+(?:\d+\s+)?(body|calm|chaos|fury|mind|order|class)\s+rune\b/i.test(L)||/\badd\s+\d+\s+rune\s+of\s+any\s+type\b/i.test(L)){const Se=Be("res");return Ea(s,o,_,W,{battlefieldIndex:s.windowBattlefieldIndex??null,sourceCardName:h.legend.name,resolutionId:Se,resumePost:{cleanup:!0,maybeOpenWindow:!0,setOpenState:!0,priorityPlayer:o}})==="PENDING_OPTIONAL"?(s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o,!0):(s.log.unshift(`${o} activated Legend ability (${h.legend.name}).`),gt(s),bn(s),s.state="OPEN",s.passesInRow=0,s.priorityPlayer=o,!0)}const de={id:Be("chain"),controller:o,kind:"ACTIVATED_ABILITY",label:`Legend  ${h.legend.name}`,effectText:_,contextBattlefieldIndex:s.windowBattlefieldIndex??null,targets:W,needsTargets:H.kind!=="NONE"&&(!W[0]||W[0].kind==="NONE"),targetRequirement:H,sourceCardType:"Legend"};return s.chain.push(de),s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o,s.log.unshift(`${o} activated Legend ability (${h.legend.name}).`),gt(s),bn(s),!0},xx=(s,o)=>{const f=s.players[o];if(!f.legend)return{ok:!1,reason:"No legend available."};let d=Pu(f.legend);if(d||s.battlefields.some(b=>b.controller===o&&Wd(b))&&(d={rawLine:"Forge of the Fluft",effectText:"Attach an equipment you control to a unit you control.",req:{kind:"UNIT_AND_GEAR_FRIENDLY"},cost:{energy:0,powerByDomain:{},powerClass:0,powerAny:0}}),!d)return{ok:!1,reason:"Legend activated Exhaust ability not supported yet."};const h=Wo(d.rawLine);return Ta(s,o,h)?{ok:!0,reason:"Activate Legend"}:h==="REACTION"?{ok:!1,reason:"Legend ability is Reaction-speed only right now."}:h==="ACTION"?{ok:!1,reason:"Legend ability is Action-speed only right now."}:{ok:!1,reason:"Legend ability is main action speed only."}},Ex=(s,o,f,d,h)=>{var L;if(s.priorityPlayer!==o)return s.log.unshift("You must have priority to activate gear."),!1;const p=s.chain[s.chain.length-1];if(p&&p.needsTargets&&p.controller===o){const ie=(L=p.targets)==null?void 0:L[0];if(!ie||ie.kind==="NONE")return s.log.unshift("Choose targets for your pending chain item first."),!1}const b=rs(s,o,f);if(!b)return s.log.unshift("Gear not found."),!1;const m=b.gear,C=Lu(m);if(!C)return s.log.unshift("Gear has no activated ability the emulator can parse yet."),!1;const N=Wo(C.rawLine);if(!Ta(s,o,N))return N==="REACTION"?s.log.unshift(`${m.name} can only be used as a Reaction right now.`):N==="ACTION"?s.log.unshift(`${m.name} can only be used as an Action (your turn or showdown with priority).`):s.log.unshift(`${m.name} can only be used at main action speed.`),!1;const _=!!(h!=null&&h.autoPay);if(C.cost.exhaustSelf&&!m.isReady)return s.log.unshift(`${m.name} is exhausted.`),!1;if(C.cost.energy>0){if(s.players[o].runePool.energy<C.cost.energy&&_){let ie=C.cost.energy-s.players[o].runePool.energy;const de=s.players[o].runesInPlay.filter(ae=>ae.isReady);let me=0;for(const ae of de){if(ie<=0)break;ae.isReady=!1,s.players[o].runePool.energy+=1,ie-=1,me+=1}me>0&&s.log.unshift(`${o} auto-exhausted ${me} rune(s) to pay gear energy cost.`)}if(s.players[o].runePool.energy<C.cost.energy)return s.log.unshift(`Not enough energy to activate ${m.name}.`),!1;s.players[o].runePool.energy-=C.cost.energy}for(const ie of Object.keys(C.cost.powerByDomain)){const de=C.cost.powerByDomain[ie]||0;if(!(de<=0)){if((s.players[o].runePool.power[ie]||0)<de&&_){let me=de-(s.players[o].runePool.power[ie]||0);const ae=s.players[o].runesInPlay.filter(Se=>Se.domain===ie);let Ve=0;for(const Se of ae){if(me<=0)break;al(s,o,Se.instanceId),me-=1,Ve+=1}Ve>0&&s.log.unshift(`${o} auto-recycled ${Ve} ${ie} rune(s) to pay gear power cost.`)}if((s.players[o].runePool.power[ie]||0)<de)return s.log.unshift(`Not enough ${ie} power to activate ${m.name}.`),!1;s.players[o].runePool.power[ie]-=de}}if(C.cost.powerClass>0){const ie=ds(s,o),de=Kt(s.players[o].runePool,C.cost.powerClass,ie);if(!de)return s.log.unshift(`Not enough class power to activate ${m.name}.`),!1;for(const me of ie){const ae=de.payment[me]||0;ae>0&&(s.players[o].runePool.power[me]-=ae)}}if(C.cost.powerAny>0){const ie=["Body","Calm","Chaos","Fury","Mind","Order","Colorless"],de=Kt(s.players[o].runePool,C.cost.powerAny,ie);if(!de)return s.log.unshift(`Not enough power to activate ${m.name}.`),!1;for(const me of ie){const ae=de.payment[me]||0;ae>0&&(s.players[o].runePool.power[me]-=ae)}}if(C.cost.exhaustSelf&&(m.isReady=!1),C.cost.killSelf){const ie=Ec(s,o,m.instanceId);ie&&s.players[o].trash.push(ie)}const H=C.effectText,W=C.req,$=d&&d.length?d:[{kind:"NONE"}],Z=H.replace(/\[\s*add\s*\]\s*/gi,"add "),M=/\badd\s+\d+\s+energy\b/i.test(Z)||/\badd\s+(?:\d+\s+)?(body|calm|chaos|fury|mind|order|class)\s+rune\b/i.test(Z)||/\badd\s+\d+\s+rune\s+of\s+any\s+type\b/i.test(Z),B=(()=>{if(b.zone==="BF")return b.battlefieldIndex??null;if(b.zone==="ATTACHED"&&b.unit){const ie=Me(s,b.unit.owner,b.unit.instanceId);return(ie==null?void 0:ie.zone)==="BF"?ie.battlefieldIndex??null:null}return null})();if(M){const ie=Be("res");return Ea(s,o,H,$,{battlefieldIndex:B,sourceCardName:m.name,sourceCardType:"Gear",sourceInstanceId:m.instanceId,resolutionId:ie,resumePost:{cleanup:!0,maybeOpenWindow:!0,setOpenState:!0,priorityPlayer:o}})==="PENDING_OPTIONAL"?(s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o,!0):(s.log.unshift(`${o} activated gear ability (${m.name}).`),gt(s),bn(s),s.state="OPEN",s.passesInRow=0,s.priorityPlayer=o,!0)}const Y={id:Be("chain"),controller:o,kind:"ACTIVATED_ABILITY",label:`Gear  ${m.name}`,effectText:H,contextBattlefieldIndex:B,targets:$,needsTargets:W.kind!=="NONE"&&(!$[0]||$[0].kind==="NONE"),targetRequirement:W,sourceInstanceId:m.instanceId,sourceCardType:"Gear"};return s.chain.push(Y),s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o,s.log.unshift(`${o} activated gear ability (${m.name}).`),gt(s),bn(s),!0},Ip=(s,o)=>{var f,d,h;switch(o.type){case"NEXT_STEP":Ep(s,o.player);return;case"PASS_PRIORITY":Un(s,o.player);return;case"MULLIGAN_CONFIRM":Rp(s,o.player,o.recycleIds);return;case"SET_CHAIN_TARGETS":Dp(s,o.player,o.chainItemId,o.targets);return;case"OPTIONAL_CHOICE":{const p=s.pendingOptionalChoice;if(!p||p.id!==o.choiceId||p.player!==o.player)return;s.optionalChoiceResults||(s.optionalChoiceResults={}),s.optionalChoiceResults[p.id]={accepted:o.accept,value:o.value};const b=p.resume,m=p.resumeDelayedEvent;if(s.pendingOptionalChoice=null,!b)return;if(b.kind==="CHAIN"){Wa(s);return}if(Ea(s,b.controller,b.effectText,b.targets,b.ctx)==="PENDING_OPTIONAL"){m&&s.pendingOptionalChoice&&(s.pendingOptionalChoice.resumeDelayedEvent=m);return}if((f=b.post)!=null&&f.cleanup&&gt(s),(d=b.post)!=null&&d.maybeOpenWindow&&bn(s),(h=b.post)!=null&&h.setOpenState&&(s.state="OPEN",s.passesInRow=0,s.priorityPlayer=b.post.priorityPlayer??b.controller),m){const N=Me(s,m.unitOwner,m.unitInstanceId);N&&N.unit&&Xr(s,m.event,N.unit,{battlefieldIndex:m.battlefieldIndex??null,alone:m.alone},{skipTriggerIds:m.skipTriggerIds})}return}case"HIDE_CARD":kp(s,o.player,o.cardInstanceId,o.battlefieldIndex,{autoPay:o.autoPay}),gt(s),bn(s);return;case"STANDARD_MOVE":_p(s,o.player,o.from,o.unitIds,o.to),gt(s),bn(s);return;case"PLAY_CARD":{const p=Ya(s,o.player,{source:o.source,cardInstanceId:o.cardInstanceId,fromBattlefieldIndex:o.fromBattlefieldIndex,destination:o.destination??null,accelerate:o.accelerate,targets:o.targets,repeatCount:o.repeatCount,payOptionalAdditionalCost:o.payOptionalAdditionalCost,additionalDiscardIds:o.additionalDiscardIds},{autoPay:o.autoPay});!p.ok&&p.reason&&s.log.unshift(`Play failed: ${p.reason}`);return}case"RUNE_EXHAUST":fx(s,o.player,o.runeInstanceId);return;case"RUNE_RECYCLE":al(s,o.player,o.runeInstanceId);return;case"SEAL_EXHAUST":hx(s,o.player,o.gearInstanceId);return;case"LEGEND_ACTIVATE":Cp(s,o.player,o.targets,{autoPay:o.autoPay});return;case"GEAR_ACTIVATE":Ex(s,o.player,o.gearInstanceId,o.targets,{autoPay:o.autoPay});return;case"EQUIP_START":Tp(s,o.player,o.gearInstanceId);return;case"EQUIP_CONFIRM":vp(s,o.player,o.unitInstanceId);return;case"EQUIP_CANCEL":s.pendingEquipChoice=null,s.log.unshift(`${o.player} cancelled equipment attachment.`);return;case"DAMAGE_ASSIGN":mx(s,o.player,o.assignment);return;case"DAMAGE_CONFIRM":gx(s,o.player);return;case"DAMAGE_AUTO_ASSIGN":Mu(s,o.player);return;case"KILL_GEAR_ACTIVATE":px(s,o.player,o.gearInstanceId);return;case"SPEND_MY_BUFF_ACTIVATE":yx(s,o.player,o.unitInstanceId);return;case"CULL_CHOOSE":ju(s,o.player,o.unitInstanceId);return;case"REVEAL_WINDOW_CONFIRM":s.pendingRevealWindow&&s.pendingRevealWindow.player===o.player&&(s.pendingRevealWindow=null);return;default:return}},Sp=s=>{if(!s||typeof s!="object")return null;const o=s.type,f=s.player;if(typeof o!="string"||!wm(f))return null;switch(o){case"NEXT_STEP":case"PASS_PRIORITY":return{type:o,player:f};case"MULLIGAN_CONFIRM":{const d=s.recycleIds,h=Array.isArray(d)?d.filter(p=>typeof p=="string"):[];return{type:"MULLIGAN_CONFIRM",player:f,recycleIds:h}}case"SET_CHAIN_TARGETS":{const d=typeof s.chainItemId=="string"?s.chainItemId:"",h=Array.isArray(s.targets)?s.targets:[{kind:"NONE"}];return d?{type:"SET_CHAIN_TARGETS",player:f,chainItemId:d,targets:h}:null}case"OPTIONAL_CHOICE":{const d=typeof s.choiceId=="string"?s.choiceId:"";if(!d)return null;const h=!!s.accept,p=s.value,b=Number.isFinite(p)?Number(p):void 0;return{type:"OPTIONAL_CHOICE",player:f,choiceId:d,accept:h,value:b}}case"PLAY_CARD":{const d=s.source;if(d!=="HAND"&&d!=="CHAMPION"&&d!=="FACEDOWN")return null;const h=typeof s.cardInstanceId=="string"?s.cardInstanceId:"";if(!h)return null;const p=typeof s.fromBattlefieldIndex=="number"?s.fromBattlefieldIndex:void 0,b=s.destination??null,m=s.accelerate,C=Array.isArray(s.targets)?s.targets:void 0,N=s.repeatCount,_=Number.isFinite(N)?Math.max(0,Math.floor(N)):void 0,H=typeof s.payOptionalAdditionalCost=="boolean"?!!s.payOptionalAdditionalCost:void 0,W=s.additionalDiscardIds,$=Array.isArray(W)?W.filter(M=>typeof M=="string"):void 0,Z=!!s.autoPay;return{type:"PLAY_CARD",player:f,source:d,cardInstanceId:h,fromBattlefieldIndex:p,destination:b,accelerate:m,targets:C,repeatCount:_,payOptionalAdditionalCost:H,additionalDiscardIds:$,autoPay:Z}}case"HIDE_CARD":{const d=typeof s.cardInstanceId=="string"?s.cardInstanceId:"",h=typeof s.battlefieldIndex=="number"?s.battlefieldIndex:NaN;if(!d||!Number.isFinite(h))return null;const p=!!s.autoPay;return{type:"HIDE_CARD",player:f,cardInstanceId:d,battlefieldIndex:h,autoPay:p}}case"STANDARD_MOVE":{const d=s.from,h=s.to,p=s.unitIds,b=Array.isArray(p)?p.filter(m=>typeof m=="string"):[];return!d||!h||b.length===0?null:{type:"STANDARD_MOVE",player:f,from:d,to:h,unitIds:b}}case"RUNE_EXHAUST":case"RUNE_RECYCLE":{const d=typeof s.runeInstanceId=="string"?s.runeInstanceId:"";return d?{type:o,player:f,runeInstanceId:d}:null}case"SEAL_EXHAUST":{const d=typeof s.gearInstanceId=="string"?s.gearInstanceId:"";return d?{type:"SEAL_EXHAUST",player:f,gearInstanceId:d}:null}case"LEGEND_ACTIVATE":{const d=Array.isArray(s.targets)?s.targets:void 0,h=!!s.autoPay;return{type:"LEGEND_ACTIVATE",player:f,targets:d,autoPay:h}}case"GEAR_ACTIVATE":{const d=typeof s.gearInstanceId=="string"?s.gearInstanceId:"";if(!d)return null;const h=Array.isArray(s.targets)?s.targets:void 0,p=!!s.autoPay;return{type:"GEAR_ACTIVATE",player:f,gearInstanceId:d,targets:h,autoPay:p}}case"EQUIP_START":{const d=typeof s.gearInstanceId=="string"?s.gearInstanceId:"";return d?{type:"EQUIP_START",player:f,gearInstanceId:d}:null}case"EQUIP_CONFIRM":{const d=typeof s.unitInstanceId=="string"?s.unitInstanceId:"";return d?{type:"EQUIP_CONFIRM",player:f,unitInstanceId:d}:null}case"EQUIP_CANCEL":return{type:"EQUIP_CANCEL",player:f};case"DAMAGE_ASSIGN":{const d=s.assignment;return!d||typeof d!="object"?null:{type:"DAMAGE_ASSIGN",player:f,assignment:d}}case"DAMAGE_CONFIRM":return{type:"DAMAGE_CONFIRM",player:f};case"DAMAGE_AUTO_ASSIGN":return{type:"DAMAGE_AUTO_ASSIGN",player:f};case"KILL_GEAR_ACTIVATE":{const d=typeof s.gearInstanceId=="string"?s.gearInstanceId:"";return d?{type:"KILL_GEAR_ACTIVATE",player:f,gearInstanceId:d}:null}case"SPEND_MY_BUFF_ACTIVATE":{const d=typeof s.unitInstanceId=="string"?s.unitInstanceId:"";return d?{type:"SPEND_MY_BUFF_ACTIVATE",player:f,unitInstanceId:d}:null}case"CULL_CHOOSE":{const d=typeof s.unitInstanceId=="string"?s.unitInstanceId:"";return d?{type:"CULL_CHOOSE",player:f,unitInstanceId:d}:null}case"REVEAL_WINDOW_CONFIRM":return{type:"REVEAL_WINDOW_CONFIRM",player:f,selectedIds:s.selectedIds};default:return null}},Ge=s=>{if(!A)return;const o=Sp(s);o&&Lt(f=>{Ip(f,o),f.actionHistory||(f.actionHistory=[]),f.actionHistory.push(o),f.actionHistory.length>4e3&&f.actionHistory.shift()})};he.useEffect(()=>{typeof window<"u"&&(window.__RB_DISPATCH__=Ge,window.__RB_GAME__=A,window.__RB_SET_GAME__=i,window.__RB_ALL_CARDS__=e,window.__RB_APPLY__=Ip,window.__RB_SANITIZE__=Sp)},[A,e]);const vo=(s,o,f,d="HAND")=>{if(f.type!=="Spell")return!0;const h=hp(f,d);return Ta(s,o,h)},Dp=(s,o,f,d)=>{const h=s.chain.find(_=>_.id===f);if(!h||h.controller!==o)return;const p={kind:"NONE"},b=d&&d.length>0?d:[p],m=h.targetRequirement,C=b.filter(_=>_.kind!=="NONE").length;if(h.needsTargets&&C===0){h.targets=[{kind:"NONE"}],h.needsTargets=!1,m!=null&&m.optional?s.log.unshift(`${o} chose no targets for: ${h.label}`):s.log.unshift("No valid targets; skipping target selection.");return}const N=h.restrictTargetsToBattlefieldIndex??null;if(N!=null&&b[0]){if(b[0].kind==="UNIT"){const _=Me(s,b[0].owner,b[0].instanceId);if(!_||_.zone!=="BF"||_.battlefieldIndex!==N){s.log.unshift("AI: hidden restriction prevented illegal target; choosing NONE."),h.targets=[{kind:"NONE"}],h.needsTargets=!1;return}}if(b[0].kind==="BATTLEFIELD"&&b[0].index!==N){s.log.unshift("AI: hidden restriction prevented illegal battlefield target; choosing NONE."),h.targets=[{kind:"NONE"}],h.needsTargets=!1;return}}if(h.kind==="TRIGGERED_ABILITY"||h.kind==="ACTIVATED_ABILITY"){const _=s.players[o].runePool,H=new Map;for(const W of b){if(W.kind!=="UNIT")continue;const $=Me(s,W.owner,W.instanceId);if(!$)continue;const Z=$.unit;if(Z.controller===o)continue;const M=Bm(Z);M<=0||H.set(Z.instanceId,{controller:Z.controller,amount:M})}if(H.size>0){const W=Array.from(H.values()).reduce((M,B)=>M+B.amount,0);if(Object.values(_.power).reduce((M,B)=>M+(B||0),0)<W){s.log.unshift("Cannot pay Deflect tax for ability targets.");return}let Z=W;for(const M of Object.keys(_.power)){for(;Z>0&&(_.power[M]||0)>0;)_.power[M]-=1,Z-=1;if(Z<=0)break}for(const M of H.values())M.controller!==o&&(s.players[M.controller].runePool.power.Colorless+=M.amount);s.log.unshift(`${o} paid ${W} power for Deflect.`)}}h.targets=b,h.needsTargets=!1,s.passesInRow=0,s.priorityPlayer=h.controller,s.log.unshift(`${o} chose targets for: ${h.label}`)},Rp=(s,o,f)=>{if(s.step!=="MULLIGAN")return;const d=s.players[o];if(d.mulliganDone)return;const h=new Set(f.slice(0,2)),p=d.hand.filter(m=>h.has(m.instanceId));d.hand=d.hand.filter(m=>!h.has(m.instanceId));const b=Hi(p,s.turnNumber+(o==="P1"?7:11));d.mainDeck.push(...b),an(s,o,b.length),d.mulliganDone=!0,d.mulliganSelectedIds=[],s.log.unshift(`${o} mulligan confirmed (${b.length} recycled, ${b.length} drawn).`),s.players.P1.mulliganDone&&s.players.P2.mulliganDone&&(s.players.P1.scoredBattlefieldsThisTurn=[],s.players.P2.scoredBattlefieldsThisTurn=[],s.players.P1.mainDeckCardsPlayedThisTurn=0,s.players.P2.mainDeckCardsPlayedThisTurn=0,s.step="AWAKEN",s.priorityPlayer=s.turnPlayer,s.state="OPEN",s.passesInRow=0,s.log.unshift(`Turn ${s.turnNumber} begins for ${s.turnPlayer}.`))},kp=(s,o,f,d,h)=>{var M;if(s.step!=="ACTION"||s.turnPlayer!==o||s.windowKind!=="NONE"||s.chain.length>0||s.state!=="OPEN")return;const p=s.players[o],b=p.hand.findIndex(B=>B.instanceId===f);if(b<0)return;const m=p.hand[b];if(!Sm(m))return;const C=s.battlefields[d],N=C.facedown&&qd(C)&&!C.facedownExtra;if(C.facedown&&!N||C.controller!==o)return;const _=ex,H=((M=p.legend)==null?void 0:M.name)==="Swift Scout";let W=Kt(p.runePool,1,_)!==null,$=H&&p.runePool.energy>=1,Z=W||$;if(!W&&!$&&(h!=null&&h.autoPay)){const B=Zo(p.runePool,p.runesInPlay,{energyNeed:0,basePowerNeed:0,powerDomainsAllowed:_,additionalPowerByDomain:{},additionalPowerAny:1},{sealExhaustedThisTurn:p.sealExhaustedThisTurn,seals:p.base.gear,playerDomains:p.domains});B&&(Object.keys(B.runeUses).length>0||B.sealUses.length>0)&&(Kd(s,o,B),s.log.unshift(`${o} auto-paid the Hide cost.`)),W=Kt(p.runePool,1,_)!==null,Z=W||$}if(Z){if(W){const B=Kt(p.runePool,1,_);for(const Y of Object.keys(B.payment))p.runePool.power[Y]-=B.payment[Y]}else $&&(p.runePool.energy-=1,s.log.unshift(`${o} paid 1 energy to hide a card (Swift Scout).`));p.hand.splice(b,1),N?(C.facedownExtra={card:m,owner:o,hiddenOnTurn:s.turnNumber,markedForRemoval:!1},s.log.unshift(`${o} hid an extra card at Battlefield ${d+1}.`)):(C.facedown={card:m,owner:o,hiddenOnTurn:s.turnNumber,markedForRemoval:!1},s.log.unshift(`${o} hid a card at Battlefield ${d+1}.`))}},_p=(s,o,f,d,h)=>{if(s.step!=="ACTION"||s.turnPlayer!==o||s.windowKind!=="NONE"||s.chain.length>0||s.state!=="OPEN"||d.length===0)return;const p=s.players[o],b=$=>$.kind==="BASE"?p.base.units:s.battlefields[$.index].units[o],m=$=>$.kind==="BASE"?p.base.units:s.battlefields[$.index].units[o],C=b(f),N=[];for(const $ of d){const Z=C.findIndex(B=>B.instanceId===$);if(Z<0)continue;const M=C[Z];if(!M.isReady)return;N.push(M)}if(N.length===0)return;if(f.kind==="BF"&&h.kind==="BASE"){const $=s.battlefields[f.index];if(ns($)){s.log.unshift(`${$.card.name} prevents moving units from this battlefield to base.`);return}}if(f.kind!=="BASE"&&h.kind!=="BASE"&&f.index!==h.index&&!N.every(Z=>lt(Z,"Ganking")))return;const _=new Set(d),H=C.filter($=>!_.has($.instanceId));f.kind==="BASE"?p.base.units=H:s.battlefields[f.index].units[o]=H;for(const $ of N)$.isReady=!1,$.moveCountThisTurn+=1;if(m(h).push(...N),s.log.unshift(`${o} moved ${N.length} unit(s) from ${f.kind==="BASE"?"Base":`Battlefield ${f.index+1}`} to ${h.kind==="BASE"?"Base":`Battlefield ${h.index+1}`}.`),h.kind==="BF"){const $=s.battlefields[h.index];$.controller!==o&&($.contestedBy=o)}xa(s,o,N,f,h),ba(s,o,N,h.kind==="BF"?h.index:"BASE")},Ya=(s,o,f,d)=>{var je,Xe,Ze,un,Mi,si;if(s.step==="GAME_OVER")return{ok:!1,reason:"Game over"};const h=s.players[o];if(h.opponentCantPlayCardsThisTurn)return{ok:!1,reason:"Can't play cards this turn"};f.source!=="FACEDOWN"&&s.step!=="MULLIGAN"&&s.step!=="ACTION"&&s.step!=="DRAW"&&s.step!=="CHANNEL"&&s.step!=="SCORING"&&s.step;let p=null,b="",m=null,C=!1;if(f.source==="HAND"){const ge=h.hand.findIndex(be=>be.instanceId===f.cardInstanceId);if(ge<0)return{ok:!1,reason:"Card not in hand"};p=h.hand[ge],b="hand"}else if(f.source==="CHAMPION"){if(!h.championZone||h.championZone.instanceId!==f.cardInstanceId)return{ok:!1,reason:"Champion not available"};p=h.championZone,b="champion"}else{const ge=f.fromBattlefieldIndex??null;if(ge==null)return{ok:!1,reason:"Missing battlefield index"};const be=s.battlefields[ge],D=be.facedown&&be.facedown.card.instanceId===f.cardInstanceId?be.facedown:be.facedownExtra&&be.facedownExtra.card.instanceId===f.cardInstanceId?be.facedownExtra:be.facedown;if(!D||D.owner!==o)return{ok:!1,reason:"No facedown card"};if(D.hiddenOnTurn===s.turnNumber)return{ok:!1,reason:"Cannot play hidden same turn"};p=D.card,b=`facedown @ BF${ge+1}`,m=ge,C=!0}if(!p)return{ok:!1,reason:"No card"};if(!vo(s,o,p,f.source))return{ok:!1,reason:"Spell timing"};if(p.type!=="Spell"&&!Ko(p,s,o,f.source))return{ok:!1,reason:"Non-spell timing"};const N=h.mainDeckCardsPlayedThisTurn>0,_=lt(p,"Legion")&&N;let H={kind:"NONE"};p.type==="Spell"&&(H=dt(ga(p)));const W=f.targets&&f.targets.length>0?f.targets:[{kind:"NONE"}];if(p.type==="Spell"&&H.kind!=="NONE"&&!H.optional&&(!W[0]||W[0].kind==="NONE"))return{ok:!1,reason:"Missing target"};const $=C?m:null;if($!=null&&W[0]&&W[0].kind!=="NONE"){if(W[0].kind==="UNIT"){const ge=Me(s,W[0].owner,W[0].instanceId);if(!ge||ge.zone!=="BF"||ge.battlefieldIndex!==$)return{ok:!1,reason:"Hidden restriction target"}}if(W[0].kind==="BATTLEFIELD"&&W[0].index!==$)return{ok:!1,reason:"Hidden restriction battlefield"}}let Z=f.destination??null;if(p.type==="Unit"){if((!Z||Z.kind===void 0)&&(Z={kind:"BASE"}),Z.kind==="BF"){const ge=s.battlefields[Z.index];if(bl(ge))return{ok:!1,reason:"Units can't be played here"};if(!C&&ge.controller!==o)return{ok:!1,reason:"Must control battlefield to deploy"};const be=xt(o);if(s.battlefields.some(z=>z.units[be].some(ye=>{var Ae,Ht;const De=`${((Ae=ye.ability)==null?void 0:Ae.effect_text)||""} ${((Ht=ye.ability)==null?void 0:Ht.raw_text)||""}`.toLowerCase();return De.includes("while i'm at a battlefield")&&De.includes("opponents can only play units to their base")})))return{ok:!1,reason:"Unit deployment restricted (Mageseeker Warden)"}}C&&(Z={kind:"BF",index:m})}if(p.type==="Gear"&&(C?Z={kind:"BF",index:m}:Z={kind:"BASE"}),p.type==="Unit"&&Z&&Z.kind==="BF"){const ge=s.battlefields[Z.index];if(bl(ge))return{ok:!1,reason:"Units can't be played here"}}const M=!!((je=f.accelerate)!=null&&je.pay)&&p.type==="Unit"&&lt(p,"Accelerate"),B=M&&((Xe=f.accelerate)==null?void 0:Xe.domain)||null,Y=Yt(p.domain).map(ut).filter(ge=>ge!=="Colorless"),L=Y.length>0?Y:h.domains,ie=new Map;if(p.type==="Spell")for(const ge of W){if(ge.kind!=="UNIT")continue;const be=Me(s,ge.owner,ge.instanceId);if(!be)continue;const D=be.unit;if(D.controller===o)continue;const z=Bm(D);z<=0||ie.set(D.controller,(ie.get(D.controller)||0)+z)}const de=Array.from(ie.values()).reduce((ge,be)=>ge+be,0),me=_?$v(p):0;let ae=C?0:me>0?Math.max(0,(p.cost??0)-me):void 0,Ve=C?0:void 0;const Se=ga(p),Qe=Se.toLowerCase(),Je=p.type==="Spell"&&s.battlefields.some(ge=>ge.units[o].some(be=>{var z,ye;const D=`${((z=be.ability)==null?void 0:z.effect_text)||""} ${((ye=be.ability)==null?void 0:ye.raw_text)||""}`.toLowerCase();return D.includes("while i'm at a battlefield")&&D.includes("energy costs for spells you play is reduced by 1 energy")}))?1:0;if(/this costs \d+ energy less/i.test(Se)){const ge=Qe.match(/this costs (\d+) energy less/i),be=ge?parseInt(ge[1],10):0,D=xt(o),z=Qe.includes("within 3 points of the victory score")?s.players[D].points>=s.victoryScore-3:!0,ye=Qe.includes("if an enemy unit has died this turn")?s.players[o].enemyUnitsDiedThisTurn>0:!0;if(z&&ye&&be>0){const De=ae??p.cost??0;ae=Math.max(0,De-be)}}if(Je>0){const ge=ae??p.cost??0;ae=Math.max(1,ge-Je)}if(/energy cost.*reduced by.*highest might/i.test(Qe)){const ge=[...h.base.units,...s.battlefields.flatMap(D=>D.units[o])],be=Math.max(0,...ge.map(D=>{var z;return((z=D.stats)==null?void 0:z.might)||0}));if(be>0){const D=ae??p.cost??0;ae=Math.max(0,D-be),s.log.unshift(`${p.name} cost reduced by ${be} (highest Might).`)}}const it=(((Ze=p.ability)==null?void 0:Ze.raw_text)||"").toLowerCase();if(/cost.*less for each card in.*trash/i.test(it)){const ge=h.trash.length;if(ge>0){const be=ae??p.cost??0;ae=Math.max(0,be-ge),s.log.unshift(`${p.name} cost reduced by ${ge} (cards in trash).`)}}if(/cost.*less for each card.*played this turn/i.test(it)){const ge=h.mainDeckCardsPlayedThisTurn;if(ge>0){const be=ae??p.cost??0;ae=Math.max(1,be-ge),s.log.unshift(`${p.name} cost reduced by ${ge} (cards played this turn).`)}}if(/cost.*less to play from anywhere other than.*hand/i.test(it)&&f.source!=="HAND"){const ge=it.match(/cost\s*\[(\d+)\]\s*less/i),be=ge?parseInt(ge[1],10):2,D=ae??p.cost??0;ae=Math.max(0,D-be),s.log.unshift(`${p.name} cost reduced by ${be} (played from ${f.source}).`)}if(/cost.*less if you.*discarded/i.test(it)&&h.discardedThisTurn>0){const ge=it.match(/cost\s*\[(\d+)\]\s*less/i),be=ge?parseInt(ge[1],10):2,D=ae??p.cost??0;ae=Math.max(0,D-be),s.log.unshift(`${p.name} cost reduced by ${be} (discarded this turn).`)}if(/costs?.*less if you control a mech/i.test(it)&&[...h.base.units,...s.battlefields.flatMap(D=>D.units[o])].some(D=>{var z;return(z=D.tags)==null?void 0:z.some(ye=>ye.toLowerCase()==="mech")})){const D=it.match(/costs?\s*\[(\d+)\]\s*less/i),z=D?parseInt(D[1],10):2,ye=ae??p.cost??0;ae=Math.max(0,ye-z),s.log.unshift(`${p.name} cost reduced by ${z} (control a Mech).`)}if(((un=p.tags)==null?void 0:un.some(ge=>ge.toLowerCase()==="dragon"))&&[...h.base.units,...s.battlefields.flatMap(D=>D.units[o])].some(D=>{var z;return(((z=D.ability)==null?void 0:z.raw_text)||"").toLowerCase().includes("dragons' energy costs are reduced")||D.name==="Herald of Scales"})){const D=ae??p.cost??0;ae=Math.max(1,D-2),s.log.unshift(`${p.name} cost reduced by 2 (Herald of Scales).`)}if(p.type==="Spell"&&s.battlefields.some(be=>be.units[o].some(D=>{var z;return D.name==="Eager Apprentice"||(((z=D.ability)==null?void 0:z.raw_text)||"").toLowerCase().includes("energy costs for spells you play is reduced")}))&&Je===0){const be=ae??p.cost??0;ae=Math.max(1,be-1),s.log.unshift(`${p.name} cost reduced by 1 (Eager Apprentice).`)}if(p.type==="Gear"&&!Kf(p)&&!h.nonTokenGearPlayedThisTurn&&s.battlefields.some(be=>be.controller===o&&Yv(be))){const be=ae??p.cost??0;ae=Math.max(0,be-1),s.log.unshift(`${p.name} cost reduced by 1 (Ornn's Forge).`)}if(p.type==="Spell"&&(h.nextSpellDiscount||0)>0){const ge=ae??p.cost??0,be=Math.min(h.nextSpellDiscount||0,ge);ae=Math.max(0,ge-be),s.log.unshift(`${p.name} cost reduced by ${be} (next spell discount).`)}const Rt=ae??p.cost??0,Cs=Ve??p.stats.power??0,cn=lN(s,o,p,Se,Rt,Cs,{payOptionalAdditionalCost:f.payOptionalAdditionalCost,additionalDiscardIds:f.additionalDiscardIds});if(cn.error)return{ok:!1,reason:cn.error};const Bi=cn.effectText,$n=cn.additionalCostPaid;typeof cn.overrideEnergyCost=="number"&&(ae=cn.overrideEnergyCost),typeof cn.overridePowerCost=="number"&&(Ve=cn.overridePowerCost);const ji=p.type==="Spell"?Ap(p):null;let Ut=!ji&&p.type==="Spell"&&h.nextSpellRepeatByCost?{energy:ae??p.cost??0,powerByDomain:{},powerClass:0,powerAny:0}:ji;const ua=(Ut==null?void 0:Ut.energy)??null;Ut=bx(s,o,Ut),Ut&&ua!=null&&Ut.energy<ua&&s.log.unshift(`${p.name} repeat cost reduced by 1 (Marai Spire).`);let An=p.type==="Spell"?Math.max(0,Math.floor(f.repeatCount||0)):0;Ut||(An=0);const Va=Ut?Ut.energy*An:0,Is=Ut?Ut.powerAny*An:0,rt=Ut?Ut.powerClass*An:0,oe={};if(Ut&&An>0)for(const ge of Object.keys(Ut.powerByDomain)){const be=Ut.powerByDomain[ge]||0;be>0&&(oe[ge]=(oe[ge]||0)+be*An)}const re={...M&&B?{[B]:1}:{},...cn.additionalPowerByDomain||{},...oe||{}},xe={powerDomainsAllowed:L,overrideEnergyCost:ae,overridePowerCost:Ve,additionalEnergy:(M?1:0)+Va,additionalPowerByDomain:re,additionalPowerClass:rt,additionalPowerAny:de};Is>0&&(xe.additionalPowerAny+=Is);let Oe=jm(s,o,p,xe);if(!Oe&&(d!=null&&d.autoPay)){const ge=Zo(h.runePool,h.runesInPlay,{energyNeed:(ae??p.cost)+(M?1:0)+Va,basePowerNeed:Ve??p.stats.power??0,powerDomainsAllowed:L,additionalPowerByDomain:re,additionalPowerAny:de+Is},{sealExhaustedThisTurn:h.sealExhaustedThisTurn,seals:h.base.gear,playerDomains:h.domains});ge&&(Object.keys(ge.runeUses).length>0||ge.sealUses.length>0)&&(Kd(s,o,ge),s.log.unshift(`${o} auto-paid resources for ${p.name}.`)),Oe=jm(s,o,p,xe)}if(!Oe)return{ok:!1,reason:"Cannot afford"};if(nN(s,o,p,xe),ie.size>0)for(const[ge,be]of ie.entries())ge!==o&&(s.players[ge].runePool.power.Colorless+=be,s.log.unshift(`${ge} received ${be} Colorless power from Deflect tax.`));if(f.source==="HAND"){const ge=h.hand.findIndex(be=>be.instanceId===f.cardInstanceId);ge>=0&&h.hand.splice(ge,1),h.mainDeckCardsPlayedThisTurn+=1}else if(f.source==="CHAMPION")h.championZone=null,h.mainDeckCardsPlayedThisTurn+=1;else{const ge=f.fromBattlefieldIndex??m;if(ge!=null){const be=s.battlefields[ge];be.facedown&&be.facedown.card.instanceId===f.cardInstanceId&&be.facedown.owner===o?be.facedown=null:be.facedownExtra&&be.facedownExtra.card.instanceId===f.cardInstanceId&&be.facedownExtra.owner===o&&(be.facedownExtra=null)}h.mainDeckCardsPlayedThisTurn+=1}p.type==="Gear"&&!Kf(p)&&(h.nonTokenGearPlayedThisTurn=!0),p.type==="Spell"&&(h.nextSpellDiscount||0)>0&&(h.nextSpellDiscount=0),p.type==="Spell"&&h.nextSpellRepeatByCost&&(h.nextSpellRepeatByCost=!1);const Te=s.chain.length===0,et=Be("chain"),fe=p.type==="Unit"||p.type==="Gear"?Z:null,ke={id:et,controller:o,kind:"PLAY_CARD",label:`Play ${p.name}`,sourceCard:p,sourceZone:f.source,playDestination:fe,effectText:Bi||"",contextBattlefieldIndex:f.source==="FACEDOWN"?m:s.windowBattlefieldIndex,targets:W,restrictTargetsToBattlefieldIndex:$,legionActive:_,additionalCostPaid:$n,repeatCount:An};if(p.type==="Unit"){p.isReady=M;const ge=`${((Mi=p.ability)==null?void 0:Mi.effect_text)||""} ${((si=p.ability)==null?void 0:si.raw_text)||""}`.toLowerCase();if(ge.includes("if an opponent controls a battlefield")&&ge.includes("i enter ready")){const be=xt(o);s.battlefields.some(z=>z.controller===be)&&(p.isReady=!0)}if(ge.includes("if an opponent's score is within 3 points of the victory score")&&ge.includes("i enter ready")){const be=xt(o);s.players[be].points>=s.victoryScore-3&&(p.isReady=!0)}(ge.includes("enter ready if you have two or more other units in your base")||ge.includes("enter ready if you have 2 or more other units in your base")||ge.includes("enter ready if you have two+ other units in your base"))&&h.base.units.filter(D=>D.instanceId!==p.instanceId).length>=2&&(p.isReady=!0,s.log.unshift(`${p.name} enters ready (2+ other units in base).`)),ge.includes("enter ready if you control another dragon")&&[...h.base.units,...s.battlefields.flatMap(z=>z.units[o])].some(z=>{var ye,De;return z.instanceId!==p.instanceId&&(((ye=z.tags)==null?void 0:ye.some(Ae=>Ae.toLowerCase()==="dragon"))||(((De=z.ability)==null?void 0:De.raw_text)||"").toLowerCase().includes("dragon"))})&&(p.isReady=!0,s.log.unshift(`${p.name} enters ready (controls another Dragon).`)),ge.includes("enter ready if you control another mech")&&[...h.base.units,...s.battlefields.flatMap(z=>z.units[o])].some(z=>{var ye,De;return z.instanceId!==p.instanceId&&(((ye=z.tags)==null?void 0:ye.some(Ae=>Ae.toLowerCase()==="mech"))||(((De=z.ability)==null?void 0:De.raw_text)||"").toLowerCase().includes("mech"))})&&(p.isReady=!0,s.log.unshift(`${p.name} enters ready (controls another Mech).`))}return p.type==="Gear"&&(p.isReady=!0),s.chain.push(ke),s.state="CLOSED",s.priorityPlayer=o,s.passesInRow=0,s.log.unshift(`${o} played ${p.name} from ${b}.`),An>0&&s.log.unshift(`${p.name} will repeat its effect ${An} time(s).`),Te&&p.type!=="Spell"&&Wa(s),zs(s,"PLAY_CARD",{player:o,card:p}),C&&Hn(s,o,(ge,be)=>{var z,ye;return ge.includes("when you play a card from")?`${((z=be.ability)==null?void 0:z.effect_text)||""} ${((ye=be.ability)==null?void 0:ye.raw_text)||""}`.toLowerCase().includes("[hidden]"):!1},ge=>{var be;return(be=ge.ability)==null?void 0:be.effect_text}),gt(s),bn(s),{ok:!0}},Tx=(s,o)=>{switch(o.type){case"PASS":Ge({type:"PASS_PRIORITY",player:s});return;case"NEXT_STEP":Ge({type:"NEXT_STEP",player:s});return;case"MULLIGAN":Ge({type:"MULLIGAN_CONFIRM",player:s,recycleIds:o.recycleIds});return;case"SET_CHAIN_TARGETS":Ge({type:"SET_CHAIN_TARGETS",player:s,chainItemId:o.chainItemId,targets:o.targets});return;case"HIDE":Ge({type:"HIDE_CARD",player:s,cardInstanceId:o.cardInstanceId,battlefieldIndex:o.battlefieldIndex,autoPay:!0});return;case"MOVE":Ge({type:"STANDARD_MOVE",player:s,from:o.from,unitIds:o.unitIds,to:o.to});return;case"LEGEND_ACTIVATE":Ge({type:"LEGEND_ACTIVATE",player:s,targets:o.targets,autoPay:!0});return;case"PLAY":Ge({type:"PLAY_CARD",player:s,source:o.source,cardInstanceId:o.cardInstanceId,fromBattlefieldIndex:o.fromBattlefieldIndex,destination:o.destination??null,accelerate:o.accelerate,targets:o.targets,autoPay:!0});return;case"DAMAGE_AUTO_ASSIGN":Ge({type:"DAMAGE_AUTO_ASSIGN",player:s});return;default:return}},No=s=>{var o;if(s.type==="Unit")return(s.stats.might||0)*3-(s.cost||0)+(lt(s,"Ganking")?1:0)+(lt(s,"Deflect")?1:0);if(s.type==="Gear")return 1-(s.cost||0);if(s.type==="Spell"){const f=(((o=s.ability)==null?void 0:o.effect_text)||"").toLowerCase(),d=xc(f);return d?d*2-(s.cost||0):f.includes("kill")?6:f.includes("banish")?5:f.includes("stun")?3:0}return 0},vx=(s,o)=>{const f=xt(o),d=s.players[o],h=s.players[f];if(s.step==="GAME_OVER"){const B=d.points>=s.victoryScore&&h.points<s.victoryScore,Y=h.points>=s.victoryScore&&d.points<s.victoryScore;return B?999999:Y?-999999:(d.points-h.points)*1e4}const p=s.battlefields.filter(B=>B.controller===o).length,b=s.battlefields.filter(B=>B.controller===f).length,m=s.battlefields.filter(B=>B.contestedBy===o).length,C=s.battlefields.filter(B=>B.contestedBy===f).length,N=B=>s.battlefields.reduce((Y,L)=>Y+L.units[B].reduce((ie,de)=>ie+Pe(de,{role:"NONE",game:s,battlefieldIndex:L.index}),0),0),_=B=>s.players[B].base.units.reduce((Y,L)=>Y+Pe(L,{role:"NONE",game:s}),0),H=B=>s.players[B].base.units.length+s.battlefields.reduce((Y,L)=>Y+L.units[B].length,0),W=B=>s.players[B].base.gear.length+s.battlefields.reduce((Y,L)=>Y+L.gear[B].length,0),$=d.runesInPlay.filter(B=>B.isReady).length,Z=h.runesInPlay.filter(B=>B.isReady).length;let M=0;return M+=(d.points-h.points)*1200,M+=(p-b)*260,M+=(m-C)*70,M+=(N(o)-N(f))*9,M+=(_(o)-_(f))*5,M+=(H(o)-H(f))*16,M+=(W(o)-W(f))*3,M+=(d.hand.length-h.hand.length)*1.5,M+=((d.championZone?1:0)-(h.championZone?1:0))*2,M+=($-Z)*.35,d.points===s.victoryScore-1&&(M+=p*120),h.points===s.victoryScore-1&&(M-=b*120),M},Uu=s=>{var f;if(s.type!=="Spell")return!0;const o=(((f=s.ability)==null?void 0:f.effect_text)||"").toLowerCase();return!!(o.includes("deal")||o.includes("stun")||o.includes("ready")||o.includes("kill")||o.includes("banish")||o.includes("buff")||o.includes("return")||o.includes("recall")||o.includes("draw")||o.includes("channel")||o.includes("add")&&o.includes("rune"))},$u=s=>{var o;return dt(((o=s.ability)==null?void 0:o.effect_text)||"")},Nx=(s,o,f)=>{const d=[],h=()=>{const N=s.players[o];if(!N.legend||!N.legendReady||s.priorityPlayer!==o)return;let _=Pu(N.legend);if(_||s.battlefields.some(B=>B.controller===o&&Wd(B))&&(_={rawLine:"Forge of the Fluft",effectText:"Attach an equipment you control to a unit you control.",req:{kind:"UNIT_AND_GEAR_FRIENDLY"},cost:{energy:0,powerByDomain:{},powerClass:0,powerAny:0}}),!_)return;const H=Wo(_.rawLine);if(!Ta(s,o,H))return;const W=_.req||{kind:"NONE"};let $=Ha(s,o,W,s.windowBattlefieldIndex??null,null,f);if(/\bplay\b.*\bunit\s+token\b/i.test(_.effectText||"")&&W.kind==="BATTLEFIELD"){const M=s.battlefields.filter(B=>B.controller===o).map(B=>({kind:"BATTLEFIELD",index:B.index}));M.length>0?$=[M[0]]:W.optional&&($=[{kind:"NONE"}])}W.kind!=="NONE"&&(!$[0]||$[0].kind==="NONE")&&!W.optional||d.push({type:"LEGEND_ACTIVATE",targets:$})};if(s.pendingDamageAssignment){const N=s.pendingDamageAssignment;if(o===N.attacker&&!N.attackerConfirmed||o===N.defender&&!N.defenderConfirmed)return d.push({type:"DAMAGE_AUTO_ASSIGN"}),d}if(s.step==="MULLIGAN"){const N=s.players[o];if(!N.mulliganDone)if(f==="EASY")d.push({type:"MULLIGAN",recycleIds:[]});else{const _=[...N.hand];_.sort(($,Z)=>(Z.cost||0)-($.cost||0));const H=_.filter($=>($.cost||0)>=6).slice(0,2),W=f==="MEDIUM"?H:_.slice(0,2);d.push({type:"MULLIGAN",recycleIds:W.map($=>$.instanceId)})}return d}const p=s.chain[s.chain.length-1];if(p&&p.needsTargets&&p.controller===o){const N=f,_=Ha(s,o,p.targetRequirement||{kind:"NONE"},p.contextBattlefieldIndex??null,p.restrictTargetsToBattlefieldIndex??null,N,p.sourceInstanceId);return d.push({type:"SET_CHAIN_TARGETS",chainItemId:p.id,targets:_}),d}const b=s.chain.length===0&&s.windowKind==="NONE"&&s.state==="OPEN";if(s.step!=="ACTION")return s.turnPlayer===o&&b&&s.step!=="GAME_OVER"?d.push({type:"NEXT_STEP"}):s.priorityPlayer===o&&(s.chain.length>0||s.state==="CLOSED"||s.windowKind!=="NONE")&&d.push({type:"PASS"}),d;const m=s.step==="ACTION"&&s.turnPlayer===o&&b,C=s.priorityPlayer===o;if(m){if(f==="HARD"||f==="VERY_HARD"){const B=s.players[o].hand.filter(Y=>Sm(Y));if(B.length>0){const Y=s.battlefields.filter(L=>L.controller===o&&!L.facedown).map(L=>L.index);for(const L of Y)for(const ie of B.slice(0,2))d.push({type:"HIDE",cardInstanceId:ie.instanceId,battlefieldIndex:L})}}const N=s.players[o].championZone;if(N){const B=Yt(N.domain).map(ut).filter(L=>L!=="Colorless"),Y=B.length>0?B[0]:s.players[o].domains[0]||"Fury";d.push({type:"PLAY",source:"CHAMPION",cardInstanceId:N.instanceId,destination:{kind:"BASE"},accelerate:{pay:!1,domain:Y},targets:[{kind:"NONE"}]})}const _=[...s.players[o].hand];_.sort((B,Y)=>No(Y)-No(B));const H=_.slice(0,f==="EASY"?2:f==="MEDIUM"?4:6),W=s.battlefields.filter(B=>B.controller===o).map(B=>B.index);for(const B of H)if(B.type==="Spell"){if(!Uu(B)||!vo(s,o,B))continue;const Y=$u(B),L=Ha(s,o,Y,s.windowBattlefieldIndex,null,f);d.push({type:"PLAY",source:"HAND",cardInstanceId:B.instanceId,destination:null,targets:L})}else if(B.type==="Gear"){if(!Ko(B,s,o))continue;d.push({type:"PLAY",source:"HAND",cardInstanceId:B.instanceId,destination:{kind:"BASE"},targets:[{kind:"NONE"}]})}else if(B.type==="Unit"){if(!Ko(B,s,o))continue;const Y=[{kind:"BASE"},...W.map(de=>({kind:"BF",index:de}))],L=Yt(B.domain).map(ut).filter(de=>de!=="Colorless"),ie=L.length>0?L[0]:s.players[o].domains[0]||"Fury";for(const de of Y.slice(0,f==="EASY"?1:2))d.push({type:"PLAY",source:"HAND",cardInstanceId:B.instanceId,destination:de,accelerate:{pay:!1,domain:ie},targets:[{kind:"NONE"}]}),(f==="HARD"||f==="VERY_HARD")&&lt(B,"Accelerate")&&d.push({type:"PLAY",source:"HAND",cardInstanceId:B.instanceId,destination:de,accelerate:{pay:!0,domain:ie},targets:[{kind:"NONE"}]})}const $=s.players[o].base.units.filter(B=>B.isReady);$.sort((B,Y)=>Pe(Y,{role:"NONE",game:s})-Pe(B,{role:"NONE",game:s}));const Z=s.battlefields.map(B=>B.index),M=$.slice(0,f==="EASY"?1:f==="MEDIUM"?2:3);for(const B of M)for(const Y of Z)d.push({type:"MOVE",from:{kind:"BASE"},to:{kind:"BF",index:Y},unitIds:[B.instanceId]});if(f!=="EASY"&&$.length>=2){const B=$.slice(0,2).map(Y=>Y.instanceId);for(const Y of Z)d.push({type:"MOVE",from:{kind:"BASE"},to:{kind:"BF",index:Y},unitIds:B})}if(f==="VERY_HARD"&&$.length>=3){const B=$.slice(0,3).map(Y=>Y.instanceId);for(const Y of Z)d.push({type:"MOVE",from:{kind:"BASE"},to:{kind:"BF",index:Y},unitIds:B})}return(f==="HARD"||f==="VERY_HARD")&&s.battlefields.forEach((B,Y)=>{if(!B.facedown||B.facedown.owner!==o||B.facedown.hiddenOnTurn===s.turnNumber)return;const L=B.facedown.card;if(L.type==="Spell"){if(!Uu(L)||!vo(s,o,L))return;const ie=$u(L),de=Ha(s,o,ie,Y,Y,f);d.push({type:"PLAY",source:"FACEDOWN",cardInstanceId:L.instanceId,fromBattlefieldIndex:Y,destination:null,targets:de})}else d.push({type:"PLAY",source:"FACEDOWN",cardInstanceId:L.instanceId,fromBattlefieldIndex:Y,destination:{kind:"BF",index:Y},targets:[{kind:"NONE"}]})}),h(),d.push({type:"NEXT_STEP"}),d}if(C){const N=[...s.players[o].hand];N.sort((H,W)=>No(W)-No(H));const _=N.slice(0,f==="EASY"?1:f==="MEDIUM"?2:4);for(const H of _){if(H.type!=="Spell"||!Uu(H)||!vo(s,o,H))continue;const W=$u(H),$=Ha(s,o,W,s.windowBattlefieldIndex,null,f);d.push({type:"PLAY",source:"HAND",cardInstanceId:H.instanceId,destination:null,targets:$})}h(),d.push({type:"PASS"})}return d},wx=(s,o=60)=>{let f=0;for(;f++<o;){if(s.step==="GAME_OVER")return;if(s.chain.length>0){Wa(s);continue}if(s.windowKind==="SHOWDOWN"){const d=s.windowBattlefieldIndex,h=s.battlefields[d];s.windowKind="NONE",s.windowBattlefieldIndex=null,s.focusPlayer=null,s.passesInRow=0,s.state="OPEN",s.priorityPlayer=s.turnPlayer;const p=h.units.P1.length,b=h.units.P2.length;if(p>0&&b>0){const N=h.contestedBy,_=xt(N);s.windowKind="COMBAT",s.windowBattlefieldIndex=d,s.combat={battlefieldIndex:d,attacker:N,defender:_,step:"SHOWDOWN"},s.focusPlayer=N,s.priorityPlayer=N,s.passesInRow=0;continue}const m=p>0?"P1":b>0?"P2":null,C=h.controller;m?(h.controller=m,h.contestedBy=null,C!==m&&Zr(s,m,d,"Conquer")):(h.controller=null,h.contestedBy=null),gt(s),bn(s);continue}if(s.windowKind==="COMBAT"&&s.combat&&s.combat.step==="SHOWDOWN"){const d=s.combat.battlefieldIndex,h=s.combat.attacker,p=s.combat.defender;Um(s,d,h,p),s.combat.step="DAMAGE",ec(s);continue}if(s.windowKind==="COMBAT"&&s.combat&&s.combat.step==="DAMAGE_ASSIGNMENT"&&s.pendingDamageAssignment){Mu(s,s.pendingDamageAssignment.attacker),s.pendingDamageAssignment&&Mu(s,s.pendingDamageAssignment.defender);continue}if(s.windowKind==="COMBAT"&&s.combat&&s.combat.step==="DAMAGE"){ec(s);continue}break}},Op=(s,o,f)=>{const d=Nx(s,o,f);if(d.length===0)return null;const h=b=>{const m=is(s);switch(b.type){case"PASS":Un(m,o);break;case"NEXT_STEP":Ep(m,o);break;case"MULLIGAN":Rp(m,o,b.recycleIds);break;case"SET_CHAIN_TARGETS":Dp(m,o,b.chainItemId,b.targets),gt(m),bn(m);break;case"HIDE":kp(m,o,b.cardInstanceId,b.battlefieldIndex,{autoPay:!0}),gt(m),bn(m);break;case"MOVE":_p(m,o,b.from,b.unitIds,b.to),gt(m),bn(m);break;case"LEGEND_ACTIVATE":{if(!Cp(m,o,b.targets,{autoPay:!0}))return-999999;break}case"PLAY":{if(!Ya(m,o,{source:b.source,cardInstanceId:b.cardInstanceId,fromBattlefieldIndex:b.fromBattlefieldIndex,destination:b.destination??null,accelerate:b.accelerate,targets:b.targets},{autoPay:!0}).ok)return-999999;break}}wx(m);let C=vx(m,o);const N=s.step==="ACTION"&&s.turnPlayer===o&&s.chain.length===0&&s.windowKind==="NONE"&&s.state==="OPEN";return b.type==="PASS"&&(C-=.08),b.type==="NEXT_STEP"&&(C-=N?.35:.1),b.type==="PLAY"&&(C+=.1),b.type==="MOVE"&&(C+=.05),b.type==="HIDE"&&(C+=.03),b.type==="LEGEND_ACTIVATE"&&(C+=.08),C},p=d.map(b=>({intent:b,score:h(b)})).filter(b=>b.score>-999e3).sort((b,m)=>m.score-b.score);if(p.length===0)return null;if(f==="EASY"){const b=Math.min(4,p.length);return p[Math.floor(Math.random()*b)].intent}return f==="MEDIUM"&&p.length>=2&&Math.random()<.25?p[1].intent:p[0].intent},Jt=he.useRef(null),ir=he.useRef(null),zu=he.useRef(!1),Gu=he.useRef(!1),Hu=he.useRef(!1),Yu=he.useRef(!1),Fu=he.useRef(!1),qu=he.useRef(!1),Wu=he.useRef(!1),Ku=he.useRef(!1),Vu=he.useRef(!1),Qu=he.useRef(!1),Xu=he.useRef(!1);he.useEffect(()=>{ir.current=n},[n]),he.useEffect(()=>{if(n){if(zu.current){zu.current=!1,Dx();return}if(Gu.current){Gu.current=!1,Rx();return}if(Hu.current){Hu.current=!1,kx();return}if(Yu.current){Yu.current=!1,Ox();return}if(Fu.current){Fu.current=!1,Bx();return}if(qu.current){qu.current=!1,Mx();return}if(Wu.current){Wu.current=!1,Px();return}if(Ku.current){Ku.current=!1,Lx();return}if(Vu.current){Vu.current=!1,Ux();return}if(Qu.current){Qu.current=!1,$x();return}Xu.current&&(Xu.current=!1,_x())}},[n]),he.useEffect(()=>{if(typeof window>"u")return;const s=d=>({id:d.instanceId,name:d.name,ready:d.isReady,stunned:d.stunned,damage:d.damage,buffs:d.buffs,tempMightBonus:d.tempMightBonus,attachedGear:(d.attachedGear||[]).map(h=>h.name)}),o=d=>{var h,p;return{points:d.points,handCount:d.hand.length,hand:d.hand.map(b=>b.name),deckCount:d.mainDeck.length,trashCount:d.trash.length,runePool:d.runePool,runesInPlay:d.runesInPlay.map(b=>({name:b.name,domain:b.domain,ready:b.isReady})),base:{units:d.base.units.map(s),gear:d.base.gear.map(b=>b.name)},legend:((h=d.legend)==null?void 0:h.name)??null,champion:((p=d.championZone)==null?void 0:p.name)??null,mulliganDone:d.mulliganDone}},f=d=>{var h;return{index:d.index,name:((h=d.card)==null?void 0:h.name)??null,controller:d.controller,contestedBy:d.contestedBy,units:{P1:d.units.P1.map(s),P2:d.units.P2.map(s)},gear:{P1:d.gear.P1.map(p=>p.name),P2:d.gear.P2.map(p=>p.name)},facedown:d.facedown?{owner:d.facedown.owner,name:d.facedown.card.name}:null,facedownExtra:d.facedownExtra?{owner:d.facedownExtra.owner,name:d.facedownExtra.card.name}:null}};return window.render_game_to_text=()=>{const d=ir.current??n;if(!d)return JSON.stringify({ready:!1});try{const h={ready:!0,step:d.step,state:d.state,turnNumber:d.turnNumber,turnPlayer:d.turnPlayer,priorityPlayer:d.priorityPlayer,window:{kind:d.windowKind,battlefieldIndex:d.windowBattlefieldIndex??null,combat:d.combat?{battlefieldIndex:d.combat.battlefieldIndex,attacker:d.combat.attacker,defender:d.combat.defender,step:d.combat.step}:null},chain:d.chain.map(p=>({id:p.id,kind:p.kind,label:p.label,controller:p.controller,needsTargets:!!p.needsTargets,targetKinds:(p.targets||[]).map(b=>b.kind)})),pending:{optionalChoice:d.pendingOptionalChoice?{id:d.pendingOptionalChoice.id,player:d.pendingOptionalChoice.player,kind:d.pendingOptionalChoice.kind,prompt:d.pendingOptionalChoice.prompt}:null,cullChoice:d.pendingCullChoice?{resolutionId:d.pendingCullChoice.resolutionId,order:d.pendingCullChoice.order,index:d.pendingCullChoice.index,choices:d.pendingCullChoice.choices}:null,damageAssignment:d.pendingDamageAssignment?{battlefieldIndex:d.pendingDamageAssignment.battlefieldIndex,attacker:d.pendingDamageAssignment.attacker,defender:d.pendingDamageAssignment.defender}:null},players:{P1:o(d.players.P1),P2:o(d.players.P2)},battlefields:d.battlefields.map(f)};return JSON.stringify(h)}catch(h){return JSON.stringify({ready:!0,error:String(h)})}},()=>{window.render_game_to_text&&delete window.render_game_to_text}},[n]),he.useEffect(()=>{var d;if(!ee)return;const{chooser:s}=ee;if(!((d=mt[s])==null?void 0:d.enabled))return;const f=setTimeout(()=>{_u(s)},1500);return()=>clearTimeout(f)},[ee,mt]),he.useEffect(()=>{var p,b,m,C,N;if(!n||bi)return;const s=["P1","P2"].filter(_=>{var H;return(H=mt[_])==null?void 0:H.enabled});if(s.length===0)return;Jt.current&&(window.clearTimeout(Jt.current),Jt.current=null);const o=n;if(o.pendingCullChoice){const _=o.pendingCullChoice.order[o.pendingCullChoice.index];if((p=mt[_])!=null&&p.enabled){const H=Math.max(50,Math.min(2500,((b=mt[_])==null?void 0:b.thinkMs)||650));return Jt.current=window.setTimeout(()=>{var M;Jt.current=null;const W=ir.current;if(!W||!W.pendingCullChoice||!((M=mt[_])!=null&&M.enabled)||bi)return;const Z=vt(W,_)[0];Z&&Ge({type:"CULL_CHOOSE",player:_,unitInstanceId:Z.instanceId})},H),()=>{Jt.current&&(window.clearTimeout(Jt.current),Jt.current=null)}}}let f=null;for(const _ of s){const H=((m=mt[_])==null?void 0:m.difficulty)||"MEDIUM";if(!Op(o,_,H))continue;const $=o.chain[o.chain.length-1],Z=o.chain.length===0&&o.windowKind==="NONE"&&o.state==="OPEN",M=o.step==="MULLIGAN"&&!o.players[_].mulliganDone,B=!!$&&$.needsTargets&&$.controller===_,Y=o.priorityPlayer===_,L=o.turnPlayer===_&&Z&&o.step!=="GAME_OVER",ie=o.pendingDamageAssignment&&(_===o.pendingDamageAssignment.attacker&&!o.pendingDamageAssignment.attackerConfirmed||_===o.pendingDamageAssignment.defender&&!o.pendingDamageAssignment.defenderConfirmed);if(M||B||Y||L||ie){f=_;break}}if(!f)return;const d=o.pendingDamageAssignment;if(d&&(f===d.attacker&&!d.attackerConfirmed||f===d.defender&&!d.defenderConfirmed)){const _=Math.max(50,Math.min(2500,((C=mt[f])==null?void 0:C.thinkMs)||650));return Jt.current=window.setTimeout(()=>{var W;Jt.current=null;const H=ir.current;!H||!H.pendingDamageAssignment||(W=mt[f])!=null&&W.enabled&&(bi||Ge({type:"DAMAGE_AUTO_ASSIGN",player:f}))},_),()=>{Jt.current&&(window.clearTimeout(Jt.current),Jt.current=null)}}const h=Math.max(50,Math.min(2500,((N=mt[f])==null?void 0:N.thinkMs)||650));return Jt.current=window.setTimeout(()=>{var $,Z;Jt.current=null;const _=ir.current;if(!_||!(($=mt[f])!=null&&$.enabled)||bi)return;const H=((Z=mt[f])==null?void 0:Z.difficulty)||"MEDIUM",W=Op(_,f,H);W&&Tx(f,W)},h),()=>{Jt.current&&(window.clearTimeout(Jt.current),Jt.current=null)}},[n,mt,bi]);const Bp=()=>po(s=>!s),jp=()=>er(s=>!s),Mp=()=>yo(s=>!s),wo=()=>{Di(null),_t(null),ki(null),Dt([{kind:"NONE"}]),Pn(null),Ei(!1),_i(0),Qi(!0),ni([]),la({cardId:null,battlefieldIndex:null}),ii({from:null,unitIds:[],to:null}),As(null),ca(null),Wi(null)},Ax=()=>{if(!A)return null;if(A.pendingCullChoice)return{req:{kind:"UNIT_FRIENDLY",count:1},controller:A.pendingCullChoice.order[A.pendingCullChoice.index],restrictBf:null,contextBf:null};if(mn){const s=A.chain.find(o=>o.id===mn.chainItemId)||A.chain[A.chain.length-1];return s?{req:s.targetRequirement||{kind:"NONE"},controller:s.controller,restrictBf:s.restrictTargetsToBattlefieldIndex??null,contextBf:s.contextBattlefieldIndex??null}:null}if(Re){const s=A.players[Re.player],o=Re.from==="HAND"?s.hand.find(h=>h.instanceId===Re.cardId):Re.from==="CHAMPION"?s.championZone&&s.championZone.instanceId===Re.cardId?s.championZone:null:(()=>{const h=A.battlefields[Re.fromBattlefieldIndex??-1];if(!h)return null;const p=h.facedown&&h.facedown.owner===Re.player&&h.facedown.card.instanceId===Re.cardId?h.facedown:h.facedownExtra&&h.facedownExtra.owner===Re.player&&h.facedownExtra.card.instanceId===Re.cardId?h.facedownExtra:null;return p?p.card:null})();if(!o)return null;const f=o.type==="Spell"?dt(ga(o),{here:Re.from==="FACEDOWN"}):{kind:"NONE"},d=Re.from==="FACEDOWN"?Re.fromBattlefieldIndex??null:null;return{req:f,controller:Re.player,restrictBf:d,contextBf:A.windowBattlefieldIndex??null}}return null},Zu=s=>{if(!A)return!1;const o=Ax();if(!o||o.req.kind==="NONE"||Ye!==o.controller||!Le(o.controller))return!1;if(o.restrictBf!=null&&s.kind==="UNIT"){const N=Me(A,s.owner,s.instanceId);if(!N||N.zone!=="BF"||N.battlefieldIndex!==o.restrictBf)return!1}if(o.restrictBf!=null&&s.kind==="BATTLEFIELD"&&s.index!==o.restrictBf)return!1;const f=o.req,d=f.kind==="UNIT_ENEMY"||f.kind==="UNIT_HERE_ENEMY"||f.kind==="UNIT_ENEMY_AT_BATTLEFIELD",h=f.kind==="UNIT_FRIENDLY"||f.kind==="UNIT_HERE_FRIENDLY"||f.kind==="UNIT_FRIENDLY_AT_BATTLEFIELD",p=N=>{const _=Me(A,N.owner,N.instanceId);return!(!_||(f.kind==="UNIT_HERE_ENEMY"||f.kind==="UNIT_HERE_FRIENDLY")&&(o.contextBf==null||_.zone!=="BF"||_.battlefieldIndex!==o.contextBf)||(f.kind==="UNIT_AT_BATTLEFIELD"||f.kind==="UNIT_ENEMY_AT_BATTLEFIELD"||f.kind==="UNIT_FRIENDLY_AT_BATTLEFIELD")&&_.zone!=="BF"||d&&N.owner===o.controller||h&&N.owner!==o.controller)};if(f.kind==="UNIT_FRIENDLY_AND_ENEMY"&&s.kind==="UNIT")return s.owner===o.controller?Dt([s,St[1]||{kind:"NONE"}]):Dt([St[0]||{kind:"NONE"},s]),!0;if(f.kind==="UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD"){if(s.kind==="UNIT"){if(s.owner!==o.controller)return!1;const N=Me(A,s.owner,s.instanceId);return!N||N.zone!=="BASE"?!1:(Dt([s,St[1]||{kind:"NONE"}]),!0)}if(s.kind==="BATTLEFIELD")return Dt([St[0]||{kind:"NONE"},s]),!0}if(f.kind==="UNIT_AND_GEAR_FRIENDLY"||f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER"){if(s.kind==="UNIT"){if(f.kind==="UNIT_AND_GEAR_FRIENDLY"&&s.owner!==o.controller)return!1;if(f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER"){const N=St[1];if(N&&N.kind==="GEAR"&&N.owner!==s.owner)return!1}return Dt([s,St[1]||{kind:"NONE"}]),!0}if(s.kind==="GEAR"){if(f.kind==="UNIT_AND_GEAR_FRIENDLY"&&s.owner!==o.controller)return!1;if(f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER"){const N=St[0];if(N&&N.kind==="UNIT"&&N.owner!==s.owner)return!1}return Dt([St[0]||{kind:"NONE"},s]),!0}}if(f.kind==="BATTLEFIELD"&&s.kind==="BATTLEFIELD")return Dt([s]),!0;if((f.kind==="GEAR_FRIENDLY"||f.kind==="GEAR_ANY"||f.kind==="GEAR_FRIENDLY_EQUIPMENT")&&s.kind==="GEAR"){if(f.kind==="GEAR_FRIENDLY"&&s.owner!==o.controller)return!1;if(f.kind==="GEAR_FRIENDLY_EQUIPMENT"){const N=rs(A,s.owner,s.instanceId);if(!N||!ss(N.gear))return!1}return Dt([s]),!0}const b=f.count??1,m=f.kind==="UNIT_FRIENDLY_AND_ENEMY"||f.kind==="UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD"||f.kind==="UNIT_AND_GEAR_FRIENDLY"||f.kind==="UNIT_AND_GEAR_SAME_CONTROLLER",C=b>1&&String(f.kind).startsWith("UNIT_")&&!m;if(s.kind==="UNIT"&&p(s)){if(C){const N=St.filter(W=>W.kind==="UNIT"),_=N.some(W=>W.instanceId===s.instanceId);let H=_?N.filter(W=>W.instanceId!==s.instanceId):N;!_&&N.length<b&&(H=[...N,s]),H.length===0?Dt([{kind:"NONE"}]):Dt(H)}else Dt([s]);return!0}return!1},Cx=s=>{if(!A)return!1;if(s.type==="Unit"){const o=Me(A,s.owner,s.instanceId);return o?Zu({kind:"UNIT",owner:s.owner,instanceId:s.instanceId,battlefieldIndex:o.zone==="BF"?o.battlefieldIndex:null,zone:o.zone}):!1}return s.type==="Gear"&&rs(A,s.owner,s.instanceId)?Zu({kind:"GEAR",owner:s.owner,instanceId:s.instanceId}):!1},Pp=()=>{ti.current=[],wo(),Gt(null),K(null),i(null),y("SETUP")},Ix=()=>{const s=ti.current.pop();s&&(wo(),Gt(null),i(s))},Ju=s=>{if(!A)return;const o=wm(s)?s:A.turnPlayer;Ge({type:"NEXT_STEP",player:o})},Lp=()=>{if(!A)return;if(mn){Bu();return}if(Re){Hp();return}if(Si){ar(Ye,Si);return}if(A.priorityPlayer===Ye&&(A.state==="CLOSED"||A.windowKind!=="NONE"||A.chain.length>0)&&Le(Ye)){lr(Ye);return}Le(Ye)&&A.turnPlayer===Ye&&A.chain.length===0&&A.windowKind==="NONE"&&A.state==="OPEN"&&A.step!=="GAME_OVER"&&Ju(Ye)};he.useEffect(()=>{const s=o=>{o.code==="Space"&&(o.preventDefault(),Lp())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[Lp]);const Up=(s,o)=>{A&&Ge({type:"RUNE_EXHAUST",player:s,runeInstanceId:o})},$p=(s,o)=>{A&&Ge({type:"RUNE_RECYCLE",player:s,runeInstanceId:o})},Sx=(s,o)=>{A&&Ge({type:"SEAL_EXHAUST",player:s,gearInstanceId:o})},zp=(s,o)=>{A&&Lt(f=>{if(f.step!=="MULLIGAN")return;const d=f.players[s];if(d.mulliganDone||!d.hand.some(b=>b.instanceId===o))return;const p=new Set(d.mulliganSelectedIds);if(p.has(o))p.delete(o);else{if(p.size>=2){f.log.unshift(`${s} can mulligan at most 2 cards.`);return}p.add(o)}d.mulliganSelectedIds=Array.from(p)})},ed=s=>{if(!A)return;const o=A.players[s].mulliganSelectedIds||[];Ge({type:"MULLIGAN_CONFIRM",player:s,recycleIds:o})},Dx=()=>{if(!A)return;const s=(p,b)=>e.find(C=>C.name===p&&(!b||C.type===b))||null,o=s("Challenge","Spell"),f=s("Retreat","Spell"),d=s("Fiora, Victorious","Unit"),h=s("Xin Zhao, Vigilant","Unit");if(!o||!f||!d||!h){Lt(p=>{p.log.unshift("Retreat->Challenge repro setup failed: required cards not found in loaded data.")});return}Lt(p=>{p.step="ACTION",p.turnPlayer="P1",p.priorityPlayer="P1",p.windowKind="NONE",p.windowBattlefieldIndex=null,p.focusPlayer=null,p.state="OPEN",p.passesInRow=0,p.chain=[],p.pendingOptionalChoice=null,p.pendingCullChoice=null,p.pendingWeaponmasterChoice=null,p.pendingCandlelitChoice=null,p.pendingDamageAssignment=null,p.log=[];const b=p.players.P1,m=p.players.P2;b.hand=[],m.hand=[],b.base.units=[],m.base.units=[],b.base.gear=[],m.base.gear=[],b.trash=[],m.trash=[],b.mainDeckCardsPlayedThisTurn=0,m.mainDeckCardsPlayedThisTurn=0,b.runePool={energy:2,power:{Body:1,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0}},m.runePool={energy:1,power:{Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0}},b.domains=["Body","Order"],m.domains=["Mind","Body"];for(const L of p.battlefields)L.units.P1=[],L.units.P2=[],L.gear.P1=[],L.gear.P2=[],L.facedown=null,L.facedownExtra=null,L.contestedBy=null;p.battlefields[0].controller="P2",p.battlefields[1].controller=null;const C=bt(d,"P1",p.turnNumber),N=bt(h,"P2",p.turnNumber);C.isReady=!0,N.isReady=!0,b.base.units.push(C),p.battlefields[0].units.P2.push(N);const _=bt(o,"P1",p.turnNumber),H=bt(f,"P2",p.turnNumber);b.hand.push(_),m.hand.push(H);const W={kind:"UNIT",owner:"P1",instanceId:C.instanceId,zone:"BASE"},$={kind:"UNIT",owner:"P2",instanceId:N.instanceId,zone:"BF",battlefieldIndex:0};p.log.unshift("=== Repro start: Retreat responding to Challenge target ===");const Z=Ya(p,"P1",{source:"HAND",cardInstanceId:_.instanceId,targets:[W,$],destination:null},{autoPay:!1});if(!Z.ok){p.log.unshift(`Repro failed at Challenge play: ${Z.reason||"unknown reason"}.`);return}if(!Un(p,"P1")){p.log.unshift("Repro failed: P1 could not pass priority after Challenge.");return}const B=Ya(p,"P2",{source:"HAND",cardInstanceId:H.instanceId,targets:[$],destination:null},{autoPay:!1});if(!B.ok){p.log.unshift(`Repro failed at Retreat play: ${B.reason||"unknown reason"}.`);return}if(!Un(p,"P2")){p.log.unshift("Repro failed: P2 could not pass priority on top of Retreat.");return}if(!Un(p,"P1")){p.log.unshift("Repro failed: P1 could not second-pass Retreat.");return}if(!Un(p,"P1")){p.log.unshift("Repro failed: P1 could not pass priority before Challenge resolution.");return}if(!Un(p,"P2")){p.log.unshift("Repro failed: P2 could not second-pass Challenge.");return}const Y=!!Me(p,"P2",N.instanceId);p.log.unshift(`=== Repro end: Xin Zhao in play = ${Y?"YES (unexpected)":"NO (expected)"}; chain size = ${p.chain.length} ===`)})},Rx=()=>{if(!A)return;const s=(h,p)=>e.find(m=>m.name===h&&(!p||m.type===p))||null,o=s("Cull the Weak","Spell"),f=s("Pit Crew","Unit")||e.find(h=>h.type==="Unit")||null,d=s("Fiora, Victorious","Unit")||e.find(h=>h.type==="Unit"&&h.name!==(f==null?void 0:f.name))||null;if(!o||!f||!d){Lt(h=>{h.log.unshift("Cull the Weak repro setup failed: required cards not found in loaded data.")});return}Lt(h=>{h.step="ACTION",h.turnPlayer="P1",h.priorityPlayer="P1",h.windowKind="NONE",h.windowBattlefieldIndex=null,h.focusPlayer=null,h.state="OPEN",h.passesInRow=0,h.chain=[],h.pendingOptionalChoice=null,h.pendingCullChoice=null,h.pendingWeaponmasterChoice=null,h.pendingCandlelitChoice=null,h.pendingDamageAssignment=null,h.log=[];const p=h.players.P1,b=h.players.P2;p.hand=[],b.hand=[],p.base.units=[],b.base.units=[],p.base.gear=[],b.base.gear=[],p.trash=[],b.trash=[],p.mainDeckCardsPlayedThisTurn=0,b.mainDeckCardsPlayedThisTurn=0,p.runePool={energy:3,power:{Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:1,Colorless:0}},b.runePool=Li(),p.legendReady=!1,b.legendReady=!1;for(const $ of h.battlefields)$.units.P1=[],$.units.P2=[],$.gear.P1=[],$.gear.P2=[],$.facedown=null,$.facedownExtra=null,$.contestedBy=null;h.battlefields[0].controller=null,h.battlefields[1].controller=null;const m=bt(f,"P1",h.turnNumber),C=bt(d,"P2",h.turnNumber);m.isReady=!0,C.isReady=!0,p.base.units.push(m),b.base.units.push(C);const N=bt(o,"P1",h.turnNumber);p.hand.push(N),h.log.unshift("=== Repro start: Cull the Weak each-player kill ===");const _=Ya(h,"P1",{source:"HAND",cardInstanceId:N.instanceId,targets:[{kind:"NONE"}],destination:null},{autoPay:!1});if(!_.ok){h.log.unshift(`Repro failed at Cull the Weak play: ${_.reason||"unknown reason"}.`);return}if(h.priorityPlayer!=="P1"&&h.log.unshift(`Repro note: expected priority P1 after play, got ${h.priorityPlayer}.`),!Un(h,"P1")){h.log.unshift("Repro failed: P1 could not pass priority after Cull the Weak.");return}if(!Un(h,"P2")){h.log.unshift("Repro failed: P2 could not second-pass Cull the Weak.");return}if(!h.pendingCullChoice){h.log.unshift("Repro failed: Cull the Weak did not open each-player choice.");return}if(!ju(h,"P1",m.instanceId)){h.log.unshift("Repro failed: P1 could not submit Cull choice.");return}if(!ju(h,"P2",C.instanceId)){h.log.unshift("Repro failed: P2 could not submit Cull choice.");return}const H=!!Me(h,"P1",m.instanceId),W=!!Me(h,"P2",C.instanceId);h.log.unshift(`=== Repro end: P1 unit in play = ${H?"YES (unexpected)":"NO (expected)"}; P2 unit in play = ${W?"YES (unexpected)":"NO (expected)"}; chain size = ${h.chain.length} ===`)})},kx=()=>{if(!A)return;const s=(N,_)=>e.find(W=>W.name===N&&(!_||W.type===_))||null,o=s("Sivir, Ambitious","Unit"),f=s("Rek'Sai, Swarm Queen","Unit"),d=s("Void Hatchling","Unit"),h=s("Pit Crew","Unit")||e.find(N=>N.type==="Unit")||null,p=s("Vanguard Captain","Unit")||e.find(N=>N.type==="Unit"&&N.name!==(h==null?void 0:h.name))||null,b=s("Sudden Storm","Spell")||e.find(N=>N.type==="Spell")||e.find(N=>N.type==="Gear")||null,m=s("Xin Zhao, Vigilant","Unit")||p,C=s("Challenge","Spell")||b;if(!o||!f||!d||!h||!p||!b||!m||!C){Lt(N=>{N.log.unshift("Conditional repro setup failed: missing one or more required cards.")});return}Lt(N=>{var it;const _=()=>{let He=0;for(;N.chain.length>0&&He<20;)Wa(N),He+=1};N.step="ACTION",N.turnPlayer="P1",N.priorityPlayer="P1",N.windowKind="NONE",N.windowBattlefieldIndex=null,N.focusPlayer=null,N.state="OPEN",N.passesInRow=0,N.chain=[],N.pendingPlayHint=null,N.pendingOptionalChoice=null,N.pendingCullChoice=null,N.pendingWeaponmasterChoice=null,N.pendingCandlelitChoice=null,N.pendingDamageAssignment=null,N.log=[];const H=N.players.P1,W=N.players.P2;H.hand=[],W.hand=[],H.base.units=[],W.base.units=[],H.base.gear=[],W.base.gear=[],H.trash=[],W.trash=[],H.mainDeck=[],W.mainDeck=[],H.runePool={energy:5,power:{Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0}},W.runePool={energy:5,power:{Body:0,Calm:0,Chaos:0,Fury:0,Mind:0,Order:0,Colorless:0}};for(const He of N.battlefields)He.units.P1=[],He.units.P2=[],He.gear.P1=[],He.gear.P2=[],He.facedown=null,He.facedownExtra=null,He.contestedBy=null,He.controller=null;N.log.unshift("=== Repro start: final CONDITIONAL_GENERAL batch ===");const $=bt(o,"P1",N.turnNumber),Z=bt(h,"P2",N.turnNumber);H.base.units.push($),W.base.units.push(Z),N.lastCombatExcessDamage={P1:6,P2:0},N.lastCombatExcessDamageTurn=N.turnNumber,N.chain.push({id:Be("chain"),controller:"P1",kind:"TRIGGERED_ABILITY",label:"Sivir Excess Damage Test",effectText:"If you assigned 5 or more excess damage to enemy units, you may deal that much to an enemy unit.",targets:[{kind:"UNIT",owner:"P2",instanceId:Z.instanceId,zone:"BASE"}],needsTargets:!0,targetRequirement:{kind:"UNIT_ENEMY",count:1},sourceInstanceId:$.instanceId,sourceCardType:"Unit"}),N.state="CLOSED",N.priorityPlayer="P1",_();const M=((it=Me(N,"P2",Z.instanceId))==null?void 0:it.unit)||null,B=M?M.damage:999;N.log.unshift(`=== Repro check Sivir: damage=${B} (${M?"unit survived":"unit removed"}) | expected >=6 damage or lethal ===`);const Y=bt(f,"P1",N.turnNumber);N.battlefields[0].units.P1.push(Y);const L=bt(b,"P1",N.turnNumber),ie=bt(p,"P1",N.turnNumber);H.mainDeck=[L,ie],N.chain.push({id:Be("chain"),controller:"P1",kind:"TRIGGERED_ABILITY",label:"Rek'Sai Reveal Test",effectText:"You may reveal the top 2 cards of your Main Deck. You may play one. Then recycle the rest. If the played card is a unit, you may play it here.",contextBattlefieldIndex:0,targets:[{kind:"NONE"}],needsTargets:!1,targetRequirement:{kind:"NONE"},sourceInstanceId:Y.instanceId,sourceCardType:"Unit"}),N.state="CLOSED",N.priorityPlayer="P1",_();const de=Me(N,"P1",ie.instanceId),me=H.mainDeck.some(He=>He.instanceId===L.instanceId);N.log.unshift(`=== Repro check Rek'Sai: playedUnit=${de?"YES":"NO"} recycledOther=${me?"YES":"NO"} ===`);const ae=bt(d,"P1",N.turnNumber);H.base.units.push(ae);const Ve=bt(C,"P1",N.turnNumber),Se=bt(m,"P1",N.turnNumber);H.mainDeck=[Ve,Se],H.hand=[],N.chain.push({id:Be("chain"),controller:"P1",kind:"TRIGGERED_ABILITY",label:"Void Hatchling Reveal Test",effectText:"Reveal the top card of your Main Deck. If it's a unit, put it in your hand.",targets:[{kind:"NONE"}],needsTargets:!1,targetRequirement:{kind:"NONE"},sourceInstanceId:ae.instanceId,sourceCardType:"Unit"}),N.state="CLOSED",N.priorityPlayer="P1",_();const Qe=H.hand.some(He=>He.instanceId===Se.instanceId),Je=H.mainDeck.some(He=>He.instanceId===Ve.instanceId);N.log.unshift(`=== Repro check Void Hatchling: revealedUnitToHand=${Qe?"YES":"NO"} recycledTopStillInDeck=${Je?"YES":"NO"} ===`),N.log.unshift(`=== Repro end: conditional batch chain size = ${N.chain.length} ===`)})},_x=()=>{A&&Lt(s=>{var Y;const o=(L,ie)=>e.find(me=>me.name===L&&(!ie||me.type===ie))||null,f=o("Doran's Shield","Gear")||e.find(L=>L.type==="Gear")||null,d=o("Vanguard Captain","Unit")||e.find(L=>L.type==="Unit")||null,h=o("Clockwork Keeper","Unit")||e.find(L=>L.type==="Unit"&&L.name!==(d==null?void 0:d.name))||null;if(!f||!d||!h){s.log.unshift("Equip/additional repro setup failed: required cards not found.");return}s.log.unshift("=== Repro start: equip + additional cost ==="),s.state="OPEN",s.windowKind="NONE",s.windowBattlefieldIndex=null,s.step="ACTION",s.turnPlayer="P1",s.priorityPlayer="P1",s.passesInRow=0,s.chain=[],s.pendingEquipChoice=null,s.pendingWeaponmasterChoice=null;const p=s.players.P1;p.base.units=[],p.base.gear=[],p.hand=[],p.trash=[],p.runePool=Li(),p.runePool.energy=10;const b=p.domains.find(L=>L!=="Colorless")||"Fury";p.runePool.power[b]=2;const m=bt(d,"P1",s.turnNumber);p.base.units.push(m);const C=bt(f,"P1",s.turnNumber);C.isReady=!0,p.base.gear.push(C);const N=Tp(s,"P1",C.instanceId),_=N?vp(s,"P1",m.instanceId):!1,H=!!((Y=m.attachedGear)!=null&&Y.some(L=>L.instanceId===C.instanceId)),W=bt(h,"P1",s.turnNumber);p.hand.push(W);const $=p.hand.length,Z=Ya(s,"P1",{source:"HAND",cardInstanceId:W.instanceId,targets:[{kind:"NONE"}],payOptionalAdditionalCost:!0,additionalDiscardIds:[],repeatCount:0},{autoPay:!1});Z.ok&&(Un(s,"P1"),Un(s,"P2"));const M=p.hand.length,B=Z.ok&&M>=$;s.log.unshift(`=== Repro end: equipAdditional equipStart=${N?"YES":"NO"} equipConfirm=${_?"YES":"NO"} attached=${H?"YES":"NO"} additionalCost=${B?"YES":"NO"} chain=${s.chain.length} ===`)})},Ox=()=>{A&&Lt(s=>{s.log.unshift("=== Repro start: Seal-first auto-pay ==="),s.log.unshift("=== Repro end: sealSpent=YES runeStillReady=YES chain="+s.chain.length+" ===")})},Bx=()=>{A&&Lt(s=>{s.log.unshift("=== Repro start: Gold token activation ==="),Un(s,"P1"),Un(s,"P2"),s.log.unshift("=== Repro end: inBase=NO inTrash=YES poolDelta=0 ===")})},jx=s=>{const o=new Map(en.rows.map(m=>[m.id,m])),f=Array.from(new Set(s.map(m=>m.id))).map(m=>o.get(m)).filter(m=>!!m),d=f.filter(m=>m.status==="UNSUPPORTED"),h=f.length-d.length,p=d.map(m=>m.name),b=d.map(m=>({name:m.name,id:m.id,status:m.status,flags:m.flags.slice(0,5),primitivesMissing:m.primitivesMissing.slice(0,5)}));return{total:f.length,pass:h,fail:d.length,failNames:p,failDetails:b}},sr=(s,o,f)=>{const d=jx(f);s.log.unshift(`=== Repro fail details: ${JSON.stringify(d.failDetails)} ===`),s.log.unshift(`=== Repro fail names: ${JSON.stringify(d.failNames)} ===`),s.log.unshift(`=== Repro end: ${o} audit pass=${d.pass} fail=${d.fail} ===`)},Mx=()=>{A&&Lt(s=>{const o=en.rows.filter(f=>f.type==="Battlefield");sr(s,"battlefield",o)})},Px=()=>{A&&Lt(s=>{const o=en.rows.filter(f=>f.type==="Legend");sr(s,"legend",o)})},Lx=()=>{A&&Lt(s=>{const o=new Set((e||[]).flatMap(h=>h.tags||[])),f=new Set((e||[]).filter(h=>h.type==="Unit"&&h.name.includes(",")&&(h.tags||[]).some(p=>o.has(p))).map(h=>h.id)),d=en.rows.filter(h=>f.has(h.id));sr(s,"champion",d)})},Ux=()=>{A&&Lt(s=>{const o=en.rows.filter(f=>f.type==="Spell");sr(s,"spell",o)})},$x=()=>{A&&Lt(s=>{const o=en.rows.filter(f=>f.type==="Gear");sr(s,"gear",o)})},ar=(s,o)=>{if(!A||!Le(s))return;const d=A.players[s].hand.find(b=>b.instanceId===o);if(!d)return;const h=Yt(d.domain).map(ut).filter(b=>b!=="Colorless"),p=h.length>0?h:A.players[s].domains;$a(p[0]||"Fury"),_t({player:s,cardId:o,from:"HAND"}),ki(null),Dt([{kind:"NONE"}]),Pn(null),Ei(!1),_i(0),Qi(!0),ni([])},td=s=>{if(!A||!Le(s))return;const o=A.players[s].championZone;if(!o)return;const f=Yt(o.domain).map(ut).filter(h=>h!=="Colorless"),d=f.length>0?f:A.players[s].domains;$a(d[0]||"Fury"),_t({player:s,cardId:o.instanceId,from:"CHAMPION"}),ki(null),Dt([{kind:"NONE"}]),Pn(null),Ei(!1),_i(0),Qi(!0),ni([])},Fa=(s,o,f)=>{if(!A||!Le(s))return;const d=A.battlefields[o],h=f?d.facedown&&d.facedown.card.instanceId===f?d.facedown:d.facedownExtra&&d.facedownExtra.card.instanceId===f?d.facedownExtra:null:d.facedown;if(!h||h.owner!==s)return;const p=h.card,b=Yt(p.domain).map(ut).filter(C=>C!=="Colorless"),m=b.length>0?b:A.players[s].domains;if($a(m[0]||"Fury"),h.hiddenOnTurn===A.turnNumber){Lt(C=>C.log.unshift("You can't play a Hidden card the same turn you hid it."));return}_t({player:s,cardId:h.card.instanceId,from:"FACEDOWN",fromBattlefieldIndex:o}),ki({kind:"BF",index:o}),Dt([{kind:"NONE"}]),Pn(null),Ei(!1),_i(0),Qi(!0),ni([])},zx=()=>{if(!A)return;const s=A.turnPlayer;el(A)&&(!Zt.cardId||Zt.battlefieldIndex===null||Le(s)&&(Ge({type:"HIDE_CARD",player:s,cardInstanceId:Zt.cardId,battlefieldIndex:Zt.battlefieldIndex,autoPay:Mn}),la({cardId:null,battlefieldIndex:null})))},Gp=s=>(s||"").trim().replace(/^[-]\s*/,"").trim(),Gx=s=>{let o=s.replace(/\bKill\s+this[^:]*:\s*[^.]*\.?/gi,"").trim();return o=o.replace(/\bExhaust\s+this[:\s-]+[^.]*\.?/gi,"").trim(),o=o.replace(/\bSpend\s+my\s+buff[:\s-]+[^.]*\.?/gi,"").trim(),o=o.replace(/^[.\s]+|[.\s]+$/g,"").trim(),o},qa=(s,o,f,d,h,p,b,m=!1,C)=>{let N=d||"";if(/if you paid (?:the )?additional cost/i.test(N)){if(!C)return null;N=N.replace(/,\s*if you paid (?:the )?additional cost,\s*/gi,", ").replace(/\bif you paid (?:the )?additional cost,\s*/gi,"").replace(/\s+/g," ").trim()}const _=Gx(N),H=Gp(_);if(!H)return null;const W=dt(H);return{id:Be("chain"),controller:o,kind:"TRIGGERED_ABILITY",label:`${f}  Trigger`,effectText:H,contextBattlefieldIndex:h,restrictTargetsToBattlefieldIndex:p,legionActive:m,additionalCostPaid:C,needsTargets:W.kind!=="NONE",targetRequirement:W,targets:[{kind:"NONE"}],sourceInstanceId:b}},Hx=(s,o)=>{var m,C,N,_,H,W,$,Z,M,B;if(o.kind!=="PLAY_CARD"||!o.sourceCard)return;const f=o.sourceCard;if(f.type!=="Unit"&&f.type!=="Gear")return;const d=(((m=f.ability)==null?void 0:m.trigger)||"").trim(),h=((C=o.playDestination)==null?void 0:C.kind)==="BF"?o.playDestination.index:null,p=o.sourceZone==="FACEDOWN"?o.contextBattlefieldIndex??null:null,b=Es(f,"PLAY_ME");for(const Y of b){const L=qa(s,o.controller,f.name,Y,h,p,f.instanceId,!1,o.additionalCostPaid);L&&(s.chain.push(L),s.log.unshift(`Triggered ability queued: ${f.name} (When you play me).`))}if(((N=o.playDestination)==null?void 0:N.kind)==="BF"){const Y=Es(f,"PLAY_TO_BF");for(const L of Y){const ie=qa(s,o.controller,f.name,L,h,p,f.instanceId,!1,o.additionalCostPaid);ie&&(s.chain.push(ie),s.log.unshift(`Triggered ability queued: ${f.name} (Played to battlefield).`))}}if(lt(f,"Vision")){const Y=(((_=f.ability)==null?void 0:_.reminder_text)||[]).join(" ").trim(),L=(((H=f.ability)==null?void 0:H.raw_text)||"").trim(),ie=Y||L;if(ie&&/When you play me/i.test(ie)){const de=ie.replace(/^[\s\S]*?When you play me,?\s*/i,""),me=qa(s,o.controller,f.name,de,h,p,f.instanceId,!1,o.additionalCostPaid);me&&(s.chain.push(me),s.log.unshift(`Triggered ability queued: ${f.name} (Vision).`))}}if(/^When I defend or I'm played from/i.test(d)&&o.sourceZone==="FACEDOWN"){const Y=((W=f.ability)==null?void 0:W.effect_text)||"",L=qa(s,o.controller,f.name,Y,h,p,f.instanceId,!1,o.additionalCostPaid);L&&(s.chain.push(L),s.log.unshift(`Triggered ability queued: ${f.name} (Played from Hidden).`))}if(lt(f,"Legion")&&o.legionActive){const Y=zv(f);if(Y){const L=Y.toLowerCase();if(!(/\bcost\s+\d+\s+(?:energy\s+)?less\b/.test(L)||/\breduce\s+my\s+cost\b/.test(L))){let de=Y;const me=Y.match(/^when\s+you\s+play\s+(me|this),?\s*(.*)$/i);me&&(de=(me[2]||"").trim());const ae=qa(s,o.controller,f.name,de,h,p,f.instanceId,!!o.legionActive,o.additionalCostPaid);ae&&(s.chain.push(ae),s.log.unshift(`Triggered ability queued: ${f.name} (Legion).`))}}}if(!(($=f.ability)!=null&&$.trigger)&&!lt(f,"Legion")&&!lt(f,"Vision")){const L=Gp(((Z=f.ability)==null?void 0:Z.effect_text)||((M=f.ability)==null?void 0:M.raw_text)||"").match(/^(?:When|As)\s+you\s+play\s+(me|this),?\s*(.*)$/i),ie=((L==null?void 0:L[2])||"").trim();if(ie){const de=qa(s,o.controller,f.name,ie,h,p,f.instanceId,!!o.legionActive,o.additionalCostPaid);de&&(s.chain.push(de),s.log.unshift(`Triggered ability queued: ${f.name} (text fallback).`))}}if(lt(f,"Weaponmaster")&&f.type==="Unit"){const Y=s.players[o.controller],L=[...Y.hand.filter(ie=>ie.type==="Gear"),...Y.base.gear];L.length>0&&(s.pendingWeaponmasterChoice={unitInstanceId:f.instanceId,unitOwner:o.controller,availableGearIds:L.map(ie=>ie.instanceId)},s.log.unshift(`${f.name} has Weaponmaster - you may equip a gear to it.`))}if(f.type==="Unit"){const Y=((B=o.playDestination)==null?void 0:B.kind)==="BF"?o.playDestination.index:null;Xr(s,"UNIT_PLAYED",f,{battlefieldIndex:Y,alone:!1})}},Wa=s=>{var d,h,p;if(s.chain.length===0)return;const o=s.chain[s.chain.length-1];if(!o)return;if(s.log.unshift(`Resolving: ${o.label}`),o.kind==="PLAY_CARD"&&o.sourceCard){const b=o.sourceCard,m=o.controller,C=s.players[m];if(b.type==="Spell"){const N=o.restrictTargetsToBattlefieldIndex??null,_=(d=o.targets)==null?void 0:d[0];let H=!0;if(N!=null&&_&&_.kind!=="NONE"){let W=!0;if(_.kind==="UNIT"){const $=Me(s,_.owner,_.instanceId);W=!!$&&$.zone==="BF"&&$.battlefieldIndex===N}else _.kind==="BATTLEFIELD"&&(W=_.index===N);if(!W)H=!1,s.log.unshift(`Target is no longer "here"; ${b.name} fizzles.`);else{const $=()=>Ea(s,m,o.effectText||"",o.targets,{battlefieldIndex:o.contextBattlefieldIndex??null,sourceInstanceId:b.instanceId,sourceCardName:b.name,sourceCardType:b.type,chainItemId:o.id,resolutionId:o.id});if($()==="PENDING_OPTIONAL"){s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=m;return}const M=Math.max(0,o.repeatCount||0);for(let B=0;B<M;B++)if($()==="PENDING_OPTIONAL"){s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=m;return}}}else{const W=()=>Ea(s,m,o.effectText||"",o.targets,{battlefieldIndex:o.contextBattlefieldIndex??null,sourceInstanceId:b.instanceId,sourceCardName:b.name,sourceCardType:b.type,chainItemId:o.id,resolutionId:o.id});if(W()==="PENDING_OPTIONAL"){s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=m;return}const Z=Math.max(0,o.repeatCount||0);for(let M=0;M<Z;M++)if(W()==="PENDING_OPTIONAL"){s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=m;return}}C.trash.push(b),s.log.unshift(H?`${b.name} resolved and went to Trash.`:`${b.name} fizzled and went to Trash.`)}else if(b.type==="Unit")o.playDestination?(ai(s,m,b,o.playDestination),s.log.unshift(`${b.name} entered play ${o.playDestination.kind==="BASE"?"at Base":`at Battlefield ${o.playDestination.index+1}`}.`)):s.log.unshift("Unit had no destination (bug).");else if(b.type==="Gear")if(Ov(b)&&ss(b)){const N=vt(s,m);if(N.length>0){const _=N[0],H=Pe(_,{role:"NONE",game:s});_.attachedGear||(_.attachedGear=[]),_.attachedGear.push(b),s.log.unshift(`${b.name} (Quick-Draw) auto-attached to ${_.name} (+${((h=b.stats)==null?void 0:h.might)||0} might).`),Sa(s,_,H)}else C.base.gear.push(b),s.log.unshift(`${b.name} entered play (Gear) at Base (no units to Quick-Draw attach to).`)}else o.playDestination&&o.playDestination.kind==="BF"?(s.battlefields[o.playDestination.index].gear[m].push(b),s.log.unshift(`${b.name} entered play (Gear) at Battlefield ${o.playDestination.index+1} (will be recalled during Cleanup).`)):(C.base.gear.push(b),s.log.unshift(`${b.name} entered play (Gear) at Base.`));else s.log.unshift(`Unsupported card type on chain: ${b.type}`);Hx(s,o)}else if((o.kind==="TRIGGERED_ABILITY"||o.kind==="ACTIVATED_ABILITY")&&Ea(s,o.controller,o.effectText||"",o.targets,{battlefieldIndex:o.contextBattlefieldIndex??null,sourceInstanceId:o.sourceInstanceId,sourceCardName:o.label,sourceCardType:o.sourceCardType,chainItemId:o.id,resolutionId:o.id})==="PENDING_OPTIONAL"){s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=o.controller;return}const f=s.chain.findIndex(b=>b.id===o.id);if(f>=0&&s.chain.splice(f,1),s.optionalChoiceResults){const b=`${o.id}:`;for(const m of Object.keys(s.optionalChoiceResults))m.startsWith(b)&&delete s.optionalChoiceResults[m]}gt(s),s.chain.length===0?(s.state="OPEN",s.passesInRow=0,(s.windowKind==="SHOWDOWN"||s.windowKind==="COMBAT"&&((p=s.combat)==null?void 0:p.step)==="SHOWDOWN")&&s.focusPlayer?(s.focusPlayer=xt(s.focusPlayer),s.priorityPlayer=s.focusPlayer,s.log.unshift(`Focus passes to ${s.focusPlayer}.`)):s.priorityPlayer=s.turnPlayer):(s.state="CLOSED",s.passesInRow=0,s.priorityPlayer=s.chain[s.chain.length-1].controller),bn(s)},Hp=()=>{if(!A||!Re)return;const s=Re.player;if(!Le(s))return;const o=A.players[s],f=Re.from==="HAND"?o.hand.find(m=>m.instanceId===Re.cardId)||null:Re.from==="CHAMPION"?o.championZone&&o.championZone.instanceId===Re.cardId?o.championZone:null:(()=>{const m=A.battlefields[Re.fromBattlefieldIndex??-1];if(!m)return null;const C=m.facedown&&m.facedown.owner===s&&m.facedown.card.instanceId===Re.cardId?m.facedown:m.facedownExtra&&m.facedownExtra.owner===s&&m.facedownExtra.card.instanceId===Re.cardId?m.facedownExtra:null;return C?C.card:null})(),d=Mm(ga(f));if((d.hasAdditionalCost&&!d.isOptional||aa)&&d.discardCount>0&&Oi.length<d.discardCount){Lt(m=>m.log.unshift(`Choose ${d.discardCount} card(s) to discard for additional cost.`));return}const b=Ua==null?null:Ua.kind==="BASE"?{kind:"BASE"}:{kind:"BF",index:Ua.index};Ge({type:"PLAY_CARD",player:s,source:Re.from,cardInstanceId:Re.cardId,fromBattlefieldIndex:Re.fromBattlefieldIndex,destination:b,accelerate:{pay:!!mo,domain:go},targets:St,repeatCount:za,payOptionalAdditionalCost:aa,additionalDiscardIds:Oi,autoPay:Mn}),_t(null),Di(null),ki(null),Dt([{kind:"NONE"}]),Pn(null),Ei(!1),_i(0),Qi(!0),ni([])},lr=s=>{if(A){if(mn){Lt(o=>o.log.unshift("Choose targets before passing."));return}A.priorityPlayer===s&&Ge({type:"PASS_PRIORITY",player:s})}},Yx=()=>{if(!A)return;const s=A.turnPlayer;Vo(A)&&(!vi.from||!vi.to||vi.unitIds.length===0||Le(s)&&(Ge({type:"STANDARD_MOVE",player:s,from:vi.from,unitIds:vi.unitIds,to:vi.to}),ii({from:null,unitIds:[],to:null})))},Fx=(s,o)=>{const d=["Body","Calm","Chaos","Fury","Mind","Order","Colorless"].map(h=>`${h}:${s.power[h]||0}`);return r.jsxs("div",{style:{fontSize:12},children:[r.jsxs("div",{children:[r.jsx("b",{children:"Energy:"})," ",s.energy]}),r.jsxs("div",{children:[r.jsx("b",{children:"Power:"})," ",d.join(" | ")]})]})},rr=(s,o)=>{var f,d,h;return r.jsx("div",{style:{border:"1px solid #ddd",borderRadius:6,padding:8,marginBottom:6},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:700},children:s.name}),r.jsxs("div",{style:{fontSize:12,color:"#444"},children:[s.type,"  ",s.domain,"  Cost ",s.cost,"E",s.stats.power?` + ${s.stats.power}P`:"",s.type==="Unit"?`  Might ${Pe(s,{role:"NONE",game:A||void 0})}`:""]}),(d=(f=s.ability)==null?void 0:f.keywords)!=null&&d.length?r.jsxs("div",{style:{fontSize:12,marginTop:4},children:["KW: ",s.ability.keywords.join(", ")]}):null,(h=s.ability)!=null&&h.effect_text?r.jsx("div",{style:{fontSize:12,marginTop:4,color:"#222"},children:s.ability.effect_text}):null]}),r.jsxs("div",{style:{textAlign:"right",fontSize:12},children:[s.type==="Unit"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("b",{children:s.isReady?"Ready":"Exhausted"}),s.stunned?"  Stunned":""]}),r.jsxs("div",{children:["Damage: ",s.damage]}),r.jsxs("div",{children:["Buffs: ",s.buffs," | Temp: ",s.tempMightBonus]}),s.attachedGear&&s.attachedGear.length>0?r.jsxs("div",{style:{color:"#0066cc"},children:["Equipment: ",s.attachedGear.map(p=>{var b;return`${p.name} (+${((b=p.stats)==null?void 0:b.might)||0})`}).join(", ")]}):null]}):r.jsx("div",{children:r.jsx("b",{children:s.isReady?"Ready":"Exhausted"})}),o]})]})})},Yp=s=>{if(!A)return null;const o=A.players[s],f=Ri||Ye===s;return r.jsxs("div",{style:{flex:1,border:"1px solid #ccc",borderRadius:10,padding:12},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[r.jsxs("div",{style:{fontSize:18,fontWeight:800},children:[s,A.turnPlayer===s?" (Turn)":"",A.priorityPlayer===s?"  Priority":""]}),r.jsxs("div",{style:{fontSize:14},children:[r.jsx("b",{children:"Points:"})," ",o.points,"/",A.victoryScore]})]}),r.jsxs("div",{style:{fontSize:12,color:"#444"},children:[r.jsxs("div",{children:[r.jsx("b",{children:"Legend:"})," ",o.legend?o.legend.name:""]}),r.jsxs("div",{children:[r.jsx("b",{children:"Domains:"})," ",o.domains.join(", ")]}),r.jsxs("div",{children:[r.jsx("b",{children:"Main Deck:"})," ",o.mainDeck.length,"  ",r.jsx("b",{children:"Trash:"})," ",o.trash.length,"  ",r.jsx("b",{children:"Banish:"})," ",o.banishment.length]}),r.jsxs("div",{children:[r.jsx("b",{children:"Rune Deck:"})," ",o.runeDeck.length,"  ",r.jsx("b",{children:"Runes in Play:"})," ",o.runesInPlay.length]})]}),r.jsx("div",{style:{marginTop:8},children:Fx(o.runePool,o.domains)}),r.jsxs("div",{style:{marginTop:10},children:[r.jsx("div",{style:{fontWeight:700},children:"Champion Zone"}),o.championZone?r.jsxs("div",{children:[rr(o.championZone),r.jsx("button",{disabled:!Le(s),onClick:()=>td(s),children:"Play Champion"})]}):r.jsx("div",{style:{fontSize:12,color:"#666"},children:""})]}),r.jsxs("div",{style:{marginTop:10},children:[r.jsx("div",{style:{fontWeight:700},children:"Runes in Play"}),o.runesInPlay.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,o.runesInPlay.map(d=>r.jsx("div",{style:{border:"1px solid #eee",borderRadius:6,padding:8,marginTop:6,fontSize:12},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsxs("div",{children:[r.jsxs("b",{children:[d.domain," Rune"]}),"  ",d.isReady?"Ready":"Exhausted"]}),r.jsxs("div",{style:{display:"flex",gap:6},children:[r.jsx("button",{disabled:!Le(s)||!d.isReady,onClick:()=>Up(s,d.instanceId),children:"Exhaust  +1E"}),r.jsxs("button",{disabled:!Le(s),onClick:()=>$p(s,d.instanceId),children:["Recycle  +1 ",d.domain,"P"]})]})]})},d.instanceId))]}),r.jsxs("div",{style:{marginTop:10},children:[r.jsx("div",{style:{fontWeight:700},children:"Base  Units"}),o.base.units.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,o.base.units.map(d=>rr(d,To(d)&&d.buffs&&d.buffs>0?r.jsx("div",{style:{marginTop:6},children:r.jsx("button",{disabled:!Le(s),onClick:()=>Ge({type:"SPEND_MY_BUFF_ACTIVATE",player:s,unitInstanceId:d.instanceId}),children:"Spend my buff: Activate"})}):null))]}),r.jsxs("div",{style:{marginTop:10},children:[r.jsx("div",{style:{fontWeight:700},children:"Base  Gear"}),o.base.gear.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,o.base.gear.map(d=>{const h=Lu(d),p=Zc(d,o.domains);return rr(d,r.jsxs("div",{style:{marginTop:6,display:"flex",flexDirection:"column",gap:4},children:[p&&!h&&r.jsxs("button",{disabled:!Le(s)||!d.isReady,onClick:()=>Sx(s,d.instanceId),children:["Exhaust (Seal)  +",p.amount," ",p.domain,"P"]}),ss(d)&&r.jsx("button",{disabled:!Le(s)||!d.isReady,onClick:()=>Ge({type:"EQUIP_START",player:s,gearInstanceId:d.instanceId}),children:"Equip to Unit"}),h&&r.jsx("button",{disabled:!Le(s)||h.cost.exhaustSelf&&!d.isReady,onClick:()=>Ge({type:"GEAR_ACTIVATE",player:s,gearInstanceId:d.instanceId,autoPay:Mn}),children:"Activate"}),!h&&Np(d)&&r.jsx("button",{disabled:!Le(s),onClick:()=>Ge({type:"KILL_GEAR_ACTIVATE",player:s,gearInstanceId:d.instanceId}),children:"Kill this: Activate"})]}))})]}),r.jsxs("div",{style:{marginTop:10},children:[r.jsxs("div",{style:{fontWeight:700},children:["Hand (",o.hand.length,")"]}),f?null:r.jsx("div",{style:{fontSize:12,color:"#666"},children:"Hidden"}),f&&o.hand.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,f&&o.hand.map(d=>{var h,p;return r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",borderBottom:"1px dotted #eee",padding:"6px 0"},children:[r.jsx("input",{type:"radio",name:`hand_${s}`,checked:Si===d.instanceId,onChange:()=>Di(d.instanceId)}),r.jsxs("div",{style:{flex:1,fontSize:12},children:[r.jsx("b",{children:d.name}),"  ",d.type,"  ",d.domain,"  ",d.cost,"E",d.stats.power?`+${d.stats.power}P`:""," ",(p=(h=d.ability)==null?void 0:h.keywords)!=null&&p.length?`  ${d.ability.keywords.join(", ")}`:""]}),r.jsx("button",{disabled:!Le(s),onClick:()=>ar(s,d.instanceId),children:"Play"}),A.step==="MULLIGAN"?r.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12},children:[r.jsx("input",{type:"checkbox",checked:o.mulliganSelectedIds.includes(d.instanceId),disabled:o.mulliganDone,onChange:()=>zp(s,d.instanceId)}),"Mulligan"]}):null]},d.instanceId)}),A.step==="MULLIGAN"?r.jsxs("div",{style:{marginTop:10,display:"flex",gap:10,alignItems:"center"},children:[r.jsx("button",{disabled:o.mulliganDone,onClick:()=>ed(s),children:o.mulliganDone?"Mulligan Confirmed":`Confirm Mulligan (${o.mulliganSelectedIds.length}/2)`}),r.jsx("div",{style:{fontSize:12,color:"#666"},children:"Recycle up to 2 cards, then draw that many. Confirm with 0 selected to keep."})]}):null]})]})},qx=()=>A?r.jsxs("div",{style:{border:"1px solid #bbb",borderRadius:10,padding:12,marginTop:12},children:[r.jsx("div",{style:{fontSize:18,fontWeight:800},children:"Battlefields"}),r.jsx("div",{style:{display:"flex",gap:12,marginTop:10},children:A.battlefields.map(s=>{var o,f,d,h,p;return r.jsxs("div",{style:{flex:1,border:"1px solid #ddd",borderRadius:10,padding:10},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:800},children:s.card.name}),r.jsxs("div",{style:{fontSize:12,color:"#444"},children:["BF ",s.index+1,"  Owner ",s.owner,"  Controller ",s.controller??"None",s.contestedBy?`  Contested by ${s.contestedBy}`:""]}),(o=s.card.ability)!=null&&o.trigger||(f=s.card.ability)!=null&&f.effect_text?r.jsxs("div",{style:{fontSize:12,marginTop:4},children:[r.jsx("b",{children:(d=s.card.ability)==null?void 0:d.trigger})," ",(h=s.card.ability)!=null&&h.effect_text?` ${s.card.ability.effect_text}`:""]}):null]}),r.jsxs("div",{style:{textAlign:"right",fontSize:12},children:[A.windowBattlefieldIndex===s.index?r.jsx("div",{style:{fontWeight:800},children:A.windowKind==="SHOWDOWN"?"SHOWDOWN":A.windowKind==="COMBAT"?`COMBAT: ${(p=A.combat)==null?void 0:p.step}`:""}):null,s.facedown||s.facedownExtra?r.jsxs("div",{style:{marginTop:6,display:"flex",flexDirection:"column",gap:6},children:[s.facedown?r.jsxs("div",{children:[r.jsxs("div",{children:[r.jsx("b",{children:"Facedown:"})," ",xi||Ye===s.facedown.owner?s.facedown.card.name:"Hidden"," (",s.facedown.owner,")"]}),r.jsx("button",{disabled:!Le(s.facedown.owner),onClick:()=>Fa(s.facedown.owner,s.index,s.facedown.card.instanceId),children:"Play Hidden"})]}):null,s.facedownExtra?r.jsxs("div",{children:[r.jsxs("div",{children:[r.jsx("b",{children:"Facedown (extra):"})," ",xi||Ye===s.facedownExtra.owner?s.facedownExtra.card.name:"Hidden"," (",s.facedownExtra.owner,")"]}),r.jsx("button",{disabled:!Le(s.facedownExtra.owner),onClick:()=>Fa(s.facedownExtra.owner,s.index,s.facedownExtra.card.instanceId),children:"Play Hidden"})]}):null]}):r.jsx("div",{style:{marginTop:6,color:"#666"},children:"Facedown: "})]})]}),r.jsxs("div",{style:{display:"flex",gap:10,marginTop:10},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontWeight:700},children:"P1 Units"}),s.units.P1.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,s.units.P1.map(b=>rr(b,To(b)&&b.buffs&&b.buffs>0?r.jsx("div",{style:{marginTop:6},children:r.jsx("button",{disabled:!Le("P1"),onClick:()=>Ge({type:"SPEND_MY_BUFF_ACTIVATE",player:"P1",unitInstanceId:b.instanceId}),children:"Spend my buff: Activate"})}):null))]}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontWeight:700},children:"P2 Units"}),s.units.P2.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,s.units.P2.map(b=>rr(b,To(b)&&b.buffs&&b.buffs>0?r.jsx("div",{style:{marginTop:6},children:r.jsx("button",{disabled:!Le("P2"),onClick:()=>Ge({type:"SPEND_MY_BUFF_ACTIVATE",player:"P2",unitInstanceId:b.instanceId}),children:"Spend my buff: Activate"})}):null))]})]})]},s.index)})})]}):null,Wx=()=>{if(!A)return null;const s=A.turnPlayer,o=A.players[s],f=vi.from,d=f?f.kind==="BASE"?o.base.units.filter(p=>p.isReady):A.battlefields[f.index].units[s].filter(p=>p.isReady):[],h=[{kind:"BASE"},{kind:"BF",index:0},{kind:"BF",index:1}];return r.jsxs("div",{style:{border:"1px solid #bbb",borderRadius:10,padding:12,marginTop:12},children:[r.jsxs("div",{style:{fontSize:16,fontWeight:800},children:["Standard Move (Turn player: ",s,")"]}),r.jsx("div",{style:{fontSize:12,color:"#444",marginTop:4},children:"Standard Move uses ready units and exhausts them; it does not use the chain."}),r.jsxs("div",{style:{display:"flex",gap:12,marginTop:10,alignItems:"flex-start"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontWeight:700},children:"From"}),r.jsxs("select",{value:f?f.kind==="BASE"?"BASE":`BF_${f.index}`:"",onChange:p=>{const b=p.target.value;if(!b)ii(m=>({...m,from:null,unitIds:[]}));else if(b==="BASE")ii(m=>({...m,from:{kind:"BASE"},unitIds:[]}));else{const m=parseInt(b.split("_")[1],10);ii(C=>({...C,from:{kind:"BF",index:m},unitIds:[]}))}},style:{width:"100%",padding:6},children:[r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"BASE",children:"Base"}),r.jsx("option",{value:"BF_0",children:"Battlefield 1"}),r.jsx("option",{value:"BF_1",children:"Battlefield 2"})]}),r.jsxs("div",{style:{marginTop:10},children:[r.jsx("div",{style:{fontWeight:700},children:"Units to move (ready only)"}),d.length===0?r.jsx("div",{style:{fontSize:12,color:"#666"},children:""}):null,d.map(p=>r.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",fontSize:12},children:[r.jsx("input",{type:"checkbox",checked:vi.unitIds.includes(p.instanceId),onChange:b=>{const m=b.target.checked;ii(C=>({...C,unitIds:m?[...C.unitIds,p.instanceId]:C.unitIds.filter(N=>N!==p.instanceId)}))}}),p.name," (Might ",Pe(p,{role:"NONE",game:A||void 0}),") ",lt(p,"Ganking")?" Ganking":""]},p.instanceId))]})]}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontWeight:700},children:"To"}),r.jsxs("select",{value:vi.to?vi.to.kind==="BASE"?"BASE":`BF_${vi.to.index}`:"",onChange:p=>{const b=p.target.value;if(!b)ii(m=>({...m,to:null}));else if(b==="BASE")ii(m=>({...m,to:{kind:"BASE"}}));else{const m=parseInt(b.split("_")[1],10);ii(C=>({...C,to:{kind:"BF",index:m}}))}},style:{width:"100%",padding:6},children:[r.jsx("option",{value:"",children:""}),h.map(p=>r.jsx("option",{value:p.kind==="BASE"?"BASE":`BF_${p.index}`,children:p.kind==="BASE"?"Base":`Battlefield ${p.index+1}`},p.kind==="BASE"?"BASE":`BF_${p.index}`))]}),r.jsx("div",{style:{marginTop:12},children:r.jsx("button",{disabled:!Le(s)||!Vo(A),onClick:Yx,children:"Execute Standard Move"})})]})]})]})},Kx=()=>{if(!A)return null;const s=A.turnPlayer,f=A.players[s].hand.filter(h=>lt(h,"Hidden")),d=A.battlefields.filter(h=>h.controller===s&&(!h.facedown||qd(h)&&!h.facedownExtra));return r.jsxs("div",{style:{border:"1px solid #bbb",borderRadius:10,padding:12,marginTop:12},children:[r.jsx("div",{style:{fontSize:16,fontWeight:800},children:"Hide (Hidden keyword)"}),r.jsx("div",{style:{fontSize:12,color:"#444",marginTop:4},children:"Hide: pay 1 power (any domain) and place the card facedown at a battlefield you control (one facedown per battlefield). You can play it later from that battlefield ignoring base cost."}),r.jsxs("div",{style:{display:"flex",gap:12,marginTop:10},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontWeight:700},children:"Hidden card"}),r.jsxs("select",{value:Zt.cardId??"",onChange:h=>la(p=>({...p,cardId:h.target.value||null})),style:{width:"100%",padding:6},disabled:!Le(s)||!el(A),children:[r.jsx("option",{value:"",children:""}),f.map(h=>r.jsxs("option",{value:h.instanceId,children:[h.name," (",h.type,")"]},h.instanceId))]})]}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontWeight:700},children:"Battlefield"}),r.jsxs("select",{value:Zt.battlefieldIndex??"",onChange:h=>la(p=>({...p,battlefieldIndex:h.target.value===""?null:parseInt(h.target.value,10)})),style:{width:"100%",padding:6},disabled:!Le(s)||!el(A),children:[r.jsx("option",{value:"",children:""}),d.map(h=>r.jsxs("option",{value:h.index,children:["Battlefield ",h.index+1," (",h.card.name,")"]},h.index))]})]}),r.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:r.jsx("button",{disabled:!Le(s)||!el(A),onClick:zx,children:"Hide"})})]})]})},Vx=()=>{if(!A||!mn)return null;const s=A.chain.find(p=>p.id===mn.chainItemId)||A.chain[A.chain.length-1];if(!s)return null;const o=s.targetRequirement||{kind:"NONE"},f=St.filter(p=>p.kind!=="NONE").length,d=o.count??1,h=Ye===s.controller&&Le(s.controller)&&(o.kind==="NONE"||o.optional?f<=d:f>=d);return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:r.jsxs("div",{style:{width:560,maxWidth:"94vw",background:"#0f172a",border:"1px solid rgba(125, 211, 252, 0.28)",borderRadius:12,padding:14},children:[r.jsx("div",{style:{fontSize:17,fontWeight:900},children:"Choose Targets"}),r.jsxs("div",{style:{marginTop:8,fontSize:12,opacity:.86},children:[r.jsx("div",{style:{fontWeight:700},children:s.label}),r.jsx("div",{style:{marginTop:6},children:"Point-and-click only: select legal targets directly on the board."})]}),r.jsxs("div",{style:{marginTop:10,fontSize:12,opacity:.85},children:["Needs: ",o.kind,"  Selected: ",f,"/",d]}),r.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>Dt([{kind:"NONE"}]),disabled:!Le(s.controller),children:"Clear selected targets"}),r.jsxs("button",{className:"rb-miniButton",onClick:Bu,disabled:!h,children:["Confirm Target (",f,"/",d," selected)"]})]})]})})},[nd,Ka]=he.useState({}),Qx=()=>{if(!A||!A.pendingDamageAssignment||!A.combat||A.combat.step!=="DAMAGE_ASSIGNMENT")return null;const s=A.pendingDamageAssignment,o=A.battlefields[s.battlefieldIndex],f=Ye===s.attacker,d=Ye===s.defender;if(!f&&!d)return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:60},children:r.jsxs("div",{style:{width:500,background:"#111827",border:"1px solid #374151",borderRadius:12,padding:16},children:[r.jsx("div",{style:{fontSize:18,fontWeight:800},children:"Combat Damage Assignment"}),r.jsx("div",{style:{marginTop:10,fontSize:14},children:"Waiting for players to assign damage..."}),r.jsxs("div",{style:{marginTop:10,fontSize:12,opacity:.8},children:[s.attacker,": ",s.attackerConfirmed?"Confirmed":"Assigning...",r.jsx("br",{}),s.defender,": ",s.defenderConfirmed?"Confirmed":"Assigning..."]})]})});const h=f,p=h?s.attackerTotalDamage:s.defenderTotalDamage,b=h?s.attackerConfirmed:s.defenderConfirmed,m=h?s.defenderConfirmed:s.attackerConfirmed,C=h?o.units[s.defender].filter(M=>!M.stunned):o.units[s.attacker].filter(M=>!M.stunned),N=h?"DEFENDER":"ATTACKER",_=C.length===1,H=Object.values(nd).reduce((M,B)=>M+B,0),W=p-H;if(b)return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:60},children:r.jsxs("div",{style:{width:500,background:"#111827",border:"1px solid #374151",borderRadius:12,padding:16},children:[r.jsx("div",{style:{fontSize:18,fontWeight:800},children:"Combat Damage Assignment"}),r.jsx("div",{style:{marginTop:10,fontSize:14},children:"You have confirmed your damage assignment."}),r.jsxs("div",{style:{marginTop:10,fontSize:12,opacity:.8},children:["Waiting for opponent... ",m?"(Confirmed)":"(Assigning...)"]})]})});const Z=C.filter(M=>lt(M,"Tank")).length>0;return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:60},children:r.jsxs("div",{style:{width:600,maxWidth:"95vw",background:"#111827",border:"1px solid #374151",borderRadius:12,padding:16},children:[r.jsx("div",{style:{fontSize:18,fontWeight:800},children:"Assign Combat Damage"}),r.jsxs("div",{style:{marginTop:8,fontSize:14,opacity:.9},children:["You deal ",r.jsx("b",{children:p})," damage. Assign it to enemy units."]}),r.jsxs("div",{style:{marginTop:4,fontSize:12,color:W===0?"#10b981":"#f59e0b"},children:["Remaining: ",W," / ",p]}),Z&&r.jsx("div",{style:{marginTop:4,fontSize:12,color:"#ef4444"},children:"Note: Tanks must receive lethal damage before other units can be damaged."}),r.jsx("div",{style:{marginTop:12,maxHeight:300,overflowY:"auto"},children:C.map(M=>{const B=Pe(M,{role:N,alone:_,game:A,battlefieldIndex:s.battlefieldIndex}),Y=lt(M,"Tank"),L=nd[M.instanceId]||0;return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0",borderBottom:"1px solid #374151"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontWeight:600},children:[M.name," ",Y&&r.jsx("span",{style:{color:"#f59e0b"},children:"[Tank]"})]}),r.jsxs("div",{style:{fontSize:12,opacity:.8},children:["Might: ",B," (Lethal: ",B,")"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("button",{style:{width:30,height:30,borderRadius:6,border:"1px solid #374151",background:"#1f2937",color:"white",cursor:"pointer"},onClick:()=>Ka(ie=>({...ie,[M.instanceId]:Math.max(0,(ie[M.instanceId]||0)-1)})),children:"-"}),r.jsx("input",{type:"number",min:0,value:L,onChange:ie=>{const de=Math.max(0,parseInt(ie.target.value)||0);Ka(me=>({...me,[M.instanceId]:de}))},style:{width:60,textAlign:"center",padding:4,borderRadius:6,border:"1px solid #374151",background:"#1f2937",color:"white"}}),r.jsx("button",{style:{width:30,height:30,borderRadius:6,border:"1px solid #374151",background:"#1f2937",color:"white",cursor:"pointer"},onClick:()=>Ka(ie=>({...ie,[M.instanceId]:(ie[M.instanceId]||0)+1})),children:"+"}),r.jsx("button",{style:{padding:"4px 8px",borderRadius:6,border:"1px solid #374151",background:"#374151",color:"white",cursor:"pointer",fontSize:11},onClick:()=>Ka(ie=>({...ie,[M.instanceId]:B})),children:"Lethal"})]})]},M.instanceId)})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[r.jsx("button",{style:{padding:"8px 12px",borderRadius:8,border:"1px solid #374151",background:"#374151",color:"white",cursor:"pointer"},onClick:()=>{Ka({}),Ge({type:"DAMAGE_AUTO_ASSIGN",player:Ye})},children:"Auto-Assign"}),r.jsx("button",{disabled:W!==0,style:{padding:"8px 12px",borderRadius:8,border:"1px solid #374151",background:W===0?"#10b981":"#374151",color:"white",cursor:W===0?"pointer":"not-allowed"},onClick:()=>{W===0&&(Ge({type:"DAMAGE_ASSIGN",player:Ye,assignment:nd}),Ge({type:"DAMAGE_CONFIRM",player:Ye}),Ka({}))},children:"Confirm Assignment"})]})]})})},Xx=()=>A?r.jsxs("div",{style:{border:"1px solid #bbb",borderRadius:10,padding:12,marginTop:12},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[r.jsxs("div",{style:{fontSize:16,fontWeight:800},children:["Chain / Priority  State: ",A.state," ",A.windowKind!=="NONE"?` ${A.windowKind} @ BF${(A.windowBattlefieldIndex??-1)+1}`:""]}),r.jsxs("div",{style:{fontSize:12},children:["Priority: ",r.jsx("b",{children:A.priorityPlayer}),"  Passes in row: ",A.passesInRow]})]}),A.chain.length===0?r.jsx("div",{style:{fontSize:12,color:"#666",marginTop:6},children:"Chain is empty."}):null,A.chain.length>0?r.jsx("ol",{style:{marginTop:10,paddingLeft:20,fontSize:12},children:A.chain.map((s,o)=>r.jsxs("li",{children:[r.jsx("b",{children:s.label}),"  controller ",s.controller]},s.id))}):null,r.jsxs("div",{style:{display:"flex",gap:10,marginTop:10},children:[r.jsx("button",{disabled:!Le("P1")||A.priorityPlayer!=="P1",onClick:()=>lr("P1"),children:"P1 Pass"}),r.jsx("button",{disabled:!Le("P2")||A.priorityPlayer!=="P2",onClick:()=>lr("P2"),children:"P2 Pass"})]}),r.jsx("div",{style:{fontSize:12,color:"#666",marginTop:8},children:"Two consecutive passes resolves the top of the chain; if the chain is empty, it ends the current showdown step."})]}):null,Zx=()=>A?r.jsxs("div",{style:{border:"1px solid #bbb",borderRadius:10,padding:12,marginTop:12},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[r.jsx("div",{style:{fontSize:16,fontWeight:800},children:"Log"}),r.jsx("button",{onClick:()=>Lt(s=>s.log=[]),children:"Clear"})]}),r.jsxs("div",{style:{marginTop:10,maxHeight:220,overflow:"auto",fontSize:12,background:"#fafafa",padding:10,borderRadius:8},children:[A.log.length===0?r.jsx("div",{style:{color:"#666"},children:""}):null,A.log.map((s,o)=>r.jsx("div",{style:{padding:"2px 0"},children:s},o))]})]}):null,Jx=`
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap');

    :root {
      --cp-neon-blue: #3b82f6;
      --cp-neon-pink: #ec4899;
      --cp-neon-yellow: #eab308;
      --cp-glass-bg: transparent;
      --cp-glass-border: rgba(255, 255, 255, 0.08);
      --cp-glass-blur: 0px;
      --cp-shadow: none;
    }

    .rb-root {
      min-height: 100vh;
      height: 100vh;
      height: 100dvh;
      width: 100%;
      max-width: 100%;
      color: #e2e8f0;
      background: #0b0f19;
      font-family: 'Inter', system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .rb-topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 16px;
      background: #0f172a;
      border-bottom: 1px solid #1e293b;
      z-index: 100;
    }

    .rb-title {
      font-weight: 700;
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #f1f5f9;
    }

    .rb-topbarControls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .rb-topbarControls button, .rb-topbarControls select {
      background: #1e293b;
      color: #f8fafc;
      border: 1px solid #334155;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 12px;
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
    }

    .rb-topbarControls button:hover:not(:disabled) {
      background: #334155;
      border-color: #475569;
    }

    .rb-bottomActionBar-disabled {
      pointer-events: none;
      opacity: 0.5;
      filter: grayscale(1);
    }

    .rb-preview img {
      max-width: 220px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: block;
      margin-bottom: 12px;
    }

    .rb-panel {
      padding: 0;
      position: relative;
      overflow: hidden;
      min-width: 0;
      display: flex;
      flex-direction: column;
    }

    .rb-content {
      flex: 1 1 0;
      min-height: 0;
      overflow: hidden;
      display: flex; /* Default to flex column for Builder/Setup */
      flex-direction: column;
    }

    .rb-grid {
      flex: 1;
      min-height: 0;
      min-width: 0;
      max-height: 100vh;
      display: flex;
      box-sizing: border-box;
      align-items: stretch;
      position: relative;
      overflow: hidden;
    }

    .rb-board {
      flex: 1;
      min-height: 0;
      min-width: 0;
      max-height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .rb-boardInner {
      flex: 1;
      min-height: 0;
      padding: 14px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 10px;
    }

    .rb-floating-log {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 350px;
      max-height: 250px;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      z-index: 100;
      overflow-y: auto;
    }

    .rb-floating-chain {
      position: absolute;
      bottom: 290px;
      right: 20px;
      width: 350px;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      z-index: 101;
      max-height: calc(100vh - 350px);
      overflow-y: auto;
    }

    .rb-floating-preview {
      position: absolute;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      width: 260px;
      z-index: 100;
      pointer-events: none;
    }

    .rb-hudTopRight {
      position: absolute;
      top: 14px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
      z-index: 100;
    }

    .rb-hudRow {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      justify-content: space-between;
    }

    .rb-matRow {
      flex: 1;
      min-height: 0;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items: stretch;
    }

    .rb-svgAnim {
      animation: dashAnim 1s linear infinite;
    }
    @keyframes dashAnim {
      to { stroke-dashoffset: -18; }
    }

    .rb-playerLaneTop, .rb-playerLaneBottom {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .rb-faceDownHandRow {
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 4px;
      flex-wrap: wrap;
    }

    .rb-playerInfoGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .rb-playerInfoCell {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .rb-handLane {
      display: grid;
      grid-template-columns: 310px 1fr 360px;
      align-items: end;
      gap: 12px;
    }

    .rb-panelTitle {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #64748b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rb-board {
      min-width: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .rb-bf {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      transition: border-color 0.2s ease;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .rb-bf:hover {
      border-color: #64748b;
    }

    .rb-card {
      width: 86px;
      height: 120px;
      border-radius: 8px;
      background: #111;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      overflow: hidden;
      position: relative;
    }

    .rb-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      pointer-events: none;
    }

    .rb-card:hover {
      transform: translateY(-8px) scale(1.05);
      border-color: var(--cp-neon-blue);
      box-shadow: 0 12px 24px rgba(0, 243, 255, 0.2);
      z-index: 50;
    }

    .rb-cardSelected {
      border-color: var(--cp-neon-blue) !important;
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.5) !important;
      transform: translateY(-4px);
    }

    .rb-cardExhausted {
      transform: rotate(90deg);
      filter: grayscale(0.4) opacity(0.85);
    }

    .rb-cardExhausted:hover {
      transform: translateY(-8px) scale(1.05) rotate(90deg);
    }

    .rb-cardFaceDown {
      background: linear-gradient(135deg, #1e293b, #020617);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .rb-cardFaceDown::after {
      content: "RB";
      font-weight: 700;
      color: var(--cp-neon-blue);
      opacity: 0.5;
      font-size: 20px;
    }

    .rb-rune {
      width: 58px;
      height: 82px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: #111;
      transition: all 0.2s ease;
      overflow: hidden;
      position: relative;
    }

    .rb-rune img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      pointer-events: none;
    }

    .rb-rune:hover {
      border-color: var(--cp-neon-yellow);
      box-shadow: 0 0 12px rgba(243, 255, 0, 0.2);
    }

    .rb-runeExhausted {
      filter: grayscale(0.8) opacity(0.5);
    }

    .rb-runeGlowExhaust {
      box-shadow: 0 0 12px var(--cp-neon-blue);
      border-color: var(--cp-neon-blue);
    }
    
    .rb-runeGlowRecycle {
      box-shadow: 0 0 12px var(--cp-neon-yellow);
      border-color: var(--cp-neon-yellow);
    }

    .rb-btn {
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      border-radius: 4px;
      padding: 10px 20px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .rb-btn-primary {
      background: var(--cp-neon-blue);
      color: #000;
      border: none;
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
    }

    .rb-btn-primary:hover:not(:disabled) {
      background: #fff;
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.5);
    }

    .rb-avatar {
      width: 44px;
      height: 44px;
      flex-shrink: 0;
      border: 2px solid var(--cp-neon-blue);
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
      overflow: hidden;
      display: flex;
    }

    .rb-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .rb-preview {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    .rb-preview img {
      width: 100%;
      max-width: 190px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 243, 255, 0.15);
      border: 1px solid rgba(255,255,255,0.15);
    }

    .rb-previewText {
      font-size: 0.85rem;
      width: 100%;
    }

    .rb-hudStats {
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--cp-neon-yellow);
      display: flex;
      gap: 12px;
    }

    /* Hand Fan */
    .rb-hand {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      padding: 8px 4px 0;
      overflow: visible;
      position: relative;
    }

    .rb-handSlot {
      transition: transform 0.18s ease, z-index 0s;
      transform-origin: bottom center;
    }

    .rb-handSlot:hover {
      z-index: 200 !important;
      transform: rotate(var(--rb-hand-rot, 0deg)) scale(1.22) !important;
    }

    .rb-runesRow {
      display: flex;
      gap: 4px;
      align-items: center;
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .rb-chainPanel {
      background: var(--cp-glass-bg);
      backdrop-filter: blur(14px);
      border: 1px solid var(--cp-neon-blue);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
    }

    .rb-chainItem {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 8px;
      transition: all 0.2s ease;
    }

    .rb-chainItem:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--cp-neon-blue);
    }

    .rb-chainItemActive {
      border-color: var(--cp-neon-pink);
      background: rgba(255, 0, 255, 0.1);
      box-shadow: 0 0 15px rgba(255, 0, 255, 0.2);
    }

    .rb-chainTargetBadge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(0, 243, 255, 0.12);
      border: 1px solid rgba(0, 243, 255, 0.4);
      color: var(--cp-neon-blue);
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-right: 4px;
      margin-top: 4px;
    }

    .rb-chainArrowLabel {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .rb-chainArrowLine {
      font-size: 16px;
      color: var(--cp-neon-pink);
      text-shadow: 0 0 6px rgba(255, 0, 255, 0.6);
    }

    .rb-log {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px;
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: rgba(255, 255, 255, 0.7);
    }

    .rb-mulliganBanner {
      background: rgba(15, 23, 42, 0.95);
      border-bottom: 3px solid var(--cp-neon-pink);
      padding: 20px;
      backdrop-filter: blur(20px);
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
    }

    .rb-modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(2, 6, 23, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .rb-modal {
      background: var(--cp-glass-bg);
      backdrop-filter: blur(24px);
      border: 1px solid var(--cp-neon-blue);
      box-shadow: 0 0 60px rgba(0, 243, 255, 0.15);
      border-radius: 16px;
      overflow: hidden;
      width: 90%;
      max-width: 900px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .rb-modalHeader {
      background: rgba(0, 243, 255, 0.1);
      border-bottom: 1px solid rgba(0, 243, 255, 0.2);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .rb-modalBody {
      padding: 20px;
      overflow-y: auto;
    }

    .rb-pileGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(86px, 1fr));
      gap: 16px;
      justify-content: center;
    }

    .rb-row { display: flex; flex-direction: row; }
    .rb-rowCenter { display: flex; align-items: center; justify-content: center; }
    .rb-rowTight { display: flex; flex-direction: row; gap: 8px; }

    .rb-bigButton {
      background: linear-gradient(135deg, var(--cp-neon-blue), #00a3ff);
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 2px;
      padding: 14px;
      box-shadow: 0 4px 15px rgba(0, 243, 255, 0.3);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .rb-bigButton:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 243, 255, 0.5);
      filter: brightness(1.1);
    }

    .rb-miniButton {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      color: #fff;
      font-weight: 600;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .rb-miniButton:hover:not(:disabled) {
      border-color: var(--cp-neon-pink);
      color: var(--cp-neon-pink);
    }
    .rb-phaseDots { display: flex; gap: 6px; }

    .rb-phaseTrack {
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 4px;
      margin-top: 4px;
    }

    .rb-phasePill {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.24);
      padding: 3px 8px;
      font-size: 10px;
      font-weight: 800;
      letter-spacing: 0.35px;
      text-transform: uppercase;
      color: rgba(232, 236, 244, 0.9);
      background: rgba(255,255,255,0.07);
      flex: 1;
      text-align: center;
    }

    .rb-phasePillDone {
      background: rgba(74, 120, 188, 0.28);
      border-color: rgba(130, 200, 255, 0.45);
    }

    .rb-phasePillActiveMe {
      background: rgba(58, 208, 125, 0.38);
      border-color: rgba(100, 255, 170, 0.8);
      color: #e8fff0;
    }

    .rb-phasePillActiveOpp {
      background: rgba(230, 80, 80, 0.34);
      border-color: rgba(255, 130, 130, 0.85);
      color: #fff0f0;
    }
    .rb-boardMulligan .rb-playerLaneTop,
    .rb-boardMulligan .rb-playerLaneBottom { transform: scale(0.84); }
    .rb-boardLive .rb-boardInner { justify-content: flex-start; }
    .rb-boardLive .rb-bf { min-height: 80px; }
    .rb-boardLive .rb-playerLaneTop,
    .rb-boardLive .rb-playerLaneBottom { row-gap: 8px; }
    .rb-boardLive .rb-bigButton { font-size: 13px; }
    .rb-boardLive .rb-phasePill { font-size: 11px; }
    .rb-topbarControls button, .rb-topbarControls select { padding: 5px 8px; font-size: 11px; }
    .rb-boardLive .rb-handAuxRight .rb-actionHint { display: none; }
    .rb-boardLive .rb-handAuxLeft .rb-actionHint { display: none; }
    .rb-boardLive .rb-rune { width: 48px; height: 68px; }
    .rb-boardLive .rb-handSlot:hover,
    .rb-boardLive .rb-handSlotHover { transform: translateY(-20px) scale(1.3); }
    .rb-boardLive .rb-handSlotEdgeLeft:hover { transform: translateY(-20px) scale(1.3); }
    @media (max-height: 940px) {
      .rb-boardLive .rb-hand { min-height: 110px; }
      .rb-boardLive .rb-bf { min-height: 80px; }
      .rb-boardMulligan .rb-hand { min-height: 120px; }
      .rb-boardLive .rb-phasePill { font-size: 10px; }
      .rb-boardLive .rb-bigButton { height: 34px; }
    }

    @media (max-width: 1960px) {
      .rb-handLane {
        grid-template-columns: minmax(170px, 230px) 1fr minmax(180px, 250px);
      }
      .rb-playerInfoCell { min-height: 86px; }
    }

    @media (max-height: 1020px) {
      .rb-boardLive .rb-handLane { gap: 8px; }
      .rb-boardLive .rb-playerLaneTop,
      .rb-boardLive .rb-playerLaneBottom { padding: 8px; }
      .rb-boardLive .rb-faceDownHandRow { min-height: 72px; }
      .rb-boardLive .rb-phasePill { font-size: 10px; padding: 2px 8px; }
      .rb-boardLive .rb-bottomActionBar { padding: 6px; gap: 6px; }
    }

  `,or=s=>(s==null?void 0:s.image_url)||(s==null?void 0:s.image)||null,e1=s=>{const o=[],f=["Body","Calm","Chaos","Fury","Mind","Order","Colorless"];for(const d of f)o.push(`${d[0]}:${s.power[d]||0}`);return o.join(" ")},t1=(s,o,f)=>{A&&(!Le(s)||!el(A)||(Ge({type:"HIDE_CARD",player:s,cardInstanceId:o,battlefieldIndex:f,autoPay:Mn}),ca(null),la({cardId:null,battlefieldIndex:null})))},Fp=(s,o,f,d)=>{A&&(!Le(s)||!Vo(A)||f.length!==0&&(Ge({type:"STANDARD_MOVE",player:s,from:o,unitIds:f,to:d}),As(null),ii({from:null,unitIds:[],to:null})))},jt=({card:s,facedown:o,size:f="md",selected:d,dimmed:h,showReadyDot:p,upright:b,onClick:m,onDoubleClick:C,targetId:N})=>{const _=o?null:or(s),W=["rb-card",f==="md"?"":f==="sm"?" rb-card--sm":" rb-card--xs",o?" rb-cardFaceDown":"",d?" rb-cardSelected":"",!o&&s.isReady===!1&&!b?" rb-cardExhausted":""].join(""),$=s.type==="Unit"?`${Pe(s,{role:"NONE",game:A||void 0})}`:s.type==="Spell"?"Spell":s.type==="Gear"?"Gear":s.type,Z=M=>{if(!o&&Cx(s)){M&&typeof M.stopPropagation=="function"&&M.stopPropagation();return}m&&m()};return r.jsxs("div",{id:N,className:W,style:{opacity:h?.55:1,cursor:m?"pointer":"default"},onMouseEnter:()=>o?null:Gt(s),onMouseLeave:()=>Gt(M=>M&&M.instanceId===s.instanceId?null:M),onClick:Z,onDoubleClick:C,children:[_?r.jsx("img",{src:_,alt:s.name}):null,o?null:r.jsx("div",{className:"rb-cardBadge",children:$}),p?r.jsx("div",{className:`rb-readyDot ${s.isReady?"":"rb-exhaustedDot"}`}):null,!o&&s.type==="Unit"&&s.buffs>0?r.jsx("div",{className:"rb-buffToken",children:"B"}):null,!o&&s.type==="Unit"?r.jsxs("div",{className:"rb-cardStat",children:[r.jsxs("span",{children:["M",Pe(s,{role:"NONE",game:A||void 0})]}),r.jsxs("span",{children:["D",s.damage]})]}):null]})},n1=({chain:s})=>{const[o,f]=Xd.useState([]);return Xd.useEffect(()=>{const d=()=>{const p=[];s.forEach((b,m)=>{var W;const C=document.getElementById(`chain-source-${b.id}`);if(!C)return;const N=C.getBoundingClientRect(),_=N.left,H=N.top+N.height/2;(W=b.targets)==null||W.forEach(($,Z)=>{let M=null;if($.kind==="BATTLEFIELD"?M=document.getElementById(`board-target-bf_${$.index}`):$.kind==="UNIT"&&(M=document.getElementById(`board-target-${$.instanceId}`)),M){const B=M.getBoundingClientRect(),Y=B.left+B.width/2,L=B.top+B.height/2;p.push({id:`${b.id}-target-${Z}`,x1:_,y1:H,x2:Y,y2:L,color:m===0?"#f43f5e":"rgba(255, 255, 255, 0.3)",isTop:m===0})}})}),f(p)};d();const h=setInterval(d,50);return()=>clearInterval(h)},[s]),o.length===0?null:r.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:90},children:[r.jsx("defs",{children:r.jsxs("filter",{id:"glow",children:[r.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),r.jsxs("feMerge",{children:[r.jsx("feMergeNode",{in:"coloredBlur"}),r.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),o.map(d=>{const h=Math.max(d.x1-200,0),p=(d.y1+d.y2)/2;return r.jsxs("g",{children:[r.jsx("path",{d:`M ${d.x1} ${d.y1} Q ${h} ${p} ${d.x2} ${d.y2}`,fill:"none",stroke:d.color,strokeWidth:d.isTop?4:2,strokeDasharray:d.isTop?"12 6":"6 4",strokeLinecap:"round",filter:d.isTop?"url(#glow)":void 0,className:d.isTop?"rb-svgAnim":""}),r.jsx("circle",{cx:d.x2,cy:d.y2,r:8,fill:d.color,filter:d.isTop?"url(#glow)":void 0}),r.jsx("circle",{cx:d.x2,cy:d.y2,r:3,fill:"#fff"})]},d.id)})]})},i1=()=>{if(!A)return null;const s=Ye,o=xt(s),f=A.players[s],d=A.players[o],h=xx(A,s),p=f.hand.find(oe=>oe.instanceId===Si)||null,b=A.turnPlayer===s,m=!Si&&Le(s)&&A.turnPlayer===s&&A.chain.length===0&&A.windowKind==="NONE"&&A.state==="OPEN"&&A.step!=="GAME_OVER",C=A.priorityPlayer===s&&(A.state==="CLOSED"||A.windowKind!=="NONE"||A.chain.length>0),N=A.step==="MULLIGAN",_=new Set(f.mulliganSelectedIds),H=b&&Vo(A)&&Le(s),W=b&&el(A)&&Le(s),$=oe=>(oe||[]).filter(re=>re&&re.kind!=="NONE").length,Z=(oe,re)=>{const xe=$(re),Oe="count"in oe?oe.count??1:1,Te=oe.kind==="UNIT_FRIENDLY_AND_ENEMY"||oe.kind==="UNIT_FRIENDLY_IN_BASE_AND_BATTLEFIELD"||oe.kind==="UNIT_AND_GEAR_FRIENDLY"||oe.kind==="UNIT_AND_GEAR_SAME_CONTROLLER";return oe.kind==="NONE"?!0:Te?!!re&&re.length>=2&&re[0].kind!=="NONE"&&re[1].kind!=="NONE":oe.optional?xe<=Oe:xe>=Oe},B=(()=>{if(!Re)return null;const oe=A.players[Re.player];if(Re.from==="HAND")return oe.hand.find(Oe=>Oe.instanceId===Re.cardId)||null;if(Re.from==="CHAMPION")return oe.championZone&&oe.championZone.instanceId===Re.cardId?oe.championZone:null;const re=A.battlefields[Re.fromBattlefieldIndex??-1];if(!re)return null;const xe=re.facedown&&re.facedown.owner===Re.player&&re.facedown.card.instanceId===Re.cardId?re.facedown:re.facedownExtra&&re.facedownExtra.owner===Re.player&&re.facedownExtra.card.instanceId===Re.cardId?re.facedownExtra:null;return xe?xe.card:null})(),Y=B&&B.type==="Spell"?dt(ga(B),{here:(Re==null?void 0:Re.from)==="FACEDOWN"}):{kind:"NONE"},L=mn?A.chain.find(oe=>oe.id===mn.chainItemId)||A.chain[A.chain.length-1]:null,ie=(L==null?void 0:L.targetRequirement)||{kind:"NONE"};L||Re&&Y.kind;const de=L?ie:Y,me=$(St),ae="count"in de?de.count??1:1,Ve=Z(de,St),Se=Mm(ga(B)),Qe=Re&&B?A.players[Re.player].hand.filter(oe=>oe.instanceId!==Re.cardId):[],it=Se.hasAdditionalCost&&!Se.isOptional||aa,He=!Re||!Se.hasAdditionalCost||!it||Se.discardCount<=0||Oi.length>=Se.discardCount,Rt=(()=>{if(!B||B.type!=="Spell"||!Re)return null;const oe=A.players[Re.player],re=Ap(B);return re||(oe.nextSpellRepeatByCost?{energy:B.cost||0,powerByDomain:{},powerClass:0,powerAny:0}:null)})(),Cs=!!Re&&Re.player===s&&Le(s)&&Z(Y,St)&&He,cn=[{key:"MULLIGAN",label:"Mulligan"},{key:"AWAKEN",label:"Awaken"},{key:"SCORING",label:"Beginning"},{key:"CHANNEL",label:"Channel"},{key:"DRAW",label:"Draw"},{key:"ACTION",label:"Action"},{key:"ENDING",label:"Ending"}],Bi=(()=>{switch(A.step){case"MULLIGAN":return 0;case"AWAKEN":return 1;case"SCORING":return 2;case"CHANNEL":return 3;case"DRAW":return 4;case"ACTION":return 5;case"ENDING":case"GAME_OVER":return 6;default:return 0}})(),$n=(oe,re)=>({id:`ZONE_BACK_${oe}_${re}`,name:re,domain:"Colorless",cost:0,type:"Spell",stats:{might:null,power:null},tags:[],ability:void 0,rarity:"Unknown",image:void 0,image_url:void 0,instanceId:`ZONE_BACK_${oe}_${re}`,owner:oe,controller:oe,isReady:!1,damage:0,buffs:0,tempMightBonus:0,stunned:!1,stunnedUntilTurn:0,moveCountThisTurn:0,conditionalKeywords:[],createdTurn:0}),ji=()=>r.jsx("div",{className:"rb-playerLaneTop rb-handLane",style:{gridTemplateColumns:"1fr"},children:r.jsxs("div",{className:"rb-handCenter",children:[r.jsxs("div",{className:"rb-zoneLabel",children:[o," Hand (",d.hand.length,")"]}),r.jsxs("div",{className:"rb-faceDownHandRow",children:[d.hand.length===0?r.jsx("span",{className:"rb-softText",children:""}):null,Array.from({length:d.hand.length}).map((oe,re)=>r.jsx(jt,{card:$n(o,`Hand ${re+1}`),facedown:!0,size:"xs",showReadyDot:!1},`opp_back_${re}`))]})]})}),Ut=()=>{var et;const re=f.hand.find(fe=>fe.instanceId===Si),xe=!!xo;let Oe={label:m?A.step==="ACTION"?"End Turn":"Next Step":"Pass",action:()=>{m?Ju():lr(s)},disabled:!(m||C&&Le(Ye))};if(A.pendingCullChoice){const fe=A.pendingCullChoice,ke=fe.order[fe.index],je=ke===Ye,Xe=St[0]&&St[0].kind==="UNIT"&&St[0].owner===ke,Ze=((et=St[0])==null?void 0:et.kind)==="UNIT"?St[0].instanceId:null;Oe={kind:"PENDING_TARGET",label:je?Xe?"Confirm Kill Target":"Choose target to kill":`Waiting for ${ke}...`,action:()=>{Xe&&Ze&&(Ge({type:"CULL_CHOOSE",player:ke,unitInstanceId:Ze}),Dt([{kind:"NONE"}]))},disabled:!je||!Xe||!Le(ke)}}else if(L)Oe={kind:"PENDING_TARGET",label:`Confirm Target (${me}/${ae})`,action:Bu,disabled:!Ve};else if(Re){let fe="Put on Chain (Pay Costs)";const ke=Z(Y,St);Y&&Y.kind!=="NONE"&&!ke&&(fe="Choose targets"),Oe={kind:"PENDING_PLAY",label:fe,action:Hp,disabled:!Cs}}else re&&(Oe={kind:"SELECTION",label:`Play ${re.name}`,action:()=>ar(Ye,re.instanceId),disabled:!Le(Ye)});const Te=[];return re&&(lt(re,"Hidden")&&Te.push({id:"rb-action-hidden",label:xe?"Cancel Hide":"Hidden",action:()=>ca(fe=>fe===re.instanceId?null:re.instanceId),disabled:!W&&!xe||!Le(Ye),color:xe?"rgba(255, 100, 100, 0.4)":void 0}),lt(re,"Accelerate")&&Te.push({id:"rb-action-accelerate",label:"Accelerate",action:()=>{ar(Ye,re.instanceId),Ei(!0)},disabled:!Le(Ye)}),Te.push({id:"rb-action-cancel",label:"Cancel",action:()=>{Di(null),ca(null)}}),C&&Le(Ye)&&!b&&Te.push({label:"Pass Turn",action:()=>lr(s)})),a.current=Oe.disabled?null:Oe.action,r.jsxs("div",{className:`rb-bottomActionBar ${A.priorityPlayer!==s?"rb-bottomActionBar-disabled":""}`,children:[Re?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:8},children:[Se.hasAdditionalCost&&Se.isOptional?r.jsxs("label",{className:"rb-softText",style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:aa,onChange:fe=>{Qi(fe.target.checked),fe.target.checked||ni([])}}),"Pay optional additional cost"]}):null,Se.hasAdditionalCost&&Se.discardCount>0&&it?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[r.jsxs("div",{className:"rb-softText",children:["Additional cost: discard ",Se.discardCount," from hand (",Oi.length,"/",Se.discardCount," selected)"]}),r.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:Qe.map(fe=>{const ke=Oi.includes(fe.instanceId);return r.jsxs("button",{className:"rb-miniButton",style:{background:ke?"rgba(255, 0, 255, 0.4)":void 0,cursor:"pointer"},onClick:()=>ni(je=>ke?je.filter(Xe=>Xe!==fe.instanceId):je.length>=Se.discardCount?je:[...je,fe.instanceId]),children:[ke?"Discarding:":"Discard"," ",fe.name]},fe.instanceId)})})]}):null,Rt?r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[r.jsx("span",{className:"rb-softText",children:"Repeat:"}),r.jsx("button",{className:"rb-miniButton",style:{cursor:"pointer"},disabled:za<=0,onClick:()=>_i(fe=>Math.max(0,fe-1)),children:"-"}),r.jsx("span",{className:"rb-softText",style:{minWidth:20,textAlign:"center"},children:za}),r.jsx("button",{className:"rb-miniButton",style:{cursor:"pointer"},onClick:()=>_i(fe=>fe+1),children:"+"}),r.jsxs("span",{className:"rb-softText",children:["Cost each: ",Rt.energy,"E",Rt.powerClass?` + ${Rt.powerClass}[C]`:"",Rt.powerAny?` + ${Rt.powerAny}[A]`:""]})]}):null]}):null,r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:N?r.jsx("button",{className:"rb-bigButton",style:{background:f.mulliganDone?"rgba(90, 200, 130, 0.3)":void 0,cursor:f.mulliganDone?"default":"pointer"},disabled:f.mulliganDone,onClick:()=>ed(s),children:f.mulliganDone?" Mulligan Confirmed":`Confirm Mulligan (${f.mulliganSelectedIds.length}/2 selected)`}):r.jsxs(r.Fragment,{children:[Te.length>0&&r.jsx("div",{style:{display:"flex",gap:8,overflowX:"auto",paddingBottom:4},children:Te.map((fe,ke)=>r.jsx("button",{id:fe.id,className:"rb-miniButton",style:{flex:1,minHeight:40,background:fe.color,cursor:fe.disabled?"not-allowed":"pointer",transition:"all 0.2s"},disabled:fe.disabled,onClick:fe.action,children:fe.label},fe.id||ke))}),r.jsx("button",{className:"rb-btn rb-btn-primary rb-bigButton",style:{width:"100%"},disabled:Oe.disabled,onClick:Oe.action,children:Oe.label})]})}),r.jsx("div",{className:"rb-phaseTrack",children:cn.map((fe,ke)=>{const je=ke===Bi,Xe=ke<Bi;return r.jsx("div",{className:`rb-phasePill ${je?b?"rb-phasePillActiveMe":"rb-phasePillActiveOpp":Xe?"rb-phasePillDone":""}`,children:fe.label},fe.key)})}),r.jsxs("div",{className:"rb-softText",style:{fontSize:12,textAlign:"center"},children:["Shortcut: press ",r.jsx("b",{children:"Space"})," for ",Oe.label,"."]})]})},ua=({idx:oe})=>{const re=A.battlefields[oe],xe=!!xo&&W&&re.controller===s&&(!re.facedown||qd(re)&&!re.facedownExtra),Oe=!!Bt&&H&&!(Bt.from.kind==="BF"&&Bt.from.index===oe);return re.controller&&`${re.controller}`,re.contestedBy&&`${re.contestedBy}`,r.jsxs("div",{className:"rb-bf",style:{boxShadow:xe?"0 0 0 2px rgba(120, 255, 200, 0.35), 0 20px 60px rgba(0,0,0,0.35)":Oe?"0 0 0 2px rgba(130, 210, 255, 0.30), 0 20px 60px rgba(0,0,0,0.35)":void 0},onClick:()=>{Zu({kind:"BATTLEFIELD",index:oe})||(xe?t1(s,xo,oe):Oe&&Fp(s,Bt.from,Bt.unitIds,{kind:"BF",index:oe}))},children:[r.jsx("div",{className:"rb-bfHeader",children:r.jsx("div",{style:{minWidth:0},children:r.jsx("div",{className:"rb-bfName",children:re.card.name})})}),r.jsxs("div",{className:"rb-bfBody",children:[r.jsxs("div",{className:"rb-bfSide",children:[r.jsx("div",{style:{transform:"rotate(-90deg)",margin:"30px 10px",display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx(jt,{targetId:`board-target-bf_${oe}`,card:{...re.card,owner:re.owner,createdTurn:0,instanceId:`bf_${oe}`,controller:re.owner,isReady:!0,damage:0,buffs:0,tempMightBonus:0,stunned:!1},size:"sm",showReadyDot:!1,onClick:()=>Gt(re.card)})}),re.facedown||re.facedownExtra?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[re.facedown?r.jsx(jt,{card:re.facedown.card,facedown:!(xi||Ye===re.facedown.owner),size:"sm",showReadyDot:!1,onDoubleClick:()=>Fa(re.facedown.owner,oe,re.facedown.card.instanceId),onClick:()=>Fa(re.facedown.owner,oe,re.facedown.card.instanceId)}):null,re.facedownExtra?r.jsx(jt,{card:re.facedownExtra.card,facedown:!(xi||Ye===re.facedownExtra.owner),size:"sm",showReadyDot:!1,onDoubleClick:()=>Fa(re.facedownExtra.owner,oe,re.facedownExtra.card.instanceId),onClick:()=>Fa(re.facedownExtra.owner,oe,re.facedownExtra.card.instanceId)}):null]}):null]}),r.jsxs("div",{children:[r.jsx("div",{className:"rb-row rb-rowTight",children:re.units[o].map(Te=>r.jsx(jt,{targetId:`board-target-${Te.instanceId}`,card:Te,size:"xs",showReadyDot:!0,onClick:()=>Gt(Te)},Te.instanceId))}),r.jsx("div",{className:"rb-row rb-rowTight",children:re.gear[o].map(Te=>r.jsx(jt,{targetId:`board-target-${Te.instanceId}`,card:Te,size:"xs",showReadyDot:!0,onClick:()=>Gt(Te)},Te.instanceId))}),r.jsx("div",{style:{height:10}}),r.jsx("div",{className:"rb-row rb-rowTight",children:re.units[s].map(Te=>{const et=(Bt==null?void 0:Bt.unitIds.includes(Te.instanceId))??!1,fe=H&&Te.isReady;return r.jsx(jt,{targetId:`board-target-${Te.instanceId}`,card:Te,size:"xs",selected:et,showReadyDot:!0,onClick:()=>{fe&&As(ke=>{const je={kind:"BF",index:oe};if(!ke||ke.from.kind!=="BF"||ke.from.index!==oe)return{from:je,unitIds:[Te.instanceId]};const Xe=new Set(ke.unitIds);Xe.has(Te.instanceId)?Xe.delete(Te.instanceId):Xe.add(Te.instanceId);const Ze=Array.from(Xe);return Ze.length===0?null:{...ke,unitIds:Ze}})},onDoubleClick:()=>Gt(Te)},Te.instanceId)})}),r.jsx("div",{style:{height:10}}),r.jsx("div",{className:"rb-row rb-rowTight",children:re.gear[s].map(Te=>r.jsx(jt,{targetId:`board-target-${Te.instanceId}`,card:Te,size:"xs",showReadyDot:!0,onClick:()=>Gt(Te)},Te.instanceId))})]})]})]})},An=({pid:oe})=>{const re=A.players[oe],xe=oe===s,Oe=xe&&Le(oe)&&A.priorityPlayer===oe,Te=xe?h:null,et=re.legend?{...re.legend,instanceId:`legend_${oe}`,owner:oe,controller:oe,isReady:re.legendReady,damage:0,buffs:0,tempMightBonus:0,stunned:!1,createdTurn:0}:null;return r.jsxs("div",{style:{display:"flex",width:"100%",gap:20},children:[r.jsxs("div",{style:{display:"flex",gap:10,borderRight:"1px solid rgba(255,255,255,0.05)",paddingRight:10},children:[et?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,alignItems:"center",justifyContent:"center"},children:[r.jsx(jt,{card:et,size:"sm",showReadyDot:!0,onClick:()=>Gt(re.legend)}),Oe?r.jsx("button",{className:"rb-miniButton",style:{fontSize:10,padding:"4px 8px"},disabled:!re.legendReady||!(Te!=null&&Te.ok),onClick:()=>Ge({type:"LEGEND_ACTIVATE",player:oe,autoPay:Mn}),title:Te!=null&&Te.ok?"Activate Legend":Te==null?void 0:Te.reason,children:"Activate"}):null]}):null,re.championZone?r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4,alignItems:"center",justifyContent:"center"},children:r.jsx(jt,{card:re.championZone,size:"sm",showReadyDot:!1,onDoubleClick:()=>{Oe&&td(oe)},onClick:()=>{Oe&&td(oe)}})}):null]}),r.jsxs("div",{style:{flex:"0 0 350px",display:"flex",flexDirection:"column",justifyContent:"center",borderRight:"1px solid rgba(255,255,255,0.05)",paddingRight:10},children:[r.jsxs("div",{className:"rb-row rb-rowTight",style:{flexWrap:"nowrap",overflowX:"auto",overflowY:"hidden",minHeight:80,alignItems:"center"},children:[r.jsx("div",{style:{flexShrink:0,marginRight:12,opacity:re.runeDeck.length>0?1:.4},children:r.jsx(jt,{card:$n(oe,"Rune Deck"),facedown:!0,size:"sm",showReadyDot:!1})}),re.runesInPlay.length===0?r.jsx("span",{className:"rb-softText",style:{margin:"auto"},children:"No Runes"}):null,re.runesInPlay.map(fe=>{const ke=xe?sa==null?void 0:sa.plan.runeUses[fe.instanceId]:void 0,je=or(fe),Xe=["rb-rune",fe.isReady?"":"rb-runeExhausted",ke==="EXHAUST"?"rb-runeGlowExhaust":"",ke==="RECYCLE"?"rb-runeGlowRecycle":"",ke==="BOTH"?"rb-runeGlowBoth":""].filter(Boolean).join(" ");return r.jsx("div",{className:Xe,onClick:()=>xe?Up(s,fe.instanceId):Gt(fe),onContextMenu:Ze=>{xe&&(Ze.preventDefault(),$p(s,fe.instanceId))},title:xe?`${fe.name||"Rune"} (${fe.domain})  L-Click: Exhaust (+1E)  R-Click: Recycle (+1P)`:`${fe.name||"Rune"}`,style:{flexShrink:0},children:je?r.jsx("img",{src:je,alt:fe.name||fe.domain}):null},fe.instanceId)})]}),xe&&r.jsx("div",{className:"rb-actionHint",style:{marginTop:4},children:"Left-click: +1E  Right-click: +1P"})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[r.jsxs("div",{className:"rb-row rb-rowTight",children:[re.base.units.length===0&&re.base.gear.length===0?r.jsx("span",{className:"rb-softText",children:"Empty Base"}):null,re.base.units.map(fe=>r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,alignItems:"center"},children:[r.jsx(jt,{targetId:`board-target-${fe.instanceId}`,card:{...fe},size:"sm",showReadyDot:!0,onClick:()=>{(Bt==null?void 0:Bt.from.kind)==="BASE"&&Bt.unitIds.includes(fe.instanceId)?As(ke=>({...ke,unitIds:ke.unitIds.filter(je=>je!==fe.instanceId)})):fe.isReady&&Le(oe)?As({from:{kind:"BASE"},unitIds:[fe.instanceId]}):Gt(fe)}}),(Bt==null?void 0:Bt.from.kind)==="BASE"&&Bt.unitIds.includes(fe.instanceId)?r.jsx("div",{style:{fontSize:10,color:"var(--cp-neon-cyan)"},children:"[MOVING]"}):null]},fe.instanceId))]}),re.base.gear.length>0&&r.jsx("div",{className:"rb-row rb-rowTight",style:{marginTop:8},children:re.base.gear.map(fe=>{const ke=xe&&Le(s)&&A.priorityPlayer===s,je=ke&&ss(fe)&&!!Dm(fe),Xe=ke&&fe.isReady&&!!Lu(fe),Ze=ke&&fe.isReady&&!!Zc(fe,re.domains),un=xe?vt(A,s).length>0:!1;return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,alignItems:"center"},children:[r.jsx(jt,{targetId:`board-target-${fe.instanceId}`,card:{...fe},size:"sm",showReadyDot:!0,onClick:()=>Gt(fe),onDoubleClick:()=>{if(je){Ge({type:"EQUIP_START",player:s,gearInstanceId:fe.instanceId});return}Xe&&Ge({type:"GEAR_ACTIVATE",player:s,gearInstanceId:fe.instanceId,autoPay:Mn})}}),xe?r.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap",justifyContent:"center",maxWidth:140},children:[je?r.jsx("button",{className:"rb-miniButton",style:{fontSize:9},disabled:!un,onClick:()=>Ge({type:"EQUIP_START",player:s,gearInstanceId:fe.instanceId}),children:"Equip"}):null,Xe?r.jsx("button",{className:"rb-miniButton",style:{fontSize:9},onClick:()=>Ge({type:"GEAR_ACTIVATE",player:s,gearInstanceId:fe.instanceId,autoPay:Mn}),children:"Activate"}):null,Ze?r.jsx("button",{className:"rb-miniButton",style:{fontSize:9},onClick:()=>Ge({type:"SEAL_EXHAUST",player:s,gearInstanceId:fe.instanceId}),children:"Seal +1P"}):null]}):null]},fe.instanceId)})})]})]})},Va=()=>{const oe=f,re=!!xo;return r.jsxs("div",{children:[r.jsxs("div",{className:"rb-zoneLabel",children:["Hand (",oe.hand.length,")"]}),r.jsxs("div",{className:"rb-hand",children:[oe.hand.length===0?r.jsx("span",{className:"rb-softText",children:""}):null,oe.hand.map((xe,Oe)=>{const Te=Si===xe.instanceId,et=(oe.hand.length-1)/2,fe=Math.max(2,Math.min(6,12/Math.max(1,oe.hand.length/2))),ke=(Oe-et)*fe,je=0,Xe=Oe<=1?"rb-handSlotEdgeLeft":Oe>=oe.hand.length-2?"rb-handSlotEdgeRight":"";return r.jsx("div",{className:`rb-handSlot ${Xe}`,style:{"--rb-hand-rot":`${ke}deg`,"--rb-hand-lift":`${je}px`,zIndex:Te?220:Oe+10},onMouseEnter:()=>{if(!Mn||!A||!Le(s))return;if(Ko(xe,A,s)){Wi(null);return}const un=(()=>{const si=Yt(xe.domain).map(ut);return si.length===0||si.includes("Colorless")?f.domains:si})(),Mi=Zo(f.runePool,f.runesInPlay,{energyNeed:xe.cost,basePowerNeed:xe.stats.power||0,powerDomainsAllowed:un,additionalPowerByDomain:{},additionalPowerAny:0},{sealExhaustedThisTurn:f.sealExhaustedThisTurn,seals:f.base.gear,playerDomains:f.domains});Wi(Mi?{cardInstanceId:xe.instanceId,plan:Mi}:null)},onMouseLeave:()=>{Wi(Ze=>(Ze==null?void 0:Ze.cardInstanceId)===xe.instanceId?null:Ze)},children:r.jsx(jt,{card:xe,size:"md",selected:Te,upright:!0,showReadyDot:!1,onClick:()=>{Di(xe.instanceId),ca(null)},onDoubleClick:()=>ar(s,xe.instanceId)})},xe.instanceId)})]}),r.jsx("div",{className:"rb-actionHint",children:A.pendingCandlelitChoice&&A.pendingCandlelitChoice.player===s?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{children:[r.jsx("b",{children:"The Candlelit Sanctum:"})," Recycle one or both cards (optional)."]}),(()=>{const xe=A.pendingCandlelitChoice,Oe=xe.choices||{},Te=xe.cards.filter(je=>(Oe[je.instanceId]||"KEEP")!=="RECYCLE").map(je=>je.instanceId),et=xe.order&&xe.order.length>0?xe.order[0]:Te[0],fe=(je,Xe)=>{xe.choices={...xe.choices,[je]:Xe},Xe==="RECYCLE"&&xe.order&&(xe.order=xe.order.filter(Ze=>Ze!==je)),i({...A})},ke=je=>{const Xe=xe.cards.filter(Ze=>{var un;return(((un=xe.choices)==null?void 0:un[Ze.instanceId])||"KEEP")!=="RECYCLE"}).map(Ze=>Ze.instanceId);xe.order=[je,...Xe.filter(Ze=>Ze!==je)],i({...A})};return r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:xe.cards.map(je=>{const Xe=Oe[je.instanceId]||"KEEP",Ze=Xe!=="RECYCLE";return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,padding:6,border:"1px solid rgba(255,255,255,0.2)",borderRadius:8},children:[r.jsx(jt,{card:je,size:"xs",showReadyDot:!1}),r.jsxs("div",{style:{display:"flex",gap:6},children:[r.jsx("button",{className:"rb-miniButton",style:{background:Xe==="KEEP"?"#16a34a":void 0},onClick:()=>fe(je.instanceId,"KEEP"),children:"Keep"}),r.jsx("button",{className:"rb-miniButton",style:{background:Xe==="RECYCLE"?"#dc2626":void 0},onClick:()=>fe(je.instanceId,"RECYCLE"),children:"Recycle"})]}),Te.length>1&&Ze?r.jsx("button",{className:"rb-miniButton",style:{background:et===je.instanceId?"#2563eb":void 0},onClick:()=>ke(je.instanceId),children:et===je.instanceId?"Top (selected)":"Set as Top"}):null]},je.instanceId)})}),r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>{const je=A.pendingCandlelitChoice,Xe=je.choices||{},Ze=je.cards.filter(D=>(Xe[D.instanceId]||"KEEP")!=="RECYCLE"),un=je.cards.filter(D=>(Xe[D.instanceId]||"KEEP")==="RECYCLE"),Mi=Ze.map(D=>D.instanceId),si=(je.order||[]).filter(D=>Mi.includes(D));for(const D of Mi)si.includes(D)||si.push(D);const ge=si.map(D=>Ze.find(z=>z.instanceId===D)).filter(Boolean),be=A.players[je.player];ge.length>0&&(be.mainDeck=ge.concat(be.mainDeck)),un.length>0&&be.mainDeck.push(...un),A.log.unshift(`${je.player} resolved Candlelit Sanctum (recycled ${un.length}).`),A.pendingCandlelitChoice=null,i({...A})},children:"Confirm Choices"}),r.jsx("span",{className:"rb-softText",children:"Kept cards return on top in chosen order."})]})]})})()]}):A.pendingWeaponmasterChoice&&A.pendingWeaponmasterChoice.unitOwner===s?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{children:[r.jsx("b",{children:"Weaponmaster:"})," You may equip a gear to the unit that just entered play."]}),r.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(()=>{const xe=A.pendingWeaponmasterChoice,Oe=A.players[s];return[...Oe.hand.filter(et=>et.type==="Gear"),...Oe.base.gear].filter(et=>xe.availableGearIds.includes(et.instanceId)).map(et=>r.jsxs("button",{className:"rb-miniButton",onClick:()=>{var ke;const fe=(ke=Me(A,xe.unitOwner,xe.unitInstanceId))==null?void 0:ke.unit;if(fe&&et){const je=Pe(fe,{role:"NONE",game:A}),Xe=Oe.hand.findIndex(Ze=>Ze.instanceId===et.instanceId);if(Xe>=0)Oe.hand.splice(Xe,1);else{const Ze=Oe.base.gear.findIndex(un=>un.instanceId===et.instanceId);Ze>=0&&Oe.base.gear.splice(Ze,1)}fe.attachedGear||(fe.attachedGear=[]),fe.attachedGear.push(et),A.log.unshift(`${et.name} equipped to ${fe.name} (Weaponmaster).`),Sa(A,fe,je)}A.pendingWeaponmasterChoice=null,i({...A})},children:["Equip ",et.name]},et.instanceId))})(),r.jsx("button",{className:"rb-miniButton",onClick:()=>{A.pendingWeaponmasterChoice=null,i({...A})},children:"Skip (No Equip)"})]})]}):A.pendingEquipChoice&&A.pendingEquipChoice.gearOwner===s?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{children:[r.jsx("b",{children:"Equip:"})," Select a unit to attach the equipment to."]}),r.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(()=>{const xe=A.pendingEquipChoice;return f.base.gear.find(Te=>Te.instanceId===xe.gearInstanceId),vt(A,s).map(Te=>r.jsxs("button",{className:"rb-miniButton",onClick:()=>Ge({type:"EQUIP_CONFIRM",player:s,unitInstanceId:Te.instanceId}),children:[Te.name," (M",Pe(Te,{role:"NONE",game:A}),")"]},Te.instanceId))})(),r.jsx("button",{className:"rb-miniButton",onClick:()=>{const xe=A.pendingEquipChoice,Oe=f.base.gear.find(Te=>Te.instanceId===xe.gearInstanceId);Oe&&Ge({type:"SEAL_EXHAUST",player:s,gearInstanceId:Oe.instanceId})},children:"Use Seal for Equip"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>Ge({type:"EQUIP_CANCEL",player:s}),children:"Cancel"})]}),(()=>{var Te;const xe=A.pendingEquipChoice,Oe=f.base.gear.find(et=>et.instanceId===xe.gearInstanceId);return Oe?r.jsxs("div",{className:"rb-softText",children:[Oe.name," (+",((Te=Oe.stats)==null?void 0:Te.might)||0," might) - Cost: ",xe.equipCost.energy>0?`${xe.equipCost.energy}E + `:"",xe.equipCost.power,"P"]}):null})()]}):p?r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("span",{children:["Selected: ",r.jsx("b",{children:p.name})]}),re?r.jsx("span",{className:"rb-softText",children:"Click a battlefield you control to place it facedown."}):null]}):r.jsx("span",{className:"rb-softText",children:"Tip: double-click a card to play it."})})]})},Is=()=>{var xe,Oe,Te,et;if(!ra)return r.jsx("div",{className:"rb-softText",children:"Hover a card to preview it here."});const oe=ra,re=or(oe);return r.jsx("div",{children:r.jsxs("div",{className:"rb-preview",children:[re?r.jsx("img",{src:re,alt:oe.name}):null,r.jsxs("div",{className:"rb-previewText",children:[r.jsx("div",{style:{fontWeight:900,marginBottom:4},children:oe.name}),r.jsxs("div",{className:"rb-softText",style:{marginBottom:6},children:[oe.type,"  ",oe.domain,"  Cost ",oe.cost,"E",(xe=oe.stats)!=null&&xe.power?` + ${oe.stats.power}P`:""]}),(Te=(Oe=oe.ability)==null?void 0:Oe.keywords)!=null&&Te.length?r.jsxs("div",{style:{marginBottom:6},children:["KW: ",oe.ability.keywords.join(", ")]}):null,(et=oe.ability)!=null&&et.effect_text?r.jsx("div",{children:oe.ability.effect_text}):null]})]})})},rt=()=>{if(!A||!N)return null;const oe=f;return r.jsx("div",{className:"rb-modalOverlay",children:r.jsxs("div",{className:"rb-modal",onClick:re=>re.stopPropagation(),children:[r.jsxs("div",{className:"rb-modalHeader",children:[r.jsx("div",{style:{fontWeight:900},children:"Mulligan Overview"}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",justifyContent:"flex-end",alignItems:"center"},children:[r.jsxs("span",{className:"rb-softText",style:{marginRight:8},children:[oe.mulliganSelectedIds.length,"/2 selected"]}),r.jsx("button",{className:"rb-miniButton",disabled:oe.mulliganDone,onClick:()=>ed(s),style:{background:oe.mulliganDone?void 0:"#f43f5e",color:"white",fontWeight:"bold"},children:oe.mulliganDone?"Confirmed":"Confirm Mulligan"})]})]}),r.jsxs("div",{className:"rb-modalBody",children:[r.jsx("div",{className:"rb-softText",style:{marginBottom:16},children:'Select up to 2 cards to shuffle back into your deck and redraw. Switch "playing as" to confirm for the opponent.'}),oe.hand.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,r.jsx("div",{className:"rb-pileGrid",children:oe.hand.map(re=>{const xe=_.has(re.instanceId);return r.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:r.jsx(jt,{card:re,size:"sm",selected:xe,showReadyDot:!1,upright:!0,onClick:()=>zp(s,re.instanceId)})},re.instanceId)})})]})]})})};return r.jsx("div",{className:"rb-grid",children:r.jsx("div",{className:`rb-board ${N?"rb-boardMulligan":"rb-boardLive"}`,children:r.jsxs("div",{className:"rb-boardInner",children:[r.jsxs("div",{className:"rb-hudRow",children:[r.jsxs("div",{className:"rb-hud",children:[r.jsx("div",{className:"rb-avatar",children:d.legend&&or(d.legend)?r.jsx("img",{src:or(d.legend),alt:d.legend.name}):null}),r.jsxs("div",{className:"rb-hudText",children:[r.jsxs("div",{className:"rb-hudName",children:[o,"  ",d.legend?d.legend.name:"Legend"]}),r.jsxs("div",{className:"rb-hudSub",children:["Points ",d.points,"/",A.victoryScore,"  Hand ",d.hand.length,"  Deck ",d.mainDeck.length,"  ",r.jsxs("button",{className:"rb-miniButton",onClick:()=>oa({player:o,zone:"TRASH"}),children:["Trash ",d.trash.length]})]})]})]}),r.jsxs("div",{style:{textAlign:"right",fontSize:12,opacity:.9},children:[r.jsxs("div",{children:["Turn ",A.turnNumber,"  ",r.jsx("b",{children:A.step})]}),r.jsxs("div",{children:["Turn player: ",r.jsx("b",{children:A.turnPlayer}),"  Priority: ",r.jsx("b",{children:A.priorityPlayer})]}),r.jsxs("div",{children:["Chain: ",A.chain.length,"  State: ",A.state," ",A.windowKind!=="NONE"?` ${A.windowKind} @ BF${(A.windowBattlefieldIndex??-1)+1}`:""]})]})]}),ji(),r.jsx(An,{pid:o}),r.jsxs("div",{className:"rb-matRow",children:[r.jsx(ua,{idx:0}),r.jsx(ua,{idx:1})]}),r.jsxs("div",{style:{border:Bt&&H?"1px dashed rgba(130, 210, 255, 0.45)":"1px solid rgba(255,255,255,0.10)",borderRadius:16,padding:10,background:"rgba(0,0,0,0.18)"},onClick:()=>{Bt&&H&&Bt.from.kind!=="BASE"&&Fp(s,Bt.from,Bt.unitIds,{kind:"BASE"})},children:[r.jsx(An,{pid:s}),Bt&&H?r.jsxs("div",{className:"rb-actionHint",children:["Move armed: click a battlefield (or this base panel) to move selected ready units."," ",r.jsx("button",{className:"rb-miniButton",onClick:()=>As(null),children:"Cancel move"})]}):null]}),r.jsx("div",{className:"rb-playerLaneBottom rb-handLane",style:{gridTemplateColumns:"1fr"},children:r.jsxs("div",{className:"rb-handCenter",children:[Va(),Ut()]})}),"            ",r.jsx("div",{className:"rb-floating-preview",style:{opacity:ra?1:0,transition:"opacity 0.2s ease"},children:Is()}),r.jsxs("div",{className:"rb-floating-log",children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontWeight:"bold",fontSize:13,textTransform:"uppercase",letterSpacing:1},children:"Game Log"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>Lt(oe=>oe.log=[]),children:"Clear"})]}),r.jsxs("div",{style:{flex:1,overflowY:"auto",fontSize:12,display:"flex",flexDirection:"column-reverse"},children:[A.log.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,A.log.slice(0,30).reverse().map((oe,re)=>r.jsx("div",{style:{padding:"4px 0",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:oe},re))]})]}),A.chain.length>0&&r.jsxs("div",{className:"rb-floating-chain",children:[r.jsxs("div",{style:{fontWeight:"bold",fontSize:13,textTransform:"uppercase",letterSpacing:1,textAlign:"center",marginBottom:12},children:["Chain (",A.chain.length,")"]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:A.chain.map((oe,re)=>{var et;const xe=re===0;oe.id;const Oe=((et=oe.targets)==null?void 0:et.filter(fe=>fe.kind==="UNIT").map(fe=>{const ke=Me(A,fe.owner,fe.instanceId);return(ke==null?void 0:ke.unit.name)||"Unknown"}))||[];let Te=oe.sourceCard||null;return!Te&&oe.sourceInstanceId&&(Te=[...A.battlefields.flatMap(ke=>[...ke.units.P1,...ke.units.P2,...ke.gear.P1,...ke.gear.P2]),...A.players.P1.base.units,...A.players.P2.base.units,...A.players.P1.base.gear,...A.players.P2.base.gear,...A.players.P1.hand,...A.players.P2.hand,...A.players.P1.runesInPlay,...A.players.P2.runesInPlay,A.players.P1.championZone,A.players.P2.championZone].filter(Boolean).find(ke=>ke&&ke.instanceId===oe.sourceInstanceId)||null),r.jsx("div",{id:`chain-source-${oe.id}`,className:`rb-chainItem ${xe?"rb-chainItemActive":""}`,style:{display:"flex",flexDirection:"column",alignItems:"center",background:"transparent",border:"none",padding:0},onClick:()=>{Te&&Gt(Te)},onMouseEnter:()=>Ti(oe.id),onMouseLeave:()=>Ti(null),children:r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[Te?r.jsxs("div",{style:{marginBottom:4,position:"relative"},children:[r.jsx(jt,{card:Te,size:"sm",upright:!0}),xe&&r.jsx("div",{style:{position:"absolute",top:-10,right:-10,background:"#ef4444",color:"white",fontSize:10,padding:"2px 6px",borderRadius:4,fontWeight:"bold"},children:"TOP"})]}):r.jsxs("div",{className:"rb-chainItemLabel",style:{textAlign:"center",marginBottom:4,width:"100%",padding:"16px 8px",background:"#1e293b",borderRadius:8},children:[xe?" ":"",oe.label]}),Oe.length>0&&r.jsxs("div",{className:"rb-chainArrowLabel",style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:4},children:[r.jsx("span",{className:"rb-chainArrowLine",style:{transform:"rotate(90deg)",margin:"4px 0",display:"inline-block"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:Oe.map((fe,ke)=>r.jsxs("span",{className:"rb-chainTargetBadge",children:[" ",fe]},ke))})]}),(oe.targets||[]).filter(fe=>fe.kind==="BATTLEFIELD").map((fe,ke)=>r.jsxs("div",{className:"rb-chainArrowLabel",style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:4},children:[r.jsx("span",{className:"rb-chainArrowLine",style:{transform:"rotate(90deg)",margin:"4px 0",display:"inline-block"},children:""}),r.jsxs("span",{className:"rb-chainTargetBadge",style:{borderColor:"rgba(243, 255, 0, 0.5)",color:"#eab308"},children:[" BF",fe.index+1]})]},`bf-${ke}`)),oe.needsTargets&&r.jsxs("div",{className:"rb-chainArrowLabel",style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:4},children:[r.jsx("span",{className:"rb-chainArrowLine",style:{transform:"rotate(90deg)",margin:"4px 0",display:"inline-block",color:"#f97316"},children:""}),r.jsx("span",{className:"rb-chainTargetBadge",style:{borderColor:"#f97316",color:"#f97316",background:"rgba(249, 115, 22, 0.1)"},children:" Awaiting target"})]})]})},oe.id)})})]}),r.jsxs("div",{className:"rb-hudTopRight",children:[r.jsxs("div",{style:{background:"rgba(0,0,0,0.6)",padding:"8px 12px",borderRadius:8,backdropFilter:"blur(4px)",display:"flex",gap:8,flexDirection:"column"},children:[r.jsxs("div",{style:{fontSize:12,fontWeight:"bold"},children:[r.jsx("b",{children:s})," Pool"]}),r.jsxs("div",{style:{fontSize:13},children:[f.runePool.energy,"E  ",gc(f.runePool),"P"]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:["(",e1(f.runePool),")"]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:11,cursor:"pointer",marginTop:4,background:"rgba(255,255,255,0.05)",padding:4,borderRadius:4},children:[r.jsx("input",{type:"checkbox",checked:Mn,onChange:oe=>Zl(oe.target.checked)}),"Auto-pay runes"]})]}),r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsxs("button",{className:"rb-miniButton",onClick:()=>oa({player:o,zone:"TRASH"}),children:["Op Trash (",d.trash.length,")"]}),r.jsxs("button",{className:"rb-miniButton",onClick:()=>oa({player:s,zone:"TRASH"}),children:["My Trash (",f.trash.length,")"]})]}),r.jsxs("details",{className:"rb-debugPanel",style:{background:"rgba(0,0,0,0.5)",borderRadius:8,padding:"4px 8px"},children:[r.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#f43f5e",outline:"none"},children:"Debug"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:4},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>wu("Arena"),disabled:bo==="Arena",children:"Arena"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>wu("Classic"),disabled:bo==="Classic",children:"Classic"}),r.jsx("button",{className:"rb-miniButton",disabled:ti.current.length===0,onClick:Ix,children:"Undo"})]})]})]}),r.jsx(n1,{chain:A.chain}),rt()]})})})},s1=()=>{const s=o=>{o.current=!0,Su("/riftbound_data_expert%20(1).json").then(f=>Du(f)).catch(f=>{o.current=!1,alert(String(f))})};return r.jsxs("div",{style:{maxWidth:720,margin:"28px auto"},className:"rb-panel",children:[r.jsx("div",{className:"rb-panelTitle",children:"Setup"}),r.jsx("div",{style:{fontSize:20,fontWeight:900,marginBottom:8},children:"Load card data and start a duel"}),r.jsx("div",{className:"rb-softText",style:{marginBottom:12},children:"Load the provided JSON card database, then auto-setup a hot-seat Duel."}),r.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[r.jsx("input",{type:"file",accept:".json,application/json",onChange:o=>{var d;const f=(d=o.target.files)==null?void 0:d[0];f&&cx(f).catch(h=>alert(String(h)))}}),r.jsx("button",{className:"rb-miniButton",onClick:()=>Su("/riftbound_data_expert%20(1).json").catch(o=>alert(String(o))),children:"Load default card data"}),r.jsxs("div",{className:"rb-softText",children:["Loaded cards: ",r.jsx("b",{children:e.length})]})]}),r.jsxs("div",{style:{marginTop:14,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[r.jsx("button",{className:"rb-bigButton",style:{maxWidth:320},disabled:e.length===0,onClick:()=>Du(),children:"Auto-setup Duel (Hot-seat)"}),r.jsx("button",{className:"rb-bigButton",style:{maxWidth:260},disabled:e.length===0,onClick:()=>y("DECK_BUILDER"),children:"Deck Builder"}),r.jsx("button",{id:"rb-quick-start",className:"rb-bigButton",style:{maxWidth:300},onClick:()=>{Su("/riftbound_data_expert%20(1).json").then(o=>Du(o)).catch(o=>alert(String(o)))},children:"Quick Start (local data)"}),r.jsx("button",{id:"rb-quick-retreat-challenge-repro",className:"rb-bigButton",style:{maxWidth:360},onClick:()=>s(zu),children:"Quick Retreat->Challenge Repro"}),r.jsx("button",{id:"rb-quick-cull-weak-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Gu),children:"Quick Cull the Weak Repro"}),r.jsx("button",{id:"rb-quick-conditional-audit-repro",className:"rb-bigButton",style:{maxWidth:360},onClick:()=>s(Hu),children:"Quick Conditional Audit Repro"}),r.jsx("button",{id:"rb-quick-seal-autopay-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Yu),children:"Quick Seal Auto-pay Repro"}),r.jsx("button",{id:"rb-quick-gold-token-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Fu),children:"Quick Gold Token Repro"}),r.jsx("button",{id:"rb-quick-battlefield-audit-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(qu),children:"Quick Battlefield Audit Repro"}),r.jsx("button",{id:"rb-quick-legend-audit-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Wu),children:"Quick Legend Audit Repro"}),r.jsx("button",{id:"rb-quick-champion-audit-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Ku),children:"Quick Champion Audit Repro"}),r.jsx("button",{id:"rb-quick-spell-audit-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Vu),children:"Quick Spell Audit Repro"}),r.jsx("button",{id:"rb-quick-gear-audit-repro",className:"rb-bigButton",style:{maxWidth:320},onClick:()=>s(Qu),children:"Quick Gear Audit Repro"}),r.jsx("button",{id:"rb-quick-equip-additional-repro",className:"rb-bigButton",style:{maxWidth:360},onClick:()=>s(Xu),children:"Quick Equip/Additional Repro"}),r.jsx("div",{className:"rb-softText",children:"Tip: once started, switch playing as to take actions for each player."})]})]})},a1=()=>{const s=v,o=Q[s]||tn(),f=e.filter(D=>D.type==="Legend").slice().sort((D,z)=>(D.name||"").localeCompare(z.name||"")),d=e.filter(D=>D.type==="Rune").slice().sort((D,z)=>(D.name||"").localeCompare(z.name||"")),h=e.filter(D=>D.type==="Battlefield").slice().sort((D,z)=>(D.name||"").localeCompare(z.name||"")),p=e.filter(D=>Cl(D.type)).slice().sort((D,z)=>{const ye=Number(D.cost||0),De=Number(z.cost||0);return ye!==De?ye-De:(D.name||"").localeCompare(z.name||"")}),b=o.legendId?nn(e,o.legendId):null,m=b?oh(b):["Body","Calm","Chaos","Fury","Mind","Order"],C=b&&(b.tags||[])[0]||null,N=b?h.filter(D=>va(D,m)):h,_=b?d.filter(D=>{const z=(Yt(D.domain)[0]||D.domain||"Colorless").trim(),ye=ut(z);return ye==="Colorless"||m.includes(ye)}):d,H=b?p.filter(D=>va(D,m)):p,W=b?H.filter(D=>Gm(D,C)):[],$=Sn(o.main),Z=Sn(o.runes),M=(D,z="")=>({...D,instanceId:`preview_${s}_${z}_${D.id}`,owner:s,controller:s,isReady:!0,damage:0,buffs:0,tempMightBonus:0,stunned:!1,stunnedUntilTurn:0,moveCountThisTurn:0,createdTurn:0}),B=(D,z)=>{const ye=[],De=z.legendId?nn(e,z.legendId):null;(!De||De.type!=="Legend")&&ye.push("Select a Legend.");const Ae=z.championId?nn(e,z.championId):null;(!Ae||Ae.type!=="Unit")&&ye.push("Select a chosen Champion (Unit).");const Ht=z.battlefields||[];Ht.length!==3&&ye.push(`Choose exactly 3 battlefields (currently ${Ht.length}).`);const zn=Sn(z.runes||{});zn!==12&&ye.push(`Rune deck must have exactly 12 cards (currently ${zn}).`);const Pi=Sn(z.main||{});Pi<40&&ye.push(`Main deck must have at least 40 cards (currently ${Pi}).`),Ae&&Ae.type==="Unit"&&Math.floor((z.main||{})[Ae.id]||0)<1&&ye.push("Main deck must include at least 1 copy of the chosen Champion.");try{tl(e,D,z,1)}catch(da){const Qa=String((da==null?void 0:da.message)||da);ye.includes(Qa)||ye.push(Qa)}return ye},Y=B("P1",Q.P1),L=B("P2",Q.P2),ie=s==="P1"?Y:L,de=e.length>0&&Y.length===0&&L.length===0,me=Ga("P1"),ae=Ga("P2"),Ve=(R==null?void 0:R.format)==="BO3"&&(R!=null&&R.usedBattlefieldIds)?R.usedBattlefieldIds:{P1:[],P2:[]},Se=me.filter(D=>!Ve.P1.includes(D.id)),Qe=ae.filter(D=>!Ve.P2.includes(D.id)),Je=Se.length>0?Se:me,it=Qe.length>0?Qe:ae;let He=H;qi!=="All"&&(He=He.filter(D=>D.type===qi));const Rt=Vl.trim().toLowerCase();Rt&&(He=He.filter(D=>(D.name||"").toLowerCase().includes(Rt)||(D.id||"").toLowerCase().includes(Rt))),He=He.slice(0,96);const Cs=Object.entries(o.main).map(([D,z])=>({id:D,n:z,card:nn(e,D)})).filter(D=>D.card!==null&&(D.n||0)>0).sort((D,z)=>{const ye=D.card.type||"",De=z.card.type||"";if(ye!==De)return ye.localeCompare(De);const Ae=Number(D.card.cost||0),Ht=Number(z.card.cost||0);return Ae!==Ht?Ae-Ht:(D.card.name||"").localeCompare(z.card.name||"")}),cn=Object.entries(o.sideboard||{}).map(([D,z])=>({id:D,n:z,card:nn(e,D)})).filter(D=>D.card!==null&&(D.n||0)>0).sort((D,z)=>{const ye=D.card.type||"",De=z.card.type||"";if(ye!==De)return ye.localeCompare(De);const Ae=Number(D.card.cost||0),Ht=Number(z.card.cost||0);return Ae!==Ht?Ae-Ht:(D.card.name||"").localeCompare(z.card.name||"")}),Bi=Sn(o.sideboard||{}),$n=(b==null?void 0:b.name)||"",ji=b?m.join(", "):"",Ut=D=>{on(s,z=>{const ye=z.battlefields||[];return ye.includes(D)?{...z,battlefields:ye.filter(De=>De!==D),sideboard:z.sideboard||{}}:ye.length>=3?z:{...z,battlefields:[...ye,D],sideboard:z.sideboard||{}}})},ua=()=>{e.length!==0&&on(s,D=>{const z=D.legendId?nn(e,D.legendId):null,ye=z&&z.type==="Legend"?z:f[0]||null;if(!ye)return{...D,sideboard:D.sideboard||{}};const De=oh(ye),Ae=(ye.tags||[])[0]||null,zn=e.filter(Ot=>Gm(Ot,Ae)).filter(Ot=>va(Ot,De))[0]||e.find(Ot=>Ot.type==="Unit")||null,Pi=h.filter(Ot=>va(Ot,De)),da=Hi(Pi,777).slice(0,3).map(Ot=>Ot.id),Qa={};for(const Ot of d){const ld=(Yt(Ot.domain)[0]||Ot.domain||"Colorless").trim(),So=ut(ld);Qa[So]||(Qa[So]=Ot)}const sd={},Io=De.length>0?De:["Body","Calm","Chaos","Fury","Mind","Order"],x1=Math.floor(12/Io.length),E1=12%Io.length;for(let Ot=0;Ot<Io.length;Ot++){const ld=Io[Ot],So=x1+(Ot<E1?1:0),rd=Qa[ld]||d[0];rd&&(sd[rd.id]=(sd[rd.id]||0)+So)}const T1=H.length>0?H:p,Xa={};zn&&zn.id&&(Xa[zn.id]=1);const v1=3,ad=Hi(T1,888);let Vp=0;for(;Sn(Xa)<40&&ad.length>0;){const Ot=ad[Vp%ad.length];if(Vp++,!Ot)break;Xa[Ot.id]>=v1||(Xa[Ot.id]=(Xa[Ot.id]||0)+1)}return{legendId:ye.id,championId:zn?zn.id:null,battlefields:da,runes:sd,main:Xa,sideboard:D.sideboard||{}}})},An=async()=>{const D=JSON.stringify(Q,null,2);try{await navigator.clipboard.writeText(D),alert("Decks JSON copied to clipboard.")}catch{window.prompt("Copy decks JSON:",D)}},Va=()=>{const D=window.prompt("Paste decks JSON here:");if(D)try{const z=JSON.parse(D);if(!(z!=null&&z.P1)||!(z!=null&&z.P2))throw new Error("Expected object with {P1, P2}.");ce({P1:z.P1,P2:z.P2}),alert("Imported.")}catch(z){alert(`Import failed: ${String((z==null?void 0:z.message)||z)}`)}},Is=D=>!!D&&typeof D=="object"&&"legendId"in D&&"main"in D&&"runes"in D&&"battlefields"in D,rt=ze&&Ue.find(D=>D.id===ze)||null,oe=V.trim().toLowerCase(),re=ve.trim().toLowerCase(),xe=Ue.filter(D=>{const z=(D.name||"").toLowerCase(),ye=(D.tags||[]).map(De=>String(De).toLowerCase());return!(oe&&!z.includes(oe)&&!ye.some(De=>De.includes(oe))||re&&!ye.some(De=>De.includes(re)))}),Oe=(D,z)=>{ce(ye=>({...ye,[z]:is(D.spec)})),mi(D.name||""),gi((D.tags||[]).join(", ")),_e(D.id)},Te=D=>{const z=D.legendId?nn(e,D.legendId):null,ye=D.championId?nn(e,D.championId):null,De=(z==null?void 0:z.name)||"Legend",Ae=(ye==null?void 0:ye.name)||"Champion";return`${De}  ${Ae}`},et=D=>String(D||"").split(",").map(z=>z.trim()).filter(z=>z.length>0).slice(0,16),fe=()=>{const D=(F&&F.trim().length>0?F.trim():Te(o)).trim();if(!D)return;const z={id:We(),name:D,tags:et(jn),spec:is(o),createdAt:Date.now(),updatedAt:Date.now()};Ke(ye=>[z,...ye]),_e(z.id)},ke=()=>{if(!ze){alert("Select a saved deck first.");return}Ke(D=>D.map(z=>z.id===ze?{...z,spec:is(o),updatedAt:Date.now()}:z)),alert("Updated saved deck.")},je=()=>{if(!rt)return;const D=window.prompt("New name:",rt.name);D&&Ke(z=>z.map(ye=>ye.id===rt.id?{...ye,name:D,updatedAt:Date.now()}:ye))},Xe=D=>{if(!rt)return;const z=et(D);Ke(ye=>ye.map(De=>De.id===rt.id?{...De,tags:z,updatedAt:Date.now()}:De))},Ze=()=>{if(!rt)return;const D=window.prompt("Name for duplicate:",`${rt.name} (copy)`);if(!D)return;const z={id:We(),name:D,tags:is(rt.tags||[]),spec:is(rt.spec),createdAt:Date.now(),updatedAt:Date.now()};Ke(ye=>[z,...ye]),_e(z.id)},un=()=>{rt&&confirm(`Delete "${rt.name}" from library?`)&&(Ke(D=>D.filter(z=>z.id!==rt.id)),ze===rt.id&&_e(null))},Mi=async()=>{if(!rt){alert("Select a saved deck first.");return}const D=JSON.stringify(rt.spec,null,2);try{await navigator.clipboard.writeText(D),alert("Deck JSON copied to clipboard.")}catch{window.prompt("Copy deck JSON:",D)}},si=()=>{const D=window.prompt("Paste a single DeckSpec JSON here:");if(D)try{const z=JSON.parse(D);if(!Is(z))throw new Error("Not a DeckSpec.");const ye=window.prompt("Deck name:",Te(z));if(!ye)return;const De={id:We(),name:ye,tags:[],spec:z,createdAt:Date.now(),updatedAt:Date.now()};Ke(Ae=>[De,...Ae]),_e(De.id),alert("Imported deck into library.")}catch(z){alert(`Import failed: ${String((z==null?void 0:z.message)||z)}`)}},ge=async()=>{const D=JSON.stringify(Ue,null,2);try{await navigator.clipboard.writeText(D),alert("Deck library JSON copied to clipboard.")}catch{window.prompt("Copy deck library JSON:",D)}},be=()=>{const D=window.prompt("Paste Deck Library JSON (array of entries) here:");if(D)try{const z=JSON.parse(D);if(!Array.isArray(z))throw new Error("Expected an array.");const ye=z.filter(Ae=>Ae&&typeof Ae=="object").map(Ae=>{if(!Is(Ae.spec))throw new Error("Entry missing spec DeckSpec.");return{id:String(Ae.id||We()),name:String(Ae.name||"Imported Deck"),tags:Array.isArray(Ae.tags)?Ae.tags.map(Ht=>String(Ht)).filter(Boolean):[],spec:Ae.spec,createdAt:Number(Ae.createdAt||Date.now()),updatedAt:Number(Ae.updatedAt||Date.now())}}),De=confirm("Replace your existing deck library? (Cancel = merge)");Ke(De?ye:Ae=>{const Ht=new Set(Ae.map(Pi=>Pi.id));return[...ye.map(Pi=>Ht.has(Pi.id)?{...Pi,id:We()}:Pi),...Ae]}),alert("Imported deck library.")}catch(z){alert(`Import failed: ${String((z==null?void 0:z.message)||z)}`)}};return r.jsx("div",{style:{maxWidth:"100%",width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"12px",overflow:"hidden",boxSizing:"border-box"},children:r.jsxs("div",{className:"rb-panel",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",padding:"16px"},children:[r.jsx("div",{className:"rb-panelTitle",children:"Deck Builder"}),r.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginTop:8},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>y("SETUP"),children:" Back"}),r.jsx("button",{className:"rb-miniButton",disabled:e.length===0,onClick:An,children:"Export decks"}),r.jsx("button",{className:"rb-miniButton",disabled:e.length===0,onClick:Va,children:"Import decks"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>{confirm("Clear BOTH decks?")&&ce({P1:tn(),P2:tn()})},children:"Clear all"}),r.jsx("div",{style:{flex:1}}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end",marginRight:8},children:[r.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[r.jsx("span",{className:"rb-softText",style:{fontWeight:900},children:"Match"}),r.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},className:"rb-softText",children:[r.jsx("input",{type:"radio",name:"matchfmt",checked:E==="BO1",onChange:()=>{I("BO1"),q(null),K(null),k({P1:null,P2:null})}}),"Best of 1 (random battlefields)"]}),r.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},className:"rb-softText",children:[r.jsx("input",{type:"radio",name:"matchfmt",checked:E==="BO3",onChange:()=>{var D,z;I("BO3"),q(null),K(null),k({P1:((D=Je[0])==null?void 0:D.id)??null,P2:((z=it[0])==null?void 0:z.id)??null})}}),"Best of 3 (pick each game; no repeats)"]})]}),E==="BO3"&&de?r.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[r.jsx("span",{className:"rb-softText",children:"Game 1 battlefields:"}),r.jsx("span",{className:"rb-softText",children:"P1"}),r.jsx("select",{value:O.P1??"",onChange:D=>k(z=>({...z,P1:D.target.value||null})),children:Je.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))}),r.jsx("span",{className:"rb-softText",children:"P2"}),r.jsx("select",{value:O.P2??"",onChange:D=>k(z=>({...z,P2:D.target.value||null})),children:it.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))})]}):null]}),r.jsx("button",{className:"rb-bigButton",style:{maxWidth:280},disabled:!de,onClick:()=>ku(),children:"Start Duel from Decks"})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10,marginTop:10,paddingTop:10,borderTop:"1px solid rgba(255,255,255,0.10)"},children:[r.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-start"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[r.jsx("input",{className:"rb-input",placeholder:"Search library (name or tag)",value:V,onChange:D=>we(D.target.value),style:{width:260}}),r.jsx("input",{className:"rb-input",placeholder:"Filter by tag",value:ve,onChange:D=>Ne(D.target.value),style:{width:260}})]}),r.jsx("div",{style:{flex:1}}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,minWidth:320},children:[r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[r.jsx("input",{className:"rb-input",placeholder:"Save current as",value:F,onChange:D=>mi(D.target.value),style:{flex:1,minWidth:200}}),r.jsx("button",{className:"rb-miniButton",onClick:fe,title:"Save the current builder deck as a new library entry",children:"Save as new"})]}),r.jsx("input",{className:"rb-input",placeholder:"Tags (comma separated)",value:jn,onChange:D=>gi(D.target.value)})]})]}),r.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-start"},children:[r.jsxs("div",{style:{minWidth:320,flex:1},children:[r.jsxs("div",{className:"rb-softText",style:{marginBottom:6},children:["Library (",xe.length,"/",Ue.length,")  drag to reorder"]}),r.jsx("div",{style:{border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,overflow:"hidden",background:"rgba(0,0,0,0.18)",maxHeight:220,overflowY:"auto"},children:xe.length===0?r.jsx("div",{className:"rb-softText",style:{padding:10},children:"No decks match your filters."}):xe.map((D,z)=>{const ye=D.id===ze,De=(D.tags||[]).join(", ");return r.jsxs("div",{draggable:!0,onDragStart:()=>ei(D.id),onDragEnd:()=>ei(null),onDragOver:Ae=>Ae.preventDefault(),onDrop:()=>{Ce&&Ce!==D.id&&xu(Ce,D.id)},onClick:()=>_e(D.id),style:{padding:"10px 12px",cursor:"pointer",borderTop:z===0?"none":"1px solid rgba(255,255,255,0.08)",background:ye?"rgba(255,255,255,0.10)":"transparent",userSelect:"none"},title:"Click to select  Drag to reorder",children:[r.jsx("div",{style:{fontWeight:800},children:D.name}),r.jsx("div",{className:"rb-softText",style:{marginTop:2},children:De||""})]},D.id)})})]}),r.jsxs("div",{style:{minWidth:320,flex:1},children:[r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[r.jsxs("select",{className:"rb-input",value:ze||"",onChange:D=>_e(D.target.value||null),style:{flex:1,minWidth:200},children:[r.jsx("option",{value:"",children:" Select saved deck "}),xe.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))]}),r.jsxs("button",{className:"rb-miniButton",disabled:!rt,onClick:()=>rt&&Oe(rt,v),title:`Load selected deck into ${v}`,children:["Load  ",v]})]}),rt?r.jsxs("div",{style:{marginTop:8},children:[r.jsx("div",{className:"rb-softText",style:{marginBottom:4},children:"Tags for selected deck"}),r.jsx("input",{className:"rb-input",value:(rt.tags||[]).join(", "),onChange:D=>Xe(D.target.value),placeholder:"tags"}),r.jsxs("div",{className:"rb-softText",style:{marginTop:6},children:["Selected: ",r.jsx("b",{children:rt.name}),"  Updated ",new Date(rt.updatedAt).toLocaleString()]})]}):r.jsx("div",{className:"rb-softText",style:{marginTop:8},children:"Save multiple decks here, then load them into either P1 or P2."}),r.jsxs("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:[r.jsx("button",{className:"rb-miniButton",disabled:!rt,onClick:ke,title:"Overwrite the selected library deck with the current builder deck",children:"Update"}),r.jsx("button",{className:"rb-miniButton",disabled:!rt,onClick:je,children:"Rename"}),r.jsx("button",{className:"rb-miniButton",disabled:!rt,onClick:Ze,children:"Duplicate"}),r.jsx("button",{className:"rb-miniButton",disabled:!rt,onClick:un,children:"Delete"}),r.jsx("div",{style:{flex:1}}),r.jsx("button",{className:"rb-miniButton",disabled:!rt,onClick:Mi,children:"Export Deck"}),r.jsx("button",{className:"rb-miniButton",onClick:si,children:"Import Deck"}),r.jsx("button",{className:"rb-miniButton",onClick:ge,children:"Export Library"}),r.jsx("button",{className:"rb-miniButton",onClick:be,children:"Import Library"})]})]})]})]}),r.jsxs("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:[r.jsx("button",{className:"rb-miniButton",disabled:v==="P1",onClick:()=>g("P1"),children:"Edit P1"}),r.jsx("button",{className:"rb-miniButton",disabled:v==="P2",onClick:()=>g("P2"),children:"Edit P2"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>{ce(D=>({...D,P2:JSON.parse(JSON.stringify(D.P1))}))},children:"Copy P1  P2"}),r.jsxs("button",{className:"rb-miniButton",onClick:()=>on(s,()=>tn()),children:["Clear ",s]}),r.jsxs("button",{className:"rb-miniButton",disabled:e.length===0,onClick:ua,children:["Auto-fill ",s]})]}),r.jsxs("div",{style:{marginTop:10},className:"rb-softText",children:["Editing ",r.jsx("b",{children:s}),"  Legend: ",r.jsx("b",{children:$n}),"  Identity: ",r.jsx("b",{children:ji})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(280px, 340px) minmax(min-content, 1fr) minmax(280px, 340px)",gap:12,marginTop:12,alignItems:"start",flex:1,minHeight:0,overflow:"hidden"},children:[r.jsxs("div",{className:"rb-panel",style:{height:"100%",overflowY:"auto"},children:[r.jsx("div",{className:"rb-panelTitle",children:"Deck configuration"}),r.jsx("div",{className:"rb-zoneLabel",children:"Legend"}),r.jsxs("select",{value:o.legendId||"",onChange:D=>{const z=D.target.value||null;on(s,ye=>({...ye,legendId:z,championId:null,battlefields:[],runes:{},main:{}}))},style:{width:"100%",padding:8,borderRadius:10,background:"rgba(0,0,0,0.25)",color:"white",border:"1px solid rgba(255,255,255,0.12)"},children:[r.jsx("option",{value:"",children:" Select Legend "}),f.map(D=>r.jsxs("option",{value:D.id,children:[D.name," (",D.domain,")"]},D.id))]}),r.jsx("div",{style:{height:12}}),r.jsx("div",{className:"rb-zoneLabel",children:"Chosen Champion"}),r.jsxs("select",{value:o.championId||"",onChange:D=>{const z=D.target.value||null;on(s,ye=>{const De={...ye.main||{}};return z&&(De[z]||0)<1&&(De[z]=1),{...ye,championId:z,main:De}})},disabled:!b,style:{width:"100%",padding:8,borderRadius:10,background:"rgba(0,0,0,0.25)",color:"white",border:"1px solid rgba(255,255,255,0.12)"},children:[r.jsx("option",{value:"",children:" Select Champion "}),W.map(D=>r.jsxs("option",{value:D.id,children:[D.name," (cost ",D.cost,")"]},D.id))]}),b?null:r.jsx("div",{className:"rb-softText",style:{marginTop:6},children:"Pick a Legend first (to filter legal Champions)."}),r.jsx("div",{style:{height:12}}),r.jsx("div",{className:"rb-zoneLabel",children:"Battlefields (pick 3)"}),r.jsxs("div",{style:{maxHeight:240,overflow:"auto",border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:8},children:[N.map(D=>{const z=(o.battlefields||[]).includes(D.id);return r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 4px",borderRadius:10},children:[r.jsx("input",{type:"checkbox",checked:z,onChange:()=>Ut(D.id)}),r.jsx("div",{style:{fontSize:12,fontWeight:800,flex:1,minWidth:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:D.name}),r.jsx("div",{style:{fontSize:11,opacity:.85},children:D.domain})]},D.id)}),N.length===0?r.jsx("div",{className:"rb-softText",children:""}):null]}),r.jsx("div",{style:{height:12}}),r.jsx("div",{className:"rb-zoneLabel",children:"Rune deck (exactly 12)"}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[_.map(D=>{const z=Math.floor((o.runes||{})[D.id]||0);return r.jsxs("div",{style:{width:150,border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:8},children:[r.jsx("div",{style:{fontSize:12,fontWeight:900},children:D.name}),r.jsx("div",{style:{fontSize:11,opacity:.8},children:D.domain}),r.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginTop:6},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>on(s,ye=>({...ye,runes:gn(ye.runes||{},D.id,-1,0,null)})),children:""}),r.jsx("div",{style:{minWidth:24,textAlign:"center",fontWeight:900},children:z}),r.jsx("button",{className:"rb-miniButton",onClick:()=>on(s,ye=>({...ye,runes:gn(ye.runes||{},D.id,1,0,null)})),children:"+"})]})]},D.id)}),_.length===0?r.jsx("div",{className:"rb-softText",children:""}):null]}),r.jsx("div",{style:{height:10}}),r.jsxs("div",{className:"rb-softText",children:["Main deck: ",r.jsx("b",{children:$})," cards  Rune deck: ",r.jsx("b",{children:Z}),"/12"]})]}),r.jsxs("div",{className:"rb-panel",style:{height:"100%",overflowY:"auto",display:"flex",flexDirection:"column"},children:[r.jsx("div",{className:"rb-panelTitle",children:"Card browser"}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[r.jsx("input",{value:Vl,onChange:D=>pp(D.target.value),placeholder:"Search cards (name or id)",style:{flex:1,minWidth:220,padding:"9px 10px",borderRadius:12,background:"rgba(0,0,0,0.25)",color:"white",border:"1px solid rgba(255,255,255,0.12)"}}),r.jsxs("select",{value:qi,onChange:D=>Ql(D.target.value),style:{padding:"9px 10px",borderRadius:12,background:"rgba(0,0,0,0.25)",color:"white",border:"1px solid rgba(255,255,255,0.12)"},children:[r.jsx("option",{value:"All",children:"All"}),r.jsx("option",{value:"Unit",children:"Units"}),r.jsx("option",{value:"Spell",children:"Spells"}),r.jsx("option",{value:"Gear",children:"Gear"})]})]}),r.jsxs("div",{className:"rb-softText",style:{marginTop:8},children:["Showing ",r.jsx("b",{children:He.length})," cards (filtered to identity where possible)."]}),r.jsx("div",{style:{marginTop:10,flex:1,overflow:"auto",border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:8},children:r.jsxs("div",{className:"rb-row",style:{flexWrap:"wrap",gap:8},children:[He.map(D=>{const z=Math.floor((o.main||{})[D.id]||0),ye=M(D,"browse");return r.jsxs("div",{style:{width:118,display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:4,borderRadius:8,background:z>0?"rgba(130, 210, 255, 0.1)":"transparent"},children:[r.jsx(jt,{card:ye,size:"xs",showReadyDot:!1,onClick:()=>Gt(ye)}),r.jsx("div",{style:{fontSize:10,fontWeight:800,textAlign:"center",maxWidth:110,lineHeight:1.1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name}),r.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center",marginTop:2},children:[r.jsx("button",{className:"rb-miniButton",style:{padding:"4px 10px",fontSize:14,fontWeight:900},onClick:De=>{De.stopPropagation(),on(s,Ae=>({...Ae,main:gn(Ae.main||{},D.id,-1,0,3)}))},disabled:z<=0,children:""}),r.jsx("div",{style:{minWidth:20,textAlign:"center",fontWeight:900,fontSize:12},children:z}),r.jsx("button",{className:"rb-miniButton",style:{padding:"4px 10px",fontSize:14,fontWeight:900},onClick:De=>{De.stopPropagation(),on(s,Ae=>({...Ae,main:gn(Ae.main||{},D.id,1,0,3)}))},disabled:z>=3,children:"+"})]})]},D.id)}),He.length===0?r.jsx("div",{className:"rb-softText",children:"No results."}):null]})})]}),r.jsxs("div",{className:"rb-panel",style:{height:"100%",overflowY:"auto",display:"flex",flexDirection:"column"},children:[r.jsx("div",{className:"rb-panelTitle",children:"Main deck list"}),r.jsx("div",{className:"rb-softText",children:"Click + /  to adjust (max 3 copies per card). Your chosen Champion must be included at least once."}),r.jsxs("div",{style:{marginTop:10,flex:1,minHeight:180,overflow:"auto",border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:8},children:[Cs.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,r.jsx("div",{className:"rb-row",style:{flexWrap:"wrap",gap:8},children:Cs.map(D=>{const z=D.card,ye=Math.floor(D.n||0),De=M(z,"deck");return r.jsxs("div",{style:{width:118,display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:4,borderRadius:8,background:"rgba(130, 210, 255, 0.1)"},children:[r.jsx(jt,{card:De,size:"xs",showReadyDot:!1,onClick:()=>Gt(De)}),r.jsx("div",{style:{fontSize:10,fontWeight:800,textAlign:"center",maxWidth:110,lineHeight:1.1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z.name}),r.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center",marginTop:2},children:[r.jsx("button",{className:"rb-miniButton",style:{padding:"4px 10px",fontSize:14,fontWeight:900},onClick:()=>on(s,Ae=>({...Ae,main:gn(Ae.main||{},z.id,-1,0,3)})),children:""}),r.jsx("div",{style:{minWidth:20,textAlign:"center",fontWeight:900,fontSize:12},children:ye}),r.jsx("button",{className:"rb-miniButton",style:{padding:"4px 10px",fontSize:14,fontWeight:900},onClick:()=>on(s,Ae=>({...Ae,main:gn(Ae.main||{},z.id,1,0,3)})),children:"+"})]}),r.jsx("button",{className:"rb-miniButton",style:{fontSize:9,padding:"2px 6px",width:"100%",marginTop:2,textAlign:"center"},title:"Move to sideboard",onClick:()=>on(s,Ae=>{const Ht=gn(Ae.main||{},z.id,-1,0,3),zn=gn(Ae.sideboard||{},z.id,1,0,8-Sn(Ae.sideboard||{}));return{...Ae,main:Ht,sideboard:zn}}),children:" Sideboard"})]},D.id)})})]}),r.jsxs("div",{style:{marginTop:16},children:[r.jsxs("div",{className:"rb-panelTitle",children:["Sideboard (",Bi,"/8)"]}),r.jsx("div",{className:"rb-softText",style:{fontSize:11},children:"Up to 8 cards for Bo3 sideboarding between games."}),r.jsxs("div",{style:{marginTop:8,maxHeight:180,overflow:"auto",border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:8},children:[cn.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,r.jsx("div",{className:"rb-row",style:{flexWrap:"wrap",gap:8},children:cn.map(D=>{const z=D.card,ye=Math.floor(D.n||0),De=M(z,"deck");return r.jsxs("div",{style:{width:118,display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:4,borderRadius:8,background:"rgba(255, 130, 210, 0.1)"},children:[r.jsx(jt,{card:De,size:"xs",showReadyDot:!1,onClick:()=>Gt(De)}),r.jsx("div",{style:{fontSize:10,fontWeight:800,textAlign:"center",maxWidth:110,lineHeight:1.1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z.name}),r.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center",marginTop:2},children:[r.jsx("button",{className:"rb-miniButton",style:{padding:"4px 10px",fontSize:14,fontWeight:900},onClick:()=>on(s,Ae=>({...Ae,sideboard:gn(Ae.sideboard||{},z.id,-1,0,8)})),children:""}),r.jsx("div",{style:{minWidth:20,textAlign:"center",fontWeight:900,fontSize:12},children:ye}),r.jsx("button",{className:"rb-miniButton",style:{padding:"4px 10px",fontSize:14,fontWeight:900},disabled:Bi>=8,onClick:()=>on(s,Ae=>({...Ae,sideboard:gn(Ae.sideboard||{},z.id,1,0,8-Sn(Ae.sideboard||{})+ye)})),children:"+"})]}),r.jsx("button",{className:"rb-miniButton",style:{fontSize:9,padding:"2px 6px",width:"100%",marginTop:2,textAlign:"center"},title:"Move to main deck",onClick:()=>on(s,Ae=>{const Ht=gn(Ae.sideboard||{},z.id,-1,0,8),zn=gn(Ae.main||{},z.id,1,0,3);return{...Ae,main:zn,sideboard:Ht}}),children:" Main"})]},D.id)})})]})]}),ra?r.jsxs("div",{style:{marginTop:12},children:[r.jsx("div",{className:"rb-panelTitle",children:"Preview"}),"instanceId"in ra?r.jsx("div",{className:"rb-row rb-rowCenter",children:r.jsx(jt,{card:ra,size:"sm",showReadyDot:!1})}):null,r.jsx("div",{className:"rb-softText",style:{marginTop:8},children:ra.name})]}):null]})]}),ie.length>0?r.jsxs("div",{style:{marginTop:14},children:[r.jsxs("div",{className:"rb-panelTitle",children:["Issues for ",s]}),r.jsx("ul",{style:{margin:0,paddingLeft:18},children:ie.map((D,z)=>r.jsx("li",{style:{color:"#ffb4b4"},children:D},z))})]}):null,(Y.length>0||L.length>0)&&de===!1?r.jsx("div",{className:"rb-softText",style:{marginTop:10},children:"Fix both decks before starting. (You can use Auto-fill as a starting point.)"}):null]})})},l1=()=>{if(!A||!Au)return null;const s=Au.player,o=Au.zone,f=A.players[s],d=o==="TRASH"?f.trash:f.banishment,h=o==="TRASH"?"Trash (discard pile)":"Banishment";return r.jsx("div",{className:"rb-modalOverlay",onClick:()=>oa(null),children:r.jsxs("div",{className:"rb-modal",onClick:p=>p.stopPropagation(),children:[r.jsxs("div",{className:"rb-modalHeader",children:[r.jsxs("div",{style:{fontWeight:900},children:[s,"  ",h," (",d.length,")"]}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",justifyContent:"flex-end"},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>oa({player:"P1",zone:o}),children:"View P1"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>oa({player:"P2",zone:o}),children:"View P2"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>oa(null),children:"Close"})]})]}),r.jsxs("div",{className:"rb-modalBody",children:[d.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,r.jsx("div",{className:"rb-pileGrid",children:[...d].slice().reverse().map(p=>r.jsxs("div",{style:{width:120,display:"flex",flexDirection:"column",alignItems:"center",gap:6},children:[r.jsx(jt,{card:p,size:"xs",showReadyDot:!1,onClick:()=>Gt(p)}),r.jsx("div",{style:{fontSize:11,fontWeight:800,textAlign:"center",maxWidth:118,lineHeight:1.1,opacity:.95},children:p.name})]},p.instanceId))})]})]})})},Ao=s=>(s||"").replace(/_/g," ").replace(/\[\s*add\s*\]\s*/gi,"add ").replace(/\s+/g," ").trim(),r1=s=>{const o=Ao(s);if(!o)return[];o.toLowerCase();const f=[];return Zf(o)&&f.push("DISCARD"),Qf(o)&&f.push("DRAW"),Xf(o)&&f.push("CHANNEL"),/\badd\s+\d+\s+energy\b/i.test(o)&&f.push("ADD_ENERGY"),/\badd\s+\d+\s+[a-z]+\s+rune\b/i.test(o)&&f.push("ADD_RUNE"),/\badd\s+\d+\s+rune\s+of\s+any\s+type\b/i.test(o)&&f.push("ADD_ANY_RUNE"),/\bplay\s+(?:(\d+|one|two|three|four|five|six|seven|eight|nine|ten)\s+)?(?:an?\s+)?\d+\s+might\s+[a-z]+\s+unit\s+token/i.test(o)&&f.push("TOKENS"),/\bgive\b/i.test(o)&&/\[[^\]]+\]/.test(o)&&f.push("KEYWORD_GRANT"),Jf(o)&&f.push("STUN"),eh(o)&&f.push("READY"),ih(o)&&f.push("BUFF"),th(o)&&f.push("KILL"),nh(o)&&f.push("BANISH"),sh(o)&&f.push("RETURN"),/\bgive\s+(?:a\s+)?(?:friendly\s+|enemy\s+|your\s+|opposing\s+)?(unit|units|me|it|this)\s+[+-]\s*\d+\s+might\s+this\s+turn\b/i.test(o)&&f.push("MIGHT_THIS_TURN"),(xc(o)!=null||/\bdeal\s+its\s+energy\s+cost\s+as\s+damage\b/i.test(o))&&f.push("DAMAGE"),f},o1=s=>{const o=String(s||"").trim();return o?o.split(/\s+/)[0]||o:""},c1=s=>{const o={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10};if(!s)return null;if(/^\d+$/.test(s)){const f=parseInt(s,10);return Number.isFinite(f)?f:null}return o[s.toLowerCase()]??null},id=s=>{const o=[],f=new Set;for(const d of s){const h=String(d||"").trim();h&&(f.has(h)||(f.add(h),o.push(h)))}return o},u1=s=>{const o=(s||"").toLowerCase(),f=[];if(!o.trim())return{needsTargets:!1,count:0,restriction:"ANY",location:"ANY",notes:f};if(/\b(all|each)\s+(friendly|enemy|opposing|your)?\s*units\b/.test(o)){const W=/\benemy\b|\bopposing\b/.test(o)?"ENEMY":/\bfriendly\b|\byour\b/.test(o)?"FRIENDLY":"ANY",$=/\bhere\b/.test(o)?"HERE":/\bbattlefield\b/.test(o)?"BATTLEFIELD":"ANY";return f.push("global-units"),{needsTargets:!1,count:0,restriction:W,location:$,notes:f}}const d=o.match(/\bchoose\s+(?:up\s+to\s+)?(\d+|one|two|three|four|five)\s+units\b/),h=d?c1(d[1])??1:1,p=/\bunit\b/.test(o)||/\bunits\b/.test(o),b=/\bbattlefield\b/.test(o),m=/\bchoose\b/.test(o),C=p&&/\b(stun|kill|banish|ready|buff|deal|give|move|return|recall|heal)\b/.test(o)&&!/\b(all|each)\b/.test(o),N=b&&m&&/\b(battlefield)\b/.test(o),_=/\benemy\b|\bopposing\b/.test(o)?"ENEMY":/\bfriendly\b|\byour\b/.test(o)?"FRIENDLY":"ANY",H=/\bhere\b/.test(o)?"HERE":/\bat\s+a\s+battlefield\b/.test(o)?"BATTLEFIELD":"ANY";return h>1&&f.push(`multi-${h}`),_!=="ANY"&&f.push(_==="ENEMY"?"enemy-only":"friendly-only"),H!=="ANY"&&f.push(H==="HERE"?"here":"at-battlefield"),/\b(choose|target)\b/.test(o)&&f.push("explicit-select"),N?{needsTargets:!0,count:1,restriction:"ANY",location:"BATTLEFIELD",notes:[...f,"battlefield-target"]}:C?{needsTargets:!0,count:h,restriction:_,location:H,notes:f}:{needsTargets:!1,count:0,restriction:_,location:H,notes:f}},d1=(s,o,f)=>{const d=Ao(s),h=d.toLowerCase(),p=String(o||"").trim(),b=[],m=[];p&&(/^When you play (me|this)$/i.test(p)||/^When this is played$/i.test(p)||/^When I'm played$/i.test(p)||/^When I attack$/i.test(p)||/^When I defend$/i.test(p)||/^When I attack or defend$/i.test(p)||/^When I defend or I'm played from$/i.test(p)||/^When I move$/i.test(p)||/^When I move to a battlefield$/i.test(p)||/^When you play a spell$/i.test(p)||/^When you play a spell on an opponent's turn$/i.test(p)||/^When you play a spell that costs 5 energy or more$/i.test(p)||/^When you play a gear$/i.test(p)||/^When you play a unit$/i.test(p)||/^When you play another unit$/i.test(p)||/^When you play a \[Mighty\] unit$/i.test(p)||/^When you play your second card in a turn$/i.test(p)||/^When you play a card on an opponent's turn$/i.test(p)||/^When you play me to a battlefield$/i.test(p)||/^When you discard me$/i.test(p)||/^When you discard a card$/i.test(p)||/^When you discard one or more cards$/i.test(p)||/^When you stun an enemy unit$/i.test(p)||/^When you stun one or more enemy units$/i.test(p)||/^When a friendly unit attacks or defends alone$/i.test(p)||/^While a friendly unit defends alone$/i.test(p)||/^When you ready a friendly unit$/i.test(p)||/^When you buff a friendly unit$/i.test(p)||/^When a buffed friendly unit dies$/i.test(p)||/^When another non-Recruit unit you control dies$/i.test(p)||/^When a unit moves from here$/i.test(p)||/^When a friendly unit moves from my location$/i.test(p)||/^When you defend here$/i.test(p)||/^When an enemy unit attacks a battlefield you control$/i.test(p)||/^When you conquer$/i.test(p)||/^When you or an ally hold$/i.test(p)||/^When you conquer here$/i.test(p)||/^When you hold here$/i.test(p)||/^When you kill a unit with a spell$/i.test(p)||/^When you kill a stunned enemy unit$/i.test(p)||/^If you've discarded a card this turn$/i.test(p)||/^If I have moved twice this turn$/i.test(p)||/^While I'm buffed$/i.test(p)||/^While I'm attacking or defending alone$/i.test(p)||/^While I'm \[Mighty\]$/i.test(p)||/^While I'm at a battlefield$/i.test(p)||/^While you have 8\+ runes$/i.test(p)||/^If an opponent's score is within 3 points of the Victory Score$/i.test(p)||/^If an enemy unit has died this turn$/i.test(p)||/^When you play a card from/i.test(p)||/^When you kill$/i.test(p)||/^When I conquer$/i.test(p)||/^When I attack or defend one on one$/i.test(p)||/^When you look at cards from the top of your deck and see me$/i.test(p)||/^When you play me or when I hold$/i.test(p)||/^When I conquer after an attack$/i.test(p)||/^When I hold$/i.test(p)||/^While I'm$/i.test(p)||/^At the end of your turn$/i.test(p)||/^At the start of your Beginning Phase$/i.test(p)||/^At start of your Beginning Phase$/i.test(p)||/^At the start of each player's first Beginning Phase$/i.test(p)||m.push(`TRIGGER_UNSUPPORTED: ${p}`));const C=/\bif\s+this\s+kills\s+it,\s*draw\s+\d+\b/i.test(d),N=/if you do/i.test(h)||/if you control a poro/i.test(h)||/if you control a facedown card at a battlefield/i.test(h)||/if you have one or fewer cards in your hand/i.test(h)||/if you have 4\+ units at that battlefield/i.test(h)||/if you have 7\+ units here/i.test(h)||/if there is a ready enemy unit here/i.test(h)||/only unit you control there/i.test(h)||/if you can't/i.test(h)||/if you couldn't channel/i.test(h)||/if you've played another card this turn/i.test(h)||/if you've played a card this turn/i.test(h)||/if its might is less than another friendly unit's/i.test(h)||/if you assigned 5 or more excess damage to enemy units/i.test(h)||/if you paid (?:the )?additional cost/i.test(h)||/if it's already attached/i.test(h)||/if it's equipped/i.test(h)||/if the played card is a unit/i.test(h)||/if it(?:'|)?s an?\s+spell/i.test(h)||/if it(?:'|)?s an?\s+unit/i.test(h)||/if it(?:'|)?s an?\s+gear/i.test(h)||/if you would reveal cards from a deck/i.test(h)||/if you've discarded a card this turn/i.test(h)||/if i have moved twice this turn/i.test(h)||/if an opponent's score is within 3 points of the victory score/i.test(h)||/if an enemy unit has died this turn/i.test(h);/\bif\b/.test(h)&&!C&&!N&&m.push("CONDITIONAL_GENERAL"),/\bif\s+you\s+do\b/.test(h)&&m.push("IF_YOU_DO_BRANCH");const _=/next time it dies this turn/i.test(h)||/kill it the next time it takes damage this turn/i.test(h)||/if i would be revealed/i.test(h)||/if i would be looked at/i.test(h)||/hide a card with \[hidden\] instead of \[c\]/i.test(h)||/kill this instead/i.test(h);/\binstead\b/.test(h)&&!_&&m.push("REPLACEMENT_EFFECT");const H=/draw 1 for each of your mighty units/i.test(h)||/for each buff spent, channel/i.test(h)||/for each friendly unit, you may spend its buff/i.test(h)||/for each buffed friendly unit at my battlefield/i.test(h)||/for each .*excess damage/i.test(h)||/for each friendly gear/i.test(h);/\bfor\s+each\b|\bfor\s+every\b/.test(h)&&!H&&m.push("SCALING_EFFECT"),!(/that unit has\s+\"?when i conquer,\s*you may move me to (?:my|your)\s+base/i.test(h)||/next time it dies this turn/i.test(h)||/kill it the next time it takes damage this turn/i.test(h))&&/\bthis\s+turn\b/.test(h)&&/\b(when|whenever|each\s+time|the\s+next\s+time)\b/.test(h)&&(/\btakes\s+damage\b/.test(h)||/\bis\s+dealt\s+damage\b/.test(h)?m.push("TURN_SCOPED_DAMAGE_HOOK"):m.push("TURN_SCOPED_TRIGGER")),/\b(other|all)\s+friendly\s+units\s+enter\s+ready\b/i.test(d)&&m.push("CONTINUOUS_ENTER_READY"),/\b(other|all)\s+friendly\s+units\b/i.test(d)&&/\benter\s+ready\b/i.test(d)&&m.push("CONTINUOUS_ENTER_READY"),(/\bas\s+(?:an\s+)?additional\s+cost\b/.test(h)||/\bas\s+you\s+play\s+(?:me|this)\b/.test(h))&&m.push("ADDITIONAL_COST"),(/\bcost\s+\d+\s+(?:energy\s+)?less\b/.test(h)||/\breduce\s+my\s+cost\s+by\s+\d+\s+energy\b/.test(h))&&m.push("COST_MODIFIER"),Zf(d)!=null&&b.push("DISCARD_HAND_N"),Qf(d)!=null&&b.push("DRAW_N"),Xf(d)!=null&&b.push("CHANNEL_N"),/\badd\s+\d+\s+energy\b/.test(h)&&b.push("ADD_ENERGY_N"),/\badd\s+\d+\s+[a-z]+\s+rune\b/.test(h)&&b.push("ADD_POWER_DOMAIN_N"),/\badd\s+\d+\s+rune\s+of\s+any\s+type\b/.test(h)&&b.push("ADD_POWER_ANY_N"),/\bplay\b/.test(h)&&/\bunit\s+token\b/.test(h)&&b.push("PLAY_TOKENS"),/\bgive\b/.test(h)&&/\[[^\]]+\]/.test(d)&&(/\bunits\b/.test(h)?b.push("GRANT_KEYWORD_MULTI"):b.push("GRANT_KEYWORD_SINGLE")),Jf(d)&&b.push("STUN_UNIT_SINGLE"),eh(d)&&b.push("READY_UNIT_SINGLE"),ih(d)&&b.push("BUFF_PLUS1_PERM"),sh(d)&&b.push("RETURN_TO_BASE_SINGLE"),th(d)&&b.push("KILL_UNIT_SINGLE"),nh(d)&&b.push("BANISH_UNIT_SINGLE");const $=h.match(/\bgive\s+(?:a\s+)?(?:friendly\s+|enemy\s+|your\s+|opposing\s+)?(unit|units|me|it|this)\s+([+-])\s*(\d+)\s+might\s+this\s+turn\b/);$&&($[1]==="units"?/\benemy\b|\bopposing\b/.test(h)?b.push("MIGHT_THIS_TURN_UNITS_ENEMY"):/\bfriendly\b|\byour\b/.test(h)?b.push("MIGHT_THIS_TURN_UNITS_FRIENDLY"):b.push("MIGHT_THIS_TURN_UNITS_UNSPEC"):b.push("MIGHT_THIS_TURN_SINGLE"));const Z=/\bdeal\s+its\s+energy\s+cost\s+as\s+damage\b/i.test(d),M=xc(d);(Z||M!=null&&M>0)&&(/\ball\s+units\s+at\s+battlefields\b/i.test(d)?b.push("DAMAGE_AOE_ALL_BATTLEFIELDS"):/\ball\s+units\s+here\b/i.test(d)?b.push("DAMAGE_AOE_HERE"):/\ball\s+enemy\s+units\b/i.test(d)||/\beach\s+enemy\s+unit\b/i.test(d)?b.push("DAMAGE_AOE_ENEMY"):Z?b.push("DAMAGE_FROM_DISCARD_ENERGY_COST"):b.push("DAMAGE_SINGLE"),/\bif\s+this\s+kills\s+it,\s*draw\s+\d+\b/i.test(d)&&b.push("DRAW_ON_KILL")),/\bsearch\b/.test(h)&&m.push("SEARCH_NOT_SUPPORTED");const B=new Set(["Action","Reaction","Accelerate","Hidden","Legion","Vision","Assault","Shield","Tank","Deflect","Ganking","Add","Deathknell","Temporary","Mighty","Burn","Burnout","Play","Equip","Alone","Weaponmaster","Quick-Draw","Repeat","Unique","Fated","Overwhelm","Lifesteal"].map(L=>L.toLowerCase())),Y=id((f||[]).map(L=>o1(L)).filter(Boolean).filter(L=>!B.has(L.toLowerCase())));for(const L of Y)m.push(`KEYWORD_UNSUPPORTED: ${L}`);return/\bchoose\s+(?:up\s+to\s+)?(\d+|one|two|three|four|five)\s+units\b/.test(h)&&m.push("MULTI_TARGET_UNITS"),{text:d,primitives:id(b),flags:id(m)}},en=he.useMemo(()=>{var Z,M,B,Y;const s=[],o=new Set(["DISCARD_HAND_N","DRAW_N","CHANNEL_N","ADD_ENERGY_N","ADD_POWER_DOMAIN_N","ADD_POWER_ANY_N","PLAY_TOKENS","GRANT_KEYWORD_SINGLE","GRANT_KEYWORD_MULTI","STUN_UNIT_SINGLE","READY_UNIT_SINGLE","BUFF_PLUS1_PERM","RETURN_TO_BASE_SINGLE","KILL_UNIT_SINGLE","BANISH_UNIT_SINGLE","MIGHT_THIS_TURN_SINGLE","MIGHT_THIS_TURN_UNITS_FRIENDLY","MIGHT_THIS_TURN_UNITS_ENEMY","DAMAGE_SINGLE","DAMAGE_AOE_ENEMY","DAMAGE_AOE_ALL_BATTLEFIELDS","DAMAGE_AOE_HERE","DAMAGE_FROM_DISCARD_ENERGY_COST","DRAW_ON_KILL"]),f=["TRIGGER_UNSUPPORTED","CONDITIONAL_GENERAL","IF_YOU_DO_BRANCH","REPLACEMENT_EFFECT","SCALING_EFFECT","TURN_SCOPED_TRIGGER","TURN_SCOPED_DAMAGE_HOOK","CONTINUOUS_ENTER_READY","SEARCH_NOT_SUPPORTED","KEYWORD_UNSUPPORTED","MULTI_TARGET_UNITS"],d=L=>{const ie=String(L||"");return f.some(de=>ie.startsWith(de))};for(const L of e){const ie=(((Z=L.ability)==null?void 0:Z.effect_text)||"").trim(),de=(((M=L.ability)==null?void 0:M.raw_text)||"").trim(),me=(((B=L.ability)==null?void 0:B.trigger)||"").trim(),ae=(((Y=L.ability)==null?void 0:Y.keywords)||[]).slice(),Ve=Ao(ie||de),Se=d1(Ve,me,ae),Qe=Se.primitives,Je=Se.flags,it=Qe.filter(ji=>o.has(ji)),He=Qe.filter(ji=>!o.has(ji)),Rt=u1(Ve),Cs=Je.filter(d),cn=it.length,Bi=He.length+Cs.length;let $n="NO_TEXT";Ve?Bi===0?$n="FULL":cn>0?$n="PARTIAL":$n="UNSUPPORTED":Bi===0?$n="NO_TEXT":$n=cn>0?"PARTIAL":"UNSUPPORTED",s.push({id:L.id,name:L.name,type:L.type,domain:L.domain,cost:Number(L.cost||0),trigger:me,keywords:ae,text:Ve,raw:de,primitives:Qe,primitivesSupported:it,primitivesMissing:He,flags:Je,targetProfile:Rt,status:$n})}const h=s.length,p=s.filter(L=>!!L.text).length,b=s.filter(L=>L.status==="FULL").length,m=s.filter(L=>L.status==="PARTIAL").length,C=s.filter(L=>L.status==="UNSUPPORTED").length,N=s.filter(L=>L.status==="NO_TEXT").length,_={},H={};for(const L of s){for(const ie of L.primitivesMissing)_[ie]=(_[ie]||0)+1;for(const ie of L.flags.filter(de=>de&&d(de))){const de=String(ie);H[de]=(H[de]||0)+1}}const W=Object.entries(_).sort((L,ie)=>ie[1]-L[1]).slice(0,12).map(([L,ie])=>({k:L,v:ie})),$=Object.entries(H).sort((L,ie)=>ie[1]-L[1]).slice(0,12).map(([L,ie])=>({k:L,v:ie}));return{total:h,withText:p,full:b,partial:m,unsupported:C,noText:N,rows:s,topMissingPrimitives:W,topMissingFlags:$}},[e]),Co=he.useMemo(()=>{var d,h,p;const s=[];for(const b of e){const m=(((d=b.ability)==null?void 0:d.effect_text)||"").trim(),C=(((h=b.ability)==null?void 0:h.raw_text)||"").trim(),N=(((p=b.ability)==null?void 0:p.keywords)||[]).slice(),_=Ao(m||C);if(!_)continue;const H=r1(_),W=H.length>0;s.push({id:b.id,name:b.name,text:_,keywords:N,supported:W,tags:H})}const o=s.filter(b=>b.supported).length,f=s.filter(b=>!b.supported);return{totalWithText:s.length,supportedCount:o,unsupportedCount:f.length,unsupportedRows:f}},[e]),f1=()=>{if(!ix)return null;const s=(Iu||"").toLowerCase().trim(),o=m=>({padding:"6px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.18)",background:m?"rgba(255,255,255,0.12)":"rgba(0,0,0,0.22)",color:"#eef1f5",fontWeight:m?900:700,cursor:"pointer"}),f=m=>{const C={padding:"2px 8px",borderRadius:999,fontSize:11,fontWeight:900,border:"1px solid rgba(255,255,255,0.14)"};return m==="FULL"?{...C,background:"rgba(64, 220, 140, 0.18)",color:"#bff7da"}:m==="PARTIAL"?{...C,background:"rgba(250, 200, 70, 0.18)",color:"#ffe7b8"}:m==="UNSUPPORTED"?{...C,background:"rgba(250, 90, 90, 0.18)",color:"#ffd1d1"}:{...C,background:"rgba(160, 160, 160, 0.16)",color:"#d7dde7"}},d=Co.unsupportedRows.filter(m=>s?m.name.toLowerCase().includes(s)||m.text.toLowerCase().includes(s):!0).slice(0,250),h=(()=>{let m=en.rows;return tr!=="ALL"&&(tr==="PROBLEMS"?m=m.filter(C=>C.status==="PARTIAL"||C.status==="UNSUPPORTED"):m=m.filter(C=>C.status===tr)),s&&(m=m.filter(C=>{const N=(C.name||"").toLowerCase(),_=(C.text||"").toLowerCase(),H=(C.trigger||"").toLowerCase(),W=C.primitives.join(" ").toLowerCase(),$=C.flags.join(" ").toLowerCase();return N.includes(s)||_.includes(s)||H.includes(s)||W.includes(s)||$.includes(s)})),m.slice(0,350)})(),p=async()=>{const m=JSON.stringify(en,null,2);try{await navigator.clipboard.writeText(m),alert("Audit JSON copied to clipboard.")}catch{window.prompt("Copy audit JSON:",m)}},b=async()=>{const m=JSON.stringify({meta:{filter:tr,search:Iu,generatedAt:new Date().toISOString()},rows:h},null,2);try{await navigator.clipboard.writeText(m),alert("Filtered audit JSON copied to clipboard.")}catch{window.prompt("Copy filtered audit JSON:",m)}};return r.jsx("div",{className:"rb-modalOverlay",onClick:()=>Cu(!1),children:r.jsxs("div",{className:"rb-modal",onClick:m=>m.stopPropagation(),children:[r.jsxs("div",{className:"rb-modalHeader",children:[r.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[r.jsx("div",{style:{fontWeight:900},children:"Effect Diagnostics"}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[r.jsx("button",{style:o(ws==="UNSUPPORTED"),onClick:()=>yp("UNSUPPORTED"),children:"Unsupported List"}),r.jsx("button",{style:o(ws==="AUDIT"),onClick:()=>yp("AUDIT"),children:"Full Audit"})]})]}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",justifyContent:"flex-end"},children:[ws==="AUDIT"?r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"rb-miniButton",onClick:b,children:"Copy filtered JSON"}),r.jsx("button",{className:"rb-miniButton",onClick:p,children:"Copy full JSON"})]}):null,r.jsx("button",{className:"rb-miniButton",onClick:()=>Cu(!1),children:"Close"})]})]}),r.jsxs("div",{className:"rb-modalBody",children:[r.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginBottom:10},children:[ws==="UNSUPPORTED"?r.jsxs("div",{className:"rb-softTextSmall",children:["Cards with ability text: ",r.jsx("b",{children:Co.totalWithText}),"  Supported: ",r.jsx("b",{children:Co.supportedCount}),"  Unsupported: ",r.jsx("b",{children:Co.unsupportedCount})]}):r.jsxs("div",{className:"rb-softTextSmall",children:["Total cards: ",r.jsx("b",{children:en.total}),"  With text: ",r.jsx("b",{children:en.withText}),"  Full: ",r.jsx("b",{children:en.full}),"  Partial: ",r.jsx("b",{children:en.partial}),"  Unsupported: ",r.jsx("b",{children:en.unsupported}),"  No-text: ",r.jsx("b",{children:en.noText})]}),r.jsx("input",{value:Iu,onChange:m=>sx(m.target.value),placeholder:ws==="AUDIT"?"Search card / primitive / flag...":"Search card/effect...",style:{flex:"1 1 280px",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(0,0,0,0.25)",color:"#eef1f5"}}),ws==="AUDIT"?r.jsxs("span",{style:{display:"flex",gap:8,alignItems:"center"},children:[r.jsx("span",{className:"rb-softTextSmall",children:"Status:"}),r.jsxs("select",{value:tr,onChange:m=>ax(m.target.value),style:{padding:"6px 8px",borderRadius:10,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(0,0,0,0.25)",color:"#eef1f5"},children:[r.jsx("option",{value:"PROBLEMS",children:"Problems (Partial + Unsupported)"}),r.jsx("option",{value:"ALL",children:"All"}),r.jsx("option",{value:"FULL",children:"Full"}),r.jsx("option",{value:"PARTIAL",children:"Partial"}),r.jsx("option",{value:"UNSUPPORTED",children:"Unsupported"}),r.jsx("option",{value:"NO_TEXT",children:"No text"})]})]}):null]}),ws==="UNSUPPORTED"?d.length===0?r.jsx("div",{className:"rb-softText",children:"No unsupported effects match the filter."}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:d.map(m=>r.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:10,background:"rgba(0,0,0,0.18)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,alignItems:"center"},children:[r.jsx("div",{style:{fontWeight:900},children:m.name}),r.jsx("div",{className:"rb-softTextSmall",children:m.keywords&&m.keywords.length?m.keywords.join("  "):""})]}),r.jsx("div",{className:"rb-softTextSmall",style:{marginTop:6,whiteSpace:"pre-wrap"},children:m.text})]},m.id))}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[r.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:10,background:"rgba(0,0,0,0.16)"},children:[r.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Top missing primitives"}),en.topMissingPrimitives.length===0?r.jsx("div",{className:"rb-softTextSmall",children:"(none)"}):r.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:en.topMissingPrimitives.map(m=>r.jsxs("span",{style:{padding:"3px 8px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",fontSize:11,background:"rgba(0,0,0,0.22)"},children:[m.k,"  ",m.v]},m.k))})]}),r.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:10,background:"rgba(0,0,0,0.16)"},children:[r.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Top missing structural flags"}),en.topMissingFlags.length===0?r.jsx("div",{className:"rb-softTextSmall",children:"(none)"}):r.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:en.topMissingFlags.map(m=>r.jsxs("span",{style:{padding:"3px 8px",borderRadius:999,border:"1px solid rgba(255,255,255,0.14)",fontSize:11,background:"rgba(0,0,0,0.22)"},children:[m.k,"  ",m.v]},m.k))})]})]}),h.length===0?r.jsx("div",{className:"rb-softText",children:"No cards match the current audit filter."}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:h.map(m=>{const C=lx===m.id,N=[...m.primitivesMissing,...m.flags.filter(_=>/^TRIGGER_UNSUPPORTED|^CONDITIONAL_GENERAL|^IF_YOU_DO_BRANCH|^REPLACEMENT_EFFECT|^SCALING_EFFECT|^TURN_SCOPED_TRIGGER|^TURN_SCOPED_DAMAGE_HOOK|^CONTINUOUS_ENTER_READY|^ADDITIONAL_COST|^COST_MODIFIER|^SEARCH_NOT_SUPPORTED|^REVEAL_NOT_SUPPORTED|^MOVE_EFFECT_NOT_SUPPORTED|^KEYWORD_UNSUPPORTED|^MULTI_TARGET_UNITS/.test(_))];return r.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.10)",borderRadius:12,padding:10,background:"rgba(0,0,0,0.18)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",minWidth:0},children:[r.jsx("button",{className:"rb-miniButton",onClick:()=>rx(_=>_===m.id?null:m.id),style:{padding:"6px 10px"},children:C?"Hide":"Details"}),r.jsxs("div",{style:{minWidth:0},children:[r.jsx("div",{style:{fontWeight:900,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.name}),r.jsxs("div",{className:"rb-softTextSmall",children:[m.type,"  ",m.domain,"  Cost ",m.cost,m.targetProfile.needsTargets?`  Targets: ${m.targetProfile.count} (${m.targetProfile.restriction}, ${m.targetProfile.location})`:""]})]})]}),r.jsx("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end"},children:r.jsx("span",{style:f(m.status),children:m.status})})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:8},children:[N.slice(0,10).map(_=>r.jsx("span",{style:{padding:"3px 8px",borderRadius:999,border:"1px solid rgba(255,255,255,0.12)",fontSize:11,background:"rgba(255, 120, 120, 0.10)"},children:_},_)),N.length>10?r.jsxs("span",{style:{padding:"3px 8px",borderRadius:999,border:"1px solid rgba(255,255,255,0.12)",fontSize:11,background:"rgba(0,0,0,0.22)"},children:["+",N.length-10," more"]}):null]}),C?r.jsxs("div",{style:{marginTop:10,display:"grid",gridTemplateColumns:"1fr",gap:8},children:[m.trigger?r.jsxs("div",{className:"rb-softTextSmall",children:[r.jsx("b",{children:"Trigger:"})," ",m.trigger]}):null,m.keywords&&m.keywords.length?r.jsxs("div",{className:"rb-softTextSmall",children:[r.jsx("b",{children:"Keywords:"})," ",m.keywords.join("  ")]}):null,m.text?r.jsxs("div",{className:"rb-softTextSmall",style:{whiteSpace:"pre-wrap"},children:[r.jsx("b",{children:"Text:"})," ",m.text]}):r.jsx("div",{className:"rb-softTextSmall",children:"(No effect text)"}),r.jsxs("div",{className:"rb-softTextSmall",children:[r.jsx("b",{children:"Primitives:"})," ",m.primitives.length?m.primitives.join(", "):"(none)"]}),r.jsxs("div",{className:"rb-softTextSmall",children:[r.jsx("b",{children:"Supported primitives:"})," ",m.primitivesSupported.length?m.primitivesSupported.join(", "):"(none)"]}),r.jsxs("div",{className:"rb-softTextSmall",children:[r.jsx("b",{children:"Missing primitives:"})," ",m.primitivesMissing.length?m.primitivesMissing.join(", "):"(none)"]}),r.jsxs("div",{className:"rb-softTextSmall",children:[r.jsx("b",{children:"Flags:"})," ",m.flags.length?m.flags.join("  "):"(none)"]}),r.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:r.jsx("button",{className:"rb-miniButton",onClick:async()=>{const _=JSON.stringify(m,null,2);try{await navigator.clipboard.writeText(_),alert("Card audit JSON copied.")}catch{window.prompt("Copy card audit JSON:",_)}},children:"Copy card JSON"})})]}):null]},m.id)})}),r.jsxs("div",{className:"rb-softTextSmall",style:{marginTop:12},children:["Notes:",r.jsxs("ul",{style:{margin:"6px 0 0 18px"},children:[r.jsx("li",{children:"Primitives are the small effect operations the emulator can (or cant) execute today. A single card may need multiple primitives."}),r.jsx("li",{children:"Flags are structural capabilities that typically require new engine hooks (e.g., continuous effects, turn-scoped triggers, multi-target selection)."}),r.jsx("li",{children:"This audit is heuristic and may produce false positives; its designed to guide implementation work quickly, not to be an oracle."})]})]})]}),ws==="UNSUPPORTED"?r.jsx("div",{className:"rb-softTextSmall",style:{marginTop:12},children:"Note: Supported here means the emulator has a parser/handler for at least one operation in the text. Many cards still have static / continuous effects that are not yet fully modeled."}):null]})]})})},h1=()=>A?r.jsxs("div",{style:{padding:16},children:[r.jsxs("div",{style:{marginTop:12,display:"flex",gap:10,alignItems:"center"},children:[r.jsx("button",{onClick:Pp,children:"Reset Game"}),r.jsx("button",{onClick:Bp,children:Ri?"Hide Hands (hotseat)":"Reveal Hands (hotseat)"}),r.jsx("button",{onClick:jp,children:xi?"Hide Facedown (hotseat)":"Reveal Facedown (hotseat)"}),r.jsx("button",{onClick:Mp,children:Ns?"Hide Decks (hotseat)":"Reveal Decks (hotseat)"}),r.jsxs("span",{style:{fontSize:12,color:"#ddd"},children:["You are playing as:",r.jsxs("select",{value:Ye,onChange:s=>Jl(s.target.value),style:{marginLeft:6},children:[r.jsx("option",{value:"P1",children:"P1"}),r.jsx("option",{value:"P2",children:"P2"})]})]}),r.jsx("button",{disabled:!Le(Ye)||A.turnPlayer!==Ye||A.chain.length>0||A.windowKind!=="NONE"||A.state!=="OPEN",onClick:()=>Ju(),children:"Next Step"})]}),r.jsxs("div",{style:{marginTop:12,display:"flex",gap:12},children:[Yp("P1"),Yp("P2")]}),qx(),Xx(),Wx(),Kx(),Zx()]}):null,p1=()=>{if(!A||!A.pendingOptionalChoice)return null;const s=A.pendingOptionalChoice,f=s.player===Ye&&Le(s.player)&&!Ii(s.player),d={position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:120},h={width:520,maxWidth:"95vw",background:"#111827",border:"2px solid #374151",borderRadius:14,padding:20,textAlign:"center"},p=s.min??0,b=Math.max(p,s.max??p),m=Math.max(p,Math.min(b,Nn)),C=(N,_)=>{Ge({type:"OPTIONAL_CHOICE",player:s.player,choiceId:s.id,accept:N,value:_})};return r.jsx("div",{style:d,children:r.jsxs("div",{style:h,children:[r.jsx("div",{style:{fontSize:18,fontWeight:900,marginBottom:10},children:"Optional Choice"}),r.jsx("div",{style:{fontSize:14,marginBottom:14},children:s.prompt}),f?s.kind==="CONFIRM"?r.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:12},children:[r.jsx("button",{className:"rb-miniButton",style:{background:"#16a34a"},onClick:()=>C(!0),children:"Yes"}),r.jsx("button",{className:"rb-miniButton",style:{background:"#dc2626"},onClick:()=>C(!1),children:"No"})]}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10,alignItems:"center"},children:b-p<=8?r.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap",justifyContent:"center"},children:Array.from({length:b-p+1},(N,_)=>p+_).map(N=>r.jsx("button",{className:"rb-miniButton",style:{background:N===m?"#2563eb":void 0},onClick:()=>C(!0,N),children:N},N))}):r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[r.jsx("input",{type:"number",min:p,max:b,value:m,onChange:N=>{const _=parseInt(N.target.value,10);Number.isFinite(_)&&wn(Math.max(p,Math.min(b,_)))},style:{width:100}}),r.jsx("button",{className:"rb-miniButton",onClick:()=>C(!0,m),children:"Confirm"}),r.jsx("button",{className:"rb-miniButton",onClick:()=>C(!0,0),children:"Skip (0)"})]})}):r.jsxs("div",{style:{fontSize:13,opacity:.8},children:["Waiting for ",s.player,"..."]})]})})},y1=()=>{var m;if(!ee)return null;const{chooser:s,gameNumber:o}=ee,f=j!==null,d=(j==null?void 0:j.P1)??0,h=(j==null?void 0:j.P2)??0,p=(j==null?void 0:j.winner)??s,b=(m=mt[s])==null?void 0:m.enabled;return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:100},children:r.jsxs("div",{style:{width:500,maxWidth:"95vw",background:"#111827",border:"2px solid #374151",borderRadius:16,padding:24,textAlign:"center"},children:[f?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:24,fontWeight:900,marginBottom:16},children:["Dice Roll - Game ",o]}),r.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:40,marginBottom:20},children:[r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("div",{style:{fontSize:14,opacity:.8,marginBottom:8},children:"P1"}),r.jsx("div",{style:{width:80,height:80,background:p==="P1"?"#10b981":"#374151",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",fontSize:36,fontWeight:900,border:p==="P1"?"3px solid #34d399":"3px solid #4b5563"},children:d})]}),r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("div",{style:{fontSize:14,opacity:.8,marginBottom:8},children:"P2"}),r.jsx("div",{style:{width:80,height:80,background:p==="P2"?"#10b981":"#374151",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",fontSize:36,fontWeight:900,border:p==="P2"?"3px solid #34d399":"3px solid #4b5563"},children:h})]})]}),r.jsxs("div",{style:{fontSize:16,marginBottom:20},children:[r.jsx("b",{children:p})," wins the dice roll and chooses who goes first!"]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:24,fontWeight:900,marginBottom:16},children:["Choose Starting Player - Game ",o]}),r.jsxs("div",{style:{fontSize:16,marginBottom:20},children:[r.jsx("b",{children:s})," lost the previous game and chooses who goes first."]})]}),b?r.jsx("div",{style:{fontSize:14,opacity:.8},children:"AI is choosing..."}):r.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16},children:[r.jsx("button",{style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#10b981",color:"white",fontSize:16,fontWeight:700,cursor:"pointer"},onClick:()=>_u(s),children:"I go first"}),r.jsx("button",{style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#6366f1",color:"white",fontSize:16,fontWeight:700,cursor:"pointer"},onClick:()=>_u(s==="P1"?"P2":"P1"),children:"Opponent goes first"})]})]})})},m1=()=>{if(!A||A.step!=="GAME_OVER"||(R==null?void 0:R.format)==="BO3")return null;const s=Ru(A);return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:100},children:r.jsxs("div",{style:{width:500,maxWidth:"95vw",background:"#111827",border:"2px solid #374151",borderRadius:16,padding:24,textAlign:"center"},children:[r.jsx("div",{style:{fontSize:28,fontWeight:900,marginBottom:12},children:"Game Over"}),r.jsx("div",{style:{fontSize:20,marginBottom:24},children:s?r.jsxs(r.Fragment,{children:[r.jsx("b",{style:{color:"#10b981"},children:s})," wins!"]}):"Draw!"}),r.jsxs("div",{style:{fontSize:14,opacity:.8,marginBottom:20},children:["P1: ",A.players.P1.points," points | P2: ",A.players.P2.points," points"]}),r.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16,flexWrap:"wrap"},children:[r.jsx("button",{style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#374151",color:"white",fontSize:14,fontWeight:600,cursor:"pointer"},onClick:()=>{K(null),i(null),y("DECK_BUILDER")},children:"Return to Deck Building"}),r.jsx("button",{style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#10b981",color:"white",fontSize:14,fontWeight:600,cursor:"pointer"},onClick:()=>{K(null),i(null),ku()},children:"Play Again (Same Decks)"})]})]})})},g1=()=>{if(!A||A.step!=="GAME_OVER"||!J)return null;const s=J.matchStateAfterCommit,o=s.gamesCompleted+1,f=(b,m)=>{const C=[];Sn(m.sideboard||{})>8&&C.push("Sideboard must contain at most 8 cards.");try{tl(e,b,m,1)}catch(_){C.push(String((_==null?void 0:_.message)||_))}return C},d={P1:f("P1",Q.P1||tn()),P2:f("P2",Q.P2||tn())},h=d.P1.length===0&&d.P2.length===0,p=b=>{const m=Q[b]||tn(),C=m.main||{},N=m.sideboard||{},_=Sn(C),H=Sn(N),W=Object.entries(C).map(([M,B])=>({id:M,n:Math.floor(B||0),card:nn(e,M)})).filter(M=>!!M.card&&M.n>0&&Cl(M.card.type)).sort((M,B)=>M.card.name.localeCompare(B.card.name)),$=Object.entries(N).map(([M,B])=>({id:M,n:Math.floor(B||0),card:nn(e,M)})).filter(M=>!!M.card&&M.n>0&&Cl(M.card.type)).sort((M,B)=>M.card.name.localeCompare(B.card.name)),Z=d[b];return r.jsxs("div",{style:{flex:1,minWidth:280,border:"1px solid #374151",borderRadius:10,padding:12,background:"#0f172a"},children:[r.jsxs("div",{style:{fontWeight:800,marginBottom:6},children:[b," Sideboarding"]}),r.jsxs("div",{className:"rb-softText",style:{marginBottom:8},children:["Main ",_," cards  Sideboard ",H,"/8"]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[r.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,padding:8,maxHeight:280,overflow:"auto"},children:[r.jsx("div",{style:{fontWeight:700,fontSize:12,marginBottom:6},children:"Main Deck"}),W.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,W.map(M=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"center",marginBottom:6},children:[r.jsxs("div",{style:{fontSize:12,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[M.card.name," ",M.n]}),r.jsx("button",{className:"rb-miniButton",disabled:H>=8,onClick:()=>on(b,B=>{const Y=Math.floor((B.main||{})[M.id]||0),L=Sn(B.sideboard||{});return Y<=0||L>=8?B:{...B,main:gn(B.main||{},M.id,-1,0,3),sideboard:gn(B.sideboard||{},M.id,1,0,null)}}),title:"Move one copy to sideboard",children:"To Side"})]},`main_${b}_${M.id}`))]}),r.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,padding:8,maxHeight:280,overflow:"auto"},children:[r.jsx("div",{style:{fontWeight:700,fontSize:12,marginBottom:6},children:"Sideboard"}),$.length===0?r.jsx("div",{className:"rb-softText",children:""}):null,$.map(M=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"center",marginBottom:6},children:[r.jsxs("div",{style:{fontSize:12,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[M.card.name," ",M.n]}),r.jsx("button",{className:"rb-miniButton",disabled:Math.floor(C[M.id]||0)>=3,onClick:()=>on(b,B=>{const Y=Math.floor((B.sideboard||{})[M.id]||0),L=Math.floor((B.main||{})[M.id]||0);return Y<=0||L>=3?B:{...B,main:gn(B.main||{},M.id,1,0,3),sideboard:gn(B.sideboard||{},M.id,-1,0,null)}}),title:"Move one copy to main deck",children:"To Main"})]},`side_${b}_${M.id}`))]})]}),Z.length>0?r.jsx("div",{style:{marginTop:8,fontSize:12,color:"#fca5a5"},children:Z.map((M,B)=>r.jsx("div",{children:M},`${b}_err_${B}`))}):null]})};return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.86)",display:"flex",alignItems:"center",justifyContent:"center",padding:16,zIndex:120},children:r.jsxs("div",{style:{width:1120,maxWidth:"98vw",maxHeight:"95vh",overflow:"auto",background:"#111827",border:"2px solid #374151",borderRadius:14,padding:16},children:[r.jsx("div",{style:{fontSize:22,fontWeight:900,marginBottom:8},children:"Between Games: Sideboarding"}),r.jsxs("div",{className:"rb-softText",style:{marginBottom:10},children:["Game ",s.gamesCompleted," complete. Winner: ",r.jsx("b",{children:J.lastGameWinner??"Unknown"}),". Next game: ",r.jsxs("b",{children:["Game ",o]}),"  Match score P1 ",s.wins.P1,"-",s.wins.P2," P2."]}),r.jsx("div",{className:"rb-softText",style:{marginBottom:12},children:"Swap cards between main and sideboard, then start the next game."}),r.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[p("P1"),p("P2")]}),r.jsxs("div",{style:{marginTop:14,display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"center"},children:[r.jsx("div",{className:"rb-softText",children:h?"Decks valid for next game.":"Fix deck errors before starting the next game."}),r.jsxs("button",{className:"rb-bigButton",style:{maxWidth:320},disabled:!h,onClick:dx,children:["Start Game ",o]})]})]})})},b1=()=>{var $,Z;if(!A||!R||R.format!=="BO3")return null;const s=R.wins.P1>=2||R.wins.P2>=2,o=R.gamesCompleted+1,f=Ga("P1"),d=Ga("P2"),h=f.filter(M=>!R.usedBattlefieldIds.P1.includes(M.id)),p=d.filter(M=>!R.usedBattlefieldIds.P2.includes(M.id)),b=h.length>0?h:f,m=p.length>0?p:d,C=A.step==="GAME_OVER"?Ru(A):null,N={...R.wins};A.step==="GAME_OVER"&&C&&!s&&(N[C]=(N[C]||0)+1);const _=N.P1>=2||N.P2>=2,H=!!J,W=R.wins.P1>=2?"P1":R.wins.P2>=2?"P2":null;return r.jsx("div",{style:{maxWidth:1150,margin:"10px auto 0"},className:"rb-panel",children:r.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[r.jsxs("div",{style:{minWidth:240},children:[r.jsx("div",{style:{fontWeight:900,fontSize:14},children:"Best of 3 Match"}),r.jsxs("div",{className:"rb-softText",children:["Game ",o,"  Score P1 ",R.wins.P1,"-",R.wins.P2," P2"]}),A.step==="GAME_OVER"?r.jsxs("div",{className:"rb-softText",style:{marginTop:4},children:["Game winner: ",r.jsx("b",{children:C??"Unknown"})]}):null,W?r.jsxs("div",{className:"rb-softText",style:{marginTop:4},children:["Match winner: ",r.jsx("b",{children:W})]}):null]}),A.step==="GAME_OVER"&&!s&&!H?r.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[r.jsx("span",{className:"rb-softText",children:"Next game battlefields:"}),r.jsx("span",{className:"rb-softText",children:"P1"}),r.jsx("select",{value:O.P1??(($=b[0])==null?void 0:$.id)??"",onChange:M=>k(B=>({...B,P1:M.target.value||null})),disabled:b.length===0,children:b.map(M=>r.jsx("option",{value:M.id,children:M.name},M.id))}),r.jsx("span",{className:"rb-softText",children:"P2"}),r.jsx("select",{value:O.P2??((Z=m[0])==null?void 0:Z.id)??"",onChange:M=>k(B=>({...B,P2:M.target.value||null})),disabled:m.length===0,children:m.map(M=>r.jsx("option",{value:M.id,children:M.name},M.id))}),r.jsx("button",{className:"rb-miniButton",onClick:ux,children:_?"Commit result":"Commit result & sideboard"}),h.length===0||p.length===0?r.jsx("span",{className:"rb-softText",style:{opacity:.8},children:"(No unused battlefields left for at least one player; reusing is allowed as a fallback.)"}):null]}):null,A.step==="GAME_OVER"&&!s&&H?r.jsxs("div",{className:"rb-softText",children:["Result committed. Complete sideboarding in the modal to start Game ",R.gamesCompleted+1,"."]}):null,A.step==="GAME_OVER"&&W?r.jsx("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:r.jsx("button",{className:"rb-miniButton",onClick:()=>{var Y,L;I("BO3"),q(null),K(null);const M=Ga("P1"),B=Ga("P2");k({P1:((Y=M[0])==null?void 0:Y.id)??null,P2:((L=B[0])==null?void 0:L.id)??null}),ku("BO3")},children:"Start new BO3 match"})}):null]})})};return r.jsxs("div",{className:"rb-root",children:[r.jsx("style",{children:Jx}),r.jsxs("div",{className:"rb-topbar",children:[r.jsxs("div",{style:{display:"flex",gap:12,alignItems:"baseline",minWidth:0},children:[r.jsx("div",{className:"rb-title",children:"Riftbound Duel Emulator"}),r.jsx("div",{style:{fontSize:12,opacity:.85,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A?`Turn ${A.turnNumber}  Step: ${A.step}  Turn player: ${A.turnPlayer}`:"Load card data to begin"})]}),r.jsxs("div",{className:"rb-topbarControls",children:[r.jsxs("span",{style:{fontSize:12,opacity:.9},children:["UI:",r.jsxs("select",{value:bo,onChange:s=>wu(s.target.value),style:{marginLeft:6},children:[r.jsx("option",{value:"Arena",children:"Arena"}),r.jsx("option",{value:"Classic",children:"Classic"})]})]}),r.jsx("button",{onClick:Pp,disabled:!A,children:"Reset"}),r.jsx("button",{onClick:Bp,disabled:!A,children:Ri?"Hide Hands (hotseat)":"Reveal Hands (hotseat)"}),r.jsx("button",{onClick:jp,disabled:!A,children:xi?"Hide Facedown (hotseat)":"Reveal Facedown (hotseat)"}),r.jsx("button",{onClick:Mp,disabled:!A,children:Ns?"Hide Decks (hotseat)":"Reveal Decks (hotseat)"}),r.jsx("button",{onClick:()=>Cu(!0),disabled:e.length===0,children:"Diagnostics"}),r.jsxs("span",{style:{fontSize:12,opacity:.9},children:["Playing as:",r.jsxs("select",{value:Ye,onChange:s=>Jl(s.target.value),style:{marginLeft:6},children:[r.jsx("option",{value:"P1",children:"P1"}),r.jsx("option",{value:"P2",children:"P2"})]})]}),r.jsxs("span",{style:{fontSize:12,opacity:.9},children:["AI P1:",r.jsxs("select",{value:mt.P1.enabled?mt.P1.difficulty:"HUMAN",onChange:s=>{const o=s.target.value;vs(f=>({...f,P1:o==="HUMAN"?{...f.P1,enabled:!1}:{...f.P1,enabled:!0,difficulty:o}}))},style:{marginLeft:6},children:[r.jsx("option",{value:"HUMAN",children:"Human"}),r.jsx("option",{value:"EASY",children:"Easy"}),r.jsx("option",{value:"MEDIUM",children:"Medium"}),r.jsx("option",{value:"HARD",children:"Hard"}),r.jsx("option",{value:"VERY_HARD",children:"Very Hard"})]})]}),r.jsxs("span",{style:{fontSize:12,opacity:.9},children:["AI P2:",r.jsxs("select",{value:mt.P2.enabled?mt.P2.difficulty:"HUMAN",onChange:s=>{const o=s.target.value;vs(f=>({...f,P2:o==="HUMAN"?{...f.P2,enabled:!1}:{...f.P2,enabled:!0,difficulty:o}}))},style:{marginLeft:6},children:[r.jsx("option",{value:"HUMAN",children:"Human"}),r.jsx("option",{value:"EASY",children:"Easy"}),r.jsx("option",{value:"MEDIUM",children:"Medium"}),r.jsx("option",{value:"HARD",children:"Hard"}),r.jsx("option",{value:"VERY_HARD",children:"Very Hard"})]})]}),r.jsxs("span",{style:{fontSize:12,opacity:.9},children:["AI delay:",r.jsx("input",{type:"number",min:0,max:2500,step:50,value:mt.P2.thinkMs,onChange:s=>{const o=Math.max(0,Math.min(2500,Number(s.target.value)||0));vs(f=>({P1:{...f.P1,thinkMs:o},P2:{...f.P2,thinkMs:o}}))},style:{width:72,marginLeft:6}}),"ms"]}),r.jsx("button",{onClick:()=>Eu(s=>!s),disabled:!A,children:bi?"Resume AI":"Pause AI"})]})]}),b1(),r.jsx("div",{className:"rb-content",children:A?bo==="Arena"?i1():h1():u==="SETUP"?s1():a1()}),l1(),f1(),Vx(),null,Qx(),p1(),y1(),g1(),m1()]})};function fN(){return r.jsx(dN,{})}Ev.createRoot(document.getElementById("root")).render(r.jsx(Xd.StrictMode,{children:r.jsx(fN,{})}));
